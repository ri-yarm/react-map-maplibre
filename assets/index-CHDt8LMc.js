(function(){const Z=document.createElement("link").relList;if(Z&&Z.supports&&Z.supports("modulepreload"))return;for(const me of document.querySelectorAll('link[rel="modulepreload"]'))ae(me);new MutationObserver(me=>{for(const Ie of me)if(Ie.type==="childList")for(const D of Ie.addedNodes)D.tagName==="LINK"&&D.rel==="modulepreload"&&ae(D)}).observe(document,{childList:!0,subtree:!0});function $(me){const Ie={};return me.integrity&&(Ie.integrity=me.integrity),me.referrerPolicy&&(Ie.referrerPolicy=me.referrerPolicy),me.crossOrigin==="use-credentials"?Ie.credentials="include":me.crossOrigin==="anonymous"?Ie.credentials="omit":Ie.credentials="same-origin",Ie}function ae(me){if(me.ep)return;me.ep=!0;const Ie=$(me);fetch(me.href,Ie)}})();function gm(A){return A&&A.__esModule&&Object.prototype.hasOwnProperty.call(A,"default")?A.default:A}var Ip={exports:{}},Yh={},Ep={exports:{}},si={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hf;function _m(){if(hf)return si;hf=1;var A=Symbol.for("react.element"),Z=Symbol.for("react.portal"),$=Symbol.for("react.fragment"),ae=Symbol.for("react.strict_mode"),me=Symbol.for("react.profiler"),Ie=Symbol.for("react.provider"),D=Symbol.for("react.context"),g=Symbol.for("react.forward_ref"),ze=Symbol.for("react.suspense"),nt=Symbol.for("react.memo"),Ze=Symbol.for("react.lazy"),we=Symbol.iterator;function he(fe){return fe===null||typeof fe!="object"?null:(fe=we&&fe[we]||fe["@@iterator"],typeof fe=="function"?fe:null)}var Zt={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},jt=Object.assign,Ft={};function mt(fe,Me,Bt){this.props=fe,this.context=Me,this.refs=Ft,this.updater=Bt||Zt}mt.prototype.isReactComponent={},mt.prototype.setState=function(fe,Me){if(typeof fe!="object"&&typeof fe!="function"&&fe!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,fe,Me,"setState")},mt.prototype.forceUpdate=function(fe){this.updater.enqueueForceUpdate(this,fe,"forceUpdate")};function Yt(){}Yt.prototype=mt.prototype;function _i(fe,Me,Bt){this.props=fe,this.context=Me,this.refs=Ft,this.updater=Bt||Zt}var vt=_i.prototype=new Yt;vt.constructor=_i,jt(vt,mt.prototype),vt.isPureReactComponent=!0;var zt=Array.isArray,At=Object.prototype.hasOwnProperty,Gt={current:null},Wt={key:!0,ref:!0,__self:!0,__source:!0};function yi(fe,Me,Bt){var Ot,qt={},Jt=null,Xt=null;if(Me!=null)for(Ot in Me.ref!==void 0&&(Xt=Me.ref),Me.key!==void 0&&(Jt=""+Me.key),Me)At.call(Me,Ot)&&!Wt.hasOwnProperty(Ot)&&(qt[Ot]=Me[Ot]);var Ht=arguments.length-2;if(Ht===1)qt.children=Bt;else if(1<Ht){for(var vi=Array(Ht),rr=0;rr<Ht;rr++)vi[rr]=arguments[rr+2];qt.children=vi}if(fe&&fe.defaultProps)for(Ot in Ht=fe.defaultProps,Ht)qt[Ot]===void 0&&(qt[Ot]=Ht[Ot]);return{$$typeof:A,type:fe,key:Jt,ref:Xt,props:qt,_owner:Gt.current}}function Ji(fe,Me){return{$$typeof:A,type:fe.type,key:Me,ref:fe.ref,props:fe.props,_owner:fe._owner}}function Vr(fe){return typeof fe=="object"&&fe!==null&&fe.$$typeof===A}function Kt(fe){var Me={"=":"=0",":":"=2"};return"$"+fe.replace(/[=:]/g,function(Bt){return Me[Bt]})}var dn=/\/+/g;function bi(fe,Me){return typeof fe=="object"&&fe!==null&&fe.key!=null?Kt(""+fe.key):Me.toString(36)}function Li(fe,Me,Bt,Ot,qt){var Jt=typeof fe;(Jt==="undefined"||Jt==="boolean")&&(fe=null);var Xt=!1;if(fe===null)Xt=!0;else switch(Jt){case"string":case"number":Xt=!0;break;case"object":switch(fe.$$typeof){case A:case Z:Xt=!0}}if(Xt)return Xt=fe,qt=qt(Xt),fe=Ot===""?"."+bi(Xt,0):Ot,zt(qt)?(Bt="",fe!=null&&(Bt=fe.replace(dn,"$&/")+"/"),Li(qt,Me,Bt,"",function(rr){return rr})):qt!=null&&(Vr(qt)&&(qt=Ji(qt,Bt+(!qt.key||Xt&&Xt.key===qt.key?"":(""+qt.key).replace(dn,"$&/")+"/")+fe)),Me.push(qt)),1;if(Xt=0,Ot=Ot===""?".":Ot+":",zt(fe))for(var Ht=0;Ht<fe.length;Ht++){Jt=fe[Ht];var vi=Ot+bi(Jt,Ht);Xt+=Li(Jt,Me,Bt,vi,qt)}else if(vi=he(fe),typeof vi=="function")for(fe=vi.call(fe),Ht=0;!(Jt=fe.next()).done;)Jt=Jt.value,vi=Ot+bi(Jt,Ht++),Xt+=Li(Jt,Me,Bt,vi,qt);else if(Jt==="object")throw Me=String(fe),Error("Objects are not valid as a React child (found: "+(Me==="[object Object]"?"object with keys {"+Object.keys(fe).join(", ")+"}":Me)+"). If you meant to render a collection of children, use an array instead.");return Xt}function ur(fe,Me,Bt){if(fe==null)return fe;var Ot=[],qt=0;return Li(fe,Ot,"","",function(Jt){return Me.call(Bt,Jt,qt++)}),Ot}function ir(fe){if(fe._status===-1){var Me=fe._result;Me=Me(),Me.then(function(Bt){(fe._status===0||fe._status===-1)&&(fe._status=1,fe._result=Bt)},function(Bt){(fe._status===0||fe._status===-1)&&(fe._status=2,fe._result=Bt)}),fe._status===-1&&(fe._status=0,fe._result=Me)}if(fe._status===1)return fe._result.default;throw fe._result}var hi={current:null},Qe={transition:null},xt={ReactCurrentDispatcher:hi,ReactCurrentBatchConfig:Qe,ReactCurrentOwner:Gt};function tt(){throw Error("act(...) is not supported in production builds of React.")}return si.Children={map:ur,forEach:function(fe,Me,Bt){ur(fe,function(){Me.apply(this,arguments)},Bt)},count:function(fe){var Me=0;return ur(fe,function(){Me++}),Me},toArray:function(fe){return ur(fe,function(Me){return Me})||[]},only:function(fe){if(!Vr(fe))throw Error("React.Children.only expected to receive a single React element child.");return fe}},si.Component=mt,si.Fragment=$,si.Profiler=me,si.PureComponent=_i,si.StrictMode=ae,si.Suspense=ze,si.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=xt,si.act=tt,si.cloneElement=function(fe,Me,Bt){if(fe==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+fe+".");var Ot=jt({},fe.props),qt=fe.key,Jt=fe.ref,Xt=fe._owner;if(Me!=null){if(Me.ref!==void 0&&(Jt=Me.ref,Xt=Gt.current),Me.key!==void 0&&(qt=""+Me.key),fe.type&&fe.type.defaultProps)var Ht=fe.type.defaultProps;for(vi in Me)At.call(Me,vi)&&!Wt.hasOwnProperty(vi)&&(Ot[vi]=Me[vi]===void 0&&Ht!==void 0?Ht[vi]:Me[vi])}var vi=arguments.length-2;if(vi===1)Ot.children=Bt;else if(1<vi){Ht=Array(vi);for(var rr=0;rr<vi;rr++)Ht[rr]=arguments[rr+2];Ot.children=Ht}return{$$typeof:A,type:fe.type,key:qt,ref:Jt,props:Ot,_owner:Xt}},si.createContext=function(fe){return fe={$$typeof:D,_currentValue:fe,_currentValue2:fe,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},fe.Provider={$$typeof:Ie,_context:fe},fe.Consumer=fe},si.createElement=yi,si.createFactory=function(fe){var Me=yi.bind(null,fe);return Me.type=fe,Me},si.createRef=function(){return{current:null}},si.forwardRef=function(fe){return{$$typeof:g,render:fe}},si.isValidElement=Vr,si.lazy=function(fe){return{$$typeof:Ze,_payload:{_status:-1,_result:fe},_init:ir}},si.memo=function(fe,Me){return{$$typeof:nt,type:fe,compare:Me===void 0?null:Me}},si.startTransition=function(fe){var Me=Qe.transition;Qe.transition={};try{fe()}finally{Qe.transition=Me}},si.unstable_act=tt,si.useCallback=function(fe,Me){return hi.current.useCallback(fe,Me)},si.useContext=function(fe){return hi.current.useContext(fe)},si.useDebugValue=function(){},si.useDeferredValue=function(fe){return hi.current.useDeferredValue(fe)},si.useEffect=function(fe,Me){return hi.current.useEffect(fe,Me)},si.useId=function(){return hi.current.useId()},si.useImperativeHandle=function(fe,Me,Bt){return hi.current.useImperativeHandle(fe,Me,Bt)},si.useInsertionEffect=function(fe,Me){return hi.current.useInsertionEffect(fe,Me)},si.useLayoutEffect=function(fe,Me){return hi.current.useLayoutEffect(fe,Me)},si.useMemo=function(fe,Me){return hi.current.useMemo(fe,Me)},si.useReducer=function(fe,Me,Bt){return hi.current.useReducer(fe,Me,Bt)},si.useRef=function(fe){return hi.current.useRef(fe)},si.useState=function(fe){return hi.current.useState(fe)},si.useSyncExternalStore=function(fe,Me,Bt){return hi.current.useSyncExternalStore(fe,Me,Bt)},si.useTransition=function(){return hi.current.useTransition()},si.version="18.3.1",si}var df;function Xd(){return df||(df=1,Ep.exports=_m()),Ep.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pf;function ym(){if(pf)return Yh;pf=1;var A=Xd(),Z=Symbol.for("react.element"),$=Symbol.for("react.fragment"),ae=Object.prototype.hasOwnProperty,me=A.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ie={key:!0,ref:!0,__self:!0,__source:!0};function D(g,ze,nt){var Ze,we={},he=null,Zt=null;nt!==void 0&&(he=""+nt),ze.key!==void 0&&(he=""+ze.key),ze.ref!==void 0&&(Zt=ze.ref);for(Ze in ze)ae.call(ze,Ze)&&!Ie.hasOwnProperty(Ze)&&(we[Ze]=ze[Ze]);if(g&&g.defaultProps)for(Ze in ze=g.defaultProps,ze)we[Ze]===void 0&&(we[Ze]=ze[Ze]);return{$$typeof:Z,type:g,key:he,ref:Zt,props:we,_owner:me.current}}return Yh.Fragment=$,Yh.jsx=D,Yh.jsxs=D,Yh}var ff;function vm(){return ff||(ff=1,Ip.exports=ym()),Ip.exports}var Nr=vm(),jd={},Cp={exports:{}},bs={},Pp={exports:{}},Mp={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mf;function xm(){return mf||(mf=1,function(A){function Z(Qe,xt){var tt=Qe.length;Qe.push(xt);e:for(;0<tt;){var fe=tt-1>>>1,Me=Qe[fe];if(0<me(Me,xt))Qe[fe]=xt,Qe[tt]=Me,tt=fe;else break e}}function $(Qe){return Qe.length===0?null:Qe[0]}function ae(Qe){if(Qe.length===0)return null;var xt=Qe[0],tt=Qe.pop();if(tt!==xt){Qe[0]=tt;e:for(var fe=0,Me=Qe.length,Bt=Me>>>1;fe<Bt;){var Ot=2*(fe+1)-1,qt=Qe[Ot],Jt=Ot+1,Xt=Qe[Jt];if(0>me(qt,tt))Jt<Me&&0>me(Xt,qt)?(Qe[fe]=Xt,Qe[Jt]=tt,fe=Jt):(Qe[fe]=qt,Qe[Ot]=tt,fe=Ot);else if(Jt<Me&&0>me(Xt,tt))Qe[fe]=Xt,Qe[Jt]=tt,fe=Jt;else break e}}return xt}function me(Qe,xt){var tt=Qe.sortIndex-xt.sortIndex;return tt!==0?tt:Qe.id-xt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var Ie=performance;A.unstable_now=function(){return Ie.now()}}else{var D=Date,g=D.now();A.unstable_now=function(){return D.now()-g}}var ze=[],nt=[],Ze=1,we=null,he=3,Zt=!1,jt=!1,Ft=!1,mt=typeof setTimeout=="function"?setTimeout:null,Yt=typeof clearTimeout=="function"?clearTimeout:null,_i=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function vt(Qe){for(var xt=$(nt);xt!==null;){if(xt.callback===null)ae(nt);else if(xt.startTime<=Qe)ae(nt),xt.sortIndex=xt.expirationTime,Z(ze,xt);else break;xt=$(nt)}}function zt(Qe){if(Ft=!1,vt(Qe),!jt)if($(ze)!==null)jt=!0,ir(At);else{var xt=$(nt);xt!==null&&hi(zt,xt.startTime-Qe)}}function At(Qe,xt){jt=!1,Ft&&(Ft=!1,Yt(yi),yi=-1),Zt=!0;var tt=he;try{for(vt(xt),we=$(ze);we!==null&&(!(we.expirationTime>xt)||Qe&&!Kt());){var fe=we.callback;if(typeof fe=="function"){we.callback=null,he=we.priorityLevel;var Me=fe(we.expirationTime<=xt);xt=A.unstable_now(),typeof Me=="function"?we.callback=Me:we===$(ze)&&ae(ze),vt(xt)}else ae(ze);we=$(ze)}if(we!==null)var Bt=!0;else{var Ot=$(nt);Ot!==null&&hi(zt,Ot.startTime-xt),Bt=!1}return Bt}finally{we=null,he=tt,Zt=!1}}var Gt=!1,Wt=null,yi=-1,Ji=5,Vr=-1;function Kt(){return!(A.unstable_now()-Vr<Ji)}function dn(){if(Wt!==null){var Qe=A.unstable_now();Vr=Qe;var xt=!0;try{xt=Wt(!0,Qe)}finally{xt?bi():(Gt=!1,Wt=null)}}else Gt=!1}var bi;if(typeof _i=="function")bi=function(){_i(dn)};else if(typeof MessageChannel<"u"){var Li=new MessageChannel,ur=Li.port2;Li.port1.onmessage=dn,bi=function(){ur.postMessage(null)}}else bi=function(){mt(dn,0)};function ir(Qe){Wt=Qe,Gt||(Gt=!0,bi())}function hi(Qe,xt){yi=mt(function(){Qe(A.unstable_now())},xt)}A.unstable_IdlePriority=5,A.unstable_ImmediatePriority=1,A.unstable_LowPriority=4,A.unstable_NormalPriority=3,A.unstable_Profiling=null,A.unstable_UserBlockingPriority=2,A.unstable_cancelCallback=function(Qe){Qe.callback=null},A.unstable_continueExecution=function(){jt||Zt||(jt=!0,ir(At))},A.unstable_forceFrameRate=function(Qe){0>Qe||125<Qe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ji=0<Qe?Math.floor(1e3/Qe):5},A.unstable_getCurrentPriorityLevel=function(){return he},A.unstable_getFirstCallbackNode=function(){return $(ze)},A.unstable_next=function(Qe){switch(he){case 1:case 2:case 3:var xt=3;break;default:xt=he}var tt=he;he=xt;try{return Qe()}finally{he=tt}},A.unstable_pauseExecution=function(){},A.unstable_requestPaint=function(){},A.unstable_runWithPriority=function(Qe,xt){switch(Qe){case 1:case 2:case 3:case 4:case 5:break;default:Qe=3}var tt=he;he=Qe;try{return xt()}finally{he=tt}},A.unstable_scheduleCallback=function(Qe,xt,tt){var fe=A.unstable_now();switch(typeof tt=="object"&&tt!==null?(tt=tt.delay,tt=typeof tt=="number"&&0<tt?fe+tt:fe):tt=fe,Qe){case 1:var Me=-1;break;case 2:Me=250;break;case 5:Me=1073741823;break;case 4:Me=1e4;break;default:Me=5e3}return Me=tt+Me,Qe={id:Ze++,callback:xt,priorityLevel:Qe,startTime:tt,expirationTime:Me,sortIndex:-1},tt>fe?(Qe.sortIndex=tt,Z(nt,Qe),$(ze)===null&&Qe===$(nt)&&(Ft?(Yt(yi),yi=-1):Ft=!0,hi(zt,tt-fe))):(Qe.sortIndex=Me,Z(ze,Qe),jt||Zt||(jt=!0,ir(At))),Qe},A.unstable_shouldYield=Kt,A.unstable_wrapCallback=function(Qe){var xt=he;return function(){var tt=he;he=xt;try{return Qe.apply(this,arguments)}finally{he=tt}}}}(Mp)),Mp}var gf;function wm(){return gf||(gf=1,Pp.exports=xm()),Pp.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _f;function bm(){if(_f)return bs;_f=1;var A=Xd(),Z=wm();function $(n){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+n,h=1;h<arguments.length;h++)o+="&args[]="+encodeURIComponent(arguments[h]);return"Minified React error #"+n+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var ae=new Set,me={};function Ie(n,o){D(n,o),D(n+"Capture",o)}function D(n,o){for(me[n]=o,n=0;n<o.length;n++)ae.add(o[n])}var g=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ze=Object.prototype.hasOwnProperty,nt=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Ze={},we={};function he(n){return ze.call(we,n)?!0:ze.call(Ze,n)?!1:nt.test(n)?we[n]=!0:(Ze[n]=!0,!1)}function Zt(n,o,h,_){if(h!==null&&h.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return _?!1:h!==null?!h.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function jt(n,o,h,_){if(o===null||typeof o>"u"||Zt(n,o,h,_))return!0;if(_)return!1;if(h!==null)switch(h.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function Ft(n,o,h,_,b,k,O){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=_,this.attributeNamespace=b,this.mustUseProperty=h,this.propertyName=n,this.type=o,this.sanitizeURL=k,this.removeEmptyString=O}var mt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){mt[n]=new Ft(n,0,!1,n,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var o=n[0];mt[o]=new Ft(o,1,!1,n[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(n){mt[n]=new Ft(n,2,!1,n.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){mt[n]=new Ft(n,2,!1,n,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){mt[n]=new Ft(n,3,!1,n.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(n){mt[n]=new Ft(n,3,!0,n,null,!1,!1)}),["capture","download"].forEach(function(n){mt[n]=new Ft(n,4,!1,n,null,!1,!1)}),["cols","rows","size","span"].forEach(function(n){mt[n]=new Ft(n,6,!1,n,null,!1,!1)}),["rowSpan","start"].forEach(function(n){mt[n]=new Ft(n,5,!1,n.toLowerCase(),null,!1,!1)});var Yt=/[\-:]([a-z])/g;function _i(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var o=n.replace(Yt,_i);mt[o]=new Ft(o,1,!1,n,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var o=n.replace(Yt,_i);mt[o]=new Ft(o,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(n){var o=n.replace(Yt,_i);mt[o]=new Ft(o,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(n){mt[n]=new Ft(n,1,!1,n.toLowerCase(),null,!1,!1)}),mt.xlinkHref=new Ft("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(n){mt[n]=new Ft(n,1,!1,n.toLowerCase(),null,!0,!0)});function vt(n,o,h,_){var b=mt.hasOwnProperty(o)?mt[o]:null;(b!==null?b.type!==0:_||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(jt(o,h,b,_)&&(h=null),_||b===null?he(o)&&(h===null?n.removeAttribute(o):n.setAttribute(o,""+h)):b.mustUseProperty?n[b.propertyName]=h===null?b.type===3?!1:"":h:(o=b.attributeName,_=b.attributeNamespace,h===null?n.removeAttribute(o):(b=b.type,h=b===3||b===4&&h===!0?"":""+h,_?n.setAttributeNS(_,o,h):n.setAttribute(o,h))))}var zt=A.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,At=Symbol.for("react.element"),Gt=Symbol.for("react.portal"),Wt=Symbol.for("react.fragment"),yi=Symbol.for("react.strict_mode"),Ji=Symbol.for("react.profiler"),Vr=Symbol.for("react.provider"),Kt=Symbol.for("react.context"),dn=Symbol.for("react.forward_ref"),bi=Symbol.for("react.suspense"),Li=Symbol.for("react.suspense_list"),ur=Symbol.for("react.memo"),ir=Symbol.for("react.lazy"),hi=Symbol.for("react.offscreen"),Qe=Symbol.iterator;function xt(n){return n===null||typeof n!="object"?null:(n=Qe&&n[Qe]||n["@@iterator"],typeof n=="function"?n:null)}var tt=Object.assign,fe;function Me(n){if(fe===void 0)try{throw Error()}catch(h){var o=h.stack.trim().match(/\n( *(at )?)/);fe=o&&o[1]||""}return`
`+fe+n}var Bt=!1;function Ot(n,o){if(!n||Bt)return"";Bt=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(Se){var _=Se}Reflect.construct(n,[],o)}else{try{o.call()}catch(Se){_=Se}n.call(o.prototype)}else{try{throw Error()}catch(Se){_=Se}n()}}catch(Se){if(Se&&_&&typeof Se.stack=="string"){for(var b=Se.stack.split(`
`),k=_.stack.split(`
`),O=b.length-1,Q=k.length-1;1<=O&&0<=Q&&b[O]!==k[Q];)Q--;for(;1<=O&&0<=Q;O--,Q--)if(b[O]!==k[Q]){if(O!==1||Q!==1)do if(O--,Q--,0>Q||b[O]!==k[Q]){var se=`
`+b[O].replace(" at new "," at ");return n.displayName&&se.includes("<anonymous>")&&(se=se.replace("<anonymous>",n.displayName)),se}while(1<=O&&0<=Q);break}}}finally{Bt=!1,Error.prepareStackTrace=h}return(n=n?n.displayName||n.name:"")?Me(n):""}function qt(n){switch(n.tag){case 5:return Me(n.type);case 16:return Me("Lazy");case 13:return Me("Suspense");case 19:return Me("SuspenseList");case 0:case 2:case 15:return n=Ot(n.type,!1),n;case 11:return n=Ot(n.type.render,!1),n;case 1:return n=Ot(n.type,!0),n;default:return""}}function Jt(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Wt:return"Fragment";case Gt:return"Portal";case Ji:return"Profiler";case yi:return"StrictMode";case bi:return"Suspense";case Li:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Kt:return(n.displayName||"Context")+".Consumer";case Vr:return(n._context.displayName||"Context")+".Provider";case dn:var o=n.render;return n=n.displayName,n||(n=o.displayName||o.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case ur:return o=n.displayName||null,o!==null?o:Jt(n.type)||"Memo";case ir:o=n._payload,n=n._init;try{return Jt(n(o))}catch{}}return null}function Xt(n){var o=n.type;switch(n.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=o.render,n=n.displayName||n.name||"",o.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Jt(o);case 8:return o===yi?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function Ht(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function vi(n){var o=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function rr(n){var o=vi(n)?"checked":"value",h=Object.getOwnPropertyDescriptor(n.constructor.prototype,o),_=""+n[o];if(!n.hasOwnProperty(o)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var b=h.get,k=h.set;return Object.defineProperty(n,o,{configurable:!0,get:function(){return b.call(this)},set:function(O){_=""+O,k.call(this,O)}}),Object.defineProperty(n,o,{enumerable:h.enumerable}),{getValue:function(){return _},setValue:function(O){_=""+O},stopTracking:function(){n._valueTracker=null,delete n[o]}}}}function Ys(n){n._valueTracker||(n._valueTracker=rr(n))}function os(n){if(!n)return!1;var o=n._valueTracker;if(!o)return!0;var h=o.getValue(),_="";return n&&(_=vi(n)?n.checked?"true":"false":n.value),n=_,n!==h?(o.setValue(n),!0):!1}function Vn(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function as(n,o){var h=o.checked;return tt({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:h??n._wrapperState.initialChecked})}function So(n,o){var h=o.defaultValue==null?"":o.defaultValue,_=o.checked!=null?o.checked:o.defaultChecked;h=Ht(o.value!=null?o.value:h),n._wrapperState={initialChecked:_,initialValue:h,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function be(n,o){o=o.checked,o!=null&&vt(n,"checked",o,!1)}function Ss(n,o){be(n,o);var h=Ht(o.value),_=o.type;if(h!=null)_==="number"?(h===0&&n.value===""||n.value!=h)&&(n.value=""+h):n.value!==""+h&&(n.value=""+h);else if(_==="submit"||_==="reset"){n.removeAttribute("value");return}o.hasOwnProperty("value")?ei(n,o.type,h):o.hasOwnProperty("defaultValue")&&ei(n,o.type,Ht(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(n.defaultChecked=!!o.defaultChecked)}function oa(n,o,h){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var _=o.type;if(!(_!=="submit"&&_!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+n._wrapperState.initialValue,h||o===n.value||(n.value=o),n.defaultValue=o}h=n.name,h!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,h!==""&&(n.name=h)}function ei(n,o,h){(o!=="number"||Vn(n.ownerDocument)!==n)&&(h==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+h&&(n.defaultValue=""+h))}var Ii=Array.isArray;function ls(n,o,h,_){if(n=n.options,o){o={};for(var b=0;b<h.length;b++)o["$"+h[b]]=!0;for(h=0;h<n.length;h++)b=o.hasOwnProperty("$"+n[h].value),n[h].selected!==b&&(n[h].selected=b),b&&_&&(n[h].defaultSelected=!0)}else{for(h=""+Ht(h),o=null,b=0;b<n.length;b++){if(n[b].value===h){n[b].selected=!0,_&&(n[b].defaultSelected=!0);return}o!==null||n[b].disabled||(o=n[b])}o!==null&&(o.selected=!0)}}function us(n,o){if(o.dangerouslySetInnerHTML!=null)throw Error($(91));return tt({},o,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function cs(n,o){var h=o.value;if(h==null){if(h=o.children,o=o.defaultValue,h!=null){if(o!=null)throw Error($(92));if(Ii(h)){if(1<h.length)throw Error($(93));h=h[0]}o=h}o==null&&(o=""),h=o}n._wrapperState={initialValue:Ht(h)}}function To(n,o){var h=Ht(o.value),_=Ht(o.defaultValue);h!=null&&(h=""+h,h!==n.value&&(n.value=h),o.defaultValue==null&&n.defaultValue!==h&&(n.defaultValue=h)),_!=null&&(n.defaultValue=""+_)}function pn(n){var o=n.textContent;o===n._wrapperState.initialValue&&o!==""&&o!==null&&(n.value=o)}function aa(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ko(n,o){return n==null||n==="http://www.w3.org/1999/xhtml"?aa(o):n==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Fe,jn=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,h,_,b){MSApp.execUnsafeLocalFunction(function(){return n(o,h,_,b)})}:n}(function(n,o){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=o;else{for(Fe=Fe||document.createElement("div"),Fe.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=Fe.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;o.firstChild;)n.appendChild(o.firstChild)}});function nr(n,o){if(o){var h=n.firstChild;if(h&&h===n.lastChild&&h.nodeType===3){h.nodeValue=o;return}}n.textContent=o}var Jr={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Qs=["Webkit","ms","Moz","O"];Object.keys(Jr).forEach(function(n){Qs.forEach(function(o){o=o+n.charAt(0).toUpperCase()+n.substring(1),Jr[o]=Jr[n]})});function Ue(n,o,h){return o==null||typeof o=="boolean"||o===""?"":h||typeof o!="number"||o===0||Jr.hasOwnProperty(n)&&Jr[n]?(""+o).trim():o+"px"}function Nt(n,o){n=n.style;for(var h in o)if(o.hasOwnProperty(h)){var _=h.indexOf("--")===0,b=Ue(h,o[h],_);h==="float"&&(h="cssFloat"),_?n.setProperty(h,b):n[h]=b}}var wt=tt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Er(n,o){if(o){if(wt[n]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error($(137,n));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error($(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error($(61))}if(o.style!=null&&typeof o.style!="object")throw Error($(62))}}function fn(n,o){if(n.indexOf("-")===-1)return typeof o.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var kt=null;function In(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Un=null,mn=null,jr=null;function J(n){if(n=el(n)){if(typeof Un!="function")throw Error($(280));var o=n.stateNode;o&&(o=Sa(o),Un(n.stateNode,n.type,o))}}function R(n){mn?jr?jr.push(n):jr=[n]:mn=n}function L(){if(mn){var n=mn,o=jr;if(jr=mn=null,J(n),o)for(n=0;n<o.length;n++)J(o[n])}}function V(n,o){return n(o)}function W(){}var re=!1;function le(n,o,h){if(re)return n(o,h);re=!0;try{return V(n,o,h)}finally{re=!1,(mn!==null||jr!==null)&&(W(),L())}}function pe(n,o){var h=n.stateNode;if(h===null)return null;var _=Sa(h);if(_===null)return null;h=_[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(_=!_.disabled)||(n=n.type,_=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!_;break e;default:n=!1}if(n)return null;if(h&&typeof h!="function")throw Error($(231,o,typeof h));return h}var te=!1;if(g)try{var Te={};Object.defineProperty(Te,"passive",{get:function(){te=!0}}),window.addEventListener("test",Te,Te),window.removeEventListener("test",Te,Te)}catch{te=!1}function Pe(n,o,h,_,b,k,O,Q,se){var Se=Array.prototype.slice.call(arguments,3);try{o.apply(h,Se)}catch(Re){this.onError(Re)}}var ve=!1,Ne=null,ot=!1,pt=null,ti={onError:function(n){ve=!0,Ne=n}};function Ct(n,o,h,_,b,k,O,Q,se){ve=!1,Ne=null,Pe.apply(ti,arguments)}function ii(n,o,h,_,b,k,O,Q,se){if(Ct.apply(this,arguments),ve){if(ve){var Se=Ne;ve=!1,Ne=null}else throw Error($(198));ot||(ot=!0,pt=Se)}}function Rt(n){var o=n,h=n;if(n.alternate)for(;o.return;)o=o.return;else{n=o;do o=n,o.flags&4098&&(h=o.return),n=o.return;while(n)}return o.tag===3?h:null}function qi(n){if(n.tag===13){var o=n.memoizedState;if(o===null&&(n=n.alternate,n!==null&&(o=n.memoizedState)),o!==null)return o.dehydrated}return null}function Bi(n){if(Rt(n)!==n)throw Error($(188))}function Ut(n){var o=n.alternate;if(!o){if(o=Rt(n),o===null)throw Error($(188));return o!==n?null:n}for(var h=n,_=o;;){var b=h.return;if(b===null)break;var k=b.alternate;if(k===null){if(_=b.return,_!==null){h=_;continue}break}if(b.child===k.child){for(k=b.child;k;){if(k===h)return Bi(b),n;if(k===_)return Bi(b),o;k=k.sibling}throw Error($(188))}if(h.return!==_.return)h=b,_=k;else{for(var O=!1,Q=b.child;Q;){if(Q===h){O=!0,h=b,_=k;break}if(Q===_){O=!0,_=b,h=k;break}Q=Q.sibling}if(!O){for(Q=k.child;Q;){if(Q===h){O=!0,h=k,_=b;break}if(Q===_){O=!0,_=k,h=b;break}Q=Q.sibling}if(!O)throw Error($(189))}}if(h.alternate!==_)throw Error($(190))}if(h.tag!==3)throw Error($(188));return h.stateNode.current===h?n:o}function di(n){return n=Ut(n),n!==null?Pi(n):null}function Pi(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var o=Pi(n);if(o!==null)return o;n=n.sibling}return null}var sr=Z.unstable_scheduleCallback,cr=Z.unstable_cancelCallback,Ur=Z.unstable_shouldYield,la=Z.unstable_requestPaint,It=Z.unstable_now,hu=Z.unstable_getCurrentPriorityLevel,Fa=Z.unstable_ImmediatePriority,Yr=Z.unstable_UserBlockingPriority,Cr=Z.unstable_NormalPriority,rh=Z.unstable_LowPriority,gn=Z.unstable_IdlePriority,Pr=null,$r=null;function Io(n){if($r&&typeof $r.onCommitFiberRoot=="function")try{$r.onCommitFiberRoot(Pr,n,void 0,(n.current.flags&128)===128)}catch{}}var xi=Math.clz32?Math.clz32:Zi,Ba=Math.log,$n=Math.LN2;function Zi(n){return n>>>=0,n===0?32:31-(Ba(n)/$n|0)|0}var Eo=64,Qr=4194304;function Co(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function en(n,o){var h=n.pendingLanes;if(h===0)return 0;var _=0,b=n.suspendedLanes,k=n.pingedLanes,O=h&268435455;if(O!==0){var Q=O&~b;Q!==0?_=Co(Q):(k&=O,k!==0&&(_=Co(k)))}else O=h&~b,O!==0?_=Co(O):k!==0&&(_=Co(k));if(_===0)return 0;if(o!==0&&o!==_&&!(o&b)&&(b=_&-_,k=o&-o,b>=k||b===16&&(k&4194240)!==0))return o;if(_&4&&(_|=h&16),o=n.entangledLanes,o!==0)for(n=n.entanglements,o&=_;0<o;)h=31-xi(o),b=1<<h,_|=n[h],o&=~b;return _}function nh(n,o){switch(n){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wl(n,o){for(var h=n.suspendedLanes,_=n.pingedLanes,b=n.expirationTimes,k=n.pendingLanes;0<k;){var O=31-xi(k),Q=1<<O,se=b[O];se===-1?(!(Q&h)||Q&_)&&(b[O]=nh(Q,o)):se<=o&&(n.expiredLanes|=Q),k&=~Q}}function Ts(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function ks(){var n=Eo;return Eo<<=1,!(Eo&4194240)&&(Eo=64),n}function ri(n){for(var o=[],h=0;31>h;h++)o.push(n);return o}function Po(n,o,h){n.pendingLanes|=o,o!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,o=31-xi(o),n[o]=h}function du(n,o){var h=n.pendingLanes&~o;n.pendingLanes=o,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=o,n.mutableReadLanes&=o,n.entangledLanes&=o,o=n.entanglements;var _=n.eventTimes;for(n=n.expirationTimes;0<h;){var b=31-xi(h),k=1<<b;o[b]=0,_[b]=-1,n[b]=-1,h&=~k}}function eo(n,o){var h=n.entangledLanes|=o;for(n=n.entanglements;h;){var _=31-xi(h),b=1<<_;b&o|n[_]&o&&(n[_]|=o),h&=~b}}var pi=0;function Oa(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var ua,ca,Mo,pu,hc,bl=!1,Sl=[],tn=null,En=null,Gi=null,hr=new Map,to=new Map,qn=[],Tl="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function fu(n,o){switch(n){case"focusin":case"focusout":tn=null;break;case"dragenter":case"dragleave":En=null;break;case"mouseover":case"mouseout":Gi=null;break;case"pointerover":case"pointerout":hr.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":to.delete(o.pointerId)}}function hs(n,o,h,_,b,k){return n===null||n.nativeEvent!==k?(n={blockedOn:o,domEventName:h,eventSystemFlags:_,nativeEvent:k,targetContainers:[b]},o!==null&&(o=el(o),o!==null&&ca(o)),n):(n.eventSystemFlags|=_,o=n.targetContainers,b!==null&&o.indexOf(b)===-1&&o.push(b),n)}function sh(n,o,h,_,b){switch(o){case"focusin":return tn=hs(tn,n,o,h,_,b),!0;case"dragenter":return En=hs(En,n,o,h,_,b),!0;case"mouseover":return Gi=hs(Gi,n,o,h,_,b),!0;case"pointerover":var k=b.pointerId;return hr.set(k,hs(hr.get(k)||null,n,o,h,_,b)),!0;case"gotpointercapture":return k=b.pointerId,to.set(k,hs(to.get(k)||null,n,o,h,_,b)),!0}return!1}function mu(n){var o=Go(n.target);if(o!==null){var h=Rt(o);if(h!==null){if(o=h.tag,o===13){if(o=qi(h),o!==null){n.blockedOn=o,hc(n.priority,function(){Mo(h)});return}}else if(o===3&&h.stateNode.current.memoizedState.isDehydrated){n.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Na(n){if(n.blockedOn!==null)return!1;for(var o=n.targetContainers;0<o.length;){var h=Va(n.domEventName,n.eventSystemFlags,o[0],n.nativeEvent);if(h===null){h=n.nativeEvent;var _=new h.constructor(h.type,h);kt=_,h.target.dispatchEvent(_),kt=null}else return o=el(h),o!==null&&ca(o),n.blockedOn=h,!1;o.shift()}return!0}function dc(n,o,h){Na(n)&&h.delete(o)}function oh(){bl=!1,tn!==null&&Na(tn)&&(tn=null),En!==null&&Na(En)&&(En=null),Gi!==null&&Na(Gi)&&(Gi=null),hr.forEach(dc),to.forEach(dc)}function ha(n,o){n.blockedOn===o&&(n.blockedOn=null,bl||(bl=!0,Z.unstable_scheduleCallback(Z.unstable_NormalPriority,oh)))}function Is(n){function o(b){return ha(b,n)}if(0<Sl.length){ha(Sl[0],n);for(var h=1;h<Sl.length;h++){var _=Sl[h];_.blockedOn===n&&(_.blockedOn=null)}}for(tn!==null&&ha(tn,n),En!==null&&ha(En,n),Gi!==null&&ha(Gi,n),hr.forEach(o),to.forEach(o),h=0;h<qn.length;h++)_=qn[h],_.blockedOn===n&&(_.blockedOn=null);for(;0<qn.length&&(h=qn[0],h.blockedOn===null);)mu(h),h.blockedOn===null&&qn.shift()}var io=zt.ReactCurrentBatchConfig,zo=!0;function gu(n,o,h,_){var b=pi,k=io.transition;io.transition=null;try{pi=1,Cn(n,o,h,_)}finally{pi=b,io.transition=k}}function _u(n,o,h,_){var b=pi,k=io.transition;io.transition=null;try{pi=4,Cn(n,o,h,_)}finally{pi=b,io.transition=k}}function Cn(n,o,h,_){if(zo){var b=Va(n,o,h,_);if(b===null)Ya(n,o,_,kl,h),fu(n,_);else if(sh(b,n,o,h,_))_.stopPropagation();else if(fu(n,_),o&4&&-1<Tl.indexOf(n)){for(;b!==null;){var k=el(b);if(k!==null&&ua(k),k=Va(n,o,h,_),k===null&&Ya(n,o,_,kl,h),k===b)break;b=k}b!==null&&_.stopPropagation()}else Ya(n,o,_,null,h)}}var kl=null;function Va(n,o,h,_){if(kl=null,n=In(_),n=Go(n),n!==null)if(o=Rt(n),o===null)n=null;else if(h=o.tag,h===13){if(n=qi(o),n!==null)return n;n=null}else if(h===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;n=null}else o!==n&&(n=null);return kl=n,null}function ro(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(hu()){case Fa:return 1;case Yr:return 4;case Cr:case rh:return 16;case gn:return 536870912;default:return 16}default:return 16}}var qr=null,ni=null,Ao=null;function pc(){if(Ao)return Ao;var n,o=ni,h=o.length,_,b="value"in qr?qr.value:qr.textContent,k=b.length;for(n=0;n<h&&o[n]===b[n];n++);var O=h-n;for(_=1;_<=O&&o[h-_]===b[k-_];_++);return Ao=b.slice(n,1<_?1-_:void 0)}function Es(n){var o=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&o===13&&(n=13)):n=o,n===10&&(n=13),32<=n||n===13?n:0}function Il(){return!0}function yu(){return!1}function _n(n){function o(h,_,b,k,O){this._reactName=h,this._targetInst=b,this.type=_,this.nativeEvent=k,this.target=O,this.currentTarget=null;for(var Q in n)n.hasOwnProperty(Q)&&(h=n[Q],this[Q]=h?h(k):k[Q]);return this.isDefaultPrevented=(k.defaultPrevented!=null?k.defaultPrevented:k.returnValue===!1)?Il:yu,this.isPropagationStopped=yu,this}return tt(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=Il)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=Il)},persist:function(){},isPersistent:Il}),o}var Do={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ja=_n(Do),da=tt({},Do,{view:0,detail:0}),fc=_n(da),El,Cl,Zn,Ua=tt({},da,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:qa,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Zn&&(Zn&&n.type==="mousemove"?(El=n.screenX-Zn.screenX,Cl=n.screenY-Zn.screenY):Cl=El=0,Zn=n),El)},movementY:function(n){return"movementY"in n?n.movementY:Cl}}),mc=_n(Ua),gc=tt({},Ua,{dataTransfer:0}),$a=_n(gc),Pl=tt({},da,{relatedTarget:0}),vu=_n(Pl),ah=tt({},Do,{animationName:0,elapsedTime:0,pseudoElement:0}),_c=_n(ah),yc=tt({},Do,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),vc=_n(yc),xu=tt({},Do,{data:0}),wu=_n(xu),Ml={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Cs={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},bu={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Su(n){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(n):(n=bu[n])?!!o[n]:!1}function qa(){return Su}var xc=tt({},da,{key:function(n){if(n.key){var o=Ml[n.key]||n.key;if(o!=="Unidentified")return o}return n.type==="keypress"?(n=Es(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Cs[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:qa,charCode:function(n){return n.type==="keypress"?Es(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Es(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Za=_n(xc),Lo=tt({},Ua,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),zl=_n(Lo),lh=tt({},da,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:qa}),uh=_n(lh),Ui=tt({},Do,{propertyName:0,elapsedTime:0,pseudoElement:0}),ch=_n(Ui),$t=tt({},Ua,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Tu=_n($t),Si=[9,13,27,32],oi=g&&"CompositionEvent"in window,Gn=null;g&&"documentMode"in document&&(Gn=document.documentMode);var Ga=g&&"TextEvent"in window&&!Gn,Ha=g&&(!oi||Gn&&8<Gn&&11>=Gn),no=" ",Ro=!1;function yn(n,o){switch(n){case"keyup":return Si.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ku(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var so=!1;function Al(n,o){switch(n){case"compositionend":return ku(o);case"keypress":return o.which!==32?null:(Ro=!0,no);case"textInput":return n=o.data,n===no&&Ro?null:n;default:return null}}function Fo(n,o){if(so)return n==="compositionend"||!oi&&yn(n,o)?(n=pc(),Ao=ni=qr=null,so=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return Ha&&o.locale!=="ko"?null:o.data;default:return null}}var Dl={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pa(n){var o=n&&n.nodeName&&n.nodeName.toLowerCase();return o==="input"?!!Dl[n.type]:o==="textarea"}function Bo(n,o,h,_){R(_),o=ba(o,"onChange"),0<o.length&&(h=new ja("onChange","change",null,h,_),n.push({event:h,listeners:o}))}var Ps=null,Oo=null;function oo(n){Nl(n,0)}function Ms(n){var o=zn(n);if(os(o))return n}function wc(n,o){if(n==="change")return o}var Ll=!1;if(g){var Qt;if(g){var fa="oninput"in document;if(!fa){var bc=document.createElement("div");bc.setAttribute("oninput","return;"),fa=typeof bc.oninput=="function"}Qt=fa}else Qt=!1;Ll=Qt&&(!document.documentMode||9<document.documentMode)}function Iu(){Ps&&(Ps.detachEvent("onpropertychange",ma),Oo=Ps=null)}function ma(n){if(n.propertyName==="value"&&Ms(Oo)){var o=[];Bo(o,Oo,n,In(n)),le(oo,o)}}function Sc(n,o,h){n==="focusin"?(Iu(),Ps=o,Oo=h,Ps.attachEvent("onpropertychange",ma)):n==="focusout"&&Iu()}function Tc(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Ms(Oo)}function Wa(n,o){if(n==="click")return Ms(o)}function hh(n,o){if(n==="input"||n==="change")return Ms(o)}function Rl(n,o){return n===o&&(n!==0||1/n===1/o)||n!==n&&o!==o}var Zr=typeof Object.is=="function"?Object.is:Rl;function ao(n,o){if(Zr(n,o))return!0;if(typeof n!="object"||n===null||typeof o!="object"||o===null)return!1;var h=Object.keys(n),_=Object.keys(o);if(h.length!==_.length)return!1;for(_=0;_<h.length;_++){var b=h[_];if(!ze.call(o,b)||!Zr(n[b],o[b]))return!1}return!0}function ga(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function No(n,o){var h=ga(n);n=0;for(var _;h;){if(h.nodeType===3){if(_=n+h.textContent.length,n<=o&&_>=o)return{node:h,offset:o-n};n=_}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=ga(h)}}function _a(n,o){return n&&o?n===o?!0:n&&n.nodeType===3?!1:o&&o.nodeType===3?_a(n,o.parentNode):"contains"in n?n.contains(o):n.compareDocumentPosition?!!(n.compareDocumentPosition(o)&16):!1:!1}function ya(){for(var n=window,o=Vn();o instanceof n.HTMLIFrameElement;){try{var h=typeof o.contentWindow.location.href=="string"}catch{h=!1}if(h)n=o.contentWindow;else break;o=Vn(n.document)}return o}function lo(n){var o=n&&n.nodeName&&n.nodeName.toLowerCase();return o&&(o==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||o==="textarea"||n.contentEditable==="true")}function Fl(n){var o=ya(),h=n.focusedElem,_=n.selectionRange;if(o!==h&&h&&h.ownerDocument&&_a(h.ownerDocument.documentElement,h)){if(_!==null&&lo(h)){if(o=_.start,n=_.end,n===void 0&&(n=o),"selectionStart"in h)h.selectionStart=o,h.selectionEnd=Math.min(n,h.value.length);else if(n=(o=h.ownerDocument||document)&&o.defaultView||window,n.getSelection){n=n.getSelection();var b=h.textContent.length,k=Math.min(_.start,b);_=_.end===void 0?k:Math.min(_.end,b),!n.extend&&k>_&&(b=_,_=k,k=b),b=No(h,k);var O=No(h,_);b&&O&&(n.rangeCount!==1||n.anchorNode!==b.node||n.anchorOffset!==b.offset||n.focusNode!==O.node||n.focusOffset!==O.offset)&&(o=o.createRange(),o.setStart(b.node,b.offset),n.removeAllRanges(),k>_?(n.addRange(o),n.extend(O.node,O.offset)):(o.setEnd(O.node,O.offset),n.addRange(o)))}}for(o=[],n=h;n=n.parentNode;)n.nodeType===1&&o.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof h.focus=="function"&&h.focus(),h=0;h<o.length;h++)n=o[h],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var kc=g&&"documentMode"in document&&11>=document.documentMode,Hn=null,Eu=null,va=null,xa=!1;function Bl(n,o,h){var _=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;xa||Hn==null||Hn!==Vn(_)||(_=Hn,"selectionStart"in _&&lo(_)?_={start:_.selectionStart,end:_.selectionEnd}:(_=(_.ownerDocument&&_.ownerDocument.defaultView||window).getSelection(),_={anchorNode:_.anchorNode,anchorOffset:_.anchorOffset,focusNode:_.focusNode,focusOffset:_.focusOffset}),va&&ao(va,_)||(va=_,_=ba(Eu,"onSelect"),0<_.length&&(o=new ja("onSelect","select",null,o,h),n.push({event:o,listeners:_}),o.target=Hn)))}function Xa(n,o){var h={};return h[n.toLowerCase()]=o.toLowerCase(),h["Webkit"+n]="webkit"+o,h["Moz"+n]="moz"+o,h}var ds={animationend:Xa("Animation","AnimationEnd"),animationiteration:Xa("Animation","AnimationIteration"),animationstart:Xa("Animation","AnimationStart"),transitionend:Xa("Transition","TransitionEnd")},zs={},Mr={};g&&(Mr=document.createElement("div").style,"AnimationEvent"in window||(delete ds.animationend.animation,delete ds.animationiteration.animation,delete ds.animationstart.animation),"TransitionEvent"in window||delete ds.transitionend.transition);function uo(n){if(zs[n])return zs[n];if(!ds[n])return n;var o=ds[n],h;for(h in o)if(o.hasOwnProperty(h)&&h in Mr)return zs[n]=o[h];return n}var Ol=uo("animationend"),Vi=uo("animationiteration"),co=uo("animationstart"),_r=uo("transitionend"),Ka=new Map,wa="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function As(n,o){Ka.set(n,o),Ie(o,[n])}for(var ps=0;ps<wa.length;ps++){var Vo=wa[ps],jo=Vo.toLowerCase(),Ic=Vo[0].toUpperCase()+Vo.slice(1);As(jo,"on"+Ic)}As(Ol,"onAnimationEnd"),As(Vi,"onAnimationIteration"),As(co,"onAnimationStart"),As("dblclick","onDoubleClick"),As("focusin","onFocus"),As("focusout","onBlur"),As(_r,"onTransitionEnd"),D("onMouseEnter",["mouseout","mouseover"]),D("onMouseLeave",["mouseout","mouseover"]),D("onPointerEnter",["pointerout","pointerover"]),D("onPointerLeave",["pointerout","pointerover"]),Ie("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ie("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ie("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ie("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ie("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ie("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ho="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Cu=new Set("cancel close invalid load scroll toggle".split(" ").concat(ho));function Ja(n,o,h){var _=n.type||"unknown-event";n.currentTarget=h,ii(_,o,void 0,n),n.currentTarget=null}function Nl(n,o){o=(o&4)!==0;for(var h=0;h<n.length;h++){var _=n[h],b=_.event;_=_.listeners;e:{var k=void 0;if(o)for(var O=_.length-1;0<=O;O--){var Q=_[O],se=Q.instance,Se=Q.currentTarget;if(Q=Q.listener,se!==k&&b.isPropagationStopped())break e;Ja(b,Q,Se),k=se}else for(O=0;O<_.length;O++){if(Q=_[O],se=Q.instance,Se=Q.currentTarget,Q=Q.listener,se!==k&&b.isPropagationStopped())break e;Ja(b,Q,Se),k=se}}}if(ot)throw n=pt,ot=!1,pt=null,n}function li(n,o){var h=o[Qa];h===void 0&&(h=o[Qa]=new Set);var _=n+"__bubble";h.has(_)||(jl(o,n,2,!1),h.add(_))}function Vl(n,o,h){var _=0;o&&(_|=4),jl(h,n,_,o)}var Uo="_reactListening"+Math.random().toString(36).slice(2);function Ds(n){if(!n[Uo]){n[Uo]=!0,ae.forEach(function(h){h!=="selectionchange"&&(Cu.has(h)||Vl(h,!1,n),Vl(h,!0,n))});var o=n.nodeType===9?n:n.ownerDocument;o===null||o[Uo]||(o[Uo]=!0,Vl("selectionchange",!1,o))}}function jl(n,o,h,_){switch(ro(o)){case 1:var b=gu;break;case 4:b=_u;break;default:b=Cn}h=b.bind(null,o,h,n),b=void 0,!te||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(b=!0),_?b!==void 0?n.addEventListener(o,h,{capture:!0,passive:b}):n.addEventListener(o,h,!0):b!==void 0?n.addEventListener(o,h,{passive:b}):n.addEventListener(o,h,!1)}function Ya(n,o,h,_,b){var k=_;if(!(o&1)&&!(o&2)&&_!==null)e:for(;;){if(_===null)return;var O=_.tag;if(O===3||O===4){var Q=_.stateNode.containerInfo;if(Q===b||Q.nodeType===8&&Q.parentNode===b)break;if(O===4)for(O=_.return;O!==null;){var se=O.tag;if((se===3||se===4)&&(se=O.stateNode.containerInfo,se===b||se.nodeType===8&&se.parentNode===b))return;O=O.return}for(;Q!==null;){if(O=Go(Q),O===null)return;if(se=O.tag,se===5||se===6){_=k=O;continue e}Q=Q.parentNode}}_=_.return}le(function(){var Se=k,Re=In(h),Be=[];e:{var De=Ka.get(n);if(De!==void 0){var Xe=ja,lt=n;switch(n){case"keypress":if(Es(h)===0)break e;case"keydown":case"keyup":Xe=Za;break;case"focusin":lt="focus",Xe=vu;break;case"focusout":lt="blur",Xe=vu;break;case"beforeblur":case"afterblur":Xe=vu;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Xe=mc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Xe=$a;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Xe=uh;break;case Ol:case Vi:case co:Xe=_c;break;case _r:Xe=ch;break;case"scroll":Xe=fc;break;case"wheel":Xe=Tu;break;case"copy":case"cut":case"paste":Xe=vc;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Xe=zl}var ft=(o&4)!==0,er=!ft&&n==="scroll",ye=ft?De!==null?De+"Capture":null:De;ft=[];for(var ue=Se,xe;ue!==null;){xe=ue;var qe=xe.stateNode;if(xe.tag===5&&qe!==null&&(xe=qe,ye!==null&&(qe=pe(ue,ye),qe!=null&&ft.push($o(ue,qe,xe)))),er)break;ue=ue.return}0<ft.length&&(De=new Xe(De,lt,null,h,Re),Be.push({event:De,listeners:ft}))}}if(!(o&7)){e:{if(De=n==="mouseover"||n==="pointerover",Xe=n==="mouseout"||n==="pointerout",De&&h!==kt&&(lt=h.relatedTarget||h.fromElement)&&(Go(lt)||lt[Pt]))break e;if((Xe||De)&&(De=Re.window===Re?Re:(De=Re.ownerDocument)?De.defaultView||De.parentWindow:window,Xe?(lt=h.relatedTarget||h.toElement,Xe=Se,lt=lt?Go(lt):null,lt!==null&&(er=Rt(lt),lt!==er||lt.tag!==5&&lt.tag!==6)&&(lt=null)):(Xe=null,lt=Se),Xe!==lt)){if(ft=mc,qe="onMouseLeave",ye="onMouseEnter",ue="mouse",(n==="pointerout"||n==="pointerover")&&(ft=zl,qe="onPointerLeave",ye="onPointerEnter",ue="pointer"),er=Xe==null?De:zn(Xe),xe=lt==null?De:zn(lt),De=new ft(qe,ue+"leave",Xe,h,Re),De.target=er,De.relatedTarget=xe,qe=null,Go(Re)===Se&&(ft=new ft(ye,ue+"enter",lt,h,Re),ft.target=xe,ft.relatedTarget=er,qe=ft),er=qe,Xe&&lt)t:{for(ft=Xe,ye=lt,ue=0,xe=ft;xe;xe=Pn(xe))ue++;for(xe=0,qe=ye;qe;qe=Pn(qe))xe++;for(;0<ue-xe;)ft=Pn(ft),ue--;for(;0<xe-ue;)ye=Pn(ye),xe--;for(;ue--;){if(ft===ye||ye!==null&&ft===ye.alternate)break t;ft=Pn(ft),ye=Pn(ye)}ft=null}else ft=null;Xe!==null&&Ul(Be,De,Xe,ft,!1),lt!==null&&er!==null&&Ul(Be,er,lt,ft,!0)}}e:{if(De=Se?zn(Se):window,Xe=De.nodeName&&De.nodeName.toLowerCase(),Xe==="select"||Xe==="input"&&De.type==="file")var gt=wc;else if(pa(De))if(Ll)gt=hh;else{gt=Tc;var Tt=Sc}else(Xe=De.nodeName)&&Xe.toLowerCase()==="input"&&(De.type==="checkbox"||De.type==="radio")&&(gt=Wa);if(gt&&(gt=gt(n,Se))){Bo(Be,gt,h,Re);break e}Tt&&Tt(n,De,Se),n==="focusout"&&(Tt=De._wrapperState)&&Tt.controlled&&De.type==="number"&&ei(De,"number",De.value)}switch(Tt=Se?zn(Se):window,n){case"focusin":(pa(Tt)||Tt.contentEditable==="true")&&(Hn=Tt,Eu=Se,va=null);break;case"focusout":va=Eu=Hn=null;break;case"mousedown":xa=!0;break;case"contextmenu":case"mouseup":case"dragend":xa=!1,Bl(Be,h,Re);break;case"selectionchange":if(kc)break;case"keydown":case"keyup":Bl(Be,h,Re)}var _t;if(oi)e:{switch(n){case"compositionstart":var Lt="onCompositionStart";break e;case"compositionend":Lt="onCompositionEnd";break e;case"compositionupdate":Lt="onCompositionUpdate";break e}Lt=void 0}else so?yn(n,h)&&(Lt="onCompositionEnd"):n==="keydown"&&h.keyCode===229&&(Lt="onCompositionStart");Lt&&(Ha&&h.locale!=="ko"&&(so||Lt!=="onCompositionStart"?Lt==="onCompositionEnd"&&so&&(_t=pc()):(qr=Re,ni="value"in qr?qr.value:qr.textContent,so=!0)),Tt=ba(Se,Lt),0<Tt.length&&(Lt=new wu(Lt,n,null,h,Re),Be.push({event:Lt,listeners:Tt}),_t?Lt.data=_t:(_t=ku(h),_t!==null&&(Lt.data=_t)))),(_t=Ga?Al(n,h):Fo(n,h))&&(Se=ba(Se,"onBeforeInput"),0<Se.length&&(Re=new wu("onBeforeInput","beforeinput",null,h,Re),Be.push({event:Re,listeners:Se}),Re.data=_t))}Nl(Be,o)})}function $o(n,o,h){return{instance:n,listener:o,currentTarget:h}}function ba(n,o){for(var h=o+"Capture",_=[];n!==null;){var b=n,k=b.stateNode;b.tag===5&&k!==null&&(b=k,k=pe(n,h),k!=null&&_.unshift($o(n,k,b)),k=pe(n,o),k!=null&&_.push($o(n,k,b))),n=n.return}return _}function Pn(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Ul(n,o,h,_,b){for(var k=o._reactName,O=[];h!==null&&h!==_;){var Q=h,se=Q.alternate,Se=Q.stateNode;if(se!==null&&se===_)break;Q.tag===5&&Se!==null&&(Q=Se,b?(se=pe(h,k),se!=null&&O.unshift($o(h,se,Q))):b||(se=pe(h,k),se!=null&&O.push($o(h,se,Q)))),h=h.return}O.length!==0&&n.push({event:o,listeners:O})}var Wn=/\r\n?/g,Xn=/\u0000|\uFFFD/g;function Pu(n){return(typeof n=="string"?n:""+n).replace(Wn,`
`).replace(Xn,"")}function rn(n,o,h){if(o=Pu(o),Pu(n)!==o&&h)throw Error($(425))}function fs(){}var $l=null,Mu=null;function zu(n,o){return n==="textarea"||n==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var ql=typeof setTimeout=="function"?setTimeout:void 0,Au=typeof clearTimeout=="function"?clearTimeout:void 0,qo=typeof Promise=="function"?Promise:void 0,ms=typeof queueMicrotask=="function"?queueMicrotask:typeof qo<"u"?function(n){return qo.resolve(null).then(n).catch(Je)}:ql;function Je(n){setTimeout(function(){throw n})}function Zl(n,o){var h=o,_=0;do{var b=h.nextSibling;if(n.removeChild(h),b&&b.nodeType===8)if(h=b.data,h==="/$"){if(_===0){n.removeChild(b),Is(o);return}_--}else h!=="$"&&h!=="$?"&&h!=="$!"||_++;h=b}while(h);Is(o)}function Mn(n){for(;n!=null;n=n.nextSibling){var o=n.nodeType;if(o===1||o===3)break;if(o===8){if(o=n.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return n}function Du(n){n=n.previousSibling;for(var o=0;n;){if(n.nodeType===8){var h=n.data;if(h==="$"||h==="$!"||h==="$?"){if(o===0)return n;o--}else h==="/$"&&o++}n=n.previousSibling}return null}var gs=Math.random().toString(36).slice(2),Gr="__reactFiber$"+gs,Zo="__reactProps$"+gs,Pt="__reactContainer$"+gs,Qa="__reactEvents$"+gs,dh="__reactListeners$"+gs,Lu="__reactHandles$"+gs;function Go(n){var o=n[Gr];if(o)return o;for(var h=n.parentNode;h;){if(o=h[Pt]||h[Gr]){if(h=o.alternate,o.child!==null||h!==null&&h.child!==null)for(n=Du(n);n!==null;){if(h=n[Gr])return h;n=Du(n)}return o}n=h,h=n.parentNode}return null}function el(n){return n=n[Gr]||n[Pt],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function zn(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error($(33))}function Sa(n){return n[Zo]||null}var Gl=[],Ta=-1;function Ls(n){return{current:n}}function Mi(n){0>Ta||(n.current=Gl[Ta],Gl[Ta]=null,Ta--)}function zi(n,o){Ta++,Gl[Ta]=n.current,n.current=o}var nn={},Dt=Ls(nn),dr=Ls(!1),Kn=nn;function po(n,o){var h=n.type.contextTypes;if(!h)return nn;var _=n.stateNode;if(_&&_.__reactInternalMemoizedUnmaskedChildContext===o)return _.__reactInternalMemoizedMaskedChildContext;var b={},k;for(k in h)b[k]=o[k];return _&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=o,n.__reactInternalMemoizedMaskedChildContext=b),b}function yr(n){return n=n.childContextTypes,n!=null}function tl(){Mi(dr),Mi(Dt)}function il(n,o,h){if(Dt.current!==nn)throw Error($(168));zi(Dt,o),zi(dr,h)}function Hr(n,o,h){var _=n.stateNode;if(o=o.childContextTypes,typeof _.getChildContext!="function")return h;_=_.getChildContext();for(var b in _)if(!(b in o))throw Error($(108,Xt(n)||"Unknown",b));return tt({},h,_)}function Ho(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||nn,Kn=Dt.current,zi(Dt,n),zi(dr,dr.current),!0}function at(n,o,h){var _=n.stateNode;if(!_)throw Error($(169));h?(n=Hr(n,o,Kn),_.__reactInternalMemoizedMergedChildContext=n,Mi(dr),Mi(Dt),zi(Dt,n)):Mi(dr),zi(dr,h)}var st=null,Wo=!1,rl=!1;function nl(n){st===null?st=[n]:st.push(n)}function sn(n){Wo=!0,nl(n)}function p(){if(!rl&&st!==null){rl=!0;var n=0,o=pi;try{var h=st;for(pi=1;n<h.length;n++){var _=h[n];do _=_(!0);while(_!==null)}st=null,Wo=!1}catch(b){throw st!==null&&(st=st.slice(n+1)),sr(Fa,p),b}finally{pi=o,rl=!1}}return null}var e=[],s=0,l=null,u=0,d=[],v=0,w=null,S=1,I="";function P(n,o){e[s++]=u,e[s++]=l,l=n,u=o}function M(n,o,h){d[v++]=S,d[v++]=I,d[v++]=w,w=n;var _=S;n=I;var b=32-xi(_)-1;_&=~(1<<b),h+=1;var k=32-xi(o)+b;if(30<k){var O=b-b%5;k=(_&(1<<O)-1).toString(32),_>>=O,b-=O,S=1<<32-xi(o)+b|h<<b|_,I=k+n}else S=1<<k|h<<b|_,I=n}function B(n){n.return!==null&&(P(n,1),M(n,1,0))}function j(n){for(;n===l;)l=e[--s],e[s]=null,u=e[--s],e[s]=null;for(;n===w;)w=d[--v],d[v]=null,I=d[--v],d[v]=null,S=d[--v],d[v]=null}var q=null,G=null,X=!1,Y=null;function ie(n,o){var h=Rn(5,null,null,0);h.elementType="DELETED",h.stateNode=o,h.return=n,o=n.deletions,o===null?(n.deletions=[h],n.flags|=16):o.push(h)}function H(n,o){switch(n.tag){case 5:var h=n.type;return o=o.nodeType!==1||h.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(n.stateNode=o,q=n,G=Mn(o.firstChild),!0):!1;case 6:return o=n.pendingProps===""||o.nodeType!==3?null:o,o!==null?(n.stateNode=o,q=n,G=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(h=w!==null?{id:S,overflow:I}:null,n.memoizedState={dehydrated:o,treeContext:h,retryLane:1073741824},h=Rn(18,null,null,0),h.stateNode=o,h.return=n,n.child=h,q=n,G=null,!0):!1;default:return!1}}function oe(n){return(n.mode&1)!==0&&(n.flags&128)===0}function ce(n){if(X){var o=G;if(o){var h=o;if(!H(n,o)){if(oe(n))throw Error($(418));o=Mn(h.nextSibling);var _=q;o&&H(n,o)?ie(_,h):(n.flags=n.flags&-4097|2,X=!1,q=n)}}else{if(oe(n))throw Error($(418));n.flags=n.flags&-4097|2,X=!1,q=n}}}function _e(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;q=n}function Ce(n){if(n!==q)return!1;if(!X)return _e(n),X=!0,!1;var o;if((o=n.tag!==3)&&!(o=n.tag!==5)&&(o=n.type,o=o!=="head"&&o!=="body"&&!zu(n.type,n.memoizedProps)),o&&(o=G)){if(oe(n))throw Le(),Error($(418));for(;o;)ie(n,o),o=Mn(o.nextSibling)}if(_e(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error($(317));e:{for(n=n.nextSibling,o=0;n;){if(n.nodeType===8){var h=n.data;if(h==="/$"){if(o===0){G=Mn(n.nextSibling);break e}o--}else h!=="$"&&h!=="$!"&&h!=="$?"||o++}n=n.nextSibling}G=null}}else G=q?Mn(n.stateNode.nextSibling):null;return!0}function Le(){for(var n=G;n;)n=Mn(n.nextSibling)}function Ve(){G=q=null,X=!1}function We(n){Y===null?Y=[n]:Y.push(n)}var je=zt.ReactCurrentBatchConfig;function Oe(n,o,h){if(n=h.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(h._owner){if(h=h._owner,h){if(h.tag!==1)throw Error($(309));var _=h.stateNode}if(!_)throw Error($(147,n));var b=_,k=""+n;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===k?o.ref:(o=function(O){var Q=b.refs;O===null?delete Q[k]:Q[k]=O},o._stringRef=k,o)}if(typeof n!="string")throw Error($(284));if(!h._owner)throw Error($(290,n))}return n}function it(n,o){throw n=Object.prototype.toString.call(o),Error($(31,n==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":n))}function St(n){var o=n._init;return o(n._payload)}function $e(n){function o(ye,ue){if(n){var xe=ye.deletions;xe===null?(ye.deletions=[ue],ye.flags|=16):xe.push(ue)}}function h(ye,ue){if(!n)return null;for(;ue!==null;)o(ye,ue),ue=ue.sibling;return null}function _(ye,ue){for(ye=new Map;ue!==null;)ue.key!==null?ye.set(ue.key,ue):ye.set(ue.index,ue),ue=ue.sibling;return ye}function b(ye,ue){return ye=ta(ye,ue),ye.index=0,ye.sibling=null,ye}function k(ye,ue,xe){return ye.index=xe,n?(xe=ye.alternate,xe!==null?(xe=xe.index,xe<ue?(ye.flags|=2,ue):xe):(ye.flags|=2,ue)):(ye.flags|=1048576,ue)}function O(ye){return n&&ye.alternate===null&&(ye.flags|=2),ye}function Q(ye,ue,xe,qe){return ue===null||ue.tag!==6?(ue=xo(xe,ye.mode,qe),ue.return=ye,ue):(ue=b(ue,xe),ue.return=ye,ue)}function se(ye,ue,xe,qe){var gt=xe.type;return gt===Wt?Re(ye,ue,xe.props.children,qe,xe.key):ue!==null&&(ue.elementType===gt||typeof gt=="object"&&gt!==null&&gt.$$typeof===ir&&St(gt)===ue.type)?(qe=b(ue,xe.props),qe.ref=Oe(ye,ue,xe),qe.return=ye,qe):(qe=rc(xe.type,xe.key,xe.props,null,ye.mode,qe),qe.ref=Oe(ye,ue,xe),qe.return=ye,qe)}function Se(ye,ue,xe,qe){return ue===null||ue.tag!==4||ue.stateNode.containerInfo!==xe.containerInfo||ue.stateNode.implementation!==xe.implementation?(ue=Zc(xe,ye.mode,qe),ue.return=ye,ue):(ue=b(ue,xe.children||[]),ue.return=ye,ue)}function Re(ye,ue,xe,qe,gt){return ue===null||ue.tag!==7?(ue=Gs(xe,ye.mode,qe,gt),ue.return=ye,ue):(ue=b(ue,xe),ue.return=ye,ue)}function Be(ye,ue,xe){if(typeof ue=="string"&&ue!==""||typeof ue=="number")return ue=xo(""+ue,ye.mode,xe),ue.return=ye,ue;if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case At:return xe=rc(ue.type,ue.key,ue.props,null,ye.mode,xe),xe.ref=Oe(ye,null,ue),xe.return=ye,xe;case Gt:return ue=Zc(ue,ye.mode,xe),ue.return=ye,ue;case ir:var qe=ue._init;return Be(ye,qe(ue._payload),xe)}if(Ii(ue)||xt(ue))return ue=Gs(ue,ye.mode,xe,null),ue.return=ye,ue;it(ye,ue)}return null}function De(ye,ue,xe,qe){var gt=ue!==null?ue.key:null;if(typeof xe=="string"&&xe!==""||typeof xe=="number")return gt!==null?null:Q(ye,ue,""+xe,qe);if(typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case At:return xe.key===gt?se(ye,ue,xe,qe):null;case Gt:return xe.key===gt?Se(ye,ue,xe,qe):null;case ir:return gt=xe._init,De(ye,ue,gt(xe._payload),qe)}if(Ii(xe)||xt(xe))return gt!==null?null:Re(ye,ue,xe,qe,null);it(ye,xe)}return null}function Xe(ye,ue,xe,qe,gt){if(typeof qe=="string"&&qe!==""||typeof qe=="number")return ye=ye.get(xe)||null,Q(ue,ye,""+qe,gt);if(typeof qe=="object"&&qe!==null){switch(qe.$$typeof){case At:return ye=ye.get(qe.key===null?xe:qe.key)||null,se(ue,ye,qe,gt);case Gt:return ye=ye.get(qe.key===null?xe:qe.key)||null,Se(ue,ye,qe,gt);case ir:var Tt=qe._init;return Xe(ye,ue,xe,Tt(qe._payload),gt)}if(Ii(qe)||xt(qe))return ye=ye.get(xe)||null,Re(ue,ye,qe,gt,null);it(ue,qe)}return null}function lt(ye,ue,xe,qe){for(var gt=null,Tt=null,_t=ue,Lt=ue=0,kr=null;_t!==null&&Lt<xe.length;Lt++){_t.index>Lt?(kr=_t,_t=null):kr=_t.sibling;var gi=De(ye,_t,xe[Lt],qe);if(gi===null){_t===null&&(_t=kr);break}n&&_t&&gi.alternate===null&&o(ye,_t),ue=k(gi,ue,Lt),Tt===null?gt=gi:Tt.sibling=gi,Tt=gi,_t=kr}if(Lt===xe.length)return h(ye,_t),X&&P(ye,Lt),gt;if(_t===null){for(;Lt<xe.length;Lt++)_t=Be(ye,xe[Lt],qe),_t!==null&&(ue=k(_t,ue,Lt),Tt===null?gt=_t:Tt.sibling=_t,Tt=_t);return X&&P(ye,Lt),gt}for(_t=_(ye,_t);Lt<xe.length;Lt++)kr=Xe(_t,ye,Lt,xe[Lt],qe),kr!==null&&(n&&kr.alternate!==null&&_t.delete(kr.key===null?Lt:kr.key),ue=k(kr,ue,Lt),Tt===null?gt=kr:Tt.sibling=kr,Tt=kr);return n&&_t.forEach(function(ia){return o(ye,ia)}),X&&P(ye,Lt),gt}function ft(ye,ue,xe,qe){var gt=xt(xe);if(typeof gt!="function")throw Error($(150));if(xe=gt.call(xe),xe==null)throw Error($(151));for(var Tt=gt=null,_t=ue,Lt=ue=0,kr=null,gi=xe.next();_t!==null&&!gi.done;Lt++,gi=xe.next()){_t.index>Lt?(kr=_t,_t=null):kr=_t.sibling;var ia=De(ye,_t,gi.value,qe);if(ia===null){_t===null&&(_t=kr);break}n&&_t&&ia.alternate===null&&o(ye,_t),ue=k(ia,ue,Lt),Tt===null?gt=ia:Tt.sibling=ia,Tt=ia,_t=kr}if(gi.done)return h(ye,_t),X&&P(ye,Lt),gt;if(_t===null){for(;!gi.done;Lt++,gi=xe.next())gi=Be(ye,gi.value,qe),gi!==null&&(ue=k(gi,ue,Lt),Tt===null?gt=gi:Tt.sibling=gi,Tt=gi);return X&&P(ye,Lt),gt}for(_t=_(ye,_t);!gi.done;Lt++,gi=xe.next())gi=Xe(_t,ye,Lt,gi.value,qe),gi!==null&&(n&&gi.alternate!==null&&_t.delete(gi.key===null?Lt:gi.key),ue=k(gi,ue,Lt),Tt===null?gt=gi:Tt.sibling=gi,Tt=gi);return n&&_t.forEach(function(fp){return o(ye,fp)}),X&&P(ye,Lt),gt}function er(ye,ue,xe,qe){if(typeof xe=="object"&&xe!==null&&xe.type===Wt&&xe.key===null&&(xe=xe.props.children),typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case At:e:{for(var gt=xe.key,Tt=ue;Tt!==null;){if(Tt.key===gt){if(gt=xe.type,gt===Wt){if(Tt.tag===7){h(ye,Tt.sibling),ue=b(Tt,xe.props.children),ue.return=ye,ye=ue;break e}}else if(Tt.elementType===gt||typeof gt=="object"&&gt!==null&&gt.$$typeof===ir&&St(gt)===Tt.type){h(ye,Tt.sibling),ue=b(Tt,xe.props),ue.ref=Oe(ye,Tt,xe),ue.return=ye,ye=ue;break e}h(ye,Tt);break}else o(ye,Tt);Tt=Tt.sibling}xe.type===Wt?(ue=Gs(xe.props.children,ye.mode,qe,xe.key),ue.return=ye,ye=ue):(qe=rc(xe.type,xe.key,xe.props,null,ye.mode,qe),qe.ref=Oe(ye,ue,xe),qe.return=ye,ye=qe)}return O(ye);case Gt:e:{for(Tt=xe.key;ue!==null;){if(ue.key===Tt)if(ue.tag===4&&ue.stateNode.containerInfo===xe.containerInfo&&ue.stateNode.implementation===xe.implementation){h(ye,ue.sibling),ue=b(ue,xe.children||[]),ue.return=ye,ye=ue;break e}else{h(ye,ue);break}else o(ye,ue);ue=ue.sibling}ue=Zc(xe,ye.mode,qe),ue.return=ye,ye=ue}return O(ye);case ir:return Tt=xe._init,er(ye,ue,Tt(xe._payload),qe)}if(Ii(xe))return lt(ye,ue,xe,qe);if(xt(xe))return ft(ye,ue,xe,qe);it(ye,xe)}return typeof xe=="string"&&xe!==""||typeof xe=="number"?(xe=""+xe,ue!==null&&ue.tag===6?(h(ye,ue.sibling),ue=b(ue,xe),ue.return=ye,ye=ue):(h(ye,ue),ue=xo(xe,ye.mode,qe),ue.return=ye,ye=ue),O(ye)):h(ye,ue)}return er}var Ge=$e(!0),bt=$e(!1),wi=Ls(null),Mt=null,Vt=null,Ti=null;function pr(){Ti=Vt=Mt=null}function vn(n){var o=wi.current;Mi(wi),n._currentValue=o}function ki(n,o,h){for(;n!==null;){var _=n.alternate;if((n.childLanes&o)!==o?(n.childLanes|=o,_!==null&&(_.childLanes|=o)):_!==null&&(_.childLanes&o)!==o&&(_.childLanes|=o),n===h)break;n=n.return}}function or(n,o){Mt=n,Ti=Vt=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&o&&(fr=!0),n.firstContext=null)}function Ai(n){var o=n._currentValue;if(Ti!==n)if(n={context:n,memoizedValue:o,next:null},Vt===null){if(Mt===null)throw Error($(308));Vt=n,Mt.dependencies={lanes:0,firstContext:n}}else Vt=Vt.next=n;return o}var Hi=null;function vr(n){Hi===null?Hi=[n]:Hi.push(n)}function Jn(n,o,h,_){var b=o.interleaved;return b===null?(h.next=h,vr(o)):(h.next=b.next,b.next=h),o.interleaved=h,on(n,_)}function on(n,o){n.lanes|=o;var h=n.alternate;for(h!==null&&(h.lanes|=o),h=n,n=n.return;n!==null;)n.childLanes|=o,h=n.alternate,h!==null&&(h.childLanes|=o),h=n,n=n.return;return h.tag===3?h.stateNode:null}var Yn=!1;function xn(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function fo(n,o){n=n.updateQueue,o.updateQueue===n&&(o.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function An(n,o){return{eventTime:n,lane:o,tag:0,payload:null,callback:null,next:null}}function _s(n,o,h){var _=n.updateQueue;if(_===null)return null;if(_=_.shared,ui&2){var b=_.pending;return b===null?o.next=o:(o.next=b.next,b.next=o),_.pending=o,on(n,h)}return b=_.interleaved,b===null?(o.next=o,vr(_)):(o.next=b.next,b.next=o),_.interleaved=o,on(n,h)}function zr(n,o,h){if(o=o.updateQueue,o!==null&&(o=o.shared,(h&4194240)!==0)){var _=o.lanes;_&=n.pendingLanes,h|=_,o.lanes=h,eo(n,h)}}function Dn(n,o){var h=n.updateQueue,_=n.alternate;if(_!==null&&(_=_.updateQueue,h===_)){var b=null,k=null;if(h=h.firstBaseUpdate,h!==null){do{var O={eventTime:h.eventTime,lane:h.lane,tag:h.tag,payload:h.payload,callback:h.callback,next:null};k===null?b=k=O:k=k.next=O,h=h.next}while(h!==null);k===null?b=k=o:k=k.next=o}else b=k=o;h={baseState:_.baseState,firstBaseUpdate:b,lastBaseUpdate:k,shared:_.shared,effects:_.effects},n.updateQueue=h;return}n=h.lastBaseUpdate,n===null?h.firstBaseUpdate=o:n.next=o,h.lastBaseUpdate=o}function Ar(n,o,h,_){var b=n.updateQueue;Yn=!1;var k=b.firstBaseUpdate,O=b.lastBaseUpdate,Q=b.shared.pending;if(Q!==null){b.shared.pending=null;var se=Q,Se=se.next;se.next=null,O===null?k=Se:O.next=Se,O=se;var Re=n.alternate;Re!==null&&(Re=Re.updateQueue,Q=Re.lastBaseUpdate,Q!==O&&(Q===null?Re.firstBaseUpdate=Se:Q.next=Se,Re.lastBaseUpdate=se))}if(k!==null){var Be=b.baseState;O=0,Re=Se=se=null,Q=k;do{var De=Q.lane,Xe=Q.eventTime;if((_&De)===De){Re!==null&&(Re=Re.next={eventTime:Xe,lane:0,tag:Q.tag,payload:Q.payload,callback:Q.callback,next:null});e:{var lt=n,ft=Q;switch(De=o,Xe=h,ft.tag){case 1:if(lt=ft.payload,typeof lt=="function"){Be=lt.call(Xe,Be,De);break e}Be=lt;break e;case 3:lt.flags=lt.flags&-65537|128;case 0:if(lt=ft.payload,De=typeof lt=="function"?lt.call(Xe,Be,De):lt,De==null)break e;Be=tt({},Be,De);break e;case 2:Yn=!0}}Q.callback!==null&&Q.lane!==0&&(n.flags|=64,De=b.effects,De===null?b.effects=[Q]:De.push(Q))}else Xe={eventTime:Xe,lane:De,tag:Q.tag,payload:Q.payload,callback:Q.callback,next:null},Re===null?(Se=Re=Xe,se=Be):Re=Re.next=Xe,O|=De;if(Q=Q.next,Q===null){if(Q=b.shared.pending,Q===null)break;De=Q,Q=De.next,De.next=null,b.lastBaseUpdate=De,b.shared.pending=null}}while(!0);if(Re===null&&(se=Be),b.baseState=se,b.firstBaseUpdate=Se,b.lastBaseUpdate=Re,o=b.shared.interleaved,o!==null){b=o;do O|=b.lane,b=b.next;while(b!==o)}else k===null&&(b.shared.lanes=0);pl|=O,n.lanes=O,n.memoizedState=Be}}function Rs(n,o,h){if(n=o.effects,o.effects=null,n!==null)for(o=0;o<n.length;o++){var _=n[o],b=_.callback;if(b!==null){if(_.callback=null,_=h,typeof b!="function")throw Error($(191,b));b.call(_)}}}var ar={},Ri=Ls(ar),ai=Ls(ar),Ei=Ls(ar);function Wr(n){if(n===ar)throw Error($(174));return n}function mo(n,o){switch(zi(Ei,o),zi(ai,n),zi(Ri,ar),n=o.nodeType,n){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:ko(null,"");break;default:n=n===8?o.parentNode:o,o=n.namespaceURI||null,n=n.tagName,o=ko(o,n)}Mi(Ri),zi(Ri,o)}function Fs(){Mi(Ri),Mi(ai),Mi(Ei)}function Ec(n){Wr(Ei.current);var o=Wr(Ri.current),h=ko(o,n.type);o!==h&&(zi(ai,n),zi(Ri,h))}function Hl(n){ai.current===n&&(Mi(Ri),Mi(ai))}var Oi=Ls(0);function ys(n){for(var o=n;o!==null;){if(o.tag===13){var h=o.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||h.data==="$?"||h.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if(o.flags&128)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var ka=[];function Xo(){for(var n=0;n<ka.length;n++)ka[n]._workInProgressVersionPrimary=null;ka.length=0}var Ia=zt.ReactCurrentDispatcher,Ko=zt.ReactCurrentBatchConfig,Qn=0,fi=null,Yi=null,xr=null,Ru=!1,Fu=!1,sl=0,Bu=0;function lr(){throw Error($(321))}function Bs(n,o){if(o===null)return!1;for(var h=0;h<o.length&&h<n.length;h++)if(!Zr(n[h],o[h]))return!1;return!0}function es(n,o,h,_,b,k){if(Qn=k,fi=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,Ia.current=n===null||n.memoizedState===null?tp:od,n=h(_,b),Fu){k=0;do{if(Fu=!1,sl=0,25<=k)throw Error($(301));k+=1,xr=Yi=null,o.updateQueue=null,Ia.current=ad,n=h(_,b)}while(Fu)}if(Ia.current=al,o=Yi!==null&&Yi.next!==null,Qn=0,xr=Yi=fi=null,Ru=!1,o)throw Error($(300));return n}function go(){var n=sl!==0;return sl=0,n}function Os(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return xr===null?fi.memoizedState=xr=n:xr=xr.next=n,xr}function Dr(){if(Yi===null){var n=fi.alternate;n=n!==null?n.memoizedState:null}else n=Yi.next;var o=xr===null?fi.memoizedState:xr.next;if(o!==null)xr=o,Yi=n;else{if(n===null)throw Error($(310));Yi=n,n={memoizedState:Yi.memoizedState,baseState:Yi.baseState,baseQueue:Yi.baseQueue,queue:Yi.queue,next:null},xr===null?fi.memoizedState=xr=n:xr=xr.next=n}return xr}function Ou(n,o){return typeof o=="function"?o(n):o}function Cc(n){var o=Dr(),h=o.queue;if(h===null)throw Error($(311));h.lastRenderedReducer=n;var _=Yi,b=_.baseQueue,k=h.pending;if(k!==null){if(b!==null){var O=b.next;b.next=k.next,k.next=O}_.baseQueue=b=k,h.pending=null}if(b!==null){k=b.next,_=_.baseState;var Q=O=null,se=null,Se=k;do{var Re=Se.lane;if((Qn&Re)===Re)se!==null&&(se=se.next={lane:0,action:Se.action,hasEagerState:Se.hasEagerState,eagerState:Se.eagerState,next:null}),_=Se.hasEagerState?Se.eagerState:n(_,Se.action);else{var Be={lane:Re,action:Se.action,hasEagerState:Se.hasEagerState,eagerState:Se.eagerState,next:null};se===null?(Q=se=Be,O=_):se=se.next=Be,fi.lanes|=Re,pl|=Re}Se=Se.next}while(Se!==null&&Se!==k);se===null?O=_:se.next=Q,Zr(_,o.memoizedState)||(fr=!0),o.memoizedState=_,o.baseState=O,o.baseQueue=se,h.lastRenderedState=_}if(n=h.interleaved,n!==null){b=n;do k=b.lane,fi.lanes|=k,pl|=k,b=b.next;while(b!==n)}else b===null&&(h.lanes=0);return[o.memoizedState,h.dispatch]}function $i(n){var o=Dr(),h=o.queue;if(h===null)throw Error($(311));h.lastRenderedReducer=n;var _=h.dispatch,b=h.pending,k=o.memoizedState;if(b!==null){h.pending=null;var O=b=b.next;do k=n(k,O.action),O=O.next;while(O!==b);Zr(k,o.memoizedState)||(fr=!0),o.memoizedState=k,o.baseQueue===null&&(o.baseState=k),h.lastRenderedState=k}return[k,_]}function Pc(){}function ph(n,o){var h=fi,_=Dr(),b=o(),k=!Zr(_.memoizedState,b);if(k&&(_.memoizedState=b,fr=!0),_=_.queue,Dc(Nu.bind(null,h,_,n),[n]),_.getSnapshot!==o||k||xr!==null&&xr.memoizedState.tag&1){if(h.flags|=2048,Wl(9,Ca.bind(null,h,_,b,o),void 0,null),Sr===null)throw Error($(349));Qn&30||Ea(h,o,b)}return b}function Ea(n,o,h){n.flags|=16384,n={getSnapshot:o,value:h},o=fi.updateQueue,o===null?(o={lastEffect:null,stores:null},fi.updateQueue=o,o.stores=[n]):(h=o.stores,h===null?o.stores=[n]:h.push(n))}function Ca(n,o,h,_){o.value=h,o.getSnapshot=_,Mc(o)&&fh(n)}function Nu(n,o,h){return h(function(){Mc(o)&&fh(n)})}function Mc(n){var o=n.getSnapshot;n=n.value;try{var h=o();return!Zr(n,h)}catch{return!0}}function fh(n){var o=on(n,1);o!==null&&qs(o,n,1,-1)}function id(n){var o=Os();return typeof n=="function"&&(n=n()),o.memoizedState=o.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ou,lastRenderedState:n},o.queue=n,n=n.dispatch=yh.bind(null,fi,n),[o.memoizedState,n]}function Wl(n,o,h,_){return n={tag:n,create:o,destroy:h,deps:_,next:null},o=fi.updateQueue,o===null?(o={lastEffect:null,stores:null},fi.updateQueue=o,o.lastEffect=n.next=n):(h=o.lastEffect,h===null?o.lastEffect=n.next=n:(_=h.next,h.next=n,n.next=_,o.lastEffect=n)),n}function rd(){return Dr().memoizedState}function Xl(n,o,h,_){var b=Os();fi.flags|=n,b.memoizedState=Wl(1|o,h,void 0,_===void 0?null:_)}function zc(n,o,h,_){var b=Dr();_=_===void 0?null:_;var k=void 0;if(Yi!==null){var O=Yi.memoizedState;if(k=O.destroy,_!==null&&Bs(_,O.deps)){b.memoizedState=Wl(o,h,k,_);return}}fi.flags|=n,b.memoizedState=Wl(1|o,h,k,_)}function Ac(n,o){return Xl(8390656,8,n,o)}function Dc(n,o){return zc(2048,8,n,o)}function mh(n,o){return zc(4,2,n,o)}function ol(n,o){return zc(4,4,n,o)}function nd(n,o){if(typeof o=="function")return n=n(),o(n),function(){o(null)};if(o!=null)return n=n(),o.current=n,function(){o.current=null}}function Kl(n,o,h){return h=h!=null?h.concat([n]):null,zc(4,4,nd.bind(null,o,n),h)}function Jl(){}function Vu(n,o){var h=Dr();o=o===void 0?null:o;var _=h.memoizedState;return _!==null&&o!==null&&Bs(o,_[1])?_[0]:(h.memoizedState=[n,o],n)}function gh(n,o){var h=Dr();o=o===void 0?null:o;var _=h.memoizedState;return _!==null&&o!==null&&Bs(o,_[1])?_[0]:(n=n(),h.memoizedState=[n,o],n)}function _h(n,o,h){return Qn&21?(Zr(h,o)||(h=ks(),fi.lanes|=h,pl|=h,n.baseState=!0),o):(n.baseState&&(n.baseState=!1,fr=!0),n.memoizedState=h)}function ep(n,o){var h=pi;pi=h!==0&&4>h?h:4,n(!0);var _=Ko.transition;Ko.transition={};try{n(!1),o()}finally{pi=h,Ko.transition=_}}function Xr(){return Dr().memoizedState}function Yl(n,o,h){var _=za(n);if(h={lane:_,action:h,hasEagerState:!1,eagerState:null,next:null},vh(n))Ql(o,h);else if(h=Jn(n,o,h,_),h!==null){var b=bn();qs(h,n,_,b),sd(h,o,_)}}function yh(n,o,h){var _=za(n),b={lane:_,action:h,hasEagerState:!1,eagerState:null,next:null};if(vh(n))Ql(o,b);else{var k=n.alternate;if(n.lanes===0&&(k===null||k.lanes===0)&&(k=o.lastRenderedReducer,k!==null))try{var O=o.lastRenderedState,Q=k(O,h);if(b.hasEagerState=!0,b.eagerState=Q,Zr(Q,O)){var se=o.interleaved;se===null?(b.next=b,vr(o)):(b.next=se.next,se.next=b),o.interleaved=b;return}}catch{}finally{}h=Jn(n,o,b,_),h!==null&&(b=bn(),qs(h,n,_,b),sd(h,o,_))}}function vh(n){var o=n.alternate;return n===fi||o!==null&&o===fi}function Ql(n,o){Fu=Ru=!0;var h=n.pending;h===null?o.next=o:(o.next=h.next,h.next=o),n.pending=o}function sd(n,o,h){if(h&4194240){var _=o.lanes;_&=n.pendingLanes,h|=_,o.lanes=h,eo(n,h)}}var al={readContext:Ai,useCallback:lr,useContext:lr,useEffect:lr,useImperativeHandle:lr,useInsertionEffect:lr,useLayoutEffect:lr,useMemo:lr,useReducer:lr,useRef:lr,useState:lr,useDebugValue:lr,useDeferredValue:lr,useTransition:lr,useMutableSource:lr,useSyncExternalStore:lr,useId:lr,unstable_isNewReconciler:!1},tp={readContext:Ai,useCallback:function(n,o){return Os().memoizedState=[n,o===void 0?null:o],n},useContext:Ai,useEffect:Ac,useImperativeHandle:function(n,o,h){return h=h!=null?h.concat([n]):null,Xl(4194308,4,nd.bind(null,o,n),h)},useLayoutEffect:function(n,o){return Xl(4194308,4,n,o)},useInsertionEffect:function(n,o){return Xl(4,2,n,o)},useMemo:function(n,o){var h=Os();return o=o===void 0?null:o,n=n(),h.memoizedState=[n,o],n},useReducer:function(n,o,h){var _=Os();return o=h!==void 0?h(o):o,_.memoizedState=_.baseState=o,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:o},_.queue=n,n=n.dispatch=Yl.bind(null,fi,n),[_.memoizedState,n]},useRef:function(n){var o=Os();return n={current:n},o.memoizedState=n},useState:id,useDebugValue:Jl,useDeferredValue:function(n){return Os().memoizedState=n},useTransition:function(){var n=id(!1),o=n[0];return n=ep.bind(null,n[1]),Os().memoizedState=n,[o,n]},useMutableSource:function(){},useSyncExternalStore:function(n,o,h){var _=fi,b=Os();if(X){if(h===void 0)throw Error($(407));h=h()}else{if(h=o(),Sr===null)throw Error($(349));Qn&30||Ea(_,o,h)}b.memoizedState=h;var k={value:h,getSnapshot:o};return b.queue=k,Ac(Nu.bind(null,_,k,n),[n]),_.flags|=2048,Wl(9,Ca.bind(null,_,k,h,o),void 0,null),h},useId:function(){var n=Os(),o=Sr.identifierPrefix;if(X){var h=I,_=S;h=(_&~(1<<32-xi(_)-1)).toString(32)+h,o=":"+o+"R"+h,h=sl++,0<h&&(o+="H"+h.toString(32)),o+=":"}else h=Bu++,o=":"+o+"r"+h.toString(32)+":";return n.memoizedState=o},unstable_isNewReconciler:!1},od={readContext:Ai,useCallback:Vu,useContext:Ai,useEffect:Dc,useImperativeHandle:Kl,useInsertionEffect:mh,useLayoutEffect:ol,useMemo:gh,useReducer:Cc,useRef:rd,useState:function(){return Cc(Ou)},useDebugValue:Jl,useDeferredValue:function(n){var o=Dr();return _h(o,Yi.memoizedState,n)},useTransition:function(){var n=Cc(Ou)[0],o=Dr().memoizedState;return[n,o]},useMutableSource:Pc,useSyncExternalStore:ph,useId:Xr,unstable_isNewReconciler:!1},ad={readContext:Ai,useCallback:Vu,useContext:Ai,useEffect:Dc,useImperativeHandle:Kl,useInsertionEffect:mh,useLayoutEffect:ol,useMemo:gh,useReducer:$i,useRef:rd,useState:function(){return $i(Ou)},useDebugValue:Jl,useDeferredValue:function(n){var o=Dr();return Yi===null?o.memoizedState=n:_h(o,Yi.memoizedState,n)},useTransition:function(){var n=$i(Ou)[0],o=Dr().memoizedState;return[n,o]},useMutableSource:Pc,useSyncExternalStore:ph,useId:Xr,unstable_isNewReconciler:!1};function vs(n,o){if(n&&n.defaultProps){o=tt({},o),n=n.defaultProps;for(var h in n)o[h]===void 0&&(o[h]=n[h]);return o}return o}function xh(n,o,h,_){o=n.memoizedState,h=h(_,o),h=h==null?o:tt({},o,h),n.memoizedState=h,n.lanes===0&&(n.updateQueue.baseState=h)}var eu={isMounted:function(n){return(n=n._reactInternals)?Rt(n)===n:!1},enqueueSetState:function(n,o,h){n=n._reactInternals;var _=bn(),b=za(n),k=An(_,b);k.payload=o,h!=null&&(k.callback=h),o=_s(n,k,b),o!==null&&(qs(o,n,b,_),zr(o,n,b))},enqueueReplaceState:function(n,o,h){n=n._reactInternals;var _=bn(),b=za(n),k=An(_,b);k.tag=1,k.payload=o,h!=null&&(k.callback=h),o=_s(n,k,b),o!==null&&(qs(o,n,b,_),zr(o,n,b))},enqueueForceUpdate:function(n,o){n=n._reactInternals;var h=bn(),_=za(n),b=An(h,_);b.tag=2,o!=null&&(b.callback=o),o=_s(n,b,_),o!==null&&(qs(o,n,_,h),zr(o,n,_))}};function wh(n,o,h,_,b,k,O){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(_,k,O):o.prototype&&o.prototype.isPureReactComponent?!ao(h,_)||!ao(b,k):!0}function Lc(n,o,h){var _=!1,b=nn,k=o.contextType;return typeof k=="object"&&k!==null?k=Ai(k):(b=yr(o)?Kn:Dt.current,_=o.contextTypes,k=(_=_!=null)?po(n,b):nn),o=new o(h,k),n.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=eu,n.stateNode=o,o._reactInternals=n,_&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=b,n.__reactInternalMemoizedMaskedChildContext=k),o}function tu(n,o,h,_){n=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(h,_),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(h,_),o.state!==n&&eu.enqueueReplaceState(o,o.state,null)}function wn(n,o,h,_){var b=n.stateNode;b.props=h,b.state=n.memoizedState,b.refs={},xn(n);var k=o.contextType;typeof k=="object"&&k!==null?b.context=Ai(k):(k=yr(o)?Kn:Dt.current,b.context=po(n,k)),b.state=n.memoizedState,k=o.getDerivedStateFromProps,typeof k=="function"&&(xh(n,o,k,h),b.state=n.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(o=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),o!==b.state&&eu.enqueueReplaceState(b,b.state,null),Ar(n,h,b,_),b.state=n.memoizedState),typeof b.componentDidMount=="function"&&(n.flags|=4194308)}function ll(n,o){try{var h="",_=o;do h+=qt(_),_=_.return;while(_);var b=h}catch(k){b=`
Error generating stack: `+k.message+`
`+k.stack}return{value:n,source:o,stack:b,digest:null}}function ju(n,o,h){return{value:n,source:null,stack:h??null,digest:o??null}}function bh(n,o){try{console.error(o.value)}catch(h){setTimeout(function(){throw h})}}var ld=typeof WeakMap=="function"?WeakMap:Map;function ud(n,o,h){h=An(-1,h),h.tag=3,h.payload={element:null};var _=o.value;return h.callback=function(){Qu||(Qu=!0,mi=_),bh(n,o)},h}function cd(n,o,h){h=An(-1,h),h.tag=3;var _=n.type.getDerivedStateFromError;if(typeof _=="function"){var b=o.value;h.payload=function(){return _(b)},h.callback=function(){bh(n,o)}}var k=n.stateNode;return k!==null&&typeof k.componentDidCatch=="function"&&(h.callback=function(){bh(n,o),typeof _!="function"&&(yo===null?yo=new Set([this]):yo.add(this));var O=o.stack;this.componentDidCatch(o.value,{componentStack:O!==null?O:""})}),h}function hd(n,o,h){var _=n.pingCache;if(_===null){_=n.pingCache=new ld;var b=new Set;_.set(o,b)}else b=_.get(o),b===void 0&&(b=new Set,_.set(o,b));b.has(h)||(b.add(h),n=lp.bind(null,n,o,h),o.then(n,n))}function dd(n){do{var o;if((o=n.tag===13)&&(o=n.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return n;n=n.return}while(n!==null);return null}function Sh(n,o,h,_,b){return n.mode&1?(n.flags|=65536,n.lanes=b,n):(n===o?n.flags|=65536:(n.flags|=128,h.flags|=131072,h.flags&=-52805,h.tag===1&&(h.alternate===null?h.tag=17:(o=An(-1,1),o.tag=2,_s(h,o,1))),h.lanes|=1),n)}var pd=zt.ReactCurrentOwner,fr=!1;function wr(n,o,h,_){o.child=n===null?bt(o,null,h,_):Ge(o,n.child,h,_)}function fd(n,o,h,_,b){h=h.render;var k=o.ref;return or(o,b),_=es(n,o,h,_,k,b),h=go(),n!==null&&!fr?(o.updateQueue=n.updateQueue,o.flags&=-2053,n.lanes&=~b,Ns(n,o,b)):(X&&h&&B(o),o.flags|=1,wr(n,o,_,b),o.child)}function md(n,o,h,_,b){if(n===null){var k=h.type;return typeof k=="function"&&!qh(k)&&k.defaultProps===void 0&&h.compare===null&&h.defaultProps===void 0?(o.tag=15,o.type=k,gd(n,o,k,_,b)):(n=rc(h.type,null,_,o,o.mode,b),n.ref=o.ref,n.return=o,o.child=n)}if(k=n.child,!(n.lanes&b)){var O=k.memoizedProps;if(h=h.compare,h=h!==null?h:ao,h(O,_)&&n.ref===o.ref)return Ns(n,o,b)}return o.flags|=1,n=ta(k,_),n.ref=o.ref,n.return=o,o.child=n}function gd(n,o,h,_,b){if(n!==null){var k=n.memoizedProps;if(ao(k,_)&&n.ref===o.ref)if(fr=!1,o.pendingProps=_=k,(n.lanes&b)!==0)n.flags&131072&&(fr=!0);else return o.lanes=n.lanes,Ns(n,o,b)}return Th(n,o,h,_,b)}function _d(n,o,h){var _=o.pendingProps,b=_.children,k=n!==null?n.memoizedState:null;if(_.mode==="hidden")if(!(o.mode&1))o.memoizedState={baseLanes:0,cachePool:null,transitions:null},zi(dl,is),is|=h;else{if(!(h&1073741824))return n=k!==null?k.baseLanes|h:h,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:n,cachePool:null,transitions:null},o.updateQueue=null,zi(dl,is),is|=n,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},_=k!==null?k.baseLanes:h,zi(dl,is),is|=_}else k!==null?(_=k.baseLanes|h,o.memoizedState=null):_=h,zi(dl,is),is|=_;return wr(n,o,b,h),o.child}function yd(n,o){var h=o.ref;(n===null&&h!==null||n!==null&&n.ref!==h)&&(o.flags|=512,o.flags|=2097152)}function Th(n,o,h,_,b){var k=yr(h)?Kn:Dt.current;return k=po(o,k),or(o,b),h=es(n,o,h,_,k,b),_=go(),n!==null&&!fr?(o.updateQueue=n.updateQueue,o.flags&=-2053,n.lanes&=~b,Ns(n,o,b)):(X&&_&&B(o),o.flags|=1,wr(n,o,h,b),o.child)}function vd(n,o,h,_,b){if(yr(h)){var k=!0;Ho(o)}else k=!1;if(or(o,b),o.stateNode===null)Pa(n,o),Lc(o,h,_),wn(o,h,_,b),_=!0;else if(n===null){var O=o.stateNode,Q=o.memoizedProps;O.props=Q;var se=O.context,Se=h.contextType;typeof Se=="object"&&Se!==null?Se=Ai(Se):(Se=yr(h)?Kn:Dt.current,Se=po(o,Se));var Re=h.getDerivedStateFromProps,Be=typeof Re=="function"||typeof O.getSnapshotBeforeUpdate=="function";Be||typeof O.UNSAFE_componentWillReceiveProps!="function"&&typeof O.componentWillReceiveProps!="function"||(Q!==_||se!==Se)&&tu(o,O,_,Se),Yn=!1;var De=o.memoizedState;O.state=De,Ar(o,_,O,b),se=o.memoizedState,Q!==_||De!==se||dr.current||Yn?(typeof Re=="function"&&(xh(o,h,Re,_),se=o.memoizedState),(Q=Yn||wh(o,h,Q,_,De,se,Se))?(Be||typeof O.UNSAFE_componentWillMount!="function"&&typeof O.componentWillMount!="function"||(typeof O.componentWillMount=="function"&&O.componentWillMount(),typeof O.UNSAFE_componentWillMount=="function"&&O.UNSAFE_componentWillMount()),typeof O.componentDidMount=="function"&&(o.flags|=4194308)):(typeof O.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=_,o.memoizedState=se),O.props=_,O.state=se,O.context=Se,_=Q):(typeof O.componentDidMount=="function"&&(o.flags|=4194308),_=!1)}else{O=o.stateNode,fo(n,o),Q=o.memoizedProps,Se=o.type===o.elementType?Q:vs(o.type,Q),O.props=Se,Be=o.pendingProps,De=O.context,se=h.contextType,typeof se=="object"&&se!==null?se=Ai(se):(se=yr(h)?Kn:Dt.current,se=po(o,se));var Xe=h.getDerivedStateFromProps;(Re=typeof Xe=="function"||typeof O.getSnapshotBeforeUpdate=="function")||typeof O.UNSAFE_componentWillReceiveProps!="function"&&typeof O.componentWillReceiveProps!="function"||(Q!==Be||De!==se)&&tu(o,O,_,se),Yn=!1,De=o.memoizedState,O.state=De,Ar(o,_,O,b);var lt=o.memoizedState;Q!==Be||De!==lt||dr.current||Yn?(typeof Xe=="function"&&(xh(o,h,Xe,_),lt=o.memoizedState),(Se=Yn||wh(o,h,Se,_,De,lt,se)||!1)?(Re||typeof O.UNSAFE_componentWillUpdate!="function"&&typeof O.componentWillUpdate!="function"||(typeof O.componentWillUpdate=="function"&&O.componentWillUpdate(_,lt,se),typeof O.UNSAFE_componentWillUpdate=="function"&&O.UNSAFE_componentWillUpdate(_,lt,se)),typeof O.componentDidUpdate=="function"&&(o.flags|=4),typeof O.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof O.componentDidUpdate!="function"||Q===n.memoizedProps&&De===n.memoizedState||(o.flags|=4),typeof O.getSnapshotBeforeUpdate!="function"||Q===n.memoizedProps&&De===n.memoizedState||(o.flags|=1024),o.memoizedProps=_,o.memoizedState=lt),O.props=_,O.state=lt,O.context=se,_=Se):(typeof O.componentDidUpdate!="function"||Q===n.memoizedProps&&De===n.memoizedState||(o.flags|=4),typeof O.getSnapshotBeforeUpdate!="function"||Q===n.memoizedProps&&De===n.memoizedState||(o.flags|=1024),_=!1)}return Uu(n,o,h,_,k,b)}function Uu(n,o,h,_,b,k){yd(n,o);var O=(o.flags&128)!==0;if(!_&&!O)return b&&at(o,h,!1),Ns(n,o,k);_=o.stateNode,pd.current=o;var Q=O&&typeof h.getDerivedStateFromError!="function"?null:_.render();return o.flags|=1,n!==null&&O?(o.child=Ge(o,n.child,null,k),o.child=Ge(o,null,Q,k)):wr(n,o,Q,k),o.memoizedState=_.state,b&&at(o,h,!0),o.child}function xd(n){var o=n.stateNode;o.pendingContext?il(n,o.pendingContext,o.pendingContext!==o.context):o.context&&il(n,o.context,!1),mo(n,o.containerInfo)}function ul(n,o,h,_,b){return Ve(),We(b),o.flags|=256,wr(n,o,h,_),o.child}var kh={dehydrated:null,treeContext:null,retryLane:0};function ji(n){return{baseLanes:n,cachePool:null,transitions:null}}function $u(n,o,h){var _=o.pendingProps,b=Oi.current,k=!1,O=(o.flags&128)!==0,Q;if((Q=O)||(Q=n!==null&&n.memoizedState===null?!1:(b&2)!==0),Q?(k=!0,o.flags&=-129):(n===null||n.memoizedState!==null)&&(b|=1),zi(Oi,b&1),n===null)return ce(o),n=o.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(o.mode&1?n.data==="$!"?o.lanes=8:o.lanes=1073741824:o.lanes=1,null):(O=_.children,n=_.fallback,k?(_=o.mode,k=o.child,O={mode:"hidden",children:O},!(_&1)&&k!==null?(k.childLanes=0,k.pendingProps=O):k=ns(O,_,0,null),n=Gs(n,_,h,null),k.return=o,n.return=o,k.sibling=n,o.child=k,o.child.memoizedState=ji(h),o.memoizedState=kh,n):Rc(o,O));if(b=n.memoizedState,b!==null&&(Q=b.dehydrated,Q!==null))return Fc(n,o,O,_,Q,b,h);if(k){k=_.fallback,O=o.mode,b=n.child,Q=b.sibling;var se={mode:"hidden",children:_.children};return!(O&1)&&o.child!==b?(_=o.child,_.childLanes=0,_.pendingProps=se,o.deletions=null):(_=ta(b,se),_.subtreeFlags=b.subtreeFlags&14680064),Q!==null?k=ta(Q,k):(k=Gs(k,O,h,null),k.flags|=2),k.return=o,_.return=o,_.sibling=k,o.child=_,_=k,k=o.child,O=n.child.memoizedState,O=O===null?ji(h):{baseLanes:O.baseLanes|h,cachePool:null,transitions:O.transitions},k.memoizedState=O,k.childLanes=n.childLanes&~h,o.memoizedState=kh,_}return k=n.child,n=k.sibling,_=ta(k,{mode:"visible",children:_.children}),!(o.mode&1)&&(_.lanes=h),_.return=o,_.sibling=null,n!==null&&(h=o.deletions,h===null?(o.deletions=[n],o.flags|=16):h.push(n)),o.child=_,o.memoizedState=null,_}function Rc(n,o){return o=ns({mode:"visible",children:o},n.mode,0,null),o.return=n,n.child=o}function cl(n,o,h,_){return _!==null&&We(_),Ge(o,n.child,null,h),n=Rc(o,o.pendingProps.children),n.flags|=2,o.memoizedState=null,n}function Fc(n,o,h,_,b,k,O){if(h)return o.flags&256?(o.flags&=-257,_=ju(Error($(422))),cl(n,o,O,_)):o.memoizedState!==null?(o.child=n.child,o.flags|=128,null):(k=_.fallback,b=o.mode,_=ns({mode:"visible",children:_.children},b,0,null),k=Gs(k,b,O,null),k.flags|=2,_.return=o,k.return=o,_.sibling=k,o.child=_,o.mode&1&&Ge(o,n.child,null,O),o.child.memoizedState=ji(O),o.memoizedState=kh,k);if(!(o.mode&1))return cl(n,o,O,null);if(b.data==="$!"){if(_=b.nextSibling&&b.nextSibling.dataset,_)var Q=_.dgst;return _=Q,k=Error($(419)),_=ju(k,_,void 0),cl(n,o,O,_)}if(Q=(O&n.childLanes)!==0,fr||Q){if(_=Sr,_!==null){switch(O&-O){case 4:b=2;break;case 16:b=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:b=32;break;case 536870912:b=268435456;break;default:b=0}b=b&(_.suspendedLanes|O)?0:b,b!==0&&b!==k.retryLane&&(k.retryLane=b,on(n,b),qs(_,n,b,-1))}return qc(),_=ju(Error($(421))),cl(n,o,O,_)}return b.data==="$?"?(o.flags|=128,o.child=n.child,o=Dd.bind(null,n),b._reactRetry=o,null):(n=k.treeContext,G=Mn(b.nextSibling),q=o,X=!0,Y=null,n!==null&&(d[v++]=S,d[v++]=I,d[v++]=w,S=n.id,I=n.overflow,w=o),o=Rc(o,_.children),o.flags|=4096,o)}function iu(n,o,h){n.lanes|=o;var _=n.alternate;_!==null&&(_.lanes|=o),ki(n.return,o,h)}function Bc(n,o,h,_,b){var k=n.memoizedState;k===null?n.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:_,tail:h,tailMode:b}:(k.isBackwards=o,k.rendering=null,k.renderingStartTime=0,k.last=_,k.tail=h,k.tailMode=b)}function Ih(n,o,h){var _=o.pendingProps,b=_.revealOrder,k=_.tail;if(wr(n,o,_.children,h),_=Oi.current,_&2)_=_&1|2,o.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=o.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&iu(n,h,o);else if(n.tag===19)iu(n,h,o);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===o)break e;for(;n.sibling===null;){if(n.return===null||n.return===o)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}_&=1}if(zi(Oi,_),!(o.mode&1))o.memoizedState=null;else switch(b){case"forwards":for(h=o.child,b=null;h!==null;)n=h.alternate,n!==null&&ys(n)===null&&(b=h),h=h.sibling;h=b,h===null?(b=o.child,o.child=null):(b=h.sibling,h.sibling=null),Bc(o,!1,b,h,k);break;case"backwards":for(h=null,b=o.child,o.child=null;b!==null;){if(n=b.alternate,n!==null&&ys(n)===null){o.child=b;break}n=b.sibling,b.sibling=h,h=b,b=n}Bc(o,!0,h,null,k);break;case"together":Bc(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function Pa(n,o){!(o.mode&1)&&n!==null&&(n.alternate=null,o.alternate=null,o.flags|=2)}function Ns(n,o,h){if(n!==null&&(o.dependencies=n.dependencies),pl|=o.lanes,!(h&o.childLanes))return null;if(n!==null&&o.child!==n.child)throw Error($(153));if(o.child!==null){for(n=o.child,h=ta(n,n.pendingProps),o.child=h,h.return=o;n.sibling!==null;)n=n.sibling,h=h.sibling=ta(n,n.pendingProps),h.return=o;h.sibling=null}return o.child}function Eh(n,o,h){switch(o.tag){case 3:xd(o),Ve();break;case 5:Ec(o);break;case 1:yr(o.type)&&Ho(o);break;case 4:mo(o,o.stateNode.containerInfo);break;case 10:var _=o.type._context,b=o.memoizedProps.value;zi(wi,_._currentValue),_._currentValue=b;break;case 13:if(_=o.memoizedState,_!==null)return _.dehydrated!==null?(zi(Oi,Oi.current&1),o.flags|=128,null):h&o.child.childLanes?$u(n,o,h):(zi(Oi,Oi.current&1),n=Ns(n,o,h),n!==null?n.sibling:null);zi(Oi,Oi.current&1);break;case 19:if(_=(h&o.childLanes)!==0,n.flags&128){if(_)return Ih(n,o,h);o.flags|=128}if(b=o.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),zi(Oi,Oi.current),_)break;return null;case 22:case 23:return o.lanes=0,_d(n,o,h)}return Ns(n,o,h)}var Oc,qu,Ch,Ph;Oc=function(n,o){for(var h=o.child;h!==null;){if(h.tag===5||h.tag===6)n.appendChild(h.stateNode);else if(h.tag!==4&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===o)break;for(;h.sibling===null;){if(h.return===null||h.return===o)return;h=h.return}h.sibling.return=h.return,h=h.sibling}},qu=function(){},Ch=function(n,o,h,_){var b=n.memoizedProps;if(b!==_){n=o.stateNode,Wr(Ri.current);var k=null;switch(h){case"input":b=as(n,b),_=as(n,_),k=[];break;case"select":b=tt({},b,{value:void 0}),_=tt({},_,{value:void 0}),k=[];break;case"textarea":b=us(n,b),_=us(n,_),k=[];break;default:typeof b.onClick!="function"&&typeof _.onClick=="function"&&(n.onclick=fs)}Er(h,_);var O;h=null;for(Se in b)if(!_.hasOwnProperty(Se)&&b.hasOwnProperty(Se)&&b[Se]!=null)if(Se==="style"){var Q=b[Se];for(O in Q)Q.hasOwnProperty(O)&&(h||(h={}),h[O]="")}else Se!=="dangerouslySetInnerHTML"&&Se!=="children"&&Se!=="suppressContentEditableWarning"&&Se!=="suppressHydrationWarning"&&Se!=="autoFocus"&&(me.hasOwnProperty(Se)?k||(k=[]):(k=k||[]).push(Se,null));for(Se in _){var se=_[Se];if(Q=b!=null?b[Se]:void 0,_.hasOwnProperty(Se)&&se!==Q&&(se!=null||Q!=null))if(Se==="style")if(Q){for(O in Q)!Q.hasOwnProperty(O)||se&&se.hasOwnProperty(O)||(h||(h={}),h[O]="");for(O in se)se.hasOwnProperty(O)&&Q[O]!==se[O]&&(h||(h={}),h[O]=se[O])}else h||(k||(k=[]),k.push(Se,h)),h=se;else Se==="dangerouslySetInnerHTML"?(se=se?se.__html:void 0,Q=Q?Q.__html:void 0,se!=null&&Q!==se&&(k=k||[]).push(Se,se)):Se==="children"?typeof se!="string"&&typeof se!="number"||(k=k||[]).push(Se,""+se):Se!=="suppressContentEditableWarning"&&Se!=="suppressHydrationWarning"&&(me.hasOwnProperty(Se)?(se!=null&&Se==="onScroll"&&li("scroll",n),k||Q===se||(k=[])):(k=k||[]).push(Se,se))}h&&(k=k||[]).push("style",h);var Se=k;(o.updateQueue=Se)&&(o.flags|=4)}},Ph=function(n,o,h,_){h!==_&&(o.flags|=4)};function Zu(n,o){if(!X)switch(n.tailMode){case"hidden":o=n.tail;for(var h=null;o!==null;)o.alternate!==null&&(h=o),o=o.sibling;h===null?n.tail=null:h.sibling=null;break;case"collapsed":h=n.tail;for(var _=null;h!==null;)h.alternate!==null&&(_=h),h=h.sibling;_===null?o||n.tail===null?n.tail=null:n.tail.sibling=null:_.sibling=null}}function an(n){var o=n.alternate!==null&&n.alternate.child===n.child,h=0,_=0;if(o)for(var b=n.child;b!==null;)h|=b.lanes|b.childLanes,_|=b.subtreeFlags&14680064,_|=b.flags&14680064,b.return=n,b=b.sibling;else for(b=n.child;b!==null;)h|=b.lanes|b.childLanes,_|=b.subtreeFlags,_|=b.flags,b.return=n,b=b.sibling;return n.subtreeFlags|=_,n.childLanes=h,o}function ip(n,o,h){var _=o.pendingProps;switch(j(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return an(o),null;case 1:return yr(o.type)&&tl(),an(o),null;case 3:return _=o.stateNode,Fs(),Mi(dr),Mi(Dt),Xo(),_.pendingContext&&(_.context=_.pendingContext,_.pendingContext=null),(n===null||n.child===null)&&(Ce(o)?o.flags|=4:n===null||n.memoizedState.isDehydrated&&!(o.flags&256)||(o.flags|=1024,Y!==null&&(Rh(Y),Y=null))),qu(n,o),an(o),null;case 5:Hl(o);var b=Wr(Ei.current);if(h=o.type,n!==null&&o.stateNode!=null)Ch(n,o,h,_,b),n.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!_){if(o.stateNode===null)throw Error($(166));return an(o),null}if(n=Wr(Ri.current),Ce(o)){_=o.stateNode,h=o.type;var k=o.memoizedProps;switch(_[Gr]=o,_[Zo]=k,n=(o.mode&1)!==0,h){case"dialog":li("cancel",_),li("close",_);break;case"iframe":case"object":case"embed":li("load",_);break;case"video":case"audio":for(b=0;b<ho.length;b++)li(ho[b],_);break;case"source":li("error",_);break;case"img":case"image":case"link":li("error",_),li("load",_);break;case"details":li("toggle",_);break;case"input":So(_,k),li("invalid",_);break;case"select":_._wrapperState={wasMultiple:!!k.multiple},li("invalid",_);break;case"textarea":cs(_,k),li("invalid",_)}Er(h,k),b=null;for(var O in k)if(k.hasOwnProperty(O)){var Q=k[O];O==="children"?typeof Q=="string"?_.textContent!==Q&&(k.suppressHydrationWarning!==!0&&rn(_.textContent,Q,n),b=["children",Q]):typeof Q=="number"&&_.textContent!==""+Q&&(k.suppressHydrationWarning!==!0&&rn(_.textContent,Q,n),b=["children",""+Q]):me.hasOwnProperty(O)&&Q!=null&&O==="onScroll"&&li("scroll",_)}switch(h){case"input":Ys(_),oa(_,k,!0);break;case"textarea":Ys(_),pn(_);break;case"select":case"option":break;default:typeof k.onClick=="function"&&(_.onclick=fs)}_=b,o.updateQueue=_,_!==null&&(o.flags|=4)}else{O=b.nodeType===9?b:b.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=aa(h)),n==="http://www.w3.org/1999/xhtml"?h==="script"?(n=O.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof _.is=="string"?n=O.createElement(h,{is:_.is}):(n=O.createElement(h),h==="select"&&(O=n,_.multiple?O.multiple=!0:_.size&&(O.size=_.size))):n=O.createElementNS(n,h),n[Gr]=o,n[Zo]=_,Oc(n,o,!1,!1),o.stateNode=n;e:{switch(O=fn(h,_),h){case"dialog":li("cancel",n),li("close",n),b=_;break;case"iframe":case"object":case"embed":li("load",n),b=_;break;case"video":case"audio":for(b=0;b<ho.length;b++)li(ho[b],n);b=_;break;case"source":li("error",n),b=_;break;case"img":case"image":case"link":li("error",n),li("load",n),b=_;break;case"details":li("toggle",n),b=_;break;case"input":So(n,_),b=as(n,_),li("invalid",n);break;case"option":b=_;break;case"select":n._wrapperState={wasMultiple:!!_.multiple},b=tt({},_,{value:void 0}),li("invalid",n);break;case"textarea":cs(n,_),b=us(n,_),li("invalid",n);break;default:b=_}Er(h,b),Q=b;for(k in Q)if(Q.hasOwnProperty(k)){var se=Q[k];k==="style"?Nt(n,se):k==="dangerouslySetInnerHTML"?(se=se?se.__html:void 0,se!=null&&jn(n,se)):k==="children"?typeof se=="string"?(h!=="textarea"||se!=="")&&nr(n,se):typeof se=="number"&&nr(n,""+se):k!=="suppressContentEditableWarning"&&k!=="suppressHydrationWarning"&&k!=="autoFocus"&&(me.hasOwnProperty(k)?se!=null&&k==="onScroll"&&li("scroll",n):se!=null&&vt(n,k,se,O))}switch(h){case"input":Ys(n),oa(n,_,!1);break;case"textarea":Ys(n),pn(n);break;case"option":_.value!=null&&n.setAttribute("value",""+Ht(_.value));break;case"select":n.multiple=!!_.multiple,k=_.value,k!=null?ls(n,!!_.multiple,k,!1):_.defaultValue!=null&&ls(n,!!_.multiple,_.defaultValue,!0);break;default:typeof b.onClick=="function"&&(n.onclick=fs)}switch(h){case"button":case"input":case"select":case"textarea":_=!!_.autoFocus;break e;case"img":_=!0;break e;default:_=!1}}_&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return an(o),null;case 6:if(n&&o.stateNode!=null)Ph(n,o,n.memoizedProps,_);else{if(typeof _!="string"&&o.stateNode===null)throw Error($(166));if(h=Wr(Ei.current),Wr(Ri.current),Ce(o)){if(_=o.stateNode,h=o.memoizedProps,_[Gr]=o,(k=_.nodeValue!==h)&&(n=q,n!==null))switch(n.tag){case 3:rn(_.nodeValue,h,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&rn(_.nodeValue,h,(n.mode&1)!==0)}k&&(o.flags|=4)}else _=(h.nodeType===9?h:h.ownerDocument).createTextNode(_),_[Gr]=o,o.stateNode=_}return an(o),null;case 13:if(Mi(Oi),_=o.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(X&&G!==null&&o.mode&1&&!(o.flags&128))Le(),Ve(),o.flags|=98560,k=!1;else if(k=Ce(o),_!==null&&_.dehydrated!==null){if(n===null){if(!k)throw Error($(318));if(k=o.memoizedState,k=k!==null?k.dehydrated:null,!k)throw Error($(317));k[Gr]=o}else Ve(),!(o.flags&128)&&(o.memoizedState=null),o.flags|=4;an(o),k=!1}else Y!==null&&(Rh(Y),Y=null),k=!0;if(!k)return o.flags&65536?o:null}return o.flags&128?(o.lanes=h,o):(_=_!==null,_!==(n!==null&&n.memoizedState!==null)&&_&&(o.child.flags|=8192,o.mode&1&&(n===null||Oi.current&1?Tr===0&&(Tr=3):qc())),o.updateQueue!==null&&(o.flags|=4),an(o),null);case 4:return Fs(),qu(n,o),n===null&&Ds(o.stateNode.containerInfo),an(o),null;case 10:return vn(o.type._context),an(o),null;case 17:return yr(o.type)&&tl(),an(o),null;case 19:if(Mi(Oi),k=o.memoizedState,k===null)return an(o),null;if(_=(o.flags&128)!==0,O=k.rendering,O===null)if(_)Zu(k,!1);else{if(Tr!==0||n!==null&&n.flags&128)for(n=o.child;n!==null;){if(O=ys(n),O!==null){for(o.flags|=128,Zu(k,!1),_=O.updateQueue,_!==null&&(o.updateQueue=_,o.flags|=4),o.subtreeFlags=0,_=h,h=o.child;h!==null;)k=h,n=_,k.flags&=14680066,O=k.alternate,O===null?(k.childLanes=0,k.lanes=n,k.child=null,k.subtreeFlags=0,k.memoizedProps=null,k.memoizedState=null,k.updateQueue=null,k.dependencies=null,k.stateNode=null):(k.childLanes=O.childLanes,k.lanes=O.lanes,k.child=O.child,k.subtreeFlags=0,k.deletions=null,k.memoizedProps=O.memoizedProps,k.memoizedState=O.memoizedState,k.updateQueue=O.updateQueue,k.type=O.type,n=O.dependencies,k.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),h=h.sibling;return zi(Oi,Oi.current&1|2),o.child}n=n.sibling}k.tail!==null&&It()>fl&&(o.flags|=128,_=!0,Zu(k,!1),o.lanes=4194304)}else{if(!_)if(n=ys(O),n!==null){if(o.flags|=128,_=!0,h=n.updateQueue,h!==null&&(o.updateQueue=h,o.flags|=4),Zu(k,!0),k.tail===null&&k.tailMode==="hidden"&&!O.alternate&&!X)return an(o),null}else 2*It()-k.renderingStartTime>fl&&h!==1073741824&&(o.flags|=128,_=!0,Zu(k,!1),o.lanes=4194304);k.isBackwards?(O.sibling=o.child,o.child=O):(h=k.last,h!==null?h.sibling=O:o.child=O,k.last=O)}return k.tail!==null?(o=k.tail,k.rendering=o,k.tail=o.sibling,k.renderingStartTime=It(),o.sibling=null,h=Oi.current,zi(Oi,_?h&1|2:h&1),o):(an(o),null);case 22:case 23:return Bh(),_=o.memoizedState!==null,n!==null&&n.memoizedState!==null!==_&&(o.flags|=8192),_&&o.mode&1?is&1073741824&&(an(o),o.subtreeFlags&6&&(o.flags|=8192)):an(o),null;case 24:return null;case 25:return null}throw Error($(156,o.tag))}function rp(n,o){switch(j(o),o.tag){case 1:return yr(o.type)&&tl(),n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 3:return Fs(),Mi(dr),Mi(Dt),Xo(),n=o.flags,n&65536&&!(n&128)?(o.flags=n&-65537|128,o):null;case 5:return Hl(o),null;case 13:if(Mi(Oi),n=o.memoizedState,n!==null&&n.dehydrated!==null){if(o.alternate===null)throw Error($(340));Ve()}return n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 19:return Mi(Oi),null;case 4:return Fs(),null;case 10:return vn(o.type._context),null;case 22:case 23:return Bh(),null;case 24:return null;default:return null}}var Nc=!1,Wi=!1,np=typeof WeakSet=="function"?WeakSet:Set,ct=null;function Vs(n,o){var h=n.ref;if(h!==null)if(typeof h=="function")try{h(null)}catch(_){Qi(n,o,_)}else h.current=null}function Mh(n,o,h){try{h()}catch(_){Qi(n,o,_)}}var wd=!1;function sp(n,o){if($l=zo,n=ya(),lo(n)){if("selectionStart"in n)var h={start:n.selectionStart,end:n.selectionEnd};else e:{h=(h=n.ownerDocument)&&h.defaultView||window;var _=h.getSelection&&h.getSelection();if(_&&_.rangeCount!==0){h=_.anchorNode;var b=_.anchorOffset,k=_.focusNode;_=_.focusOffset;try{h.nodeType,k.nodeType}catch{h=null;break e}var O=0,Q=-1,se=-1,Se=0,Re=0,Be=n,De=null;t:for(;;){for(var Xe;Be!==h||b!==0&&Be.nodeType!==3||(Q=O+b),Be!==k||_!==0&&Be.nodeType!==3||(se=O+_),Be.nodeType===3&&(O+=Be.nodeValue.length),(Xe=Be.firstChild)!==null;)De=Be,Be=Xe;for(;;){if(Be===n)break t;if(De===h&&++Se===b&&(Q=O),De===k&&++Re===_&&(se=O),(Xe=Be.nextSibling)!==null)break;Be=De,De=Be.parentNode}Be=Xe}h=Q===-1||se===-1?null:{start:Q,end:se}}else h=null}h=h||{start:0,end:0}}else h=null;for(Mu={focusedElem:n,selectionRange:h},zo=!1,ct=o;ct!==null;)if(o=ct,n=o.child,(o.subtreeFlags&1028)!==0&&n!==null)n.return=o,ct=n;else for(;ct!==null;){o=ct;try{var lt=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(lt!==null){var ft=lt.memoizedProps,er=lt.memoizedState,ye=o.stateNode,ue=ye.getSnapshotBeforeUpdate(o.elementType===o.type?ft:vs(o.type,ft),er);ye.__reactInternalSnapshotBeforeUpdate=ue}break;case 3:var xe=o.stateNode.containerInfo;xe.nodeType===1?xe.textContent="":xe.nodeType===9&&xe.documentElement&&xe.removeChild(xe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error($(163))}}catch(qe){Qi(o,o.return,qe)}if(n=o.sibling,n!==null){n.return=o.return,ct=n;break}ct=o.return}return lt=wd,wd=!1,lt}function ru(n,o,h){var _=o.updateQueue;if(_=_!==null?_.lastEffect:null,_!==null){var b=_=_.next;do{if((b.tag&n)===n){var k=b.destroy;b.destroy=void 0,k!==void 0&&Mh(o,h,k)}b=b.next}while(b!==_)}}function Gu(n,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var h=o=o.next;do{if((h.tag&n)===n){var _=h.create;h.destroy=_()}h=h.next}while(h!==o)}}function zh(n){var o=n.ref;if(o!==null){var h=n.stateNode;switch(n.tag){case 5:n=h;break;default:n=h}typeof o=="function"?o(n):o.current=n}}function bd(n){var o=n.alternate;o!==null&&(n.alternate=null,bd(o)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(o=n.stateNode,o!==null&&(delete o[Gr],delete o[Zo],delete o[Qa],delete o[dh],delete o[Lu])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Sd(n){return n.tag===5||n.tag===3||n.tag===4}function Td(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Sd(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Hu(n,o,h){var _=n.tag;if(_===5||_===6)n=n.stateNode,o?h.nodeType===8?h.parentNode.insertBefore(n,o):h.insertBefore(n,o):(h.nodeType===8?(o=h.parentNode,o.insertBefore(n,h)):(o=h,o.appendChild(n)),h=h._reactRootContainer,h!=null||o.onclick!==null||(o.onclick=fs));else if(_!==4&&(n=n.child,n!==null))for(Hu(n,o,h),n=n.sibling;n!==null;)Hu(n,o,h),n=n.sibling}function hl(n,o,h){var _=n.tag;if(_===5||_===6)n=n.stateNode,o?h.insertBefore(n,o):h.appendChild(n);else if(_!==4&&(n=n.child,n!==null))for(hl(n,o,h),n=n.sibling;n!==null;)hl(n,o,h),n=n.sibling}var br=null,js=!1;function Ma(n,o,h){for(h=h.child;h!==null;)Ah(n,o,h),h=h.sibling}function Ah(n,o,h){if($r&&typeof $r.onCommitFiberUnmount=="function")try{$r.onCommitFiberUnmount(Pr,h)}catch{}switch(h.tag){case 5:Wi||Vs(h,o);case 6:var _=br,b=js;br=null,Ma(n,o,h),br=_,js=b,br!==null&&(js?(n=br,h=h.stateNode,n.nodeType===8?n.parentNode.removeChild(h):n.removeChild(h)):br.removeChild(h.stateNode));break;case 18:br!==null&&(js?(n=br,h=h.stateNode,n.nodeType===8?Zl(n.parentNode,h):n.nodeType===1&&Zl(n,h),Is(n)):Zl(br,h.stateNode));break;case 4:_=br,b=js,br=h.stateNode.containerInfo,js=!0,Ma(n,o,h),br=_,js=b;break;case 0:case 11:case 14:case 15:if(!Wi&&(_=h.updateQueue,_!==null&&(_=_.lastEffect,_!==null))){b=_=_.next;do{var k=b,O=k.destroy;k=k.tag,O!==void 0&&(k&2||k&4)&&Mh(h,o,O),b=b.next}while(b!==_)}Ma(n,o,h);break;case 1:if(!Wi&&(Vs(h,o),_=h.stateNode,typeof _.componentWillUnmount=="function"))try{_.props=h.memoizedProps,_.state=h.memoizedState,_.componentWillUnmount()}catch(Q){Qi(h,o,Q)}Ma(n,o,h);break;case 21:Ma(n,o,h);break;case 22:h.mode&1?(Wi=(_=Wi)||h.memoizedState!==null,Ma(n,o,h),Wi=_):Ma(n,o,h);break;default:Ma(n,o,h)}}function kd(n){var o=n.updateQueue;if(o!==null){n.updateQueue=null;var h=n.stateNode;h===null&&(h=n.stateNode=new np),o.forEach(function(_){var b=up.bind(null,n,_);h.has(_)||(h.add(_),_.then(b,b))})}}function Us(n,o){var h=o.deletions;if(h!==null)for(var _=0;_<h.length;_++){var b=h[_];try{var k=n,O=o,Q=O;e:for(;Q!==null;){switch(Q.tag){case 5:br=Q.stateNode,js=!1;break e;case 3:br=Q.stateNode.containerInfo,js=!0;break e;case 4:br=Q.stateNode.containerInfo,js=!0;break e}Q=Q.return}if(br===null)throw Error($(160));Ah(k,O,b),br=null,js=!1;var se=b.alternate;se!==null&&(se.return=null),b.return=null}catch(Se){Qi(b,o,Se)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)nu(o,n),o=o.sibling}function nu(n,o){var h=n.alternate,_=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Us(o,n),$s(n),_&4){try{ru(3,n,n.return),Gu(3,n)}catch(ft){Qi(n,n.return,ft)}try{ru(5,n,n.return)}catch(ft){Qi(n,n.return,ft)}}break;case 1:Us(o,n),$s(n),_&512&&h!==null&&Vs(h,h.return);break;case 5:if(Us(o,n),$s(n),_&512&&h!==null&&Vs(h,h.return),n.flags&32){var b=n.stateNode;try{nr(b,"")}catch(ft){Qi(n,n.return,ft)}}if(_&4&&(b=n.stateNode,b!=null)){var k=n.memoizedProps,O=h!==null?h.memoizedProps:k,Q=n.type,se=n.updateQueue;if(n.updateQueue=null,se!==null)try{Q==="input"&&k.type==="radio"&&k.name!=null&&be(b,k),fn(Q,O);var Se=fn(Q,k);for(O=0;O<se.length;O+=2){var Re=se[O],Be=se[O+1];Re==="style"?Nt(b,Be):Re==="dangerouslySetInnerHTML"?jn(b,Be):Re==="children"?nr(b,Be):vt(b,Re,Be,Se)}switch(Q){case"input":Ss(b,k);break;case"textarea":To(b,k);break;case"select":var De=b._wrapperState.wasMultiple;b._wrapperState.wasMultiple=!!k.multiple;var Xe=k.value;Xe!=null?ls(b,!!k.multiple,Xe,!1):De!==!!k.multiple&&(k.defaultValue!=null?ls(b,!!k.multiple,k.defaultValue,!0):ls(b,!!k.multiple,k.multiple?[]:"",!1))}b[Zo]=k}catch(ft){Qi(n,n.return,ft)}}break;case 6:if(Us(o,n),$s(n),_&4){if(n.stateNode===null)throw Error($(162));b=n.stateNode,k=n.memoizedProps;try{b.nodeValue=k}catch(ft){Qi(n,n.return,ft)}}break;case 3:if(Us(o,n),$s(n),_&4&&h!==null&&h.memoizedState.isDehydrated)try{Is(o.containerInfo)}catch(ft){Qi(n,n.return,ft)}break;case 4:Us(o,n),$s(n);break;case 13:Us(o,n),$s(n),b=n.child,b.flags&8192&&(k=b.memoizedState!==null,b.stateNode.isHidden=k,!k||b.alternate!==null&&b.alternate.memoizedState!==null||(Xi=It())),_&4&&kd(n);break;case 22:if(Re=h!==null&&h.memoizedState!==null,n.mode&1?(Wi=(Se=Wi)||Re,Us(o,n),Wi=Se):Us(o,n),$s(n),_&8192){if(Se=n.memoizedState!==null,(n.stateNode.isHidden=Se)&&!Re&&n.mode&1)for(ct=n,Re=n.child;Re!==null;){for(Be=ct=Re;ct!==null;){switch(De=ct,Xe=De.child,De.tag){case 0:case 11:case 14:case 15:ru(4,De,De.return);break;case 1:Vs(De,De.return);var lt=De.stateNode;if(typeof lt.componentWillUnmount=="function"){_=De,h=De.return;try{o=_,lt.props=o.memoizedProps,lt.state=o.memoizedState,lt.componentWillUnmount()}catch(ft){Qi(_,h,ft)}}break;case 5:Vs(De,De.return);break;case 22:if(De.memoizedState!==null){Cd(Be);continue}}Xe!==null?(Xe.return=De,ct=Xe):Cd(Be)}Re=Re.sibling}e:for(Re=null,Be=n;;){if(Be.tag===5){if(Re===null){Re=Be;try{b=Be.stateNode,Se?(k=b.style,typeof k.setProperty=="function"?k.setProperty("display","none","important"):k.display="none"):(Q=Be.stateNode,se=Be.memoizedProps.style,O=se!=null&&se.hasOwnProperty("display")?se.display:null,Q.style.display=Ue("display",O))}catch(ft){Qi(n,n.return,ft)}}}else if(Be.tag===6){if(Re===null)try{Be.stateNode.nodeValue=Se?"":Be.memoizedProps}catch(ft){Qi(n,n.return,ft)}}else if((Be.tag!==22&&Be.tag!==23||Be.memoizedState===null||Be===n)&&Be.child!==null){Be.child.return=Be,Be=Be.child;continue}if(Be===n)break e;for(;Be.sibling===null;){if(Be.return===null||Be.return===n)break e;Re===Be&&(Re=null),Be=Be.return}Re===Be&&(Re=null),Be.sibling.return=Be.return,Be=Be.sibling}}break;case 19:Us(o,n),$s(n),_&4&&kd(n);break;case 21:break;default:Us(o,n),$s(n)}}function $s(n){var o=n.flags;if(o&2){try{e:{for(var h=n.return;h!==null;){if(Sd(h)){var _=h;break e}h=h.return}throw Error($(160))}switch(_.tag){case 5:var b=_.stateNode;_.flags&32&&(nr(b,""),_.flags&=-33);var k=Td(n);hl(n,k,b);break;case 3:case 4:var O=_.stateNode.containerInfo,Q=Td(n);Hu(n,Q,O);break;default:throw Error($(161))}}catch(se){Qi(n,n.return,se)}n.flags&=-3}o&4096&&(n.flags&=-4097)}function op(n,o,h){ct=n,Id(n)}function Id(n,o,h){for(var _=(n.mode&1)!==0;ct!==null;){var b=ct,k=b.child;if(b.tag===22&&_){var O=b.memoizedState!==null||Nc;if(!O){var Q=b.alternate,se=Q!==null&&Q.memoizedState!==null||Wi;Q=Nc;var Se=Wi;if(Nc=O,(Wi=se)&&!Se)for(ct=b;ct!==null;)O=ct,se=O.child,O.tag===22&&O.memoizedState!==null?Pd(b):se!==null?(se.return=O,ct=se):Pd(b);for(;k!==null;)ct=k,Id(k),k=k.sibling;ct=b,Nc=Q,Wi=Se}Ed(n)}else b.subtreeFlags&8772&&k!==null?(k.return=b,ct=k):Ed(n)}}function Ed(n){for(;ct!==null;){var o=ct;if(o.flags&8772){var h=o.alternate;try{if(o.flags&8772)switch(o.tag){case 0:case 11:case 15:Wi||Gu(5,o);break;case 1:var _=o.stateNode;if(o.flags&4&&!Wi)if(h===null)_.componentDidMount();else{var b=o.elementType===o.type?h.memoizedProps:vs(o.type,h.memoizedProps);_.componentDidUpdate(b,h.memoizedState,_.__reactInternalSnapshotBeforeUpdate)}var k=o.updateQueue;k!==null&&Rs(o,k,_);break;case 3:var O=o.updateQueue;if(O!==null){if(h=null,o.child!==null)switch(o.child.tag){case 5:h=o.child.stateNode;break;case 1:h=o.child.stateNode}Rs(o,O,h)}break;case 5:var Q=o.stateNode;if(h===null&&o.flags&4){h=Q;var se=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":se.autoFocus&&h.focus();break;case"img":se.src&&(h.src=se.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var Se=o.alternate;if(Se!==null){var Re=Se.memoizedState;if(Re!==null){var Be=Re.dehydrated;Be!==null&&Is(Be)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error($(163))}Wi||o.flags&512&&zh(o)}catch(De){Qi(o,o.return,De)}}if(o===n){ct=null;break}if(h=o.sibling,h!==null){h.return=o.return,ct=h;break}ct=o.return}}function Cd(n){for(;ct!==null;){var o=ct;if(o===n){ct=null;break}var h=o.sibling;if(h!==null){h.return=o.return,ct=h;break}ct=o.return}}function Pd(n){for(;ct!==null;){var o=ct;try{switch(o.tag){case 0:case 11:case 15:var h=o.return;try{Gu(4,o)}catch(se){Qi(o,h,se)}break;case 1:var _=o.stateNode;if(typeof _.componentDidMount=="function"){var b=o.return;try{_.componentDidMount()}catch(se){Qi(o,b,se)}}var k=o.return;try{zh(o)}catch(se){Qi(o,k,se)}break;case 5:var O=o.return;try{zh(o)}catch(se){Qi(o,O,se)}}}catch(se){Qi(o,o.return,se)}if(o===n){ct=null;break}var Q=o.sibling;if(Q!==null){Q.return=o.return,ct=Q;break}ct=o.return}}var ap=Math.ceil,Wu=zt.ReactCurrentDispatcher,Xu=zt.ReactCurrentOwner,ts=zt.ReactCurrentBatchConfig,ui=0,Sr=null,mr=null,gr=0,is=0,dl=Ls(0),Tr=0,Ku=null,pl=0,Ju=0,Dh=0,Yu=null,Lr=null,Xi=0,fl=1/0,_o=null,Qu=!1,mi=null,yo=null,ec=!1,Jo=null,xs=0,vo=0,Vc=null,jc=-1,Uc=0;function bn(){return ui&6?It():jc!==-1?jc:jc=It()}function za(n){return n.mode&1?ui&2&&gr!==0?gr&-gr:je.transition!==null?(Uc===0&&(Uc=ks()),Uc):(n=pi,n!==0||(n=window.event,n=n===void 0?16:ro(n.type)),n):1}function qs(n,o,h,_){if(50<vo)throw vo=0,Vc=null,Error($(185));Po(n,h,_),(!(ui&2)||n!==Sr)&&(n===Sr&&(!(ui&2)&&(Ju|=h),Tr===4&&rs(n,gr)),Ln(n,_),h===1&&ui===0&&!(o.mode&1)&&(fl=It()+500,Wo&&p()))}function Ln(n,o){var h=n.callbackNode;wl(n,o);var _=en(n,n===Sr?gr:0);if(_===0)h!==null&&cr(h),n.callbackNode=null,n.callbackPriority=0;else if(o=_&-_,n.callbackPriority!==o){if(h!=null&&cr(h),o===1)n.tag===0?sn(Fh.bind(null,n)):nl(Fh.bind(null,n)),ms(function(){!(ui&6)&&p()}),h=null;else{switch(Oa(_)){case 1:h=Fa;break;case 4:h=Yr;break;case 16:h=Cr;break;case 536870912:h=gn;break;default:h=Cr}h=Uh(h,Md.bind(null,n))}n.callbackPriority=o,n.callbackNode=h}}function Md(n,o){if(jc=-1,Uc=0,ui&6)throw Error($(327));var h=n.callbackNode;if(ea()&&n.callbackNode!==h)return null;var _=en(n,n===Sr?gr:0);if(_===0)return null;if(_&30||_&n.expiredLanes||o)o=Rr(n,_);else{o=_;var b=ui;ui|=2;var k=Oh();(Sr!==n||gr!==o)&&(_o=null,fl=It()+500,ml(n,o));do try{Ad();break}catch(Q){zd(n,Q)}while(!0);pr(),Wu.current=k,ui=b,mr!==null?o=0:(Sr=null,gr=0,o=Tr)}if(o!==0){if(o===2&&(b=Ts(n),b!==0&&(_=b,o=Lh(n,b))),o===1)throw h=Ku,ml(n,0),rs(n,_),Ln(n,It()),h;if(o===6)rs(n,_);else{if(b=n.current.alternate,!(_&30)&&!$c(b)&&(o=Rr(n,_),o===2&&(k=Ts(n),k!==0&&(_=k,o=Lh(n,k))),o===1))throw h=Ku,ml(n,0),rs(n,_),Ln(n,It()),h;switch(n.finishedWork=b,n.finishedLanes=_,o){case 0:case 1:throw Error($(345));case 2:Zs(n,Lr,_o);break;case 3:if(rs(n,_),(_&130023424)===_&&(o=Xi+500-It(),10<o)){if(en(n,0)!==0)break;if(b=n.suspendedLanes,(b&_)!==_){bn(),n.pingedLanes|=n.suspendedLanes&b;break}n.timeoutHandle=ql(Zs.bind(null,n,Lr,_o),o);break}Zs(n,Lr,_o);break;case 4:if(rs(n,_),(_&4194240)===_)break;for(o=n.eventTimes,b=-1;0<_;){var O=31-xi(_);k=1<<O,O=o[O],O>b&&(b=O),_&=~k}if(_=b,_=It()-_,_=(120>_?120:480>_?480:1080>_?1080:1920>_?1920:3e3>_?3e3:4320>_?4320:1960*ap(_/1960))-_,10<_){n.timeoutHandle=ql(Zs.bind(null,n,Lr,_o),_);break}Zs(n,Lr,_o);break;case 5:Zs(n,Lr,_o);break;default:throw Error($(329))}}}return Ln(n,It()),n.callbackNode===h?Md.bind(null,n):null}function Lh(n,o){var h=Yu;return n.current.memoizedState.isDehydrated&&(ml(n,o).flags|=256),n=Rr(n,o),n!==2&&(o=Lr,Lr=h,o!==null&&Rh(o)),n}function Rh(n){Lr===null?Lr=n:Lr.push.apply(Lr,n)}function $c(n){for(var o=n;;){if(o.flags&16384){var h=o.updateQueue;if(h!==null&&(h=h.stores,h!==null))for(var _=0;_<h.length;_++){var b=h[_],k=b.getSnapshot;b=b.value;try{if(!Zr(k(),b))return!1}catch{return!1}}}if(h=o.child,o.subtreeFlags&16384&&h!==null)h.return=o,o=h;else{if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function rs(n,o){for(o&=~Dh,o&=~Ju,n.suspendedLanes|=o,n.pingedLanes&=~o,n=n.expirationTimes;0<o;){var h=31-xi(o),_=1<<h;n[h]=-1,o&=~_}}function Fh(n){if(ui&6)throw Error($(327));ea();var o=en(n,0);if(!(o&1))return Ln(n,It()),null;var h=Rr(n,o);if(n.tag!==0&&h===2){var _=Ts(n);_!==0&&(o=_,h=Lh(n,_))}if(h===1)throw h=Ku,ml(n,0),rs(n,o),Ln(n,It()),h;if(h===6)throw Error($(345));return n.finishedWork=n.current.alternate,n.finishedLanes=o,Zs(n,Lr,_o),Ln(n,It()),null}function tc(n,o){var h=ui;ui|=1;try{return n(o)}finally{ui=h,ui===0&&(fl=It()+500,Wo&&p())}}function Yo(n){Jo!==null&&Jo.tag===0&&!(ui&6)&&ea();var o=ui;ui|=1;var h=ts.transition,_=pi;try{if(ts.transition=null,pi=1,n)return n()}finally{pi=_,ts.transition=h,ui=o,!(ui&6)&&p()}}function Bh(){is=dl.current,Mi(dl)}function ml(n,o){n.finishedWork=null,n.finishedLanes=0;var h=n.timeoutHandle;if(h!==-1&&(n.timeoutHandle=-1,Au(h)),mr!==null)for(h=mr.return;h!==null;){var _=h;switch(j(_),_.tag){case 1:_=_.type.childContextTypes,_!=null&&tl();break;case 3:Fs(),Mi(dr),Mi(Dt),Xo();break;case 5:Hl(_);break;case 4:Fs();break;case 13:Mi(Oi);break;case 19:Mi(Oi);break;case 10:vn(_.type._context);break;case 22:case 23:Bh()}h=h.return}if(Sr=n,mr=n=ta(n.current,null),gr=is=o,Tr=0,Ku=null,Dh=Ju=pl=0,Lr=Yu=null,Hi!==null){for(o=0;o<Hi.length;o++)if(h=Hi[o],_=h.interleaved,_!==null){h.interleaved=null;var b=_.next,k=h.pending;if(k!==null){var O=k.next;k.next=b,_.next=O}h.pending=_}Hi=null}return n}function zd(n,o){do{var h=mr;try{if(pr(),Ia.current=al,Ru){for(var _=fi.memoizedState;_!==null;){var b=_.queue;b!==null&&(b.pending=null),_=_.next}Ru=!1}if(Qn=0,xr=Yi=fi=null,Fu=!1,sl=0,Xu.current=null,h===null||h.return===null){Tr=1,Ku=o,mr=null;break}e:{var k=n,O=h.return,Q=h,se=o;if(o=gr,Q.flags|=32768,se!==null&&typeof se=="object"&&typeof se.then=="function"){var Se=se,Re=Q,Be=Re.tag;if(!(Re.mode&1)&&(Be===0||Be===11||Be===15)){var De=Re.alternate;De?(Re.updateQueue=De.updateQueue,Re.memoizedState=De.memoizedState,Re.lanes=De.lanes):(Re.updateQueue=null,Re.memoizedState=null)}var Xe=dd(O);if(Xe!==null){Xe.flags&=-257,Sh(Xe,O,Q,k,o),Xe.mode&1&&hd(k,Se,o),o=Xe,se=Se;var lt=o.updateQueue;if(lt===null){var ft=new Set;ft.add(se),o.updateQueue=ft}else lt.add(se);break e}else{if(!(o&1)){hd(k,Se,o),qc();break e}se=Error($(426))}}else if(X&&Q.mode&1){var er=dd(O);if(er!==null){!(er.flags&65536)&&(er.flags|=256),Sh(er,O,Q,k,o),We(ll(se,Q));break e}}k=se=ll(se,Q),Tr!==4&&(Tr=2),Yu===null?Yu=[k]:Yu.push(k),k=O;do{switch(k.tag){case 3:k.flags|=65536,o&=-o,k.lanes|=o;var ye=ud(k,se,o);Dn(k,ye);break e;case 1:Q=se;var ue=k.type,xe=k.stateNode;if(!(k.flags&128)&&(typeof ue.getDerivedStateFromError=="function"||xe!==null&&typeof xe.componentDidCatch=="function"&&(yo===null||!yo.has(xe)))){k.flags|=65536,o&=-o,k.lanes|=o;var qe=cd(k,Q,o);Dn(k,qe);break e}}k=k.return}while(k!==null)}su(h)}catch(gt){o=gt,mr===h&&h!==null&&(mr=h=h.return);continue}break}while(!0)}function Oh(){var n=Wu.current;return Wu.current=al,n===null?al:n}function qc(){(Tr===0||Tr===3||Tr===2)&&(Tr=4),Sr===null||!(pl&268435455)&&!(Ju&268435455)||rs(Sr,gr)}function Rr(n,o){var h=ui;ui|=2;var _=Oh();(Sr!==n||gr!==o)&&(_o=null,ml(n,o));do try{Nh();break}catch(b){zd(n,b)}while(!0);if(pr(),ui=h,Wu.current=_,mr!==null)throw Error($(261));return Sr=null,gr=0,Tr}function Nh(){for(;mr!==null;)Qo(mr)}function Ad(){for(;mr!==null&&!Ur();)Qo(mr)}function Qo(n){var o=jh(n.alternate,n,is);n.memoizedProps=n.pendingProps,o===null?su(n):mr=o,Xu.current=null}function su(n){var o=n;do{var h=o.alternate;if(n=o.return,o.flags&32768){if(h=rp(h,o),h!==null){h.flags&=32767,mr=h;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Tr=6,mr=null;return}}else if(h=ip(h,o,is),h!==null){mr=h;return}if(o=o.sibling,o!==null){mr=o;return}mr=o=n}while(o!==null);Tr===0&&(Tr=5)}function Zs(n,o,h){var _=pi,b=ts.transition;try{ts.transition=null,pi=1,ou(n,o,h,_)}finally{ts.transition=b,pi=_}return null}function ou(n,o,h,_){do ea();while(Jo!==null);if(ui&6)throw Error($(327));h=n.finishedWork;var b=n.finishedLanes;if(h===null)return null;if(n.finishedWork=null,n.finishedLanes=0,h===n.current)throw Error($(177));n.callbackNode=null,n.callbackPriority=0;var k=h.lanes|h.childLanes;if(du(n,k),n===Sr&&(mr=Sr=null,gr=0),!(h.subtreeFlags&2064)&&!(h.flags&2064)||ec||(ec=!0,Uh(Cr,function(){return ea(),null})),k=(h.flags&15990)!==0,h.subtreeFlags&15990||k){k=ts.transition,ts.transition=null;var O=pi;pi=1;var Q=ui;ui|=4,Xu.current=null,sp(n,h),nu(h,n),Fl(Mu),zo=!!$l,Mu=$l=null,n.current=h,op(h),la(),ui=Q,pi=O,ts.transition=k}else n.current=h;if(ec&&(ec=!1,Jo=n,xs=b),k=n.pendingLanes,k===0&&(yo=null),Io(h.stateNode),Ln(n,It()),o!==null)for(_=n.onRecoverableError,h=0;h<o.length;h++)b=o[h],_(b.value,{componentStack:b.stack,digest:b.digest});if(Qu)throw Qu=!1,n=mi,mi=null,n;return xs&1&&n.tag!==0&&ea(),k=n.pendingLanes,k&1?n===Vc?vo++:(vo=0,Vc=n):vo=0,p(),null}function ea(){if(Jo!==null){var n=Oa(xs),o=ts.transition,h=pi;try{if(ts.transition=null,pi=16>n?16:n,Jo===null)var _=!1;else{if(n=Jo,Jo=null,xs=0,ui&6)throw Error($(331));var b=ui;for(ui|=4,ct=n.current;ct!==null;){var k=ct,O=k.child;if(ct.flags&16){var Q=k.deletions;if(Q!==null){for(var se=0;se<Q.length;se++){var Se=Q[se];for(ct=Se;ct!==null;){var Re=ct;switch(Re.tag){case 0:case 11:case 15:ru(8,Re,k)}var Be=Re.child;if(Be!==null)Be.return=Re,ct=Be;else for(;ct!==null;){Re=ct;var De=Re.sibling,Xe=Re.return;if(bd(Re),Re===Se){ct=null;break}if(De!==null){De.return=Xe,ct=De;break}ct=Xe}}}var lt=k.alternate;if(lt!==null){var ft=lt.child;if(ft!==null){lt.child=null;do{var er=ft.sibling;ft.sibling=null,ft=er}while(ft!==null)}}ct=k}}if(k.subtreeFlags&2064&&O!==null)O.return=k,ct=O;else e:for(;ct!==null;){if(k=ct,k.flags&2048)switch(k.tag){case 0:case 11:case 15:ru(9,k,k.return)}var ye=k.sibling;if(ye!==null){ye.return=k.return,ct=ye;break e}ct=k.return}}var ue=n.current;for(ct=ue;ct!==null;){O=ct;var xe=O.child;if(O.subtreeFlags&2064&&xe!==null)xe.return=O,ct=xe;else e:for(O=ue;ct!==null;){if(Q=ct,Q.flags&2048)try{switch(Q.tag){case 0:case 11:case 15:Gu(9,Q)}}catch(gt){Qi(Q,Q.return,gt)}if(Q===O){ct=null;break e}var qe=Q.sibling;if(qe!==null){qe.return=Q.return,ct=qe;break e}ct=Q.return}}if(ui=b,p(),$r&&typeof $r.onPostCommitFiberRoot=="function")try{$r.onPostCommitFiberRoot(Pr,n)}catch{}_=!0}return _}finally{pi=h,ts.transition=o}}return!1}function ic(n,o,h){o=ll(h,o),o=ud(n,o,1),n=_s(n,o,1),o=bn(),n!==null&&(Po(n,1,o),Ln(n,o))}function Qi(n,o,h){if(n.tag===3)ic(n,n,h);else for(;o!==null;){if(o.tag===3){ic(o,n,h);break}else if(o.tag===1){var _=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof _.componentDidCatch=="function"&&(yo===null||!yo.has(_))){n=ll(h,n),n=cd(o,n,1),o=_s(o,n,1),n=bn(),o!==null&&(Po(o,1,n),Ln(o,n));break}}o=o.return}}function lp(n,o,h){var _=n.pingCache;_!==null&&_.delete(o),o=bn(),n.pingedLanes|=n.suspendedLanes&h,Sr===n&&(gr&h)===h&&(Tr===4||Tr===3&&(gr&130023424)===gr&&500>It()-Xi?ml(n,0):Dh|=h),Ln(n,o)}function Vh(n,o){o===0&&(n.mode&1?(o=Qr,Qr<<=1,!(Qr&130023424)&&(Qr=4194304)):o=1);var h=bn();n=on(n,o),n!==null&&(Po(n,o,h),Ln(n,h))}function Dd(n){var o=n.memoizedState,h=0;o!==null&&(h=o.retryLane),Vh(n,h)}function up(n,o){var h=0;switch(n.tag){case 13:var _=n.stateNode,b=n.memoizedState;b!==null&&(h=b.retryLane);break;case 19:_=n.stateNode;break;default:throw Error($(314))}_!==null&&_.delete(o),Vh(n,h)}var jh;jh=function(n,o,h){if(n!==null)if(n.memoizedProps!==o.pendingProps||dr.current)fr=!0;else{if(!(n.lanes&h)&&!(o.flags&128))return fr=!1,Eh(n,o,h);fr=!!(n.flags&131072)}else fr=!1,X&&o.flags&1048576&&M(o,u,o.index);switch(o.lanes=0,o.tag){case 2:var _=o.type;Pa(n,o),n=o.pendingProps;var b=po(o,Dt.current);or(o,h),b=es(null,o,_,n,b,h);var k=go();return o.flags|=1,typeof b=="object"&&b!==null&&typeof b.render=="function"&&b.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,yr(_)?(k=!0,Ho(o)):k=!1,o.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,xn(o),b.updater=eu,o.stateNode=b,b._reactInternals=o,wn(o,_,n,h),o=Uu(null,o,_,!0,k,h)):(o.tag=0,X&&k&&B(o),wr(null,o,b,h),o=o.child),o;case 16:_=o.elementType;e:{switch(Pa(n,o),n=o.pendingProps,b=_._init,_=b(_._payload),o.type=_,b=o.tag=cp(_),n=vs(_,n),b){case 0:o=Th(null,o,_,n,h);break e;case 1:o=vd(null,o,_,n,h);break e;case 11:o=fd(null,o,_,n,h);break e;case 14:o=md(null,o,_,vs(_.type,n),h);break e}throw Error($(306,_,""))}return o;case 0:return _=o.type,b=o.pendingProps,b=o.elementType===_?b:vs(_,b),Th(n,o,_,b,h);case 1:return _=o.type,b=o.pendingProps,b=o.elementType===_?b:vs(_,b),vd(n,o,_,b,h);case 3:e:{if(xd(o),n===null)throw Error($(387));_=o.pendingProps,k=o.memoizedState,b=k.element,fo(n,o),Ar(o,_,null,h);var O=o.memoizedState;if(_=O.element,k.isDehydrated)if(k={element:_,isDehydrated:!1,cache:O.cache,pendingSuspenseBoundaries:O.pendingSuspenseBoundaries,transitions:O.transitions},o.updateQueue.baseState=k,o.memoizedState=k,o.flags&256){b=ll(Error($(423)),o),o=ul(n,o,_,h,b);break e}else if(_!==b){b=ll(Error($(424)),o),o=ul(n,o,_,h,b);break e}else for(G=Mn(o.stateNode.containerInfo.firstChild),q=o,X=!0,Y=null,h=bt(o,null,_,h),o.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(Ve(),_===b){o=Ns(n,o,h);break e}wr(n,o,_,h)}o=o.child}return o;case 5:return Ec(o),n===null&&ce(o),_=o.type,b=o.pendingProps,k=n!==null?n.memoizedProps:null,O=b.children,zu(_,b)?O=null:k!==null&&zu(_,k)&&(o.flags|=32),yd(n,o),wr(n,o,O,h),o.child;case 6:return n===null&&ce(o),null;case 13:return $u(n,o,h);case 4:return mo(o,o.stateNode.containerInfo),_=o.pendingProps,n===null?o.child=Ge(o,null,_,h):wr(n,o,_,h),o.child;case 11:return _=o.type,b=o.pendingProps,b=o.elementType===_?b:vs(_,b),fd(n,o,_,b,h);case 7:return wr(n,o,o.pendingProps,h),o.child;case 8:return wr(n,o,o.pendingProps.children,h),o.child;case 12:return wr(n,o,o.pendingProps.children,h),o.child;case 10:e:{if(_=o.type._context,b=o.pendingProps,k=o.memoizedProps,O=b.value,zi(wi,_._currentValue),_._currentValue=O,k!==null)if(Zr(k.value,O)){if(k.children===b.children&&!dr.current){o=Ns(n,o,h);break e}}else for(k=o.child,k!==null&&(k.return=o);k!==null;){var Q=k.dependencies;if(Q!==null){O=k.child;for(var se=Q.firstContext;se!==null;){if(se.context===_){if(k.tag===1){se=An(-1,h&-h),se.tag=2;var Se=k.updateQueue;if(Se!==null){Se=Se.shared;var Re=Se.pending;Re===null?se.next=se:(se.next=Re.next,Re.next=se),Se.pending=se}}k.lanes|=h,se=k.alternate,se!==null&&(se.lanes|=h),ki(k.return,h,o),Q.lanes|=h;break}se=se.next}}else if(k.tag===10)O=k.type===o.type?null:k.child;else if(k.tag===18){if(O=k.return,O===null)throw Error($(341));O.lanes|=h,Q=O.alternate,Q!==null&&(Q.lanes|=h),ki(O,h,o),O=k.sibling}else O=k.child;if(O!==null)O.return=k;else for(O=k;O!==null;){if(O===o){O=null;break}if(k=O.sibling,k!==null){k.return=O.return,O=k;break}O=O.return}k=O}wr(n,o,b.children,h),o=o.child}return o;case 9:return b=o.type,_=o.pendingProps.children,or(o,h),b=Ai(b),_=_(b),o.flags|=1,wr(n,o,_,h),o.child;case 14:return _=o.type,b=vs(_,o.pendingProps),b=vs(_.type,b),md(n,o,_,b,h);case 15:return gd(n,o,o.type,o.pendingProps,h);case 17:return _=o.type,b=o.pendingProps,b=o.elementType===_?b:vs(_,b),Pa(n,o),o.tag=1,yr(_)?(n=!0,Ho(o)):n=!1,or(o,h),Lc(o,_,b),wn(o,_,b,h),Uu(null,o,_,!0,n,h);case 19:return Ih(n,o,h);case 22:return _d(n,o,h)}throw Error($(156,o.tag))};function Uh(n,o){return sr(n,o)}function $h(n,o,h,_){this.tag=n,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=_,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rn(n,o,h,_){return new $h(n,o,h,_)}function qh(n){return n=n.prototype,!(!n||!n.isReactComponent)}function cp(n){if(typeof n=="function")return qh(n)?1:0;if(n!=null){if(n=n.$$typeof,n===dn)return 11;if(n===ur)return 14}return 2}function ta(n,o){var h=n.alternate;return h===null?(h=Rn(n.tag,o,n.key,n.mode),h.elementType=n.elementType,h.type=n.type,h.stateNode=n.stateNode,h.alternate=n,n.alternate=h):(h.pendingProps=o,h.type=n.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=n.flags&14680064,h.childLanes=n.childLanes,h.lanes=n.lanes,h.child=n.child,h.memoizedProps=n.memoizedProps,h.memoizedState=n.memoizedState,h.updateQueue=n.updateQueue,o=n.dependencies,h.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},h.sibling=n.sibling,h.index=n.index,h.ref=n.ref,h}function rc(n,o,h,_,b,k){var O=2;if(_=n,typeof n=="function")qh(n)&&(O=1);else if(typeof n=="string")O=5;else e:switch(n){case Wt:return Gs(h.children,b,k,o);case yi:O=8,b|=8;break;case Ji:return n=Rn(12,h,o,b|2),n.elementType=Ji,n.lanes=k,n;case bi:return n=Rn(13,h,o,b),n.elementType=bi,n.lanes=k,n;case Li:return n=Rn(19,h,o,b),n.elementType=Li,n.lanes=k,n;case hi:return ns(h,b,k,o);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Vr:O=10;break e;case Kt:O=9;break e;case dn:O=11;break e;case ur:O=14;break e;case ir:O=16,_=null;break e}throw Error($(130,n==null?n:typeof n,""))}return o=Rn(O,h,o,b),o.elementType=n,o.type=_,o.lanes=k,o}function Gs(n,o,h,_){return n=Rn(7,n,_,o),n.lanes=h,n}function ns(n,o,h,_){return n=Rn(22,n,_,o),n.elementType=hi,n.lanes=h,n.stateNode={isHidden:!1},n}function xo(n,o,h){return n=Rn(6,n,null,o),n.lanes=h,n}function Zc(n,o,h){return o=Rn(4,n.children!==null?n.children:[],n.key,o),o.lanes=h,o.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},o}function Zh(n,o,h,_,b){this.tag=o,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ri(0),this.expirationTimes=ri(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ri(0),this.identifierPrefix=_,this.onRecoverableError=b,this.mutableSourceEagerHydrationData=null}function Gh(n,o,h,_,b,k,O,Q,se){return n=new Zh(n,o,h,Q,se),o===1?(o=1,k===!0&&(o|=8)):o=0,k=Rn(3,null,null,o),n.current=k,k.stateNode=n,k.memoizedState={element:_,isDehydrated:h,cache:null,transitions:null,pendingSuspenseBoundaries:null},xn(k),n}function hp(n,o,h){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Gt,key:_==null?null:""+_,children:n,containerInfo:o,implementation:h}}function nc(n){if(!n)return nn;n=n._reactInternals;e:{if(Rt(n)!==n||n.tag!==1)throw Error($(170));var o=n;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(yr(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error($(171))}if(n.tag===1){var h=n.type;if(yr(h))return Hr(n,h,o)}return o}function Gc(n,o,h,_,b,k,O,Q,se){return n=Gh(h,_,!0,n,b,k,O,Q,se),n.context=nc(null),h=n.current,_=bn(),b=za(h),k=An(_,b),k.callback=o??null,_s(h,k,b),n.current.lanes=b,Po(n,b,_),Ln(n,_),n}function Hc(n,o,h,_){var b=o.current,k=bn(),O=za(b);return h=nc(h),o.context===null?o.context=h:o.pendingContext=h,o=An(k,O),o.payload={element:n},_=_===void 0?null:_,_!==null&&(o.callback=_),n=_s(b,o,O),n!==null&&(qs(n,b,O,k),zr(n,b,O)),O}function au(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function Wc(n,o){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var h=n.retryLane;n.retryLane=h!==0&&h<o?h:o}}function Aa(n,o){Wc(n,o),(n=n.alternate)&&Wc(n,o)}var Hh=typeof reportError=="function"?reportError:function(n){console.error(n)};function Xc(n){this._internalRoot=n}lu.prototype.render=Xc.prototype.render=function(n){var o=this._internalRoot;if(o===null)throw Error($(409));Hc(n,o,null,null)},lu.prototype.unmount=Xc.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var o=n.containerInfo;Yo(function(){Hc(null,n,null,null)}),o[Pt]=null}};function lu(n){this._internalRoot=n}lu.prototype.unstable_scheduleHydration=function(n){if(n){var o=pu();n={blockedOn:null,target:n,priority:o};for(var h=0;h<qn.length&&o!==0&&o<qn[h].priority;h++);qn.splice(h,0,n),h===0&&mu(n)}};function Kc(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function gl(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function Wh(){}function dp(n,o,h,_,b){if(b){if(typeof _=="function"){var k=_;_=function(){var Se=au(O);k.call(Se)}}var O=Gc(o,_,n,0,null,!1,!1,"",Wh);return n._reactRootContainer=O,n[Pt]=O.current,Ds(n.nodeType===8?n.parentNode:n),Yo(),O}for(;b=n.lastChild;)n.removeChild(b);if(typeof _=="function"){var Q=_;_=function(){var Se=au(se);Q.call(Se)}}var se=Gh(n,0,!1,null,null,!1,!1,"",Wh);return n._reactRootContainer=se,n[Pt]=se.current,Ds(n.nodeType===8?n.parentNode:n),Yo(function(){Hc(o,se,h,_)}),se}function Jc(n,o,h,_,b){var k=h._reactRootContainer;if(k){var O=k;if(typeof b=="function"){var Q=b;b=function(){var se=au(O);Q.call(se)}}Hc(o,O,n,b)}else O=dp(h,o,n,b,_);return au(O)}ua=function(n){switch(n.tag){case 3:var o=n.stateNode;if(o.current.memoizedState.isDehydrated){var h=Co(o.pendingLanes);h!==0&&(eo(o,h|1),Ln(o,It()),!(ui&6)&&(fl=It()+500,p()))}break;case 13:Yo(function(){var _=on(n,1);if(_!==null){var b=bn();qs(_,n,1,b)}}),Aa(n,1)}},ca=function(n){if(n.tag===13){var o=on(n,134217728);if(o!==null){var h=bn();qs(o,n,134217728,h)}Aa(n,134217728)}},Mo=function(n){if(n.tag===13){var o=za(n),h=on(n,o);if(h!==null){var _=bn();qs(h,n,o,_)}Aa(n,o)}},pu=function(){return pi},hc=function(n,o){var h=pi;try{return pi=n,o()}finally{pi=h}},Un=function(n,o,h){switch(o){case"input":if(Ss(n,h),o=h.name,h.type==="radio"&&o!=null){for(h=n;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<h.length;o++){var _=h[o];if(_!==n&&_.form===n.form){var b=Sa(_);if(!b)throw Error($(90));os(_),Ss(_,b)}}}break;case"textarea":To(n,h);break;case"select":o=h.value,o!=null&&ls(n,!!h.multiple,o,!1)}},V=tc,W=Yo;var Ld={usingClientEntryPoint:!1,Events:[el,zn,Sa,R,L,tc]},sc={findFiberByHostInstance:Go,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},pp={bundleType:sc.bundleType,version:sc.version,rendererPackageName:sc.rendererPackageName,rendererConfig:sc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:zt.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=di(n),n===null?null:n.stateNode},findFiberByHostInstance:sc.findFiberByHostInstance,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Yc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Yc.isDisabled&&Yc.supportsFiber)try{Pr=Yc.inject(pp),$r=Yc}catch{}}return bs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ld,bs.createPortal=function(n,o){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Kc(o))throw Error($(200));return hp(n,o,null,h)},bs.createRoot=function(n,o){if(!Kc(n))throw Error($(299));var h=!1,_="",b=Hh;return o!=null&&(o.unstable_strictMode===!0&&(h=!0),o.identifierPrefix!==void 0&&(_=o.identifierPrefix),o.onRecoverableError!==void 0&&(b=o.onRecoverableError)),o=Gh(n,1,!1,null,null,h,!1,_,b),n[Pt]=o.current,Ds(n.nodeType===8?n.parentNode:n),new Xc(o)},bs.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var o=n._reactInternals;if(o===void 0)throw typeof n.render=="function"?Error($(188)):(n=Object.keys(n).join(","),Error($(268,n)));return n=di(o),n=n===null?null:n.stateNode,n},bs.flushSync=function(n){return Yo(n)},bs.hydrate=function(n,o,h){if(!gl(o))throw Error($(200));return Jc(null,n,o,!0,h)},bs.hydrateRoot=function(n,o,h){if(!Kc(n))throw Error($(405));var _=h!=null&&h.hydratedSources||null,b=!1,k="",O=Hh;if(h!=null&&(h.unstable_strictMode===!0&&(b=!0),h.identifierPrefix!==void 0&&(k=h.identifierPrefix),h.onRecoverableError!==void 0&&(O=h.onRecoverableError)),o=Gc(o,null,n,1,h??null,b,!1,k,O),n[Pt]=o.current,Ds(n),_)for(n=0;n<_.length;n++)h=_[n],b=h._getVersion,b=b(h._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[h,b]:o.mutableSourceEagerHydrationData.push(h,b);return new lu(o)},bs.render=function(n,o,h){if(!gl(o))throw Error($(200));return Jc(null,n,o,!1,h)},bs.unmountComponentAtNode=function(n){if(!gl(n))throw Error($(40));return n._reactRootContainer?(Yo(function(){Jc(null,null,n,!1,function(){n._reactRootContainer=null,n[Pt]=null})}),!0):!1},bs.unstable_batchedUpdates=tc,bs.unstable_renderSubtreeIntoContainer=function(n,o,h,_){if(!gl(h))throw Error($(200));if(n==null||n._reactInternals===void 0)throw Error($(38));return Jc(n,o,h,!1,_)},bs.version="18.3.1-next-f1338f8080-20240426",bs}var yf;function Sm(){if(yf)return Cp.exports;yf=1;function A(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(A)}catch(Z){console.error(Z)}}return A(),Cp.exports=bm(),Cp.exports}var vf;function Tm(){if(vf)return jd;vf=1;var A=Sm();return jd.createRoot=A.createRoot,jd.hydrateRoot=A.hydrateRoot,jd}var km=Tm(),Ir=Xd(),zp={exports:{}},Ap={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xf;function Im(){if(xf)return Ap;xf=1;var A=Xd();function Z(ze,nt){return ze===nt&&(ze!==0||1/ze===1/nt)||ze!==ze&&nt!==nt}var $=typeof Object.is=="function"?Object.is:Z,ae=A.useSyncExternalStore,me=A.useRef,Ie=A.useEffect,D=A.useMemo,g=A.useDebugValue;return Ap.useSyncExternalStoreWithSelector=function(ze,nt,Ze,we,he){var Zt=me(null);if(Zt.current===null){var jt={hasValue:!1,value:null};Zt.current=jt}else jt=Zt.current;Zt=D(function(){function mt(At){if(!Yt){if(Yt=!0,_i=At,At=we(At),he!==void 0&&jt.hasValue){var Gt=jt.value;if(he(Gt,At))return vt=Gt}return vt=At}if(Gt=vt,$(_i,At))return Gt;var Wt=we(At);return he!==void 0&&he(Gt,Wt)?(_i=At,Gt):(_i=At,vt=Wt)}var Yt=!1,_i,vt,zt=Ze===void 0?null:Ze;return[function(){return mt(nt())},zt===null?void 0:function(){return mt(zt())}]},[nt,Ze,we,he]);var Ft=ae(ze,Zt[0],Zt[1]);return Ie(function(){jt.hasValue=!0,jt.value=Ft},[Ft]),g(Ft),Ft},Ap}var wf;function Em(){return wf||(wf=1,zp.exports=Im()),zp.exports}var Cm=Em();function Pm(A){A()}function Mm(){let A=null,Z=null;return{clear(){A=null,Z=null},notify(){Pm(()=>{let $=A;for(;$;)$.callback(),$=$.next})},get(){const $=[];let ae=A;for(;ae;)$.push(ae),ae=ae.next;return $},subscribe($){let ae=!0;const me=Z={callback:$,next:null,prev:Z};return me.prev?me.prev.next=me:A=me,function(){!ae||A===null||(ae=!1,me.next?me.next.prev=me.prev:Z=me.prev,me.prev?me.prev.next=me.next:A=me.next)}}}}var bf={notify(){},get:()=>[]};function zm(A,Z){let $,ae=bf,me=0,Ie=!1;function D(Ft){Ze();const mt=ae.subscribe(Ft);let Yt=!1;return()=>{Yt||(Yt=!0,mt(),we())}}function g(){ae.notify()}function ze(){jt.onStateChange&&jt.onStateChange()}function nt(){return Ie}function Ze(){me++,$||($=A.subscribe(ze),ae=Mm())}function we(){me--,$&&me===0&&($(),$=void 0,ae.clear(),ae=bf)}function he(){Ie||(Ie=!0,Ze())}function Zt(){Ie&&(Ie=!1,we())}const jt={addNestedSub:D,notifyNestedSubs:g,handleChangeWrapper:ze,isSubscribed:nt,trySubscribe:he,tryUnsubscribe:Zt,getListeners:()=>ae};return jt}var Am=()=>typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Dm=Am(),Lm=()=>typeof navigator<"u"&&navigator.product==="ReactNative",Rm=Lm(),Fm=()=>Dm||Rm?Ir.useLayoutEffect:Ir.useEffect,Bm=Fm(),Dp=Symbol.for("react-redux-context"),Lp=typeof globalThis<"u"?globalThis:{};function Om(){if(!Ir.createContext)return{};const A=Lp[Dp]??(Lp[Dp]=new Map);let Z=A.get(Ir.createContext);return Z||(Z=Ir.createContext(null),A.set(Ir.createContext,Z)),Z}var cu=Om();function Nm(A){const{children:Z,context:$,serverState:ae,store:me}=A,Ie=Ir.useMemo(()=>{const ze=zm(me);return{store:me,subscription:ze,getServerState:ae?()=>ae:void 0}},[me,ae]),D=Ir.useMemo(()=>me.getState(),[me]);Bm(()=>{const{subscription:ze}=Ie;return ze.onStateChange=ze.notifyNestedSubs,ze.trySubscribe(),D!==me.getState()&&ze.notifyNestedSubs(),()=>{ze.tryUnsubscribe(),ze.onStateChange=void 0}},[Ie,D]);const g=$||cu;return Ir.createElement(g.Provider,{value:Ie},Z)}var Vm=Nm;function qp(A=cu){return function(){return Ir.useContext(A)}}var Rf=qp();function Ff(A=cu){const Z=A===cu?Rf:qp(A),$=()=>{const{store:ae}=Z();return ae};return Object.assign($,{withTypes:()=>$}),$}var jm=Ff();function Um(A=cu){const Z=A===cu?jm:Ff(A),$=()=>Z().dispatch;return Object.assign($,{withTypes:()=>$}),$}var Bf=Um(),$m=(A,Z)=>A===Z;function qm(A=cu){const Z=A===cu?Rf:qp(A),$=(ae,me={})=>{const{equalityFn:Ie=$m}=typeof me=="function"?{equalityFn:me}:me,D=Z(),{store:g,subscription:ze,getServerState:nt}=D;Ir.useRef(!0);const Ze=Ir.useCallback({[ae.name](he){return ae(he)}}[ae.name],[ae]),we=Cm.useSyncExternalStoreWithSelector(ze.addNestedSub,g.getState,nt||g.getState,Ze,Ie);return Ir.useDebugValue(we),we};return Object.assign($,{withTypes:()=>$}),$}var Zp=qm();function kn(A){return`Minified Redux error #${A}; visit https://redux.js.org/Errors?code=${A} for the full message or use the non-minified dev environment for full errors. `}var Zm=typeof Symbol=="function"&&Symbol.observable||"@@observable",Sf=Zm,Rp=()=>Math.random().toString(36).substring(7).split("").join("."),Gm={INIT:`@@redux/INIT${Rp()}`,REPLACE:`@@redux/REPLACE${Rp()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${Rp()}`},qd=Gm;function Gp(A){if(typeof A!="object"||A===null)return!1;let Z=A;for(;Object.getPrototypeOf(Z)!==null;)Z=Object.getPrototypeOf(Z);return Object.getPrototypeOf(A)===Z||Object.getPrototypeOf(A)===null}function Of(A,Z,$){if(typeof A!="function")throw new Error(kn(2));if(typeof Z=="function"&&typeof $=="function"||typeof $=="function"&&typeof arguments[3]=="function")throw new Error(kn(0));if(typeof Z=="function"&&typeof $>"u"&&($=Z,Z=void 0),typeof $<"u"){if(typeof $!="function")throw new Error(kn(1));return $(Of)(A,Z)}let ae=A,me=Z,Ie=new Map,D=Ie,g=0,ze=!1;function nt(){D===Ie&&(D=new Map,Ie.forEach((mt,Yt)=>{D.set(Yt,mt)}))}function Ze(){if(ze)throw new Error(kn(3));return me}function we(mt){if(typeof mt!="function")throw new Error(kn(4));if(ze)throw new Error(kn(5));let Yt=!0;nt();const _i=g++;return D.set(_i,mt),function(){if(Yt){if(ze)throw new Error(kn(6));Yt=!1,nt(),D.delete(_i),Ie=null}}}function he(mt){if(!Gp(mt))throw new Error(kn(7));if(typeof mt.type>"u")throw new Error(kn(8));if(typeof mt.type!="string")throw new Error(kn(17));if(ze)throw new Error(kn(9));try{ze=!0,me=ae(me,mt)}finally{ze=!1}return(Ie=D).forEach(_i=>{_i()}),mt}function Zt(mt){if(typeof mt!="function")throw new Error(kn(10));ae=mt,he({type:qd.REPLACE})}function jt(){const mt=we;return{subscribe(Yt){if(typeof Yt!="object"||Yt===null)throw new Error(kn(11));function _i(){const zt=Yt;zt.next&&zt.next(Ze())}return _i(),{unsubscribe:mt(_i)}},[Sf](){return this}}}return he({type:qd.INIT}),{dispatch:he,subscribe:we,getState:Ze,replaceReducer:Zt,[Sf]:jt}}function Hm(A){Object.keys(A).forEach(Z=>{const $=A[Z];if(typeof $(void 0,{type:qd.INIT})>"u")throw new Error(kn(12));if(typeof $(void 0,{type:qd.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(kn(13))})}function Wm(A){const Z=Object.keys(A),$={};for(let Ie=0;Ie<Z.length;Ie++){const D=Z[Ie];typeof A[D]=="function"&&($[D]=A[D])}const ae=Object.keys($);let me;try{Hm($)}catch(Ie){me=Ie}return function(D={},g){if(me)throw me;let ze=!1;const nt={};for(let Ze=0;Ze<ae.length;Ze++){const we=ae[Ze],he=$[we],Zt=D[we],jt=he(Zt,g);if(typeof jt>"u")throw g&&g.type,new Error(kn(14));nt[we]=jt,ze=ze||jt!==Zt}return ze=ze||ae.length!==Object.keys(D).length,ze?nt:D}}function Zd(...A){return A.length===0?Z=>Z:A.length===1?A[0]:A.reduce((Z,$)=>(...ae)=>Z($(...ae)))}function Xm(...A){return Z=>($,ae)=>{const me=Z($,ae);let Ie=()=>{throw new Error(kn(15))};const D={getState:me.getState,dispatch:(ze,...nt)=>Ie(ze,...nt)},g=A.map(ze=>ze(D));return Ie=Zd(...g)(me.dispatch),{...me,dispatch:Ie}}}function Km(A){return Gp(A)&&"type"in A&&typeof A.type=="string"}var Nf=Symbol.for("immer-nothing"),Tf=Symbol.for("immer-draftable"),Ks=Symbol.for("immer-state");function sa(A,...Z){throw new Error(`[Immer] minified error nr: ${A}. Full error at: https://bit.ly/3cXEKWf`)}var ih=Object.getPrototypeOf;function uc(A){return!!A&&!!A[Ks]}function xl(A){var Z;return A?Vf(A)||Array.isArray(A)||!!A[Tf]||!!((Z=A.constructor)!=null&&Z[Tf])||Jd(A)||Yd(A):!1}var Jm=Object.prototype.constructor.toString();function Vf(A){if(!A||typeof A!="object")return!1;const Z=ih(A);if(Z===null)return!0;const $=Object.hasOwnProperty.call(Z,"constructor")&&Z.constructor;return $===Object?!0:typeof $=="function"&&Function.toString.call($)===Jm}function Gd(A,Z){Kd(A)===0?Reflect.ownKeys(A).forEach($=>{Z($,A[$],A)}):A.forEach(($,ae)=>Z(ae,$,A))}function Kd(A){const Z=A[Ks];return Z?Z.type_:Array.isArray(A)?1:Jd(A)?2:Yd(A)?3:0}function Op(A,Z){return Kd(A)===2?A.has(Z):Object.prototype.hasOwnProperty.call(A,Z)}function jf(A,Z,$){const ae=Kd(A);ae===2?A.set(Z,$):ae===3?A.add($):A[Z]=$}function Ym(A,Z){return A===Z?A!==0||1/A===1/Z:A!==A&&Z!==Z}function Jd(A){return A instanceof Map}function Yd(A){return A instanceof Set}function lc(A){return A.copy_||A.base_}function Np(A,Z){if(Jd(A))return new Map(A);if(Yd(A))return new Set(A);if(Array.isArray(A))return Array.prototype.slice.call(A);const $=Vf(A);if(Z===!0||Z==="class_only"&&!$){const ae=Object.getOwnPropertyDescriptors(A);delete ae[Ks];let me=Reflect.ownKeys(ae);for(let Ie=0;Ie<me.length;Ie++){const D=me[Ie],g=ae[D];g.writable===!1&&(g.writable=!0,g.configurable=!0),(g.get||g.set)&&(ae[D]={configurable:!0,writable:!0,enumerable:g.enumerable,value:A[D]})}return Object.create(ih(A),ae)}else{const ae=ih(A);if(ae!==null&&$)return{...A};const me=Object.create(ae);return Object.assign(me,A)}}function Hp(A,Z=!1){return Qd(A)||uc(A)||!xl(A)||(Kd(A)>1&&(A.set=A.add=A.clear=A.delete=Qm),Object.freeze(A),Z&&Object.entries(A).forEach(([$,ae])=>Hp(ae,!0))),A}function Qm(){sa(2)}function Qd(A){return Object.isFrozen(A)}var eg={};function cc(A){const Z=eg[A];return Z||sa(0,A),Z}var ed;function Uf(){return ed}function tg(A,Z){return{drafts_:[],parent_:A,immer_:Z,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function kf(A,Z){Z&&(cc("Patches"),A.patches_=[],A.inversePatches_=[],A.patchListener_=Z)}function Vp(A){jp(A),A.drafts_.forEach(ig),A.drafts_=null}function jp(A){A===ed&&(ed=A.parent_)}function If(A){return ed=tg(ed,A)}function ig(A){const Z=A[Ks];Z.type_===0||Z.type_===1?Z.revoke_():Z.revoked_=!0}function Ef(A,Z){Z.unfinalizedDrafts_=Z.drafts_.length;const $=Z.drafts_[0];return A!==void 0&&A!==$?($[Ks].modified_&&(Vp(Z),sa(4)),xl(A)&&(A=Hd(Z,A),Z.parent_||Wd(Z,A)),Z.patches_&&cc("Patches").generateReplacementPatches_($[Ks].base_,A,Z.patches_,Z.inversePatches_)):A=Hd(Z,$,[]),Vp(Z),Z.patches_&&Z.patchListener_(Z.patches_,Z.inversePatches_),A!==Nf?A:void 0}function Hd(A,Z,$){if(Qd(Z))return Z;const ae=Z[Ks];if(!ae)return Gd(Z,(me,Ie)=>Cf(A,ae,Z,me,Ie,$)),Z;if(ae.scope_!==A)return Z;if(!ae.modified_)return Wd(A,ae.base_,!0),ae.base_;if(!ae.finalized_){ae.finalized_=!0,ae.scope_.unfinalizedDrafts_--;const me=ae.copy_;let Ie=me,D=!1;ae.type_===3&&(Ie=new Set(me),me.clear(),D=!0),Gd(Ie,(g,ze)=>Cf(A,ae,me,g,ze,$,D)),Wd(A,me,!1),$&&A.patches_&&cc("Patches").generatePatches_(ae,$,A.patches_,A.inversePatches_)}return ae.copy_}function Cf(A,Z,$,ae,me,Ie,D){if(uc(me)){const g=Ie&&Z&&Z.type_!==3&&!Op(Z.assigned_,ae)?Ie.concat(ae):void 0,ze=Hd(A,me,g);if(jf($,ae,ze),uc(ze))A.canAutoFreeze_=!1;else return}else D&&$.add(me);if(xl(me)&&!Qd(me)){if(!A.immer_.autoFreeze_&&A.unfinalizedDrafts_<1)return;Hd(A,me),(!Z||!Z.scope_.parent_)&&typeof ae!="symbol"&&Object.prototype.propertyIsEnumerable.call($,ae)&&Wd(A,me)}}function Wd(A,Z,$=!1){!A.parent_&&A.immer_.autoFreeze_&&A.canAutoFreeze_&&Hp(Z,$)}function rg(A,Z){const $=Array.isArray(A),ae={type_:$?1:0,scope_:Z?Z.scope_:Uf(),modified_:!1,finalized_:!1,assigned_:{},parent_:Z,base_:A,draft_:null,copy_:null,revoke_:null,isManual_:!1};let me=ae,Ie=Wp;$&&(me=[ae],Ie=td);const{revoke:D,proxy:g}=Proxy.revocable(me,Ie);return ae.draft_=g,ae.revoke_=D,g}var Wp={get(A,Z){if(Z===Ks)return A;const $=lc(A);if(!Op($,Z))return ng(A,$,Z);const ae=$[Z];return A.finalized_||!xl(ae)?ae:ae===Fp(A.base_,Z)?(Bp(A),A.copy_[Z]=$p(ae,A)):ae},has(A,Z){return Z in lc(A)},ownKeys(A){return Reflect.ownKeys(lc(A))},set(A,Z,$){const ae=$f(lc(A),Z);if(ae!=null&&ae.set)return ae.set.call(A.draft_,$),!0;if(!A.modified_){const me=Fp(lc(A),Z),Ie=me==null?void 0:me[Ks];if(Ie&&Ie.base_===$)return A.copy_[Z]=$,A.assigned_[Z]=!1,!0;if(Ym($,me)&&($!==void 0||Op(A.base_,Z)))return!0;Bp(A),Up(A)}return A.copy_[Z]===$&&($!==void 0||Z in A.copy_)||Number.isNaN($)&&Number.isNaN(A.copy_[Z])||(A.copy_[Z]=$,A.assigned_[Z]=!0),!0},deleteProperty(A,Z){return Fp(A.base_,Z)!==void 0||Z in A.base_?(A.assigned_[Z]=!1,Bp(A),Up(A)):delete A.assigned_[Z],A.copy_&&delete A.copy_[Z],!0},getOwnPropertyDescriptor(A,Z){const $=lc(A),ae=Reflect.getOwnPropertyDescriptor($,Z);return ae&&{writable:!0,configurable:A.type_!==1||Z!=="length",enumerable:ae.enumerable,value:$[Z]}},defineProperty(){sa(11)},getPrototypeOf(A){return ih(A.base_)},setPrototypeOf(){sa(12)}},td={};Gd(Wp,(A,Z)=>{td[A]=function(){return arguments[0]=arguments[0][0],Z.apply(this,arguments)}});td.deleteProperty=function(A,Z){return td.set.call(this,A,Z,void 0)};td.set=function(A,Z,$){return Wp.set.call(this,A[0],Z,$,A[0])};function Fp(A,Z){const $=A[Ks];return($?lc($):A)[Z]}function ng(A,Z,$){var me;const ae=$f(Z,$);return ae?"value"in ae?ae.value:(me=ae.get)==null?void 0:me.call(A.draft_):void 0}function $f(A,Z){if(!(Z in A))return;let $=ih(A);for(;$;){const ae=Object.getOwnPropertyDescriptor($,Z);if(ae)return ae;$=ih($)}}function Up(A){A.modified_||(A.modified_=!0,A.parent_&&Up(A.parent_))}function Bp(A){A.copy_||(A.copy_=Np(A.base_,A.scope_.immer_.useStrictShallowCopy_))}var sg=class{constructor(A){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(Z,$,ae)=>{if(typeof Z=="function"&&typeof $!="function"){const Ie=$;$=Z;const D=this;return function(ze=Ie,...nt){return D.produce(ze,Ze=>$.call(this,Ze,...nt))}}typeof $!="function"&&sa(6),ae!==void 0&&typeof ae!="function"&&sa(7);let me;if(xl(Z)){const Ie=If(this),D=$p(Z,void 0);let g=!0;try{me=$(D),g=!1}finally{g?Vp(Ie):jp(Ie)}return kf(Ie,ae),Ef(me,Ie)}else if(!Z||typeof Z!="object"){if(me=$(Z),me===void 0&&(me=Z),me===Nf&&(me=void 0),this.autoFreeze_&&Hp(me,!0),ae){const Ie=[],D=[];cc("Patches").generateReplacementPatches_(Z,me,Ie,D),ae(Ie,D)}return me}else sa(1,Z)},this.produceWithPatches=(Z,$)=>{if(typeof Z=="function")return(D,...g)=>this.produceWithPatches(D,ze=>Z(ze,...g));let ae,me;return[this.produce(Z,$,(D,g)=>{ae=D,me=g}),ae,me]},typeof(A==null?void 0:A.autoFreeze)=="boolean"&&this.setAutoFreeze(A.autoFreeze),typeof(A==null?void 0:A.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(A.useStrictShallowCopy)}createDraft(A){xl(A)||sa(8),uc(A)&&(A=og(A));const Z=If(this),$=$p(A,void 0);return $[Ks].isManual_=!0,jp(Z),$}finishDraft(A,Z){const $=A&&A[Ks];(!$||!$.isManual_)&&sa(9);const{scope_:ae}=$;return kf(ae,Z),Ef(void 0,ae)}setAutoFreeze(A){this.autoFreeze_=A}setUseStrictShallowCopy(A){this.useStrictShallowCopy_=A}applyPatches(A,Z){let $;for($=Z.length-1;$>=0;$--){const me=Z[$];if(me.path.length===0&&me.op==="replace"){A=me.value;break}}$>-1&&(Z=Z.slice($+1));const ae=cc("Patches").applyPatches_;return uc(A)?ae(A,Z):this.produce(A,me=>ae(me,Z))}};function $p(A,Z){const $=Jd(A)?cc("MapSet").proxyMap_(A,Z):Yd(A)?cc("MapSet").proxySet_(A,Z):rg(A,Z);return(Z?Z.scope_:Uf()).drafts_.push($),$}function og(A){return uc(A)||sa(10,A),qf(A)}function qf(A){if(!xl(A)||Qd(A))return A;const Z=A[Ks];let $;if(Z){if(!Z.modified_)return Z.base_;Z.finalized_=!0,$=Np(A,Z.scope_.immer_.useStrictShallowCopy_)}else $=Np(A,!0);return Gd($,(ae,me)=>{jf($,ae,qf(me))}),Z&&(Z.finalized_=!1),$}var Js=new sg,Zf=Js.produce;Js.produceWithPatches.bind(Js);Js.setAutoFreeze.bind(Js);Js.setUseStrictShallowCopy.bind(Js);Js.applyPatches.bind(Js);Js.createDraft.bind(Js);Js.finishDraft.bind(Js);function Gf(A){return({dispatch:$,getState:ae})=>me=>Ie=>typeof Ie=="function"?Ie($,ae,A):me(Ie)}var ag=Gf(),lg=Gf,ug=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(arguments.length!==0)return typeof arguments[0]=="object"?Zd:Zd.apply(null,arguments)};function Pf(A,Z){function $(...ae){if(Z){let me=Z(...ae);if(!me)throw new Error(vl(0));return{type:A,payload:me.payload,..."meta"in me&&{meta:me.meta},..."error"in me&&{error:me.error}}}return{type:A,payload:ae[0]}}return $.toString=()=>`${A}`,$.type=A,$.match=ae=>Km(ae)&&ae.type===A,$}var Hf=class Qh extends Array{constructor(...Z){super(...Z),Object.setPrototypeOf(this,Qh.prototype)}static get[Symbol.species](){return Qh}concat(...Z){return super.concat.apply(this,Z)}prepend(...Z){return Z.length===1&&Array.isArray(Z[0])?new Qh(...Z[0].concat(this)):new Qh(...Z.concat(this))}};function Mf(A){return xl(A)?Zf(A,()=>{}):A}function zf(A,Z,$){return A.has(Z)?A.get(Z):A.set(Z,$(Z)).get(Z)}function cg(A){return typeof A=="boolean"}var hg=()=>function(Z){const{thunk:$=!0,immutableCheck:ae=!0,serializableCheck:me=!0,actionCreatorCheck:Ie=!0}=Z??{};let D=new Hf;return $&&(cg($)?D.push(ag):D.push(lg($.extraArgument))),D},dg="RTK_autoBatch",Af=A=>Z=>{setTimeout(Z,A)},pg=(A={type:"raf"})=>Z=>(...$)=>{const ae=Z(...$);let me=!0,Ie=!1,D=!1;const g=new Set,ze=A.type==="tick"?queueMicrotask:A.type==="raf"?typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame:Af(10):A.type==="callback"?A.queueNotification:Af(A.timeout),nt=()=>{D=!1,Ie&&(Ie=!1,g.forEach(Ze=>Ze()))};return Object.assign({},ae,{subscribe(Ze){const we=()=>me&&Ze(),he=ae.subscribe(we);return g.add(Ze),()=>{he(),g.delete(Ze)}},dispatch(Ze){var we;try{return me=!((we=Ze==null?void 0:Ze.meta)!=null&&we[dg]),Ie=!me,Ie&&(D||(D=!0,ze(nt))),ae.dispatch(Ze)}finally{me=!0}}})},fg=A=>function($){const{autoBatch:ae=!0}=$??{};let me=new Hf(A);return ae&&me.push(pg(typeof ae=="object"?ae:void 0)),me};function mg(A){const Z=hg(),{reducer:$=void 0,middleware:ae,devTools:me=!0,preloadedState:Ie=void 0,enhancers:D=void 0}=A;let g;if(typeof $=="function")g=$;else if(Gp($))g=Wm($);else throw new Error(vl(1));let ze;typeof ae=="function"?ze=ae(Z):ze=Z();let nt=Zd;me&&(nt=ug({trace:!1,...typeof me=="object"&&me}));const Ze=Xm(...ze),we=fg(Ze);let he=typeof D=="function"?D(we):we();const Zt=nt(...he);return Of(g,Ie,Zt)}function Wf(A){const Z={},$=[];let ae;const me={addCase(Ie,D){const g=typeof Ie=="string"?Ie:Ie.type;if(!g)throw new Error(vl(28));if(g in Z)throw new Error(vl(29));return Z[g]=D,me},addMatcher(Ie,D){return $.push({matcher:Ie,reducer:D}),me},addDefaultCase(Ie){return ae=Ie,me}};return A(me),[Z,$,ae]}function gg(A){return typeof A=="function"}function _g(A,Z){let[$,ae,me]=Wf(Z),Ie;if(gg(A))Ie=()=>Mf(A());else{const g=Mf(A);Ie=()=>g}function D(g=Ie(),ze){let nt=[$[ze.type],...ae.filter(({matcher:Ze})=>Ze(ze)).map(({reducer:Ze})=>Ze)];return nt.filter(Ze=>!!Ze).length===0&&(nt=[me]),nt.reduce((Ze,we)=>{if(we)if(uc(Ze)){const Zt=we(Ze,ze);return Zt===void 0?Ze:Zt}else{if(xl(Ze))return Zf(Ze,he=>we(he,ze));{const he=we(Ze,ze);if(he===void 0){if(Ze===null)return Ze;throw Error("A case reducer on a non-draftable value must not return undefined")}return he}}return Ze},g)}return D.getInitialState=Ie,D}var yg=Symbol.for("rtk-slice-createasyncthunk");function vg(A,Z){return`${A}/${Z}`}function xg({creators:A}={}){var $;const Z=($=A==null?void 0:A.asyncThunk)==null?void 0:$[yg];return function(me){const{name:Ie,reducerPath:D=Ie}=me;if(!Ie)throw new Error(vl(11));const g=(typeof me.reducers=="function"?me.reducers(Sg()):me.reducers)||{},ze=Object.keys(g),nt={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},Ze={addCase(vt,zt){const At=typeof vt=="string"?vt:vt.type;if(!At)throw new Error(vl(12));if(At in nt.sliceCaseReducersByType)throw new Error(vl(13));return nt.sliceCaseReducersByType[At]=zt,Ze},addMatcher(vt,zt){return nt.sliceMatchers.push({matcher:vt,reducer:zt}),Ze},exposeAction(vt,zt){return nt.actionCreators[vt]=zt,Ze},exposeCaseReducer(vt,zt){return nt.sliceCaseReducersByName[vt]=zt,Ze}};ze.forEach(vt=>{const zt=g[vt],At={reducerName:vt,type:vg(Ie,vt),createNotation:typeof me.reducers=="function"};kg(zt)?Eg(At,zt,Ze,Z):Tg(At,zt,Ze)});function we(){const[vt={},zt=[],At=void 0]=typeof me.extraReducers=="function"?Wf(me.extraReducers):[me.extraReducers],Gt={...vt,...nt.sliceCaseReducersByType};return _g(me.initialState,Wt=>{for(let yi in Gt)Wt.addCase(yi,Gt[yi]);for(let yi of nt.sliceMatchers)Wt.addMatcher(yi.matcher,yi.reducer);for(let yi of zt)Wt.addMatcher(yi.matcher,yi.reducer);At&&Wt.addDefaultCase(At)})}const he=vt=>vt,Zt=new Map;let jt;function Ft(vt,zt){return jt||(jt=we()),jt(vt,zt)}function mt(){return jt||(jt=we()),jt.getInitialState()}function Yt(vt,zt=!1){function At(Wt){let yi=Wt[vt];return typeof yi>"u"&&zt&&(yi=mt()),yi}function Gt(Wt=he){const yi=zf(Zt,zt,()=>new WeakMap);return zf(yi,Wt,()=>{const Ji={};for(const[Vr,Kt]of Object.entries(me.selectors??{}))Ji[Vr]=wg(Kt,Wt,mt,zt);return Ji})}return{reducerPath:vt,getSelectors:Gt,get selectors(){return Gt(At)},selectSlice:At}}const _i={name:Ie,reducer:Ft,actions:nt.actionCreators,caseReducers:nt.sliceCaseReducersByName,getInitialState:mt,...Yt(D),injectInto(vt,{reducerPath:zt,...At}={}){const Gt=zt??D;return vt.inject({reducerPath:Gt,reducer:Ft},At),{..._i,...Yt(Gt,!0)}}};return _i}}function wg(A,Z,$,ae){function me(Ie,...D){let g=Z(Ie);return typeof g>"u"&&ae&&(g=$()),A(g,...D)}return me.unwrapped=A,me}var bg=xg();function Sg(){function A(Z,$){return{_reducerDefinitionType:"asyncThunk",payloadCreator:Z,...$}}return A.withTypes=()=>A,{reducer(Z){return Object.assign({[Z.name](...$){return Z(...$)}}[Z.name],{_reducerDefinitionType:"reducer"})},preparedReducer(Z,$){return{_reducerDefinitionType:"reducerWithPrepare",prepare:Z,reducer:$}},asyncThunk:A}}function Tg({type:A,reducerName:Z,createNotation:$},ae,me){let Ie,D;if("reducer"in ae){if($&&!Ig(ae))throw new Error(vl(17));Ie=ae.reducer,D=ae.prepare}else Ie=ae;me.addCase(A,Ie).exposeCaseReducer(Z,Ie).exposeAction(Z,D?Pf(A,D):Pf(A))}function kg(A){return A._reducerDefinitionType==="asyncThunk"}function Ig(A){return A._reducerDefinitionType==="reducerWithPrepare"}function Eg({type:A,reducerName:Z},$,ae,me){if(!me)throw new Error(vl(18));const{payloadCreator:Ie,fulfilled:D,pending:g,rejected:ze,settled:nt,options:Ze}=$,we=me(A,Ie,Ze);ae.exposeAction(Z,we),D&&ae.addCase(we.fulfilled,D),g&&ae.addCase(we.pending,g),ze&&ae.addCase(we.rejected,ze),nt&&ae.addMatcher(we.settled,nt),ae.exposeCaseReducer(Z,{fulfilled:D||Ud,pending:g||Ud,rejected:ze||Ud,settled:nt||Ud})}function Ud(){}function vl(A){return`Minified Redux Toolkit error #${A}; visit https://redux-toolkit.js.org/Errors?code=${A} for the full message or use the non-minified dev environment for full errors. `}const Cg={markers:[],markerCounter:0},Xf=bg({name:"map",initialState:Cg,reducers:{addMarker:(A,Z)=>{const $={...Z.payload,id:`marker-${Date.now()}`,name:` ${A.markerCounter+1}`};A.markers.push($),A.markerCounter+=1,localStorage.setItem("markers",JSON.stringify(A.markers))},removeMarker:(A,Z)=>{A.markers=A.markers.filter($=>$.id!==Z.payload),A.markerCounter-=1,localStorage.setItem("markers",JSON.stringify(A.markers))},loadMarkersFromStorage:A=>{const Z=localStorage.getItem("markers");Z&&(A.markers=JSON.parse(Z),A.markerCounter=A.markers.length)}}}),{addMarker:Pg,removeMarker:Kf,loadMarkersFromStorage:Mg}=Xf.actions,zg=Xf.reducer,Ag=mg({reducer:{map:zg}}),Dg=({marker:A,handleRemoveMarker:Z})=>{const $=A.coordinates.lng.toFixed(4),ae=A.coordinates.lat.toFixed(4);return Nr.jsxs("li",{className:"marker",children:[Nr.jsx("h6",{children:A.name}),Nr.jsxs("p",{children:[$,", ",ae]}),Nr.jsx("button",{onClick:()=>Z(A.id),children:""})]})},Lg=Ir.memo(Dg),Rg=()=>{const A=Bf(),Z=Zp(ae=>ae.map.markers),$=Ir.useCallback(ae=>{A(Kf(ae))},[]);return Nr.jsx("ul",{className:"markers-list",children:Z.map(ae=>Nr.jsx(Lg,{marker:ae,handleRemoveMarker:$},ae.id))})},Fg=()=>{const A=Zp(Z=>Z.map.markerCounter);return Nr.jsxs("div",{className:"sidebar-wrap",children:[Nr.jsxs("h3",{children:[" : ",A]}),Nr.jsx(Rg,{})]})};var $d={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */var Bg=$d.exports,Df;function Og(){return Df||(Df=1,function(A,Z){(function($,ae){A.exports=ae()})(Bg,function(){var $={},ae={};function me(D,g,ze){if(ae[D]=ze,D==="index"){var nt="var sharedModule = {}; ("+ae.shared+")(sharedModule); ("+ae.worker+")(sharedModule);",Ze={};return ae.shared(Ze),ae.index($,Ze),typeof window<"u"&&$.setWorkerUrl(window.URL.createObjectURL(new Blob([nt],{type:"text/javascript"}))),$}}me("shared",["exports"],function(D){function g(i,t,r,a){return new(r||(r=Promise))(function(c,f){function m(T){try{x(a.next(T))}catch(E){f(E)}}function y(T){try{x(a.throw(T))}catch(E){f(E)}}function x(T){var E;T.done?c(T.value):(E=T.value,E instanceof r?E:new r(function(C){C(E)})).then(m,y)}x((a=a.apply(i,t||[])).next())})}function ze(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var nt=Ze;function Ze(i,t){this.x=i,this.y=t}Ze.prototype={clone:function(){return new Ze(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,r=i.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),r=Math.sin(i),a=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=a,this},_rotateAround:function(i,t){var r=Math.cos(i),a=Math.sin(i),c=t.y+a*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-a*(this.y-t.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ze.convert=function(i){return i instanceof Ze?i:Array.isArray(i)?new Ze(i[0],i[1]):i};var we=ze(nt),he=Zt;function Zt(i,t,r,a){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=a}Zt.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,a=0;a<8;a++){var c=this.sampleCurveX(r)-i;if(Math.abs(c)<t)return r;var f=this.sampleCurveDerivativeX(r);if(Math.abs(f)<1e-6)break;r-=c/f}var m=0,y=1;for(r=i,a=0;a<20&&(c=this.sampleCurveX(r),!(Math.abs(c-i)<t));a++)i>c?m=r:y=r,r=.5*(y-m)+m;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var jt=ze(he);let Ft,mt;function Yt(){return Ft==null&&(Ft=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ft}function _i(){if(mt==null&&(mt=!1,Yt())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let a=0;a<5*5;a++){const c=4*a;t.fillStyle=`rgb(${c},${c+1},${c+2})`,t.fillRect(a%5,Math.floor(a/5),1,1)}const r=t.getImageData(0,0,5,5).data;for(let a=0;a<5*5*4;a++)if(a%4!=3&&r[a]!==a){mt=!0;break}}}return mt||!1}function vt(i,t,r,a){const c=new jt(i,t,r,a);return f=>c.solve(f)}const zt=vt(.25,.1,.25,1);function At(i,t,r){return Math.min(r,Math.max(t,i))}function Gt(i,t,r){const a=r-t,c=((i-t)%a+a)%a+t;return c===t?r:c}function Wt(i,...t){for(const r of t)for(const a in r)i[a]=r[a];return i}let yi=1;function Ji(i,t,r){const a={};for(const c in i)a[c]=t.call(this,i[c],c,i);return a}function Vr(i,t,r){const a={};for(const c in i)t.call(this,i[c],c,i)&&(a[c]=i[c]);return a}function Kt(i){return Array.isArray(i)?i.map(Kt):typeof i=="object"&&i?Ji(i,Kt):i}const dn={};function bi(i){dn[i]||(typeof console<"u"&&console.warn(i),dn[i]=!0)}function Li(i,t,r){return(r.y-i.y)*(t.x-i.x)>(t.y-i.y)*(r.x-i.x)}function ur(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let ir=null;function hi(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Qe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function xt(i,t,r,a,c){return g(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const f=new VideoFrame(i,{timestamp:0});try{const m=f==null?void 0:f.format;if(!m||!m.startsWith("BGR")&&!m.startsWith("RGB"))throw new Error(`Unrecognized format ${m}`);const y=m.startsWith("BGR"),x=new Uint8ClampedArray(a*c*4);if(yield f.copyTo(x,function(T,E,C,z,F){const N=4*Math.max(-E,0),U=(Math.max(0,C)-C)*z*4+N,K=4*z,ee=Math.max(0,E),ge=Math.max(0,C);return{rect:{x:ee,y:ge,width:Math.min(T.width,E+z)-ee,height:Math.min(T.height,C+F)-ge},layout:[{offset:U,stride:K}]}}(i,t,r,a,c)),y)for(let T=0;T<x.length;T+=4){const E=x[T];x[T]=x[T+2],x[T+2]=E}return x}finally{f.close()}})}let tt,fe;const Me="AbortError";function Bt(){return new Error(Me)}const Ot={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function qt(i){return Ot.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const Jt="global-dispatcher";class Xt extends Error{constructor(t,r,a,c){super(`AJAXError: ${r} (${t}): ${a}`),this.status=t,this.statusText=r,this.url=a,this.body=c}}const Ht=()=>ur(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,vi=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const a=qt(i.url);if(a)return a(i,t);if(ur(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:Jt},t)}if(!(/^file:/.test(r=i.url)||/^file:/.test(Ht())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(a,c){return g(this,void 0,void 0,function*(){const f=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,cache:a.cache,referrer:Ht(),signal:c.signal});a.type!=="json"||f.headers.has("Accept")||f.headers.set("Accept","application/json");const m=yield fetch(f);if(!m.ok){const T=yield m.blob();throw new Xt(m.status,m.statusText,a.url,T)}let y;y=a.type==="arrayBuffer"||a.type==="image"?m.arrayBuffer():a.type==="json"?m.json():m.text();const x=yield y;if(c.signal.aborted)throw Bt();return{data:x,cacheControl:m.headers.get("Cache-Control"),expires:m.headers.get("Expires")}})}(i,t);if(ur(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:Jt},t)}var r;return function(a,c){return new Promise((f,m)=>{var y;const x=new XMLHttpRequest;x.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(x.responseType="arraybuffer");for(const T in a.headers)x.setRequestHeader(T,a.headers[T]);a.type==="json"&&(x.responseType="text",!((y=a.headers)===null||y===void 0)&&y.Accept||x.setRequestHeader("Accept","application/json")),x.withCredentials=a.credentials==="include",x.onerror=()=>{m(new Error(x.statusText))},x.onload=()=>{if(!c.signal.aborted)if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let T=x.response;if(a.type==="json")try{T=JSON.parse(x.response)}catch(E){return void m(E)}f({data:T,cacheControl:x.getResponseHeader("Cache-Control"),expires:x.getResponseHeader("Expires")})}else{const T=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});m(new Xt(x.status,x.statusText,a.url,T))}},c.signal.addEventListener("abort",()=>{x.abort(),m(Bt())}),x.send(a.body)})}(i,t)};function rr(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const t=new URL(i),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function Ys(i,t,r){r[i]&&r[i].indexOf(t)!==-1||(r[i]=r[i]||[],r[i].push(t))}function os(i,t,r){if(r&&r[i]){const a=r[i].indexOf(t);a!==-1&&r[i].splice(a,1)}}class Vn{constructor(t,r={}){Wt(this,r),this.type=t}}class as extends Vn{constructor(t,r={}){super("error",Wt({error:t},r))}}class So{on(t,r){return this._listeners=this._listeners||{},Ys(t,r,this._listeners),this}off(t,r){return os(t,r,this._listeners),os(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Ys(t,r,this._oneTimeListeners),this):new Promise(a=>this.once(t,a))}fire(t,r){typeof t=="string"&&(t=new Vn(t,r||{}));const a=t.type;if(this.listens(a)){t.target=this;const c=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const y of c)y.call(this,t);const f=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const y of f)os(a,y,this._oneTimeListeners),y.call(this,t);const m=this._eventedParent;m&&(Wt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(t))}else t instanceof as&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var be={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ss=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function oa(i,t){const r={};for(const a in i)a!=="ref"&&(r[a]=i[a]);return Ss.forEach(a=>{a in t&&(r[a]=t[a])}),r}function ei(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let r=0;r<i.length;r++)if(!ei(i[r],t[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(const r in i)if(!ei(i[r],t[r]))return!1;return!0}return i===t}function Ii(i,t){i.push(t)}function ls(i,t,r){Ii(r,{command:"addSource",args:[i,t[i]]})}function us(i,t,r){Ii(t,{command:"removeSource",args:[i]}),r[i]=!0}function cs(i,t,r,a){us(i,r,a),ls(i,t,r)}function To(i,t,r){let a;for(a in i[r])if(Object.prototype.hasOwnProperty.call(i[r],a)&&a!=="data"&&!ei(i[r][a],t[r][a]))return!1;for(a in t[r])if(Object.prototype.hasOwnProperty.call(t[r],a)&&a!=="data"&&!ei(i[r][a],t[r][a]))return!1;return!0}function pn(i,t,r,a,c,f){i=i||{},t=t||{};for(const m in i)Object.prototype.hasOwnProperty.call(i,m)&&(ei(i[m],t[m])||r.push({command:f,args:[a,m,t[m],c]}));for(const m in t)Object.prototype.hasOwnProperty.call(t,m)&&!Object.prototype.hasOwnProperty.call(i,m)&&(ei(i[m],t[m])||r.push({command:f,args:[a,m,t[m],c]}))}function aa(i){return i.id}function ko(i,t){return i[t.id]=t,i}class Fe{constructor(t,r,a,c){this.message=(t?`${t}: `:"")+a,c&&(this.identifier=c),r!=null&&r.__line__&&(this.line=r.__line__)}}function jn(i,...t){for(const r of t)for(const a in r)i[a]=r[a];return i}class nr extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class Jr{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[a,c]of r)this.bindings[a]=c}concat(t){return new Jr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Qs={kind:"null"},Ue={kind:"number"},Nt={kind:"string"},wt={kind:"boolean"},Er={kind:"color"},fn={kind:"object"},kt={kind:"value"},In={kind:"collator"},Un={kind:"formatted"},mn={kind:"padding"},jr={kind:"resolvedImage"},J={kind:"variableAnchorOffsetCollection"};function R(i,t){return{kind:"array",itemType:i,N:t}}function L(i){if(i.kind==="array"){const t=L(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const V=[Qs,Ue,Nt,wt,Er,Un,fn,R(kt),mn,jr,J];function W(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!W(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const r of V)if(!W(r,t))return null}}return`Expected ${L(i)} but found ${L(t)} instead.`}function re(i,t){return t.some(r=>r.kind===i.kind)}function le(i,t){return t.some(r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i)}function pe(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}const te=.96422,Te=.82521,Pe=4/29,ve=6/29,Ne=3*ve*ve,ot=ve*ve*ve,pt=Math.PI/180,ti=180/Math.PI;function Ct(i){return(i%=360)<0&&(i+=360),i}function ii([i,t,r,a]){let c,f;const m=qi((.2225045*(i=Rt(i))+.7168786*(t=Rt(t))+.0606169*(r=Rt(r)))/1);i===t&&t===r?c=f=m:(c=qi((.4360747*i+.3850649*t+.1430804*r)/te),f=qi((.0139322*i+.0971045*t+.7141733*r)/Te));const y=116*m-16;return[y<0?0:y,500*(c-m),200*(m-f),a]}function Rt(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function qi(i){return i>ot?Math.pow(i,1/3):i/Ne+Pe}function Bi([i,t,r,a]){let c=(i+16)/116,f=isNaN(t)?c:c+t/500,m=isNaN(r)?c:c-r/200;return c=1*di(c),f=te*di(f),m=Te*di(m),[Ut(3.1338561*f-1.6168667*c-.4906146*m),Ut(-.9787684*f+1.9161415*c+.033454*m),Ut(.0719453*f-.2289914*c+1.4052427*m),a]}function Ut(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function di(i){return i>ve?i*i*i:Ne*(i-Pe)}function Pi(i){return parseInt(i.padEnd(2,i),16)/255}function sr(i,t){return cr(t?i/100:i,0,1)}function cr(i,t,r){return Math.min(Math.max(t,i),r)}function Ur(i){return!i.some(Number.isNaN)}const la={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class It{constructor(t,r,a,c=1,f=!0){this.r=t,this.g=r,this.b=a,this.a=c,f||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[t,r,a,c]))}static parse(t){if(t instanceof It)return t;if(typeof t!="string")return;const r=function(a){if((a=a.toLowerCase().trim())==="transparent")return[0,0,0,0];const c=la[a];if(c){const[m,y,x]=c;return[m/255,y/255,x/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){const m=a.length<6?1:2;let y=1;return[Pi(a.slice(y,y+=m)),Pi(a.slice(y,y+=m)),Pi(a.slice(y,y+=m)),Pi(a.slice(y,y+m)||"ff")]}if(a.startsWith("rgb")){const m=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[y,x,T,E,C,z,F,N,U,K,ee,ge]=m,ne=[E||" ",F||" ",K].join("");if(ne==="  "||ne==="  /"||ne===",,"||ne===",,,"){const de=[T,z,U].join(""),ke=de==="%%%"?100:de===""?255:0;if(ke){const Ae=[cr(+x/ke,0,1),cr(+C/ke,0,1),cr(+N/ke,0,1),ee?sr(+ee,ge):1];if(Ur(Ae))return Ae}}return}}const f=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[m,y,x,T,E,C,z,F,N]=f,U=[x||" ",E||" ",z].join("");if(U==="  "||U==="  /"||U===",,"||U===",,,"){const K=[+y,cr(+T,0,100),cr(+C,0,100),F?sr(+F,N):1];if(Ur(K))return function([ee,ge,ne,de]){function ke(Ae){const Ye=(Ae+ee/30)%12,yt=ge*Math.min(ne,1-ne);return ne-yt*Math.max(-1,Math.min(Ye-3,9-Ye,1))}return ee=Ct(ee),ge/=100,ne/=100,[ke(0),ke(8),ke(4),de]}(K)}}}(t);return r?new It(...r,!1):void 0}get rgb(){const{r:t,g:r,b:a,a:c}=this,f=c||1/0;return this.overwriteGetter("rgb",[t/f,r/f,a/f,c])}get hcl(){return this.overwriteGetter("hcl",function(t){const[r,a,c,f]=ii(t),m=Math.sqrt(a*a+c*c);return[Math.round(1e4*m)?Ct(Math.atan2(c,a)*ti):NaN,m,r,f]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ii(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){const[t,r,a,c]=this.rgb;return`rgba(${[t,r,a].map(f=>Math.round(255*f)).join(",")},${c})`}}It.black=new It(0,0,0,1),It.white=new It(1,1,1,1),It.transparent=new It(0,0,0,0),It.red=new It(1,0,0,1);class hu{constructor(t,r,a){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Fa{constructor(t,r,a,c,f){this.text=t,this.image=r,this.scale=a,this.fontStack=c,this.textColor=f}}class Yr{constructor(t){this.sections=t}static fromString(t){return new Yr([new Fa(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Yr?t:Yr.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class Cr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Cr)return t;if(typeof t=="number")return new Cr([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Cr(t)}}toString(){return JSON.stringify(this.values)}}const rh=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class gn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof gn)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){const a=t[r],c=t[r+1];if(typeof a!="string"||!rh.has(a)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new gn(t)}}toString(){return JSON.stringify(this.values)}}class Pr{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Pr({name:t,available:!1}):null}}function $r(i,t,r,a){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[i,t,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[i,t,r,a]:[i,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Io(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof It||i instanceof hu||i instanceof Yr||i instanceof Cr||i instanceof gn||i instanceof Pr)return!0;if(Array.isArray(i)){for(const t of i)if(!Io(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!Io(i[t]))return!1;return!0}return!1}function xi(i){if(i===null)return Qs;if(typeof i=="string")return Nt;if(typeof i=="boolean")return wt;if(typeof i=="number")return Ue;if(i instanceof It)return Er;if(i instanceof hu)return In;if(i instanceof Yr)return Un;if(i instanceof Cr)return mn;if(i instanceof gn)return J;if(i instanceof Pr)return jr;if(Array.isArray(i)){const t=i.length;let r;for(const a of i){const c=xi(a);if(r){if(r===c)continue;r=kt;break}r=c}return R(r||kt,t)}return fn}function Ba(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof It||i instanceof Yr||i instanceof Cr||i instanceof gn||i instanceof Pr?i.toString():JSON.stringify(i)}class $n{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Io(t[1]))return r.error("invalid value");const a=t[1];let c=xi(a);const f=r.expectedType;return c.kind!=="array"||c.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(c=f),new $n(c,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Zi{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Eo={string:Nt,number:Ue,boolean:wt,object:fn};class Qr{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let a,c=1;const f=t[0];if(f==="array"){let y,x;if(t.length>2){const T=t[1];if(typeof T!="string"||!(T in Eo)||T==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);y=Eo[T],c++}else y=kt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);x=t[2],c++}a=R(y,x)}else{if(!Eo[f])throw new Error(`Types doesn't contain name = ${f}`);a=Eo[f]}const m=[];for(;c<t.length;c++){const y=r.parse(t[c],c,kt);if(!y)return null;m.push(y)}return new Qr(a,m)}evaluate(t){for(let r=0;r<this.args.length;r++){const a=this.args[r].evaluate(t);if(!W(this.type,xi(a)))return a;if(r===this.args.length-1)throw new Zi(`Expected value to be of type ${L(this.type)}, but found ${L(xi(a))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Co={"to-boolean":wt,"to-color":Er,"to-number":Ue,"to-string":Nt};class en{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const a=t[0];if(!Co[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&t.length!==2)return r.error("Expected one argument.");const c=Co[a],f=[];for(let m=1;m<t.length;m++){const y=r.parse(t[m],m,kt);if(!y)return null;f.push(y)}return new en(c,f)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,a;for(const c of this.args){if(r=c.evaluate(t),a=null,r instanceof It)return r;if(typeof r=="string"){const f=t.parseColor(r);if(f)return f}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:$r(r[0],r[1],r[2],r[3]),!a))return new It(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Zi(a||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const a of this.args){r=a.evaluate(t);const c=Cr.parse(r);if(c)return c}throw new Zi(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const a of this.args){r=a.evaluate(t);const c=gn.parse(r);if(c)return c}throw new Zi(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const a of this.args){if(r=a.evaluate(t),r===null)return 0;const c=Number(r);if(!isNaN(c))return c}throw new Zi(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Yr.fromString(Ba(this.args[0].evaluate(t)));case"resolvedImage":return Pr.fromString(Ba(this.args[0].evaluate(t)));default:return Ba(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const nh=["Unknown","Point","LineString","Polygon"];class wl{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?nh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache[t];return r||(r=this._parseColorCache[t]=It.parse(t)),r}}class Ts{constructor(t,r,a=[],c,f=new Jr,m=[]){this.registry=t,this.path=a,this.key=a.map(y=>`[${y}]`).join(""),this.scope=f,this.errors=m,this.expectedType=c,this._isConstant=r}parse(t,r,a,c,f={}){return r?this.concat(r,a,c)._parse(t,f):this._parse(t,f)}_parse(t,r){function a(c,f,m){return m==="assert"?new Qr(f,[c]):m==="coerce"?new en(f,[c]):c}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=t[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[c];if(f){let m=f.parse(t,this);if(!m)return null;if(this.expectedType){const y=this.expectedType,x=m.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||x.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string")if(y.kind!=="padding"||x.kind!=="value"&&x.kind!=="number"&&x.kind!=="array")if(y.kind!=="variableAnchorOffsetCollection"||x.kind!=="value"&&x.kind!=="array"){if(this.checkSubtype(y,x))return null}else m=a(m,y,r.typeAnnotation||"coerce");else m=a(m,y,r.typeAnnotation||"coerce");else m=a(m,y,r.typeAnnotation||"coerce");else m=a(m,y,r.typeAnnotation||"assert")}if(!(m instanceof $n)&&m.type.kind!=="resolvedImage"&&this._isConstant(m)){const y=new wl;try{m=new $n(m.type,m.evaluate(y))}catch(x){return this.error(x.message),null}}return m}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,a){const c=typeof t=="number"?this.path.concat(t):this.path,f=a?this.scope.concat(a):this.scope;return new Ts(this.registry,this._isConstant,c,r||null,f,this.errors)}error(t,...r){const a=`${this.key}${r.map(c=>`[${c}]`).join("")}`;this.errors.push(new nr(a,t))}checkSubtype(t,r){const a=W(t,r);return a&&this.error(a),a}}class ks{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const a=[];for(let f=1;f<t.length-1;f+=2){const m=t[f];if(typeof m!="string")return r.error(`Expected string, but found ${typeof m} instead.`,f);if(/[^a-zA-Z0-9_]/.test(m))return r.error("Variable names must contain only alphanumeric characters or '_'.",f);const y=r.parse(t[f+1],f+1);if(!y)return null;a.push([m,y])}const c=r.parse(t[t.length-1],t.length-1,r.expectedType,a);return c?new ks(a,c):null}outputDefined(){return this.result.outputDefined()}}class ri{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const a=t[1];return r.scope.has(a)?new ri(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Po{constructor(t,r,a){this.type=t,this.index=r,this.input=a}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=r.parse(t[1],1,Ue),c=r.parse(t[2],2,R(r.expectedType||kt));return a&&c?new Po(c.type.itemType,a,c):null}evaluate(t){const r=this.index.evaluate(t),a=this.input.evaluate(t);if(r<0)throw new Zi(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new Zi(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new Zi(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class du{constructor(t,r){this.type=wt,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const a=r.parse(t[1],1,kt),c=r.parse(t[2],2,kt);return a&&c?re(a.type,[wt,Nt,Ue,Qs,kt])?new du(a,c):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${L(a.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!a)return!1;if(!le(r,["boolean","string","number","null"]))throw new Zi(`Expected first argument to be of type boolean, string, number or null, but found ${L(xi(r))} instead.`);if(!le(a,["string","array"]))throw new Zi(`Expected second argument to be of type array or string, but found ${L(xi(a))} instead.`);return a.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class eo{constructor(t,r,a){this.type=Ue,this.needle=t,this.haystack=r,this.fromIndex=a}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=r.parse(t[1],1,kt),c=r.parse(t[2],2,kt);if(!a||!c)return null;if(!re(a.type,[wt,Nt,Ue,Qs,kt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${L(a.type)} instead`);if(t.length===4){const f=r.parse(t[3],3,Ue);return f?new eo(a,c,f):null}return new eo(a,c)}evaluate(t){const r=this.needle.evaluate(t),a=this.haystack.evaluate(t);if(!le(r,["boolean","string","number","null"]))throw new Zi(`Expected first argument to be of type boolean, string, number or null, but found ${L(xi(r))} instead.`);let c;if(this.fromIndex&&(c=this.fromIndex.evaluate(t)),le(a,["string"])){const f=a.indexOf(r,c);return f===-1?-1:[...a.slice(0,f)].length}if(le(a,["array"]))return a.indexOf(r,c);throw new Zi(`Expected second argument to be of type array or string, but found ${L(xi(a))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class pi{constructor(t,r,a,c,f,m){this.inputType=t,this.type=r,this.input=a,this.cases=c,this.outputs=f,this.otherwise=m}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let a,c;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);const f={},m=[];for(let T=2;T<t.length-1;T+=2){let E=t[T];const C=t[T+1];Array.isArray(E)||(E=[E]);const z=r.concat(T);if(E.length===0)return z.error("Expected at least one branch label.");for(const N of E){if(typeof N!="number"&&typeof N!="string")return z.error("Branch labels must be numbers or strings.");if(typeof N=="number"&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof N=="number"&&Math.floor(N)!==N)return z.error("Numeric branch labels must be integer values.");if(a){if(z.checkSubtype(a,xi(N)))return null}else a=xi(N);if(f[String(N)]!==void 0)return z.error("Branch labels must be unique.");f[String(N)]=m.length}const F=r.parse(C,T,c);if(!F)return null;c=c||F.type,m.push(F)}const y=r.parse(t[1],1,kt);if(!y)return null;const x=r.parse(t[t.length-1],t.length-1,c);return x?y.type.kind!=="value"&&r.concat(1).checkSubtype(a,y.type)?null:new pi(a,c,y,f,m,x):null}evaluate(t){const r=this.input.evaluate(t);return(xi(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Oa{constructor(t,r,a){this.type=t,this.branches=r,this.otherwise=a}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const c=[];for(let m=1;m<t.length-1;m+=2){const y=r.parse(t[m],m,wt);if(!y)return null;const x=r.parse(t[m+1],m+1,a);if(!x)return null;c.push([y,x]),a=a||x.type}const f=r.parse(t[t.length-1],t.length-1,a);if(!f)return null;if(!a)throw new Error("Can't infer output type");return new Oa(a,c,f)}evaluate(t){for(const[r,a]of this.branches)if(r.evaluate(t))return a.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,a]of this.branches)t(r),t(a);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class ua{constructor(t,r,a,c){this.type=t,this.input=r,this.beginIndex=a,this.endIndex=c}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const a=r.parse(t[1],1,kt),c=r.parse(t[2],2,Ue);if(!a||!c)return null;if(!re(a.type,[R(kt),Nt,kt]))return r.error(`Expected first argument to be of type array or string, but found ${L(a.type)} instead`);if(t.length===4){const f=r.parse(t[3],3,Ue);return f?new ua(a.type,a,c,f):null}return new ua(a.type,a,c)}evaluate(t){const r=this.input.evaluate(t),a=this.beginIndex.evaluate(t);let c;if(this.endIndex&&(c=this.endIndex.evaluate(t)),le(r,["string"]))return[...r].slice(a,c).join("");if(le(r,["array"]))return r.slice(a,c);throw new Zi(`Expected first argument to be of type array or string, but found ${L(xi(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function ca(i,t){const r=i.length-1;let a,c,f=0,m=r,y=0;for(;f<=m;)if(y=Math.floor((f+m)/2),a=i[y],c=i[y+1],a<=t){if(y===r||t<c)return y;f=y+1}else{if(!(a>t))throw new Zi("Input is not a number.");m=y-1}return 0}class Mo{constructor(t,r,a){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[c,f]of a)this.labels.push(c),this.outputs.push(f)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const a=r.parse(t[1],1,Ue);if(!a)return null;const c=[];let f=null;r.expectedType&&r.expectedType.kind!=="value"&&(f=r.expectedType);for(let m=1;m<t.length;m+=2){const y=m===1?-1/0:t[m],x=t[m+1],T=m,E=m+1;if(typeof y!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(c.length&&c[c.length-1][0]>=y)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const C=r.parse(x,E,f);if(!C)return null;f=f||C.type,c.push([y,C])}return new Mo(f,a,c)}evaluate(t){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(t);const c=this.input.evaluate(t);if(c<=r[0])return a[0].evaluate(t);const f=r.length;return c>=r[f-1]?a[f-1].evaluate(t):a[ca(r,c)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function pu(i){return i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var hc=bl;function bl(i,t,r,a){this.cx=3*i,this.bx=3*(r-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(a-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=r,this.p2y=a}bl.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var r=i,a=0;a<8;a++){var c=this.sampleCurveX(r)-i;if(Math.abs(c)<t)return r;var f=this.sampleCurveDerivativeX(r);if(Math.abs(f)<1e-6)break;r-=c/f}var m=0,y=1;for(r=i,a=0;a<20&&(c=this.sampleCurveX(r),!(Math.abs(c-i)<t));a++)i>c?m=r:y=r,r=.5*(y-m)+m;return r},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var Sl=pu(hc);function tn(i,t,r){return i+r*(t-i)}function En(i,t,r){return i.map((a,c)=>tn(a,t[c],r))}const Gi={number:tn,color:function(i,t,r,a="rgb"){switch(a){case"rgb":{const[c,f,m,y]=En(i.rgb,t.rgb,r);return new It(c,f,m,y,!1)}case"hcl":{const[c,f,m,y]=i.hcl,[x,T,E,C]=t.hcl;let z,F;if(isNaN(c)||isNaN(x))isNaN(c)?isNaN(x)?z=NaN:(z=x,m!==1&&m!==0||(F=T)):(z=c,E!==1&&E!==0||(F=f));else{let ge=x-c;x>c&&ge>180?ge-=360:x<c&&c-x>180&&(ge+=360),z=c+r*ge}const[N,U,K,ee]=function([ge,ne,de,ke]){return ge=isNaN(ge)?0:ge*pt,Bi([de,Math.cos(ge)*ne,Math.sin(ge)*ne,ke])}([z,F??tn(f,T,r),tn(m,E,r),tn(y,C,r)]);return new It(N,U,K,ee,!1)}case"lab":{const[c,f,m,y]=Bi(En(i.lab,t.lab,r));return new It(c,f,m,y,!1)}}},array:En,padding:function(i,t,r){return new Cr(En(i.values,t.values,r))},variableAnchorOffsetCollection:function(i,t,r){const a=i.values,c=t.values;if(a.length!==c.length)throw new Zi(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${t.toString()}`);const f=[];for(let m=0;m<a.length;m+=2){if(a[m]!==c[m])throw new Zi(`Cannot interpolate values containing mismatched anchors. from[${m}]: ${a[m]}, to[${m}]: ${c[m]}`);f.push(a[m]);const[y,x]=a[m+1],[T,E]=c[m+1];f.push([tn(y,T,r),tn(x,E,r)])}return new gn(f)}};class hr{constructor(t,r,a,c,f){this.type=t,this.operator=r,this.interpolation=a,this.input=c,this.labels=[],this.outputs=[];for(const[m,y]of f)this.labels.push(m),this.outputs.push(y)}static interpolationFactor(t,r,a,c){let f=0;if(t.name==="exponential")f=to(r,t.base,a,c);else if(t.name==="linear")f=to(r,1,a,c);else if(t.name==="cubic-bezier"){const m=t.controlPoints;f=new Sl(m[0],m[1],m[2],m[3]).solve(to(r,1,a,c))}return f}static parse(t,r){let[a,c,f,...m]=t;if(!Array.isArray(c)||c.length===0)return r.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const T=c[1];if(typeof T!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:T}}else{if(c[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const T=c.slice(1);if(T.length!==4||T.some(E=>typeof E!="number"||E<0||E>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:T}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(f=r.parse(f,2,Ue),!f)return null;const y=[];let x=null;a==="interpolate-hcl"||a==="interpolate-lab"?x=Er:r.expectedType&&r.expectedType.kind!=="value"&&(x=r.expectedType);for(let T=0;T<m.length;T+=2){const E=m[T],C=m[T+1],z=T+3,F=T+4;if(typeof E!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(y.length&&y[y.length-1][0]>=E)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const N=r.parse(C,F,x);if(!N)return null;x=x||N.type,y.push([E,N])}return pe(x,Ue)||pe(x,Er)||pe(x,mn)||pe(x,J)||pe(x,R(Ue))?new hr(x,a,c,f,y):r.error(`Type ${L(x)} is not interpolatable.`)}evaluate(t){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(t);const c=this.input.evaluate(t);if(c<=r[0])return a[0].evaluate(t);const f=r.length;if(c>=r[f-1])return a[f-1].evaluate(t);const m=ca(r,c),y=hr.interpolationFactor(this.interpolation,c,r[m],r[m+1]),x=a[m].evaluate(t),T=a[m+1].evaluate(t);switch(this.operator){case"interpolate":return Gi[this.type.kind](x,T,y);case"interpolate-hcl":return Gi.color(x,T,y,"hcl");case"interpolate-lab":return Gi.color(x,T,y,"lab")}}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function to(i,t,r,a){const c=a-r,f=i-r;return c===0?0:t===1?f/c:(Math.pow(t,f)-1)/(Math.pow(t,c)-1)}class qn{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expectected at least one argument.");let a=null;const c=r.expectedType;c&&c.kind!=="value"&&(a=c);const f=[];for(const y of t.slice(1)){const x=r.parse(y,1+f.length,a,void 0,{typeAnnotation:"omit"});if(!x)return null;a=a||x.type,f.push(x)}if(!a)throw new Error("No output type");const m=c&&f.some(y=>W(c,y.type));return new qn(m?kt:a,f)}evaluate(t){let r,a=null,c=0;for(const f of this.args)if(c++,a=f.evaluate(t),a&&a instanceof Pr&&!a.available&&(r||(r=a.name),a=null,c===this.args.length&&(a=r)),a!==null)break;return a}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Tl(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function fu(i,t,r,a){return a.compare(t,r)===0}function hs(i,t,r){const a=i!=="=="&&i!=="!=";return class Jf{constructor(f,m,y){this.type=wt,this.lhs=f,this.rhs=m,this.collator=y,this.hasUntypedArgument=f.type.kind==="value"||m.type.kind==="value"}static parse(f,m){if(f.length!==3&&f.length!==4)return m.error("Expected two or three arguments.");const y=f[0];let x=m.parse(f[1],1,kt);if(!x)return null;if(!Tl(y,x.type))return m.concat(1).error(`"${y}" comparisons are not supported for type '${L(x.type)}'.`);let T=m.parse(f[2],2,kt);if(!T)return null;if(!Tl(y,T.type))return m.concat(2).error(`"${y}" comparisons are not supported for type '${L(T.type)}'.`);if(x.type.kind!==T.type.kind&&x.type.kind!=="value"&&T.type.kind!=="value")return m.error(`Cannot compare types '${L(x.type)}' and '${L(T.type)}'.`);a&&(x.type.kind==="value"&&T.type.kind!=="value"?x=new Qr(T.type,[x]):x.type.kind!=="value"&&T.type.kind==="value"&&(T=new Qr(x.type,[T])));let E=null;if(f.length===4){if(x.type.kind!=="string"&&T.type.kind!=="string"&&x.type.kind!=="value"&&T.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(E=m.parse(f[3],3,In),!E)return null}return new Jf(x,T,E)}evaluate(f){const m=this.lhs.evaluate(f),y=this.rhs.evaluate(f);if(a&&this.hasUntypedArgument){const x=xi(m),T=xi(y);if(x.kind!==T.kind||x.kind!=="string"&&x.kind!=="number")throw new Zi(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${x.kind}, ${T.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const x=xi(m),T=xi(y);if(x.kind!=="string"||T.kind!=="string")return t(f,m,y)}return this.collator?r(f,m,y,this.collator.evaluate(f)):t(f,m,y)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}}}const sh=hs("==",function(i,t,r){return t===r},fu),mu=hs("!=",function(i,t,r){return t!==r},function(i,t,r,a){return!fu(0,t,r,a)}),Na=hs("<",function(i,t,r){return t<r},function(i,t,r,a){return a.compare(t,r)<0}),dc=hs(">",function(i,t,r){return t>r},function(i,t,r,a){return a.compare(t,r)>0}),oh=hs("<=",function(i,t,r){return t<=r},function(i,t,r,a){return a.compare(t,r)<=0}),ha=hs(">=",function(i,t,r){return t>=r},function(i,t,r,a){return a.compare(t,r)>=0});class Is{constructor(t,r,a){this.type=In,this.locale=a,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const a=t[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");const c=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,wt);if(!c)return null;const f=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,wt);if(!f)return null;let m=null;return a.locale&&(m=r.parse(a.locale,1,Nt),!m)?null:new Is(c,f,m)}evaluate(t){return new hu(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class io{constructor(t,r,a,c,f){this.type=Nt,this.number=t,this.locale=r,this.currency=a,this.minFractionDigits=c,this.maxFractionDigits=f}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const a=r.parse(t[1],1,Ue);if(!a)return null;const c=t[2];if(typeof c!="object"||Array.isArray(c))return r.error("NumberFormat options argument must be an object.");let f=null;if(c.locale&&(f=r.parse(c.locale,1,Nt),!f))return null;let m=null;if(c.currency&&(m=r.parse(c.currency,1,Nt),!m))return null;let y=null;if(c["min-fraction-digits"]&&(y=r.parse(c["min-fraction-digits"],1,Ue),!y))return null;let x=null;return c["max-fraction-digits"]&&(x=r.parse(c["max-fraction-digits"],1,Ue),!x)?null:new io(a,f,m,y,x)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class zo{constructor(t){this.type=Un,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const a=t[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");const c=[];let f=!1;for(let m=1;m<=t.length-1;++m){const y=t[m];if(f&&typeof y=="object"&&!Array.isArray(y)){f=!1;let x=null;if(y["font-scale"]&&(x=r.parse(y["font-scale"],1,Ue),!x))return null;let T=null;if(y["text-font"]&&(T=r.parse(y["text-font"],1,R(Nt)),!T))return null;let E=null;if(y["text-color"]&&(E=r.parse(y["text-color"],1,Er),!E))return null;const C=c[c.length-1];C.scale=x,C.font=T,C.textColor=E}else{const x=r.parse(t[m],1,kt);if(!x)return null;const T=x.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,c.push({content:x,scale:null,font:null,textColor:null})}}return new zo(c)}evaluate(t){return new Yr(this.sections.map(r=>{const a=r.content.evaluate(t);return xi(a)===jr?new Fa("",a,null,null,null):new Fa(Ba(a),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}outputDefined(){return!1}}class gu{constructor(t){this.type=jr,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const a=r.parse(t[1],1,Nt);return a?new gu(a):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),a=Pr.fromString(r);return a&&t.availableImages&&(a.available=t.availableImages.indexOf(r)>-1),a}eachChild(t){t(this.input)}outputDefined(){return!1}}class _u{constructor(t){this.type=Ue,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const a=r.parse(t[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${L(a.type)} instead.`):new _u(a):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new Zi(`Expected value to be of type string or array, but found ${L(xi(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Cn=8192;function kl(i,t){const r=(180+i[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,c=Math.pow(2,t.z);return[Math.round(r*c*Cn),Math.round(a*c*Cn)]}function Va(i,t){const r=Math.pow(2,t.z);return[(c=(i[0]/Cn+t.x)/r,360*c-180),(a=(i[1]/Cn+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,c}function ro(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function qr(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function ni(i,t,r){const a=i[0]-t[0],c=i[1]-t[1],f=i[0]-r[0],m=i[1]-r[1];return a*m-f*c==0&&a*f<=0&&c*m<=0}function Ao(i,t,r,a){return(c=[a[0]-r[0],a[1]-r[1]])[0]*(f=[t[0]-i[0],t[1]-i[1]])[1]-c[1]*f[0]!=0&&!(!Do(i,t,r,a)||!Do(r,a,i,t));var c,f}function pc(i,t,r){for(const a of r)for(let c=0;c<a.length-1;++c)if(Ao(i,t,a[c],a[c+1]))return!0;return!1}function Es(i,t,r=!1){let a=!1;for(const y of t)for(let x=0;x<y.length-1;x++){if(ni(i,y[x],y[x+1]))return r;(f=y[x])[1]>(c=i)[1]!=(m=y[x+1])[1]>c[1]&&c[0]<(m[0]-f[0])*(c[1]-f[1])/(m[1]-f[1])+f[0]&&(a=!a)}var c,f,m;return a}function Il(i,t){for(const r of t)if(Es(i,r))return!0;return!1}function yu(i,t){for(const r of i)if(!Es(r,t))return!1;for(let r=0;r<i.length-1;++r)if(pc(i[r],i[r+1],t))return!1;return!0}function _n(i,t){for(const r of t)if(yu(i,r))return!0;return!1}function Do(i,t,r,a){const c=a[0]-r[0],f=a[1]-r[1],m=(i[0]-r[0])*f-c*(i[1]-r[1]),y=(t[0]-r[0])*f-c*(t[1]-r[1]);return m>0&&y<0||m<0&&y>0}function ja(i,t,r){const a=[];for(let c=0;c<i.length;c++){const f=[];for(let m=0;m<i[c].length;m++){const y=kl(i[c][m],r);ro(t,y),f.push(y)}a.push(f)}return a}function da(i,t,r){const a=[];for(let c=0;c<i.length;c++){const f=ja(i[c],t,r);a.push(f)}return a}function fc(i,t,r,a){if(i[0]<r[0]||i[0]>r[2]){const c=.5*a;let f=i[0]-r[0]>c?-a:r[0]-i[0]>c?a:0;f===0&&(f=i[0]-r[2]>c?-a:r[2]-i[0]>c?a:0),i[0]+=f}ro(t,i)}function El(i,t,r,a){const c=Math.pow(2,a.z)*Cn,f=[a.x*Cn,a.y*Cn],m=[];for(const y of i)for(const x of y){const T=[x.x+f[0],x.y+f[1]];fc(T,t,r,c),m.push(T)}return m}function Cl(i,t,r,a){const c=Math.pow(2,a.z)*Cn,f=[a.x*Cn,a.y*Cn],m=[];for(const x of i){const T=[];for(const E of x){const C=[E.x+f[0],E.y+f[1]];ro(t,C),T.push(C)}m.push(T)}if(t[2]-t[0]<=c/2){(y=t)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const x of m)for(const T of x)fc(T,t,r,c)}var y;return m}class Zn{constructor(t,r){this.type=wt,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Io(t[1])){const a=t[1];if(a.type==="FeatureCollection"){const c=[];for(const f of a.features){const{type:m,coordinates:y}=f.geometry;m==="Polygon"&&c.push(y),m==="MultiPolygon"&&c.push(...y)}if(c.length)return new Zn(a,{type:"MultiPolygon",coordinates:c})}else if(a.type==="Feature"){const c=a.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Zn(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Zn(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,a){const c=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(a.type==="Polygon"){const y=ja(a.coordinates,f,m),x=El(r.geometry(),c,f,m);if(!qr(c,f))return!1;for(const T of x)if(!Es(T,y))return!1}if(a.type==="MultiPolygon"){const y=da(a.coordinates,f,m),x=El(r.geometry(),c,f,m);if(!qr(c,f))return!1;for(const T of x)if(!Il(T,y))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,a){const c=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(a.type==="Polygon"){const y=ja(a.coordinates,f,m),x=Cl(r.geometry(),c,f,m);if(!qr(c,f))return!1;for(const T of x)if(!yu(T,y))return!1}if(a.type==="MultiPolygon"){const y=da(a.coordinates,f,m),x=Cl(r.geometry(),c,f,m);if(!qr(c,f))return!1;for(const T of x)if(!_n(T,y))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Ua=class{constructor(i=[],t=(r,a)=>r<a?-1:r>a?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:t,compare:r}=this,a=t[i];for(;i>0;){const c=i-1>>1,f=t[c];if(r(a,f)>=0)break;t[i]=f,i=c}t[i]=a}_down(i){const{data:t,compare:r}=this,a=this.length>>1,c=t[i];for(;i<a;){let f=1+(i<<1);const m=f+1;if(m<this.length&&r(t[m],t[f])<0&&(f=m),r(t[f],c)>=0)break;t[i]=t[f],i=f}t[i]=c}};function mc(i,t,r,a,c){gc(i,t,r,a||i.length-1,c)}function gc(i,t,r,a,c){for(;a>r;){if(a-r>600){var f=a-r+1,m=t-r+1,y=Math.log(f),x=.5*Math.exp(2*y/3),T=.5*Math.sqrt(y*x*(f-x)/f)*(m-f/2<0?-1:1);gc(i,t,Math.max(r,Math.floor(t-m*x/f+T)),Math.min(a,Math.floor(t+(f-m)*x/f+T)),c)}var E=i[t],C=r,z=a;for($a(i,r,t),c(i[a],E)>0&&$a(i,r,a);C<z;){for($a(i,C,z),C++,z--;c(i[C],E)<0;)C++;for(;c(i[z],E)>0;)z--}c(i[r],E)===0?$a(i,r,z):$a(i,++z,a),z<=t&&(r=z+1),t<=z&&(a=z-1)}}function $a(i,t,r){var a=i[t];i[t]=i[r],i[r]=a}function Pl(i,t){if(i.length<=1)return[i];const r=[];let a,c;for(const f of i){const m=ah(f);m!==0&&(f.area=Math.abs(m),c===void 0&&(c=m<0),c===m<0?(a&&r.push(a),a=[f]):a.push(f))}if(a&&r.push(a),t>1)for(let f=0;f<r.length;f++)r[f].length<=t||(mc(r[f],t,1,r[f].length-1,vu),r[f]=r[f].slice(0,t));return r}function vu(i,t){return t.area-i.area}function ah(i){let t=0;for(let r,a,c=0,f=i.length,m=f-1;c<f;m=c++)r=i[c],a=i[m],t+=(a.x-r.x)*(r.y+a.y);return t}const _c=1/298.257223563,yc=_c*(2-_c),vc=Math.PI/180;class xu{constructor(t){const r=6378.137*vc*1e3,a=Math.cos(t*vc),c=1/(1-yc*(1-a*a)),f=Math.sqrt(c);this.kx=r*f*a,this.ky=r*f*c*(1-yc)}distance(t,r){const a=this.wrap(t[0]-r[0])*this.kx,c=(t[1]-r[1])*this.ky;return Math.sqrt(a*a+c*c)}pointOnLine(t,r){let a,c,f,m,y=1/0;for(let x=0;x<t.length-1;x++){let T=t[x][0],E=t[x][1],C=this.wrap(t[x+1][0]-T)*this.kx,z=(t[x+1][1]-E)*this.ky,F=0;C===0&&z===0||(F=(this.wrap(r[0]-T)*this.kx*C+(r[1]-E)*this.ky*z)/(C*C+z*z),F>1?(T=t[x+1][0],E=t[x+1][1]):F>0&&(T+=C/this.kx*F,E+=z/this.ky*F)),C=this.wrap(r[0]-T)*this.kx,z=(r[1]-E)*this.ky;const N=C*C+z*z;N<y&&(y=N,a=T,c=E,f=x,m=F)}return{point:[a,c],index:f,t:Math.max(0,Math.min(1,m))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function wu(i,t){return t[0]-i[0]}function Ml(i){return i[1]-i[0]+1}function Cs(i,t){return i[1]>=i[0]&&i[1]<t}function bu(i,t){if(i[0]>i[1])return[null,null];const r=Ml(i);if(t){if(r===2)return[i,null];const c=Math.floor(r/2);return[[i[0],i[0]+c],[i[0]+c,i[1]]]}if(r===1)return[i,null];const a=Math.floor(r/2)-1;return[[i[0],i[0]+a],[i[0]+a+1,i[1]]]}function Su(i,t){if(!Cs(t,i.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let a=t[0];a<=t[1];++a)ro(r,i[a]);return r}function qa(i){const t=[1/0,1/0,-1/0,-1/0];for(const r of i)for(const a of r)ro(t,a);return t}function xc(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function Za(i,t,r){if(!xc(i)||!xc(t))return NaN;let a=0,c=0;return i[2]<t[0]&&(a=t[0]-i[2]),i[0]>t[2]&&(a=i[0]-t[2]),i[1]>t[3]&&(c=i[1]-t[3]),i[3]<t[1]&&(c=t[1]-i[3]),r.distance([0,0],[a,c])}function Lo(i,t,r){const a=r.pointOnLine(t,i);return r.distance(i,a.point)}function zl(i,t,r,a,c){const f=Math.min(Lo(i,[r,a],c),Lo(t,[r,a],c)),m=Math.min(Lo(r,[i,t],c),Lo(a,[i,t],c));return Math.min(f,m)}function lh(i,t,r,a,c){if(!Cs(t,i.length)||!Cs(a,r.length))return 1/0;let f=1/0;for(let m=t[0];m<t[1];++m){const y=i[m],x=i[m+1];for(let T=a[0];T<a[1];++T){const E=r[T],C=r[T+1];if(Ao(y,x,E,C))return 0;f=Math.min(f,zl(y,x,E,C,c))}}return f}function uh(i,t,r,a,c){if(!Cs(t,i.length)||!Cs(a,r.length))return NaN;let f=1/0;for(let m=t[0];m<=t[1];++m)for(let y=a[0];y<=a[1];++y)if(f=Math.min(f,c.distance(i[m],r[y])),f===0)return f;return f}function Ui(i,t,r){if(Es(i,t,!0))return 0;let a=1/0;for(const c of t){const f=c[0],m=c[c.length-1];if(f!==m&&(a=Math.min(a,Lo(i,[m,f],r)),a===0))return a;const y=r.pointOnLine(c,i);if(a=Math.min(a,r.distance(i,y.point)),a===0)return a}return a}function ch(i,t,r,a){if(!Cs(t,i.length))return NaN;for(let f=t[0];f<=t[1];++f)if(Es(i[f],r,!0))return 0;let c=1/0;for(let f=t[0];f<t[1];++f){const m=i[f],y=i[f+1];for(const x of r)for(let T=0,E=x.length,C=E-1;T<E;C=T++){const z=x[C],F=x[T];if(Ao(m,y,z,F))return 0;c=Math.min(c,zl(m,y,z,F,a))}}return c}function $t(i,t){for(const r of i)for(const a of r)if(Es(a,t,!0))return!0;return!1}function Tu(i,t,r,a=1/0){const c=qa(i),f=qa(t);if(a!==1/0&&Za(c,f,r)>=a)return a;if(qr(c,f)){if($t(i,t))return 0}else if($t(t,i))return 0;let m=1/0;for(const y of i)for(let x=0,T=y.length,E=T-1;x<T;E=x++){const C=y[E],z=y[x];for(const F of t)for(let N=0,U=F.length,K=U-1;N<U;K=N++){const ee=F[K],ge=F[N];if(Ao(C,z,ee,ge))return 0;m=Math.min(m,zl(C,z,ee,ge,r))}}return m}function Si(i,t,r,a,c,f){if(!f)return;const m=Za(Su(a,f),c,r);m<t&&i.push([m,f,[0,0]])}function oi(i,t,r,a,c,f,m){if(!f||!m)return;const y=Za(Su(a,f),Su(c,m),r);y<t&&i.push([y,f,m])}function Gn(i,t,r,a,c=1/0){let f=Math.min(a.distance(i[0],r[0][0]),c);if(f===0)return f;const m=new Ua([[0,[0,i.length-1],[0,0]]],wu),y=qa(r);for(;m.length>0;){const x=m.pop();if(x[0]>=f)continue;const T=x[1],E=t?50:100;if(Ml(T)<=E){if(!Cs(T,i.length))return NaN;if(t){const C=ch(i,T,r,a);if(isNaN(C)||C===0)return C;f=Math.min(f,C)}else for(let C=T[0];C<=T[1];++C){const z=Ui(i[C],r,a);if(f=Math.min(f,z),f===0)return 0}}else{const C=bu(T,t);Si(m,f,a,i,y,C[0]),Si(m,f,a,i,y,C[1])}}return f}function Ga(i,t,r,a,c,f=1/0){let m=Math.min(f,c.distance(i[0],r[0]));if(m===0)return m;const y=new Ua([[0,[0,i.length-1],[0,r.length-1]]],wu);for(;y.length>0;){const x=y.pop();if(x[0]>=m)continue;const T=x[1],E=x[2],C=t?50:100,z=a?50:100;if(Ml(T)<=C&&Ml(E)<=z){if(!Cs(T,i.length)&&Cs(E,r.length))return NaN;let F;if(t&&a)F=lh(i,T,r,E,c),m=Math.min(m,F);else if(t&&!a){const N=i.slice(T[0],T[1]+1);for(let U=E[0];U<=E[1];++U)if(F=Lo(r[U],N,c),m=Math.min(m,F),m===0)return m}else if(!t&&a){const N=r.slice(E[0],E[1]+1);for(let U=T[0];U<=T[1];++U)if(F=Lo(i[U],N,c),m=Math.min(m,F),m===0)return m}else F=uh(i,T,r,E,c),m=Math.min(m,F)}else{const F=bu(T,t),N=bu(E,a);oi(y,m,c,i,r,F[0],N[0]),oi(y,m,c,i,r,F[0],N[1]),oi(y,m,c,i,r,F[1],N[0]),oi(y,m,c,i,r,F[1],N[1])}}return m}function Ha(i){return i.type==="MultiPolygon"?i.coordinates.map(t=>({type:"Polygon",coordinates:t})):i.type==="MultiLineString"?i.coordinates.map(t=>({type:"LineString",coordinates:t})):i.type==="MultiPoint"?i.coordinates.map(t=>({type:"Point",coordinates:t})):[i]}class no{constructor(t,r){this.type=Ue,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Io(t[1])){const a=t[1];if(a.type==="FeatureCollection")return new no(a,a.features.map(c=>Ha(c.geometry)).flat());if(a.type==="Feature")return new no(a,Ha(a.geometry));if("type"in a&&"coordinates"in a)return new no(a,Ha(a))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,a){const c=r.geometry(),f=c.flat().map(x=>Va([x.x,x.y],r.canonical));if(c.length===0)return NaN;const m=new xu(f[0][1]);let y=1/0;for(const x of a){switch(x.type){case"Point":y=Math.min(y,Ga(f,!1,[x.coordinates],!1,m,y));break;case"LineString":y=Math.min(y,Ga(f,!1,x.coordinates,!0,m,y));break;case"Polygon":y=Math.min(y,Gn(f,!1,x.coordinates,m,y))}if(y===0)return y}return y}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,a){const c=r.geometry(),f=c.flat().map(x=>Va([x.x,x.y],r.canonical));if(c.length===0)return NaN;const m=new xu(f[0][1]);let y=1/0;for(const x of a){switch(x.type){case"Point":y=Math.min(y,Ga(f,!0,[x.coordinates],!1,m,y));break;case"LineString":y=Math.min(y,Ga(f,!0,x.coordinates,!0,m,y));break;case"Polygon":y=Math.min(y,Gn(f,!0,x.coordinates,m,y))}if(y===0)return y}return y}(t,this.geometries);if(t.geometryType()==="Polygon")return function(r,a){const c=r.geometry();if(c.length===0||c[0].length===0)return NaN;const f=Pl(c,0).map(x=>x.map(T=>T.map(E=>Va([E.x,E.y],r.canonical)))),m=new xu(f[0][0][0][1]);let y=1/0;for(const x of a)for(const T of f){switch(x.type){case"Point":y=Math.min(y,Gn([x.coordinates],!1,T,m,y));break;case"LineString":y=Math.min(y,Gn(x.coordinates,!0,T,m,y));break;case"Polygon":y=Math.min(y,Tu(T,x.coordinates,m,y))}if(y===0)return y}return y}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Ro={"==":sh,"!=":mu,">":dc,"<":Na,">=":ha,"<=":oh,array:Qr,at:Po,boolean:Qr,case:Oa,coalesce:qn,collator:Is,format:zo,image:gu,in:du,"index-of":eo,interpolate:hr,"interpolate-hcl":hr,"interpolate-lab":hr,length:_u,let:ks,literal:$n,match:pi,number:Qr,"number-format":io,object:Qr,slice:ua,step:Mo,string:Qr,"to-boolean":en,"to-color":en,"to-number":en,"to-string":en,var:ri,within:Zn,distance:no};class yn{constructor(t,r,a,c){this.name=t,this.type=r,this._evaluate=a,this.args=c}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){const a=t[0],c=yn.definitions[a];if(!c)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(c)?c[0]:c.type,m=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,y=m.filter(([T])=>!Array.isArray(T)||T.length===t.length-1);let x=null;for(const[T,E]of y){x=new Ts(r.registry,Dl,r.path,null,r.scope);const C=[];let z=!1;for(let F=1;F<t.length;F++){const N=t[F],U=Array.isArray(T)?T[F-1]:T.type,K=x.parse(N,1+C.length,U);if(!K){z=!0;break}C.push(K)}if(!z)if(Array.isArray(T)&&T.length!==C.length)x.error(`Expected ${T.length} arguments, but found ${C.length} instead.`);else{for(let F=0;F<C.length;F++){const N=Array.isArray(T)?T[F]:T.type,U=C[F];x.concat(F+1).checkSubtype(N,U.type)}if(x.errors.length===0)return new yn(a,f,E,C)}}if(y.length===1)r.errors.push(...x.errors);else{const T=(y.length?y:m).map(([C])=>{return z=C,Array.isArray(z)?`(${z.map(L).join(", ")})`:`(${L(z.type)}...)`;var z}).join(" | "),E=[];for(let C=1;C<t.length;C++){const z=r.parse(t[C],1+E.length);if(!z)return null;E.push(L(z.type))}r.error(`Expected arguments of type ${T}, but found (${E.join(", ")}) instead.`)}return null}static register(t,r){yn.definitions=r;for(const a in r)t[a]=yn}}function ku(i,[t,r,a,c]){t=t.evaluate(i),r=r.evaluate(i),a=a.evaluate(i);const f=c?c.evaluate(i):1,m=$r(t,r,a,f);if(m)throw new Zi(m);return new It(t/255,r/255,a/255,f,!1)}function so(i,t){return i in t}function Al(i,t){const r=t[i];return r===void 0?null:r}function Fo(i){return{type:i}}function Dl(i){if(i instanceof ri)return Dl(i.boundExpression);if(i instanceof yn&&i.name==="error"||i instanceof Is||i instanceof Zn||i instanceof no)return!1;const t=i instanceof en||i instanceof Qr;let r=!0;return i.eachChild(a=>{r=t?r&&Dl(a):r&&a instanceof $n}),!!r&&pa(i)&&Ps(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function pa(i){if(i instanceof yn&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Zn||i instanceof no)return!1;let t=!0;return i.eachChild(r=>{t&&!pa(r)&&(t=!1)}),t}function Bo(i){if(i instanceof yn&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(r=>{t&&!Bo(r)&&(t=!1)}),t}function Ps(i,t){if(i instanceof yn&&t.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild(a=>{r&&!Ps(a,t)&&(r=!1)}),r}function Oo(i){return{result:"success",value:i}}function oo(i){return{result:"error",value:i}}function Ms(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function wc(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Ll(i){return!!i.expression&&i.expression.interpolated}function Qt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function fa(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function bc(i){return i}function Iu(i,t){const r=t.type==="color",a=i.stops&&typeof i.stops[0][0]=="object",c=a||!(a||i.property!==void 0),f=i.type||(Ll(t)?"exponential":"interval");if(r||t.type==="padding"){const E=r?It.parse:Cr.parse;(i=jn({},i)).stops&&(i.stops=i.stops.map(C=>[C[0],E(C[1])])),i.default=E(i.default?i.default:t.default)}if(i.colorSpace&&(m=i.colorSpace)!=="rgb"&&m!=="hcl"&&m!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var m;let y,x,T;if(f==="exponential")y=Wa;else if(f==="interval")y=Tc;else if(f==="categorical"){y=Sc,x=Object.create(null);for(const E of i.stops)x[E[0]]=E[1];T=typeof i.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);y=hh}if(a){const E={},C=[];for(let N=0;N<i.stops.length;N++){const U=i.stops[N],K=U[0].zoom;E[K]===void 0&&(E[K]={zoom:K,type:i.type,property:i.property,default:i.default,stops:[]},C.push(K)),E[K].stops.push([U[0].value,U[1]])}const z=[];for(const N of C)z.push([E[N].zoom,Iu(E[N],t)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:hr.interpolationFactor.bind(void 0,F),zoomStops:z.map(N=>N[0]),evaluate:({zoom:N},U)=>Wa({stops:z,base:i.base},t,N).evaluate(N,U)}}if(c){const E=f==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:hr.interpolationFactor.bind(void 0,E),zoomStops:i.stops.map(C=>C[0]),evaluate:({zoom:C})=>y(i,t,C,x,T)}}return{kind:"source",evaluate(E,C){const z=C&&C.properties?C.properties[i.property]:void 0;return z===void 0?ma(i.default,t.default):y(i,t,z,x,T)}}}function ma(i,t,r){return i!==void 0?i:t!==void 0?t:r!==void 0?r:void 0}function Sc(i,t,r,a,c){return ma(typeof r===c?a[r]:void 0,i.default,t.default)}function Tc(i,t,r){if(Qt(r)!=="number")return ma(i.default,t.default);const a=i.stops.length;if(a===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[a-1][0])return i.stops[a-1][1];const c=ca(i.stops.map(f=>f[0]),r);return i.stops[c][1]}function Wa(i,t,r){const a=i.base!==void 0?i.base:1;if(Qt(r)!=="number")return ma(i.default,t.default);const c=i.stops.length;if(c===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[c-1][0])return i.stops[c-1][1];const f=ca(i.stops.map(E=>E[0]),r),m=function(E,C,z,F){const N=F-z,U=E-z;return N===0?0:C===1?U/N:(Math.pow(C,U)-1)/(Math.pow(C,N)-1)}(r,a,i.stops[f][0],i.stops[f+1][0]),y=i.stops[f][1],x=i.stops[f+1][1],T=Gi[t.type]||bc;return typeof y.evaluate=="function"?{evaluate(...E){const C=y.evaluate.apply(void 0,E),z=x.evaluate.apply(void 0,E);if(C!==void 0&&z!==void 0)return T(C,z,m,i.colorSpace)}}:T(y,x,m,i.colorSpace)}function hh(i,t,r){switch(t.type){case"color":r=It.parse(r);break;case"formatted":r=Yr.fromString(r.toString());break;case"resolvedImage":r=Pr.fromString(r.toString());break;case"padding":r=Cr.parse(r);break;default:Qt(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return ma(r,i.default,t.default)}yn.register(Ro,{error:[{kind:"error"},[Nt],(i,[t])=>{throw new Zi(t.evaluate(i))}],typeof:[Nt,[kt],(i,[t])=>L(xi(t.evaluate(i)))],"to-rgba":[R(Ue,4),[Er],(i,[t])=>{const[r,a,c,f]=t.evaluate(i).rgb;return[255*r,255*a,255*c,f]}],rgb:[Er,[Ue,Ue,Ue],ku],rgba:[Er,[Ue,Ue,Ue,Ue],ku],has:{type:wt,overloads:[[[Nt],(i,[t])=>so(t.evaluate(i),i.properties())],[[Nt,fn],(i,[t,r])=>so(t.evaluate(i),r.evaluate(i))]]},get:{type:kt,overloads:[[[Nt],(i,[t])=>Al(t.evaluate(i),i.properties())],[[Nt,fn],(i,[t,r])=>Al(t.evaluate(i),r.evaluate(i))]]},"feature-state":[kt,[Nt],(i,[t])=>Al(t.evaluate(i),i.featureState||{})],properties:[fn,[],i=>i.properties()],"geometry-type":[Nt,[],i=>i.geometryType()],id:[kt,[],i=>i.id()],zoom:[Ue,[],i=>i.globals.zoom],"heatmap-density":[Ue,[],i=>i.globals.heatmapDensity||0],"line-progress":[Ue,[],i=>i.globals.lineProgress||0],accumulated:[kt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Ue,Fo(Ue),(i,t)=>{let r=0;for(const a of t)r+=a.evaluate(i);return r}],"*":[Ue,Fo(Ue),(i,t)=>{let r=1;for(const a of t)r*=a.evaluate(i);return r}],"-":{type:Ue,overloads:[[[Ue,Ue],(i,[t,r])=>t.evaluate(i)-r.evaluate(i)],[[Ue],(i,[t])=>-t.evaluate(i)]]},"/":[Ue,[Ue,Ue],(i,[t,r])=>t.evaluate(i)/r.evaluate(i)],"%":[Ue,[Ue,Ue],(i,[t,r])=>t.evaluate(i)%r.evaluate(i)],ln2:[Ue,[],()=>Math.LN2],pi:[Ue,[],()=>Math.PI],e:[Ue,[],()=>Math.E],"^":[Ue,[Ue,Ue],(i,[t,r])=>Math.pow(t.evaluate(i),r.evaluate(i))],sqrt:[Ue,[Ue],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[Ue,[Ue],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[Ue,[Ue],(i,[t])=>Math.log(t.evaluate(i))],log2:[Ue,[Ue],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[Ue,[Ue],(i,[t])=>Math.sin(t.evaluate(i))],cos:[Ue,[Ue],(i,[t])=>Math.cos(t.evaluate(i))],tan:[Ue,[Ue],(i,[t])=>Math.tan(t.evaluate(i))],asin:[Ue,[Ue],(i,[t])=>Math.asin(t.evaluate(i))],acos:[Ue,[Ue],(i,[t])=>Math.acos(t.evaluate(i))],atan:[Ue,[Ue],(i,[t])=>Math.atan(t.evaluate(i))],min:[Ue,Fo(Ue),(i,t)=>Math.min(...t.map(r=>r.evaluate(i)))],max:[Ue,Fo(Ue),(i,t)=>Math.max(...t.map(r=>r.evaluate(i)))],abs:[Ue,[Ue],(i,[t])=>Math.abs(t.evaluate(i))],round:[Ue,[Ue],(i,[t])=>{const r=t.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[Ue,[Ue],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[Ue,[Ue],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[wt,[Nt,kt],(i,[t,r])=>i.properties()[t.value]===r.value],"filter-id-==":[wt,[kt],(i,[t])=>i.id()===t.value],"filter-type-==":[wt,[Nt],(i,[t])=>i.geometryType()===t.value],"filter-<":[wt,[Nt,kt],(i,[t,r])=>{const a=i.properties()[t.value],c=r.value;return typeof a==typeof c&&a<c}],"filter-id-<":[wt,[kt],(i,[t])=>{const r=i.id(),a=t.value;return typeof r==typeof a&&r<a}],"filter->":[wt,[Nt,kt],(i,[t,r])=>{const a=i.properties()[t.value],c=r.value;return typeof a==typeof c&&a>c}],"filter-id->":[wt,[kt],(i,[t])=>{const r=i.id(),a=t.value;return typeof r==typeof a&&r>a}],"filter-<=":[wt,[Nt,kt],(i,[t,r])=>{const a=i.properties()[t.value],c=r.value;return typeof a==typeof c&&a<=c}],"filter-id-<=":[wt,[kt],(i,[t])=>{const r=i.id(),a=t.value;return typeof r==typeof a&&r<=a}],"filter->=":[wt,[Nt,kt],(i,[t,r])=>{const a=i.properties()[t.value],c=r.value;return typeof a==typeof c&&a>=c}],"filter-id->=":[wt,[kt],(i,[t])=>{const r=i.id(),a=t.value;return typeof r==typeof a&&r>=a}],"filter-has":[wt,[kt],(i,[t])=>t.value in i.properties()],"filter-has-id":[wt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[wt,[R(Nt)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[wt,[R(kt)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[wt,[Nt,R(kt)],(i,[t,r])=>r.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[wt,[Nt,R(kt)],(i,[t,r])=>function(a,c,f,m){for(;f<=m;){const y=f+m>>1;if(c[y]===a)return!0;c[y]>a?m=y-1:f=y+1}return!1}(i.properties()[t.value],r.value,0,r.value.length-1)],all:{type:wt,overloads:[[[wt,wt],(i,[t,r])=>t.evaluate(i)&&r.evaluate(i)],[Fo(wt),(i,t)=>{for(const r of t)if(!r.evaluate(i))return!1;return!0}]]},any:{type:wt,overloads:[[[wt,wt],(i,[t,r])=>t.evaluate(i)||r.evaluate(i)],[Fo(wt),(i,t)=>{for(const r of t)if(r.evaluate(i))return!0;return!1}]]},"!":[wt,[wt],(i,[t])=>!t.evaluate(i)],"is-supported-script":[wt,[Nt],(i,[t])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(t.evaluate(i))}],upcase:[Nt,[Nt],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[Nt,[Nt],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[Nt,Fo(kt),(i,t)=>t.map(r=>Ba(r.evaluate(i))).join("")],"resolved-locale":[Nt,[In],(i,[t])=>t.evaluate(i).resolvedLocale()]});class Rl{constructor(t,r){var a;this.expression=t,this._warningHistory={},this._evaluator=new wl,this._defaultValue=r?(a=r).type==="color"&&fa(a.default)?new It(0,0,0,0):a.type==="color"?It.parse(a.default)||null:a.type==="padding"?Cr.parse(a.default)||null:a.type==="variableAnchorOffsetCollection"?gn.parse(a.default)||null:a.default===void 0?null:a.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,a,c,f,m){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=c,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)}evaluate(t,r,a,c,f,m){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=c,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new Zi(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function Zr(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Ro}function ao(i,t){const r=new Ts(Ro,Dl,[],t?function(c){const f={color:Er,string:Nt,number:Ue,enum:Nt,boolean:wt,formatted:Un,padding:mn,resolvedImage:jr,variableAnchorOffsetCollection:J};return c.type==="array"?R(f[c.value]||kt,c.length):f[c.type]}(t):void 0),a=r.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?Oo(new Rl(a,t)):oo(r.errors)}class ga{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!Bo(r.expression)}evaluateWithoutErrorHandling(t,r,a,c,f,m){return this._styleExpression.evaluateWithoutErrorHandling(t,r,a,c,f,m)}evaluate(t,r,a,c,f,m){return this._styleExpression.evaluate(t,r,a,c,f,m)}}class No{constructor(t,r,a,c){this.kind=t,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!Bo(r.expression),this.interpolationType=c}evaluateWithoutErrorHandling(t,r,a,c,f,m){return this._styleExpression.evaluateWithoutErrorHandling(t,r,a,c,f,m)}evaluate(t,r,a,c,f,m){return this._styleExpression.evaluate(t,r,a,c,f,m)}interpolationFactor(t,r,a){return this.interpolationType?hr.interpolationFactor(this.interpolationType,t,r,a):0}}function _a(i,t){const r=ao(i,t);if(r.result==="error")return r;const a=r.value.expression,c=pa(a);if(!c&&!Ms(t))return oo([new nr("","data expressions not supported")]);const f=Ps(a,["zoom"]);if(!f&&!wc(t))return oo([new nr("","zoom expressions not supported")]);const m=lo(a);return m||f?m instanceof nr?oo([m]):m instanceof hr&&!Ll(t)?oo([new nr("",'"interpolate" expressions cannot be used with this property')]):Oo(m?new No(c?"camera":"composite",r.value,m.labels,m instanceof hr?m.interpolation:void 0):new ga(c?"constant":"source",r.value)):oo([new nr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ya{constructor(t,r){this._parameters=t,this._specification=r,jn(this,Iu(this._parameters,this._specification))}static deserialize(t){return new ya(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function lo(i){let t=null;if(i instanceof ks)t=lo(i.result);else if(i instanceof qn){for(const r of i.args)if(t=lo(r),t)break}else(i instanceof Mo||i instanceof hr)&&i.input instanceof yn&&i.input.name==="zoom"&&(t=i);return t instanceof nr||i.eachChild(r=>{const a=lo(r);a instanceof nr?t=a:!t&&a?t=new nr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&a&&t!==a&&(t=new nr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Fl(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!Fl(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const kc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Hn(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Fl(i)||(i=xa(i));const t=ao(i,kc);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,a,c)=>t.value.evaluate(r,a,{},c),needGeometry:va(i)}}function Eu(i,t){return i<t?-1:i>t?1:0}function va(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(va(i[t]))return!0;return!1}function xa(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?Bl(i[1],i[2],"=="):t==="!="?zs(Bl(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Bl(i[1],i[2],t):t==="any"?(r=i.slice(1),["any"].concat(r.map(xa))):t==="all"?["all"].concat(i.slice(1).map(xa)):t==="none"?["all"].concat(i.slice(1).map(xa).map(zs)):t==="in"?Xa(i[1],i.slice(2)):t==="!in"?zs(Xa(i[1],i.slice(2))):t==="has"?ds(i[1]):t!=="!has"||zs(ds(i[1]));var r}function Bl(i,t,r){switch(i){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,i,t]}}function Xa(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",i,["literal",t.sort(Eu)]]:["filter-in-small",i,["literal",t]]}}function ds(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function zs(i){return["!",i]}function Mr(i){const t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let c="[";for(const f of i)c+=`${Mr(f)},`;return`${c}]`}const r=Object.keys(i).sort();let a="{";for(let c=0;c<r.length;c++)a+=`${JSON.stringify(r[c])}:${Mr(i[r[c]])},`;return`${a}}`}function uo(i){let t="";for(const r of Ss)t+=`/${Mr(i[r])}`;return t}function Ol(i){const t=i.value;return t?[new Fe(i.key,t,"constants have been deprecated as of v8")]:[]}function Vi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function co(i){if(Array.isArray(i))return i.map(co);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const r in i)t[r]=co(i[r]);return t}return Vi(i)}function _r(i){const t=i.key,r=i.value,a=i.valueSpec||{},c=i.objectElementValidators||{},f=i.style,m=i.styleSpec,y=i.validateSpec;let x=[];const T=Qt(r);if(T!=="object")return[new Fe(t,r,`object expected, ${T} found`)];for(const E in r){const C=E.split(".")[0],z=a[C]||a["*"];let F;if(c[C])F=c[C];else if(a[C])F=y;else if(c["*"])F=c["*"];else{if(!a["*"]){x.push(new Fe(t,r[E],`unknown property "${E}"`));continue}F=y}x=x.concat(F({key:(t&&`${t}.`)+E,value:r[E],valueSpec:z,style:f,styleSpec:m,object:r,objectKey:E,validateSpec:y},r))}for(const E in a)c[E]||a[E].required&&a[E].default===void 0&&r[E]===void 0&&x.push(new Fe(t,r,`missing required property "${E}"`));return x}function Ka(i){const t=i.value,r=i.valueSpec,a=i.style,c=i.styleSpec,f=i.key,m=i.arrayElementValidator||i.validateSpec;if(Qt(t)!=="array")return[new Fe(f,t,`array expected, ${Qt(t)} found`)];if(r.length&&t.length!==r.length)return[new Fe(f,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new Fe(f,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let y={type:r.value,values:r.values};c.$version<7&&(y.function=r.function),Qt(r.value)==="object"&&(y=r.value);let x=[];for(let T=0;T<t.length;T++)x=x.concat(m({array:t,arrayIndex:T,value:t[T],valueSpec:y,validateSpec:i.validateSpec,style:a,styleSpec:c,key:`${f}[${T}]`}));return x}function wa(i){const t=i.key,r=i.value,a=i.valueSpec;let c=Qt(r);return c==="number"&&r!=r&&(c="NaN"),c!=="number"?[new Fe(t,r,`number expected, ${c} found`)]:"minimum"in a&&r<a.minimum?[new Fe(t,r,`${r} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&r>a.maximum?[new Fe(t,r,`${r} is greater than the maximum value ${a.maximum}`)]:[]}function As(i){const t=i.valueSpec,r=Vi(i.value.type);let a,c,f,m={};const y=r!=="categorical"&&i.value.property===void 0,x=!y,T=Qt(i.value.stops)==="array"&&Qt(i.value.stops[0])==="array"&&Qt(i.value.stops[0][0])==="object",E=_r({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(F){if(r==="identity")return[new Fe(F.key,F.value,'identity function may not have a "stops" property')];let N=[];const U=F.value;return N=N.concat(Ka({key:F.key,value:U,valueSpec:F.valueSpec,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:C})),Qt(U)==="array"&&U.length===0&&N.push(new Fe(F.key,U,"array must have at least one stop")),N},default:function(F){return F.validateSpec({key:F.key,value:F.value,valueSpec:t,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec})}}});return r==="identity"&&y&&E.push(new Fe(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||E.push(new Fe(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!Ll(i.valueSpec)&&E.push(new Fe(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(x&&!Ms(i.valueSpec)?E.push(new Fe(i.key,i.value,"property functions not supported")):y&&!wc(i.valueSpec)&&E.push(new Fe(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!T||i.value.property!==void 0||E.push(new Fe(i.key,i.value,'"property" property is required')),E;function C(F){let N=[];const U=F.value,K=F.key;if(Qt(U)!=="array")return[new Fe(K,U,`array expected, ${Qt(U)} found`)];if(U.length!==2)return[new Fe(K,U,`array length 2 expected, length ${U.length} found`)];if(T){if(Qt(U[0])!=="object")return[new Fe(K,U,`object expected, ${Qt(U[0])} found`)];if(U[0].zoom===void 0)return[new Fe(K,U,"object stop key must have zoom")];if(U[0].value===void 0)return[new Fe(K,U,"object stop key must have value")];if(f&&f>Vi(U[0].zoom))return[new Fe(K,U[0].zoom,"stop zoom values must appear in ascending order")];Vi(U[0].zoom)!==f&&(f=Vi(U[0].zoom),c=void 0,m={}),N=N.concat(_r({key:`${K}[0]`,value:U[0],valueSpec:{zoom:{}},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:wa,value:z}}))}else N=N.concat(z({key:`${K}[0]`,value:U[0],valueSpec:{},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec},U));return Zr(co(U[1]))?N.concat([new Fe(`${K}[1]`,U[1],"expressions are not allowed in function stops.")]):N.concat(F.validateSpec({key:`${K}[1]`,value:U[1],valueSpec:t,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec}))}function z(F,N){const U=Qt(F.value),K=Vi(F.value),ee=F.value!==null?F.value:N;if(a){if(U!==a)return[new Fe(F.key,ee,`${U} stop domain type must match previous stop domain type ${a}`)]}else a=U;if(U!=="number"&&U!=="string"&&U!=="boolean")return[new Fe(F.key,ee,"stop domain value must be a number, string, or boolean")];if(U!=="number"&&r!=="categorical"){let ge=`number expected, ${U} found`;return Ms(t)&&r===void 0&&(ge+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Fe(F.key,ee,ge)]}return r!=="categorical"||U!=="number"||isFinite(K)&&Math.floor(K)===K?r!=="categorical"&&U==="number"&&c!==void 0&&K<c?[new Fe(F.key,ee,"stop domain values must appear in ascending order")]:(c=K,r==="categorical"&&K in m?[new Fe(F.key,ee,"stop domain values must be unique")]:(m[K]=!0,[])):[new Fe(F.key,ee,`integer expected, found ${K}`)]}}function ps(i){const t=(i.expressionContext==="property"?_a:ao)(co(i.value),i.valueSpec);if(t.result==="error")return t.value.map(a=>new Fe(`${i.key}${a.key}`,i.value,a.message));const r=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new Fe(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Bo(r))return[new Fe(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Bo(r))return[new Fe(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Ps(r,["zoom","feature-state"]))return[new Fe(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!pa(r))return[new Fe(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Vo(i){const t=i.key,r=i.value,a=i.valueSpec,c=[];return Array.isArray(a.values)?a.values.indexOf(Vi(r))===-1&&c.push(new Fe(t,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(a.values).indexOf(Vi(r))===-1&&c.push(new Fe(t,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),c}function jo(i){return Fl(co(i.value))?ps(jn({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ic(i)}function Ic(i){const t=i.value,r=i.key;if(Qt(t)!=="array")return[new Fe(r,t,`array expected, ${Qt(t)} found`)];const a=i.styleSpec;let c,f=[];if(t.length<1)return[new Fe(r,t,"filter array must have at least 1 element")];switch(f=f.concat(Vo({key:`${r}[0]`,value:t[0],valueSpec:a.filter_operator,style:i.style,styleSpec:i.styleSpec})),Vi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Vi(t[1])==="$type"&&f.push(new Fe(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&f.push(new Fe(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(c=Qt(t[1]),c!=="string"&&f.push(new Fe(`${r}[1]`,t[1],`string expected, ${c} found`)));for(let m=2;m<t.length;m++)c=Qt(t[m]),Vi(t[1])==="$type"?f=f.concat(Vo({key:`${r}[${m}]`,value:t[m],valueSpec:a.geometry_type,style:i.style,styleSpec:i.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&f.push(new Fe(`${r}[${m}]`,t[m],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let m=1;m<t.length;m++)f=f.concat(Ic({key:`${r}[${m}]`,value:t[m],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":c=Qt(t[1]),t.length!==2?f.push(new Fe(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):c!=="string"&&f.push(new Fe(`${r}[1]`,t[1],`string expected, ${c} found`))}return f}function ho(i,t){const r=i.key,a=i.validateSpec,c=i.style,f=i.styleSpec,m=i.value,y=i.objectKey,x=f[`${t}_${i.layerType}`];if(!x)return[];const T=y.match(/^(.*)-transition$/);if(t==="paint"&&T&&x[T[1]]&&x[T[1]].transition)return a({key:r,value:m,valueSpec:f.transition,style:c,styleSpec:f});const E=i.valueSpec||x[y];if(!E)return[new Fe(r,m,`unknown property "${y}"`)];let C;if(Qt(m)==="string"&&Ms(E)&&!E.tokens&&(C=/^{([^}]+)}$/.exec(m)))return[new Fe(r,m,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(C[1])} }\`.`)];const z=[];return i.layerType==="symbol"&&(y==="text-field"&&c&&!c.glyphs&&z.push(new Fe(r,m,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&fa(co(m))&&Vi(m.type)==="identity"&&z.push(new Fe(r,m,'"text-font" does not support identity functions'))),z.concat(a({key:i.key,value:m,valueSpec:E,style:c,styleSpec:f,expressionContext:"property",propertyType:t,propertyKey:y}))}function Cu(i){return ho(i,"paint")}function Ja(i){return ho(i,"layout")}function Nl(i){let t=[];const r=i.value,a=i.key,c=i.style,f=i.styleSpec;r.type||r.ref||t.push(new Fe(a,r,'either "type" or "ref" is required'));let m=Vi(r.type);const y=Vi(r.ref);if(r.id){const x=Vi(r.id);for(let T=0;T<i.arrayIndex;T++){const E=c.layers[T];Vi(E.id)===x&&t.push(new Fe(a,r.id,`duplicate layer id "${r.id}", previously used at line ${E.id.__line__}`))}}if("ref"in r){let x;["type","source","source-layer","filter","layout"].forEach(T=>{T in r&&t.push(new Fe(a,r[T],`"${T}" is prohibited for ref layers`))}),c.layers.forEach(T=>{Vi(T.id)===y&&(x=T)}),x?x.ref?t.push(new Fe(a,r.ref,"ref cannot reference another ref layer")):m=Vi(x.type):t.push(new Fe(a,r.ref,`ref layer "${y}" not found`))}else if(m!=="background")if(r.source){const x=c.sources&&c.sources[r.source],T=x&&Vi(x.type);x?T==="vector"&&m==="raster"?t.push(new Fe(a,r.source,`layer "${r.id}" requires a raster source`)):T!=="raster-dem"&&m==="hillshade"?t.push(new Fe(a,r.source,`layer "${r.id}" requires a raster-dem source`)):T==="raster"&&m!=="raster"?t.push(new Fe(a,r.source,`layer "${r.id}" requires a vector source`)):T!=="vector"||r["source-layer"]?T==="raster-dem"&&m!=="hillshade"?t.push(new Fe(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!r.paint||!r.paint["line-gradient"]||T==="geojson"&&x.lineMetrics||t.push(new Fe(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Fe(a,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new Fe(a,r.source,`source "${r.source}" not found`))}else t.push(new Fe(a,r,'missing required property "source"'));return t=t.concat(_r({key:a,value:r,valueSpec:f.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${a}.type`,value:r.type,valueSpec:f.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:jo,layout:x=>_r({layer:r,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":T=>Ja(jn({layerType:m},T))}}),paint:x=>_r({layer:r,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":T=>Cu(jn({layerType:m},T))}})}})),t}function li(i){const t=i.value,r=i.key,a=Qt(t);return a!=="string"?[new Fe(r,t,`string expected, ${a} found`)]:[]}const Vl={promoteId:function({key:i,value:t}){if(Qt(t)==="string")return li({key:i,value:t});{const r=[];for(const a in t)r.push(...li({key:`${i}.${a}`,value:t[a]}));return r}}};function Uo(i){const t=i.value,r=i.key,a=i.styleSpec,c=i.style,f=i.validateSpec;if(!t.type)return[new Fe(r,t,'"type" is required')];const m=Vi(t.type);let y;switch(m){case"vector":case"raster":return y=_r({key:r,value:t,valueSpec:a[`source_${m.replace("-","_")}`],style:i.style,styleSpec:a,objectElementValidators:Vl,validateSpec:f}),y;case"raster-dem":return y=function(x){var T;const E=(T=x.sourceName)!==null&&T!==void 0?T:"",C=x.value,z=x.styleSpec,F=z.source_raster_dem,N=x.style;let U=[];const K=Qt(C);if(C===void 0)return U;if(K!=="object")return U.push(new Fe("source_raster_dem",C,`object expected, ${K} found`)),U;const ee=Vi(C.encoding)==="custom",ge=["redFactor","greenFactor","blueFactor","baseShift"],ne=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const de in C)!ee&&ge.includes(de)?U.push(new Fe(de,C[de],`In "${E}": "${de}" is only valid when "encoding" is set to "custom". ${ne} encoding found`)):F[de]?U=U.concat(x.validateSpec({key:de,value:C[de],valueSpec:F[de],validateSpec:x.validateSpec,style:N,styleSpec:z})):U.push(new Fe(de,C[de],`unknown property "${de}"`));return U}({sourceName:r,value:t,style:i.style,styleSpec:a,validateSpec:f}),y;case"geojson":if(y=_r({key:r,value:t,valueSpec:a.source_geojson,style:c,styleSpec:a,validateSpec:f,objectElementValidators:Vl}),t.cluster)for(const x in t.clusterProperties){const[T,E]=t.clusterProperties[x],C=typeof T=="string"?[T,["accumulated"],["get",x]]:T;y.push(...ps({key:`${r}.${x}.map`,value:E,validateSpec:f,expressionContext:"cluster-map"})),y.push(...ps({key:`${r}.${x}.reduce`,value:C,validateSpec:f,expressionContext:"cluster-reduce"}))}return y;case"video":return _r({key:r,value:t,valueSpec:a.source_video,style:c,validateSpec:f,styleSpec:a});case"image":return _r({key:r,value:t,valueSpec:a.source_image,style:c,validateSpec:f,styleSpec:a});case"canvas":return[new Fe(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Vo({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:c,validateSpec:f,styleSpec:a})}}function Ds(i){const t=i.value,r=i.styleSpec,a=r.light,c=i.style;let f=[];const m=Qt(t);if(t===void 0)return f;if(m!=="object")return f=f.concat([new Fe("light",t,`object expected, ${m} found`)]),f;for(const y in t){const x=y.match(/^(.*)-transition$/);f=f.concat(x&&a[x[1]]&&a[x[1]].transition?i.validateSpec({key:y,value:t[y],valueSpec:r.transition,validateSpec:i.validateSpec,style:c,styleSpec:r}):a[y]?i.validateSpec({key:y,value:t[y],valueSpec:a[y],validateSpec:i.validateSpec,style:c,styleSpec:r}):[new Fe(y,t[y],`unknown property "${y}"`)])}return f}function jl(i){const t=i.value,r=i.styleSpec,a=r.sky,c=i.style,f=Qt(t);if(t===void 0)return[];if(f!=="object")return[new Fe("sky",t,`object expected, ${f} found`)];let m=[];for(const y in t)m=m.concat(a[y]?i.validateSpec({key:y,value:t[y],valueSpec:a[y],style:c,styleSpec:r}):[new Fe(y,t[y],`unknown property "${y}"`)]);return m}function Ya(i){const t=i.value,r=i.styleSpec,a=r.terrain,c=i.style;let f=[];const m=Qt(t);if(t===void 0)return f;if(m!=="object")return f=f.concat([new Fe("terrain",t,`object expected, ${m} found`)]),f;for(const y in t)f=f.concat(a[y]?i.validateSpec({key:y,value:t[y],valueSpec:a[y],validateSpec:i.validateSpec,style:c,styleSpec:r}):[new Fe(y,t[y],`unknown property "${y}"`)]);return f}function $o(i){let t=[];const r=i.value,a=i.key;if(Array.isArray(r)){const c=[],f=[];for(const m in r)r[m].id&&c.includes(r[m].id)&&t.push(new Fe(a,r,`all the sprites' ids must be unique, but ${r[m].id} is duplicated`)),c.push(r[m].id),r[m].url&&f.includes(r[m].url)&&t.push(new Fe(a,r,`all the sprites' URLs must be unique, but ${r[m].url} is duplicated`)),f.push(r[m].url),t=t.concat(_r({key:`${a}[${m}]`,value:r[m],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return li({key:a,value:r})}const ba={"*":()=>[],array:Ka,boolean:function(i){const t=i.value,r=i.key,a=Qt(t);return a!=="boolean"?[new Fe(r,t,`boolean expected, ${a} found`)]:[]},number:wa,color:function(i){const t=i.key,r=i.value,a=Qt(r);return a!=="string"?[new Fe(t,r,`color expected, ${a} found`)]:It.parse(String(r))?[]:[new Fe(t,r,`color expected, "${r}" found`)]},constants:Ol,enum:Vo,filter:jo,function:As,layer:Nl,object:_r,source:Uo,light:Ds,sky:jl,terrain:Ya,projection:function(i){const t=i.value,r=i.styleSpec,a=r.projection,c=i.style,f=Qt(t);if(t===void 0)return[];if(f!=="object")return[new Fe("projection",t,`object expected, ${f} found`)];let m=[];for(const y in t)m=m.concat(a[y]?i.validateSpec({key:y,value:t[y],valueSpec:a[y],style:c,styleSpec:r}):[new Fe(y,t[y],`unknown property "${y}"`)]);return m},string:li,formatted:function(i){return li(i).length===0?[]:ps(i)},resolvedImage:function(i){return li(i).length===0?[]:ps(i)},padding:function(i){const t=i.key,r=i.value;if(Qt(r)==="array"){if(r.length<1||r.length>4)return[new Fe(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const a={type:"number"};let c=[];for(let f=0;f<r.length;f++)c=c.concat(i.validateSpec({key:`${t}[${f}]`,value:r[f],validateSpec:i.validateSpec,valueSpec:a}));return c}return wa({key:t,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const t=i.key,r=i.value,a=Qt(r),c=i.styleSpec;if(a!=="array"||r.length<1||r.length%2!=0)return[new Fe(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let f=[];for(let m=0;m<r.length;m+=2)f=f.concat(Vo({key:`${t}[${m}]`,value:r[m],valueSpec:c.layout_symbol["text-anchor"]})),f=f.concat(Ka({key:`${t}[${m+1}]`,value:r[m+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:c}));return f},sprite:$o};function Pn(i){const t=i.value,r=i.valueSpec,a=i.styleSpec;return i.validateSpec=Pn,r.expression&&fa(Vi(t))?As(i):r.expression&&Zr(co(t))?ps(i):r.type&&ba[r.type]?ba[r.type](i):_r(jn({},i,{valueSpec:r.type?a[r.type]:r}))}function Ul(i){const t=i.value,r=i.key,a=li(i);return a.length||(t.indexOf("{fontstack}")===-1&&a.push(new Fe(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&a.push(new Fe(r,t,'"glyphs" url must include a "{range}" token'))),a}function Wn(i,t=be){let r=[];return r=r.concat(Pn({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:Pn,objectElementValidators:{glyphs:Ul,"*":()=>[]}})),i.constants&&(r=r.concat(Ol({key:"constants",value:i.constants,style:i,styleSpec:t,validateSpec:Pn}))),Pu(r)}function Xn(i){return function(t){return i({...t,validateSpec:Pn})}}function Pu(i){return[].concat(i).sort((t,r)=>t.line-r.line)}function rn(i){return function(...t){return Pu(i.apply(this,t))}}Wn.source=rn(Xn(Uo)),Wn.sprite=rn(Xn($o)),Wn.glyphs=rn(Xn(Ul)),Wn.light=rn(Xn(Ds)),Wn.sky=rn(Xn(jl)),Wn.terrain=rn(Xn(Ya)),Wn.layer=rn(Xn(Nl)),Wn.filter=rn(Xn(jo)),Wn.paintProperty=rn(Xn(Cu)),Wn.layoutProperty=rn(Xn(Ja));const fs=Wn,$l=fs.light,Mu=fs.sky,zu=fs.paintProperty,ql=fs.layoutProperty;function Au(i,t){let r=!1;if(t&&t.length)for(const a of t)i.fire(new as(new Error(a.message))),r=!0;return r}class qo{constructor(t,r,a){const c=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const m=new Int32Array(this.arrayBuffer);t=m[0],this.d=(r=m[1])+2*(a=m[2]);for(let x=0;x<this.d*this.d;x++){const T=m[3+x],E=m[3+x+1];c.push(T===E?null:m.subarray(T,E))}const y=m[3+c.length+1];this.keys=m.subarray(m[3+c.length],y),this.bboxes=m.subarray(y),this.insert=this._insertReadonly}else{this.d=r+2*a;for(let m=0;m<this.d*this.d;m++)c.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=a,this.scale=r/t,this.uid=0;const f=a/r*t;this.min=-f,this.max=t+f}insert(t,r,a,c,f){this._forEachCell(r,a,c,f,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(f)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,a,c,f,m){this.cells[f].push(m)}query(t,r,a,c,f){const m=this.min,y=this.max;if(t<=m&&r<=m&&y<=a&&y<=c&&!f)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(t,r,a,c,this._queryCell,x,{},f),x}}_queryCell(t,r,a,c,f,m,y,x){const T=this.cells[f];if(T!==null){const E=this.keys,C=this.bboxes;for(let z=0;z<T.length;z++){const F=T[z];if(y[F]===void 0){const N=4*F;(x?x(C[N+0],C[N+1],C[N+2],C[N+3]):t<=C[N+2]&&r<=C[N+3]&&a>=C[N+0]&&c>=C[N+1])?(y[F]=!0,m.push(E[F])):y[F]=!1}}}}_forEachCell(t,r,a,c,f,m,y,x){const T=this._convertToCellCoord(t),E=this._convertToCellCoord(r),C=this._convertToCellCoord(a),z=this._convertToCellCoord(c);for(let F=T;F<=C;F++)for(let N=E;N<=z;N++){const U=this.d*N+F;if((!x||x(this._convertFromCellCoord(F),this._convertFromCellCoord(N),this._convertFromCellCoord(F+1),this._convertFromCellCoord(N+1)))&&f.call(this,t,r,a,c,U,m,y,x))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,r=3+this.cells.length+1+1;let a=0;for(let m=0;m<this.cells.length;m++)a+=this.cells[m].length;const c=new Int32Array(r+a+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let f=r;for(let m=0;m<t.length;m++){const y=t[m];c[3+m]=f,c.set(y,f),f+=y.length}return c[3+t.length]=f,c.set(this.keys,f),f+=this.keys.length,c[3+t.length+1]=f,c.set(this.bboxes,f),f+=this.bboxes.length,c.buffer}static serialize(t,r){const a=t.toArrayBuffer();return r&&r.push(a),{buffer:a}}static deserialize(t){return new qo(t.buffer)}}const ms={};function Je(i,t,r={}){if(ms[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),ms[i]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}Je("Object",Object),Je("TransferableGridIndex",qo),Je("Color",It),Je("Error",Error),Je("AJAXError",Xt),Je("ResolvedImage",Pr),Je("StylePropertyFunction",ya),Je("StyleExpression",Rl,{omit:["_evaluator"]}),Je("ZoomDependentExpression",No),Je("ZoomConstantExpression",ga),Je("CompoundExpression",yn,{omit:["_evaluate"]});for(const i in Ro)Ro[i]._classRegistryKey||Je(`Expression_${i}`,Ro[i]);function Zl(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Mn(i){return i.$name||i.constructor._classRegistryKey}function Du(i){return!function(t){if(t===null||typeof t!="object")return!1;const r=Mn(t);return!(!r||r==="Object")}(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||Zl(i)||hi(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function gs(i,t){if(Du(i))return(Zl(i)||hi(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const f=[];for(const m of i)f.push(gs(m,t));return f}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const r=Mn(i);if(!r)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!ms[r])throw new Error(`${r} is not registered.`);const{klass:a}=ms[r],c=a.serialize?a.serialize(i,t):{};if(a.serialize){if(t&&c===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const f in i){if(!i.hasOwnProperty(f)||ms[r].omit.indexOf(f)>=0)continue;const m=i[f];c[f]=ms[r].shallow.indexOf(f)>=0?m:gs(m,t)}i instanceof Error&&(c.message=i.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(c.$name=r),c}function Gr(i){if(Du(i))return i;if(Array.isArray(i))return i.map(Gr);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const t=Mn(i)||"Object";if(!ms[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:r}=ms[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(i);const a=Object.create(r.prototype);for(const c of Object.keys(i)){if(c==="$name")continue;const f=i[c];a[c]=ms[t].shallow.indexOf(c)>=0?f:Gr(f)}return a}class Zo{constructor(){this.first=!0}update(t,r){const a=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=a,!0))}}const Pt={"Latin-1 Supplement":i=>i>=128&&i<=255,"Hangul Jamo":i=>i>=4352&&i<=4607,Khmer:i=>i>=6016&&i<=6143,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Katakana:i=>i>=12448&&i<=12543,Kanbun:i=>i>=12688&&i<=12703,"CJK Strokes":i=>i>=12736&&i<=12783,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"Private Use Area":i=>i>=57344&&i<=63743,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function Qa(i){for(const t of i)if(Sa(t.charCodeAt(0)))return!0;return!1}function dh(i){for(const t of i)if(!el(t.charCodeAt(0)))return!1;return!0}function Lu(i){const t=i.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(t.join("|"),"u")}const Go=Lu(["Arab","Dupl","Mong","Ougr","Syrc"]);function el(i){return!Go.test(String.fromCodePoint(i))}const zn=Lu(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Sa(i){return!(i!==746&&i!==747&&(i<4352||!(Pt["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Pt["CJK Compatibility"](i)||Pt["CJK Strokes"](i)||!(!Pt["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Pt["Enclosed CJK Letters and Months"](i)||Pt["Ideographic Description Characters"](i)||Pt.Kanbun(i)||Pt.Katakana(i)&&i!==12540||!(!Pt["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Pt["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Pt["Vertical Forms"](i)||Pt["Yijing Hexagram Symbols"](i)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(i))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(i))||zn.test(String.fromCodePoint(i)))))}function Gl(i){return!(Sa(i)||function(t){return!!(Pt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Pt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Pt["Letterlike Symbols"](t)||Pt["Number Forms"](t)||Pt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Pt["Control Pictures"](t)&&t!==9251||Pt["Optical Character Recognition"](t)||Pt["Enclosed Alphanumerics"](t)||Pt["Geometric Shapes"](t)||Pt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Pt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Pt["CJK Symbols and Punctuation"](t)||Pt.Katakana(t)||Pt["Private Use Area"](t)||Pt["CJK Compatibility Forms"](t)||Pt["Small Form Variants"](t)||Pt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}const Ta=Lu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Ls(i){return Ta.test(String.fromCodePoint(i))}function Mi(i,t){return!(!t&&Ls(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Pt.Khmer(i))}function zi(i){for(const t of i)if(Ls(t.charCodeAt(0)))return!0;return!1}const nn=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Dt{constructor(t,r){this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Zo,this.transition={})}isSupportedScript(t){return function(r,a){for(const c of r)if(!Mi(c.charCodeAt(0),a))return!1;return!0}(t,nn.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,r=t-Math.floor(t),a=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*r}}}class dr{constructor(t,r){this.property=t,this.value=r,this.expression=function(a,c){if(fa(a))return new ya(a,c);if(Zr(a)){const f=_a(a,c);if(f.result==="error")throw new Error(f.value.map(m=>`${m.key}: ${m.message}`).join(", "));return f.value}{let f=a;return c.type==="color"&&typeof a=="string"?f=It.parse(a):c.type!=="padding"||typeof a!="number"&&!Array.isArray(a)?c.type==="variableAnchorOffsetCollection"&&Array.isArray(a)&&(f=gn.parse(a)):f=Cr.parse(a),{kind:"constant",evaluate:()=>f}}}(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,r,a){return this.property.possiblyEvaluate(this,t,r,a)}}class Kn{constructor(t){this.property=t,this.value=new dr(t,void 0)}transitioned(t,r){return new yr(this.property,this.value,r,Wt({},t.transition,this.transition),t.now)}untransitioned(){return new yr(this.property,this.value,null,{},0)}}class po{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Kt(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Kn(this._values[t].property)),this._values[t].value=new dr(this._values[t].property,r===null?void 0:Kt(r))}getTransition(t){return Kt(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Kn(this._values[t].property)),this._values[t].transition=Kt(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(t[r]=a);const c=this.getTransition(r);c!==void 0&&(t[`${r}-transition`]=c)}return t}transitioned(t,r){const a=new tl(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].transitioned(t,r._values[c]);return a}untransitioned(){const t=new tl(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class yr{constructor(t,r,a,c,f){this.property=t,this.value=r,this.begin=f+c.delay||0,this.end=this.begin+c.duration||0,t.specification.transition&&(c.delay||c.duration)&&(this.prior=a)}possiblyEvaluate(t,r,a){const c=t.now||0,f=this.value.possiblyEvaluate(t,r,a),m=this.prior;if(m){if(c>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(c<this.begin)return m.possiblyEvaluate(t,r,a);{const y=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(t,r,a),f,function(x){if(x<=0)return 0;if(x>=1)return 1;const T=x*x,E=T*x;return 4*(x<.5?E:3*(x-T)+E-.75)}(y))}}return f}}class tl{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,a){const c=new Ho(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].possiblyEvaluate(t,r,a);return c}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class il{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Kt(this._values[t].value)}setValue(t,r){this._values[t]=new dr(this._values[t].property,r===null?void 0:Kt(r))}serialize(){const t={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(t[r]=a)}return t}possiblyEvaluate(t,r,a){const c=new Ho(this._properties);for(const f of Object.keys(this._values))c._values[f]=this._values[f].possiblyEvaluate(t,r,a);return c}}class Hr{constructor(t,r,a){this.property=t,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,a,c){return this.property.evaluate(this.value,this.parameters,t,r,a,c)}}class Ho{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class at{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,a){const c=Gi[this.specification.type];return c?c(t,r,a):t}}class st{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,a,c){return new Hr(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},a,c)}:t.expression,r)}interpolate(t,r,a){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new Hr(this,{kind:"constant",value:void 0},t.parameters);const c=Gi[this.specification.type];if(c){const f=c(t.value.value,r.value.value,a);return new Hr(this,{kind:"constant",value:f},t.parameters)}return t}evaluate(t,r,a,c,f,m){return t.kind==="constant"?t.value:t.evaluate(r,a,c,f,m)}}class Wo extends st{possiblyEvaluate(t,r,a,c){if(t.value===void 0)return new Hr(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){const f=t.expression.evaluate(r,null,{},a,c),m=t.property.specification.type==="resolvedImage"&&typeof f!="string"?f.name:f,y=this._calculate(m,m,m,r);return new Hr(this,{kind:"constant",value:y},r)}if(t.expression.kind==="camera"){const f=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new Hr(this,{kind:"constant",value:f},r)}return new Hr(this,t.expression,r)}evaluate(t,r,a,c,f,m){if(t.kind==="source"){const y=t.evaluate(r,a,c,f,m);return this._calculate(y,y,y,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},a,c),t.evaluate({zoom:Math.floor(r.zoom)},a,c),t.evaluate({zoom:Math.floor(r.zoom)+1},a,c),r):t.value}_calculate(t,r,a,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:a,to:r}}interpolate(t){return t}}class rl{constructor(t){this.specification=t}possiblyEvaluate(t,r,a,c){if(t.value!==void 0){if(t.expression.kind==="constant"){const f=t.expression.evaluate(r,null,{},a,c);return this._calculate(f,f,f,r)}return this._calculate(t.expression.evaluate(new Dt(Math.floor(r.zoom-1),r)),t.expression.evaluate(new Dt(Math.floor(r.zoom),r)),t.expression.evaluate(new Dt(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,a,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:a,to:r}}interpolate(t){return t}}class nl{constructor(t){this.specification=t}possiblyEvaluate(t,r,a,c){return!!t.expression.evaluate(r,null,{},a,c)}interpolate(){return!1}}class sn{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in t){const a=t[r];a.specification.overridable&&this.overridableProperties.push(r);const c=this.defaultPropertyValues[r]=new dr(a,void 0),f=this.defaultTransitionablePropertyValues[r]=new Kn(a);this.defaultTransitioningPropertyValues[r]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=c.possiblyEvaluate({})}}}Je("DataDrivenProperty",st),Je("DataConstantProperty",at),Je("CrossFadedDataDrivenProperty",Wo),Je("CrossFadedProperty",rl),Je("ColorRampProperty",nl);const p="-transition";class e extends So{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),r.layout&&(this._unevaluatedLayout=new il(r.layout)),r.paint)){this._transitionablePaint=new po(r.paint);for(const a in t.paint)this.setPaintProperty(a,t.paint[a],{validate:!1});for(const a in t.layout)this.setLayoutProperty(a,t.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ho(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,r,a={}){r!=null&&this._validate(ql,`layers.${this.id}.layout.${t}`,t,r,a)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(p)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,a={}){if(r!=null&&this._validate(zu,`layers.${this.id}.paint.${t}`,t,r,a))return!1;if(t.endsWith(p))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{const c=this._transitionablePaint._values[t],f=c.property.specification["property-type"]==="cross-faded-data-driven",m=c.value.isDataDriven(),y=c.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const x=this._transitionablePaint._values[t].value;return x.isDataDriven()||m||f||this._handleOverridablePaintPropertyUpdate(t,y,x)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,a){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Vr(t,(r,a)=>!(r===void 0||a==="layout"&&!Object.keys(r).length||a==="paint"&&!Object.keys(r).length))}_validate(t,r,a,c,f={}){return(!f||f.validate!==!1)&&Au(this,t.call(fs,{key:r,layerType:this.type,objectKey:a,value:c,styleSpec:be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof Hr&&Ms(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const s={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class l{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class u{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function d(i,t=1){let r=0,a=0;return{members:i.map(c=>{const f=s[c.type].BYTES_PER_ELEMENT,m=r=v(r,Math.max(t,f)),y=c.components||1;return a=Math.max(a,f),r+=f*y,{name:c.name,type:c.type,components:y,offset:m}}),size:v(r,Math.max(a,t)),alignment:t}}function v(i,t){return Math.ceil(i/t)*t}class w extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const a=this.length;return this.resize(a+1),this.emplace(a,t,r)}emplace(t,r,a){const c=2*t;return this.int16[c+0]=r,this.int16[c+1]=a,t}}w.prototype.bytesPerElement=4,Je("StructArrayLayout2i4",w);class S extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,a)}emplace(t,r,a,c){const f=3*t;return this.int16[f+0]=r,this.int16[f+1]=a,this.int16[f+2]=c,t}}S.prototype.bytesPerElement=6,Je("StructArrayLayout3i6",S);class I extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,a,c)}emplace(t,r,a,c,f){const m=4*t;return this.int16[m+0]=r,this.int16[m+1]=a,this.int16[m+2]=c,this.int16[m+3]=f,t}}I.prototype.bytesPerElement=8,Je("StructArrayLayout4i8",I);class P extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,c,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,r,a,c,f,m)}emplace(t,r,a,c,f,m,y){const x=6*t;return this.int16[x+0]=r,this.int16[x+1]=a,this.int16[x+2]=c,this.int16[x+3]=f,this.int16[x+4]=m,this.int16[x+5]=y,t}}P.prototype.bytesPerElement=12,Je("StructArrayLayout2i4i12",P);class M extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,c,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,r,a,c,f,m)}emplace(t,r,a,c,f,m,y){const x=4*t,T=8*t;return this.int16[x+0]=r,this.int16[x+1]=a,this.uint8[T+4]=c,this.uint8[T+5]=f,this.uint8[T+6]=m,this.uint8[T+7]=y,t}}M.prototype.bytesPerElement=8,Je("StructArrayLayout2i4ub8",M);class B extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const a=this.length;return this.resize(a+1),this.emplace(a,t,r)}emplace(t,r,a){const c=2*t;return this.float32[c+0]=r,this.float32[c+1]=a,t}}B.prototype.bytesPerElement=8,Je("StructArrayLayout2f8",B);class j extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,c,f,m,y,x,T,E){const C=this.length;return this.resize(C+1),this.emplace(C,t,r,a,c,f,m,y,x,T,E)}emplace(t,r,a,c,f,m,y,x,T,E,C){const z=10*t;return this.uint16[z+0]=r,this.uint16[z+1]=a,this.uint16[z+2]=c,this.uint16[z+3]=f,this.uint16[z+4]=m,this.uint16[z+5]=y,this.uint16[z+6]=x,this.uint16[z+7]=T,this.uint16[z+8]=E,this.uint16[z+9]=C,t}}j.prototype.bytesPerElement=20,Je("StructArrayLayout10ui20",j);class q extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,c,f,m,y,x,T,E,C,z){const F=this.length;return this.resize(F+1),this.emplace(F,t,r,a,c,f,m,y,x,T,E,C,z)}emplace(t,r,a,c,f,m,y,x,T,E,C,z,F){const N=12*t;return this.int16[N+0]=r,this.int16[N+1]=a,this.int16[N+2]=c,this.int16[N+3]=f,this.uint16[N+4]=m,this.uint16[N+5]=y,this.uint16[N+6]=x,this.uint16[N+7]=T,this.int16[N+8]=E,this.int16[N+9]=C,this.int16[N+10]=z,this.int16[N+11]=F,t}}q.prototype.bytesPerElement=24,Je("StructArrayLayout4i4ui4i24",q);class G extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,a)}emplace(t,r,a,c){const f=3*t;return this.float32[f+0]=r,this.float32[f+1]=a,this.float32[f+2]=c,t}}G.prototype.bytesPerElement=12,Je("StructArrayLayout3f12",G);class X extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}X.prototype.bytesPerElement=4,Je("StructArrayLayout1ul4",X);class Y extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a,c,f,m,y,x,T){const E=this.length;return this.resize(E+1),this.emplace(E,t,r,a,c,f,m,y,x,T)}emplace(t,r,a,c,f,m,y,x,T,E){const C=10*t,z=5*t;return this.int16[C+0]=r,this.int16[C+1]=a,this.int16[C+2]=c,this.int16[C+3]=f,this.int16[C+4]=m,this.int16[C+5]=y,this.uint32[z+3]=x,this.uint16[C+8]=T,this.uint16[C+9]=E,t}}Y.prototype.bytesPerElement=20,Je("StructArrayLayout6i1ul2ui20",Y);class ie extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,c,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,r,a,c,f,m)}emplace(t,r,a,c,f,m,y){const x=6*t;return this.int16[x+0]=r,this.int16[x+1]=a,this.int16[x+2]=c,this.int16[x+3]=f,this.int16[x+4]=m,this.int16[x+5]=y,t}}ie.prototype.bytesPerElement=12,Je("StructArrayLayout2i2i2i12",ie);class H extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,c,f){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,a,c,f)}emplace(t,r,a,c,f,m){const y=4*t,x=8*t;return this.float32[y+0]=r,this.float32[y+1]=a,this.float32[y+2]=c,this.int16[x+6]=f,this.int16[x+7]=m,t}}H.prototype.bytesPerElement=16,Je("StructArrayLayout2f1f2i16",H);class oe extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,a,c,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,r,a,c,f,m)}emplace(t,r,a,c,f,m,y){const x=16*t,T=4*t,E=8*t;return this.uint8[x+0]=r,this.uint8[x+1]=a,this.float32[T+1]=c,this.float32[T+2]=f,this.int16[E+6]=m,this.int16[E+7]=y,t}}oe.prototype.bytesPerElement=16,Je("StructArrayLayout2ub2f2i16",oe);class ce extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,a)}emplace(t,r,a,c){const f=3*t;return this.uint16[f+0]=r,this.uint16[f+1]=a,this.uint16[f+2]=c,t}}ce.prototype.bytesPerElement=6,Je("StructArrayLayout3ui6",ce);class _e extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,c,f,m,y,x,T,E,C,z,F,N,U,K,ee){const ge=this.length;return this.resize(ge+1),this.emplace(ge,t,r,a,c,f,m,y,x,T,E,C,z,F,N,U,K,ee)}emplace(t,r,a,c,f,m,y,x,T,E,C,z,F,N,U,K,ee,ge){const ne=24*t,de=12*t,ke=48*t;return this.int16[ne+0]=r,this.int16[ne+1]=a,this.uint16[ne+2]=c,this.uint16[ne+3]=f,this.uint32[de+2]=m,this.uint32[de+3]=y,this.uint32[de+4]=x,this.uint16[ne+10]=T,this.uint16[ne+11]=E,this.uint16[ne+12]=C,this.float32[de+7]=z,this.float32[de+8]=F,this.uint8[ke+36]=N,this.uint8[ke+37]=U,this.uint8[ke+38]=K,this.uint32[de+10]=ee,this.int16[ne+22]=ge,t}}_e.prototype.bytesPerElement=48,Je("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",_e);class Ce extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,c,f,m,y,x,T,E,C,z,F,N,U,K,ee,ge,ne,de,ke,Ae,Ye,yt,Ke,He,ht,rt){const et=this.length;return this.resize(et+1),this.emplace(et,t,r,a,c,f,m,y,x,T,E,C,z,F,N,U,K,ee,ge,ne,de,ke,Ae,Ye,yt,Ke,He,ht,rt)}emplace(t,r,a,c,f,m,y,x,T,E,C,z,F,N,U,K,ee,ge,ne,de,ke,Ae,Ye,yt,Ke,He,ht,rt,et){const Ee=32*t,dt=16*t;return this.int16[Ee+0]=r,this.int16[Ee+1]=a,this.int16[Ee+2]=c,this.int16[Ee+3]=f,this.int16[Ee+4]=m,this.int16[Ee+5]=y,this.int16[Ee+6]=x,this.int16[Ee+7]=T,this.uint16[Ee+8]=E,this.uint16[Ee+9]=C,this.uint16[Ee+10]=z,this.uint16[Ee+11]=F,this.uint16[Ee+12]=N,this.uint16[Ee+13]=U,this.uint16[Ee+14]=K,this.uint16[Ee+15]=ee,this.uint16[Ee+16]=ge,this.uint16[Ee+17]=ne,this.uint16[Ee+18]=de,this.uint16[Ee+19]=ke,this.uint16[Ee+20]=Ae,this.uint16[Ee+21]=Ye,this.uint16[Ee+22]=yt,this.uint32[dt+12]=Ke,this.float32[dt+13]=He,this.float32[dt+14]=ht,this.uint16[Ee+30]=rt,this.uint16[Ee+31]=et,t}}Ce.prototype.bytesPerElement=64,Je("StructArrayLayout8i15ui1ul2f2ui64",Ce);class Le extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}Le.prototype.bytesPerElement=4,Je("StructArrayLayout1f4",Le);class Ve extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,a)}emplace(t,r,a,c){const f=3*t;return this.uint16[6*t+0]=r,this.float32[f+1]=a,this.float32[f+2]=c,t}}Ve.prototype.bytesPerElement=12,Je("StructArrayLayout1ui2f12",Ve);class We extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,r,a)}emplace(t,r,a,c){const f=4*t;return this.uint32[2*t+0]=r,this.uint16[f+2]=a,this.uint16[f+3]=c,t}}We.prototype.bytesPerElement=8,Je("StructArrayLayout1ul2ui8",We);class je extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const a=this.length;return this.resize(a+1),this.emplace(a,t,r)}emplace(t,r,a){const c=2*t;return this.uint16[c+0]=r,this.uint16[c+1]=a,t}}je.prototype.bytesPerElement=4,Je("StructArrayLayout2ui4",je);class Oe extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}Oe.prototype.bytesPerElement=2,Je("StructArrayLayout1ui2",Oe);class it extends u{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,a,c){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,a,c)}emplace(t,r,a,c,f){const m=4*t;return this.float32[m+0]=r,this.float32[m+1]=a,this.float32[m+2]=c,this.float32[m+3]=f,t}}it.prototype.bytesPerElement=16,Je("StructArrayLayout4f16",it);class St extends l{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new we(this.anchorPointX,this.anchorPointY)}}St.prototype.size=20;class $e extends Y{get(t){return new St(this,t)}}Je("CollisionBoxArray",$e);class Ge extends l{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Ge.prototype.size=48;class bt extends _e{get(t){return new Ge(this,t)}}Je("PlacedSymbolArray",bt);class wi extends l{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}wi.prototype.size=64;class Mt extends Ce{get(t){return new wi(this,t)}}Je("SymbolInstanceArray",Mt);class Vt extends Le{getoffsetX(t){return this.float32[1*t+0]}}Je("GlyphOffsetArray",Vt);class Ti extends S{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Je("SymbolLineVertexArray",Ti);class pr extends l{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}pr.prototype.size=12;class vn extends Ve{get(t){return new pr(this,t)}}Je("TextAnchorOffsetArray",vn);class ki extends l{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ki.prototype.size=8;class or extends We{get(t){return new ki(this,t)}}Je("FeatureIndexArray",or);class Ai extends w{}class Hi extends w{}class vr extends w{}class Jn extends P{}class on extends M{}class Yn extends B{}class xn extends j{}class fo extends q{}class An extends G{}class _s extends X{}class zr extends ie{}class Dn extends oe{}class Ar extends ce{}class Rs extends je{}const ar=d([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ri}=ar;class ai{constructor(t=[]){this.segments=t}prepareSegment(t,r,a,c){let f=this.segments[this.segments.length-1];return t>ai.MAX_VERTEX_ARRAY_LENGTH&&bi(`Max vertices per segment is ${ai.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!f||f.vertexLength+t>ai.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==c)&&(f={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},c!==void 0&&(f.sortKey=c),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,a,c){return new ai([{vertexOffset:t,primitiveOffset:r,vertexLength:a,primitiveLength:c,vaos:{},sortKey:0}])}}function Ei(i,t){return 256*(i=At(Math.floor(i),0,255))+At(Math.floor(t),0,255)}ai.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Je("SegmentVector",ai);const Wr=d([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var mo={exports:{}},Fs={exports:{}};Fs.exports=function(i,t){var r,a,c,f,m,y,x,T;for(a=i.length-(r=3&i.length),c=t,m=3432918353,y=461845907,T=0;T<a;)x=255&i.charCodeAt(T)|(255&i.charCodeAt(++T))<<8|(255&i.charCodeAt(++T))<<16|(255&i.charCodeAt(++T))<<24,++T,c=27492+(65535&(f=5*(65535&(c=(c^=x=(65535&(x=(x=(65535&x)*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(x=0,r){case 3:x^=(255&i.charCodeAt(T+2))<<16;case 2:x^=(255&i.charCodeAt(T+1))<<8;case 1:c^=x=(65535&(x=(x=(65535&(x^=255&i.charCodeAt(T)))*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295}return c^=i.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var Ec=Fs.exports,Hl={exports:{}};Hl.exports=function(i,t){for(var r,a=i.length,c=t^a,f=0;a>=4;)r=1540483477*(65535&(r=255&i.charCodeAt(f)|(255&i.charCodeAt(++f))<<8|(255&i.charCodeAt(++f))<<16|(255&i.charCodeAt(++f))<<24))+((1540483477*(r>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),a-=4,++f;switch(a){case 3:c^=(255&i.charCodeAt(f+2))<<16;case 2:c^=(255&i.charCodeAt(f+1))<<8;case 1:c=1540483477*(65535&(c^=255&i.charCodeAt(f)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var Oi=Ec,ys=Hl.exports;mo.exports=Oi,mo.exports.murmur3=Oi,mo.exports.murmur2=ys;var ka=ze(mo.exports);class Xo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,a,c){this.ids.push(Ia(t)),this.positions.push(r,a,c)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Ia(t);let a=0,c=this.ids.length-1;for(;a<c;){const m=a+c>>1;this.ids[m]>=r?c=m:a=m+1}const f=[];for(;this.ids[a]===r;)f.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return f}static serialize(t,r){const a=new Float64Array(t.ids),c=new Uint32Array(t.positions);return Ko(a,c,0,a.length-1),r&&r.push(a.buffer,c.buffer),{ids:a,positions:c}}static deserialize(t){const r=new Xo;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function Ia(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:ka(String(i))}function Ko(i,t,r,a){for(;r<a;){const c=i[r+a>>1];let f=r-1,m=a+1;for(;;){do f++;while(i[f]<c);do m--;while(i[m]>c);if(f>=m)break;Qn(i,f,m),Qn(t,3*f,3*m),Qn(t,3*f+1,3*m+1),Qn(t,3*f+2,3*m+2)}m-r<a-m?(Ko(i,t,r,m),r=m+1):(Ko(i,t,m+1,a),a=m)}}function Qn(i,t,r){const a=i[t];i[t]=i[r],i[r]=a}Je("FeaturePositionMap",Xo);class fi{constructor(t,r){this.gl=t.gl,this.location=r}}class Yi extends fi{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class xr extends fi{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Ru extends fi{constructor(t,r){super(t,r),this.current=It.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Fu=new Float32Array(16);function sl(i){return[Ei(255*i.r,255*i.g),Ei(255*i.b,255*i.a)]}class Bu{constructor(t,r,a){this.value=t,this.uniformNames=r.map(c=>`u_${c}`),this.type=a}setUniform(t,r,a){t.set(a.constantOr(this.value))}getBinding(t,r,a){return this.type==="color"?new Ru(t,r):new Yi(t,r)}}class lr{constructor(t,r){this.uniformNames=r.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,a,c){const f=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;f&&t.set(f)}getBinding(t,r,a){return a.substr(0,9)==="u_pattern"?new xr(t,r):new Yi(t,r)}}class Bs{constructor(t,r,a,c){this.expression=t,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(f=>({name:`a_${f}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(t,r,a,c,f){const m=this.paintVertexArray.length,y=this.expression.evaluate(new Dt(0),r,{},c,[],f);this.paintVertexArray.resize(t),this._setPaintValue(m,t,y)}updatePaintArray(t,r,a,c){const f=this.expression.evaluate({zoom:0},a,c);this._setPaintValue(t,r,f)}_setPaintValue(t,r,a){if(this.type==="color"){const c=sl(a);for(let f=t;f<r;f++)this.paintVertexArray.emplace(f,c[0],c[1])}else{for(let c=t;c<r;c++)this.paintVertexArray.emplace(c,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class es{constructor(t,r,a,c,f,m){this.expression=t,this.uniformNames=r.map(y=>`u_${y}_t`),this.type=a,this.useIntegerZoom=c,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=r.map(y=>({name:`a_${y}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(t,r,a,c,f){const m=this.expression.evaluate(new Dt(this.zoom),r,{},c,[],f),y=this.expression.evaluate(new Dt(this.zoom+1),r,{},c,[],f),x=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(x,t,m,y)}updatePaintArray(t,r,a,c){const f=this.expression.evaluate({zoom:this.zoom},a,c),m=this.expression.evaluate({zoom:this.zoom+1},a,c);this._setPaintValue(t,r,f,m)}_setPaintValue(t,r,a,c){if(this.type==="color"){const f=sl(a),m=sl(c);for(let y=t;y<r;y++)this.paintVertexArray.emplace(y,f[0],f[1],m[0],m[1])}else{for(let f=t;f<r;f++)this.paintVertexArray.emplace(f,a,c);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){const a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,c=At(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(c)}getBinding(t,r,a){return new Yi(t,r)}}class go{constructor(t,r,a,c,f,m){this.expression=t,this.type=r,this.useIntegerZoom=a,this.zoom=c,this.layerId=m,this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(t,r,a){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(c,t,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(t,r,a,c,f){this._setPaintValues(t,r,a.patterns&&a.patterns[this.layerId],f)}_setPaintValues(t,r,a,c){if(!c||!a)return;const{min:f,mid:m,max:y}=a,x=c[f],T=c[m],E=c[y];if(x&&T&&E)for(let C=t;C<r;C++)this.zoomInPaintVertexArray.emplace(C,T.tl[0],T.tl[1],T.br[0],T.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],T.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(C,T.tl[0],T.tl[1],T.br[0],T.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],T.pixelRatio,E.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Wr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Wr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Os{constructor(t,r,a){this.binders={},this._buffers=[];const c=[];for(const f in t.paint._values){if(!a(f))continue;const m=t.paint.get(f);if(!(m instanceof Hr&&Ms(m.property.specification)))continue;const y=Ou(f,t.type),x=m.value,T=m.property.specification.type,E=m.property.useIntegerZoom,C=m.property.specification["property-type"],z=C==="cross-faded"||C==="cross-faded-data-driven";if(x.kind==="constant")this.binders[f]=z?new lr(x.value,y):new Bu(x.value,y,T),c.push(`/u_${f}`);else if(x.kind==="source"||z){const F=Cc(f,T,"source");this.binders[f]=z?new go(x,T,E,r,F,t.id):new Bs(x,y,T,F),c.push(`/a_${f}`)}else{const F=Cc(f,T,"composite");this.binders[f]=new es(x,y,T,E,r,F),c.push(`/z_${f}`)}}this.cacheKey=c.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof Bs||r instanceof es?r.maxValue:0}populatePaintArrays(t,r,a,c,f){for(const m in this.binders){const y=this.binders[m];(y instanceof Bs||y instanceof es||y instanceof go)&&y.populatePaintArray(t,r,a,c,f)}}setConstantPatternPositions(t,r){for(const a in this.binders){const c=this.binders[a];c instanceof lr&&c.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,a,c,f){let m=!1;for(const y in t){const x=r.getPositions(y);for(const T of x){const E=a.feature(T.index);for(const C in this.binders){const z=this.binders[C];if((z instanceof Bs||z instanceof es||z instanceof go)&&z.expression.isStateDependent===!0){const F=c.paint.get(C);z.expression=F.value,z.updatePaintArray(T.start,T.end,E,t[y],f),m=!0}}}}return m}defines(){const t=[];for(const r in this.binders){const a=this.binders[r];(a instanceof Bu||a instanceof lr)&&t.push(...a.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof Bs||a instanceof es)for(let c=0;c<a.paintVertexAttributes.length;c++)t.push(a.paintVertexAttributes[c].name);else if(a instanceof go)for(let c=0;c<Wr.members.length;c++)t.push(Wr.members[c].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof Bu||a instanceof lr||a instanceof es)for(const c of a.uniformNames)t.push(c)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){const a=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof Bu||f instanceof lr||f instanceof es){for(const m of f.uniformNames)if(r[m]){const y=f.getBinding(t,r[m],m);a.push({name:m,property:c,binding:y})}}}return a}setUniforms(t,r,a,c){for(const{name:f,property:m,binding:y}of r)this.binders[m].setUniform(y,c,a.get(m),f)}updatePaintBuffers(t){this._buffers=[];for(const r in this.binders){const a=this.binders[r];if(t&&a instanceof go){const c=t.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(a instanceof Bs||a instanceof es)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(t){for(const r in this.binders){const a=this.binders[r];(a instanceof Bs||a instanceof es||a instanceof go)&&a.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof Bs||r instanceof es||r instanceof go)&&r.destroy()}}}class Dr{constructor(t,r,a=()=>!0){this.programConfigurations={};for(const c of t)this.programConfigurations[c.id]=new Os(c,r,a);this.needsUpload=!1,this._featureMap=new Xo,this._bufferOffset=0}populatePaintArrays(t,r,a,c,f,m){for(const y in this.programConfigurations)this.programConfigurations[y].populatePaintArrays(t,r,c,f,m);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,a,c){for(const f of a)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(t,this._featureMap,r,f,c)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Ou(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function Cc(i,t,r){const a={color:{source:B,composite:it},number:{source:Le,composite:B}},c=function(f){return{"line-pattern":{source:xn,composite:xn},"fill-pattern":{source:xn,composite:xn},"fill-extrusion-pattern":{source:xn,composite:xn}}[f]}(i);return c&&c[r]||a[t][r]}Je("ConstantBinder",Bu),Je("CrossFadedConstantBinder",lr),Je("SourceExpressionBinder",Bs),Je("CrossFadedCompositeBinder",go),Je("CompositeExpressionBinder",es),Je("ProgramConfiguration",Os,{omit:["_buffers"]}),Je("ProgramConfigurationSet",Dr);const $i=8192,Pc=Math.pow(2,14)-1,ph=-Pc-1;function Ea(i){const t=$i/i.extent,r=i.loadGeometry();for(let a=0;a<r.length;a++){const c=r[a];for(let f=0;f<c.length;f++){const m=c[f],y=Math.round(m.x*t),x=Math.round(m.y*t);m.x=At(y,ph,Pc),m.y=At(x,ph,Pc),(y<m.x||y>m.x+1||x<m.y||x>m.y+1)&&bi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Ca(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?Ea(i):[]}}function Nu(i,t,r,a,c){i.emplaceBack(2*t+(a+1)/2,2*r+(c+1)/2)}class Mc{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Hi,this.indexArray=new Ar,this.segments=new ai,this.programConfigurations=new Dr(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,a){const c=this.layers[0],f=[];let m=null,y=!1;c.type==="circle"&&(m=c.layout.get("circle-sort-key"),y=!m.isConstant());for(const{feature:x,id:T,index:E,sourceLayerIndex:C}of t){const z=this.layers[0]._featureFilter.needGeometry,F=Ca(x,z);if(!this.layers[0]._featureFilter.filter(new Dt(this.zoom),F,a))continue;const N=y?m.evaluate(F,{},a):void 0,U={id:T,properties:x.properties,type:x.type,sourceLayerIndex:C,index:E,geometry:z?F.geometry:Ea(x),patterns:{},sortKey:N};f.push(U)}y&&f.sort((x,T)=>x.sortKey-T.sortKey);for(const x of f){const{geometry:T,index:E,sourceLayerIndex:C}=x,z=t[E].feature;this.addFeature(x,T,E,a),r.featureIndex.insert(z,T,E,C,this.index)}}update(t,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ri),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,a,c){for(const f of r)for(const m of f){const y=m.x,x=m.y;if(y<0||y>=$i||x<0||x>=$i)continue;const T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),E=T.vertexLength;Nu(this.layoutVertexArray,y,x,-1,-1),Nu(this.layoutVertexArray,y,x,1,-1),Nu(this.layoutVertexArray,y,x,1,1),Nu(this.layoutVertexArray,y,x,-1,1),this.indexArray.emplaceBack(E,E+1,E+2),this.indexArray.emplaceBack(E,E+3,E+2),T.vertexLength+=4,T.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,{},c)}}function fh(i,t){for(let r=0;r<i.length;r++)if(ol(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(ol(i,t[r]))return!0;return!!Xl(i,t)}function id(i,t,r){return!!ol(i,t)||!!Ac(t,i,r)}function Wl(i,t){if(i.length===1)return mh(t,i[0]);for(let r=0;r<t.length;r++){const a=t[r];for(let c=0;c<a.length;c++)if(ol(i,a[c]))return!0}for(let r=0;r<i.length;r++)if(mh(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(Xl(i,t[r]))return!0;return!1}function rd(i,t,r){if(i.length>1){if(Xl(i,t))return!0;for(let a=0;a<t.length;a++)if(Ac(t[a],i,r))return!0}for(let a=0;a<i.length;a++)if(Ac(i[a],t,r))return!0;return!1}function Xl(i,t){if(i.length===0||t.length===0)return!1;for(let r=0;r<i.length-1;r++){const a=i[r],c=i[r+1];for(let f=0;f<t.length-1;f++)if(zc(a,c,t[f],t[f+1]))return!0}return!1}function zc(i,t,r,a){return Li(i,r,a)!==Li(t,r,a)&&Li(i,t,r)!==Li(i,t,a)}function Ac(i,t,r){const a=r*r;if(t.length===1)return i.distSqr(t[0])<a;for(let c=1;c<t.length;c++)if(Dc(i,t[c-1],t[c])<a)return!0;return!1}function Dc(i,t,r){const a=t.distSqr(r);if(a===0)return i.distSqr(t);const c=((i.x-t.x)*(r.x-t.x)+(i.y-t.y)*(r.y-t.y))/a;return i.distSqr(c<0?t:c>1?r:r.sub(t)._mult(c)._add(t))}function mh(i,t){let r,a,c,f=!1;for(let m=0;m<i.length;m++){r=i[m];for(let y=0,x=r.length-1;y<r.length;x=y++)a=r[y],c=r[x],a.y>t.y!=c.y>t.y&&t.x<(c.x-a.x)*(t.y-a.y)/(c.y-a.y)+a.x&&(f=!f)}return f}function ol(i,t){let r=!1;for(let a=0,c=i.length-1;a<i.length;c=a++){const f=i[a],m=i[c];f.y>t.y!=m.y>t.y&&t.x<(m.x-f.x)*(t.y-f.y)/(m.y-f.y)+f.x&&(r=!r)}return r}function nd(i,t,r){const a=r[0],c=r[2];if(i.x<a.x&&t.x<a.x||i.x>c.x&&t.x>c.x||i.y<a.y&&t.y<a.y||i.y>c.y&&t.y>c.y)return!1;const f=Li(i,t,r[0]);return f!==Li(i,t,r[1])||f!==Li(i,t,r[2])||f!==Li(i,t,r[3])}function Kl(i,t,r){const a=t.paint.get(i).value;return a.kind==="constant"?a.value:r.programConfigurations.get(t.id).getMaxValue(i)}function Jl(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Vu(i,t,r,a,c){if(!t[0]&&!t[1])return i;const f=we.convert(t)._mult(c);r==="viewport"&&f._rotate(-a);const m=[];for(let y=0;y<i.length;y++)m.push(i[y].sub(f));return m}let gh,_h;Je("CircleBucket",Mc,{omit:["layers"]});var ep={get paint(){return _h=_h||new sn({"circle-radius":new st(be.paint_circle["circle-radius"]),"circle-color":new st(be.paint_circle["circle-color"]),"circle-blur":new st(be.paint_circle["circle-blur"]),"circle-opacity":new st(be.paint_circle["circle-opacity"]),"circle-translate":new at(be.paint_circle["circle-translate"]),"circle-translate-anchor":new at(be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new at(be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new at(be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new st(be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new st(be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new st(be.paint_circle["circle-stroke-opacity"])})},get layout(){return gh=gh||new sn({"circle-sort-key":new st(be.layout_circle["circle-sort-key"])})}},Xr=1e-6,Yl=typeof Float32Array<"u"?Float32Array:Array;function yh(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function vh(i,t,r){var a=t[0],c=t[1],f=t[2],m=t[3],y=t[4],x=t[5],T=t[6],E=t[7],C=t[8],z=t[9],F=t[10],N=t[11],U=t[12],K=t[13],ee=t[14],ge=t[15],ne=r[0],de=r[1],ke=r[2],Ae=r[3];return i[0]=ne*a+de*y+ke*C+Ae*U,i[1]=ne*c+de*x+ke*z+Ae*K,i[2]=ne*f+de*T+ke*F+Ae*ee,i[3]=ne*m+de*E+ke*N+Ae*ge,i[4]=(ne=r[4])*a+(de=r[5])*y+(ke=r[6])*C+(Ae=r[7])*U,i[5]=ne*c+de*x+ke*z+Ae*K,i[6]=ne*f+de*T+ke*F+Ae*ee,i[7]=ne*m+de*E+ke*N+Ae*ge,i[8]=(ne=r[8])*a+(de=r[9])*y+(ke=r[10])*C+(Ae=r[11])*U,i[9]=ne*c+de*x+ke*z+Ae*K,i[10]=ne*f+de*T+ke*F+Ae*ee,i[11]=ne*m+de*E+ke*N+Ae*ge,i[12]=(ne=r[12])*a+(de=r[13])*y+(ke=r[14])*C+(Ae=r[15])*U,i[13]=ne*c+de*x+ke*z+Ae*K,i[14]=ne*f+de*T+ke*F+Ae*ee,i[15]=ne*m+de*E+ke*N+Ae*ge,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var Ql,sd=vh;function al(i,t,r){var a=t[0],c=t[1],f=t[2],m=t[3];return i[0]=r[0]*a+r[4]*c+r[8]*f+r[12]*m,i[1]=r[1]*a+r[5]*c+r[9]*f+r[13]*m,i[2]=r[2]*a+r[6]*c+r[10]*f+r[14]*m,i[3]=r[3]*a+r[7]*c+r[11]*f+r[15]*m,i}Ql=new Yl(4),Yl!=Float32Array&&(Ql[0]=0,Ql[1]=0,Ql[2]=0,Ql[3]=0);class tp extends e{constructor(t){super(t,ep)}createBucket(t){return new Mc(t)}queryRadius(t){const r=t;return Kl("circle-radius",this,r)+Kl("circle-stroke-width",this,r)+Jl(this.paint.get("circle-translate"))}queryIntersectsFeature(t,r,a,c,f,m,y,x){const T=Vu(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,y),E=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a),C=this.paint.get("circle-pitch-alignment")==="map",z=C?T:function(N,U){return N.map(K=>od(K,U))}(T,x),F=C?E*y:E;for(const N of c)for(const U of N){const K=C?U:od(U,x);let ee=F;const ge=al([],[U.x,U.y,0,1],x);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ee*=ge[3]/m.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ee*=m.cameraToCenterDistance/ge[3]),id(z,K,ee))return!0}return!1}}function od(i,t){const r=al([],[i.x,i.y,0,1],t);return new we(r[0]/r[3],r[1]/r[3])}class ad extends Mc{}let vs;Je("HeatmapBucket",ad,{omit:["layers"]});var xh={get paint(){return vs=vs||new sn({"heatmap-radius":new st(be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new st(be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new at(be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new nl(be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new at(be.paint_heatmap["heatmap-opacity"])})}};function eu(i,{width:t,height:r},a,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==t*r*a)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${t*r*a}`)}else c=new Uint8Array(t*r*a);return i.width=t,i.height=r,i.data=c,i}function wh(i,{width:t,height:r},a){if(t===i.width&&r===i.height)return;const c=eu({},{width:t,height:r},a);Lc(i,c,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,r)},a),i.width=t,i.height=r,i.data=c.data}function Lc(i,t,r,a,c,f){if(c.width===0||c.height===0)return t;if(c.width>i.width||c.height>i.height||r.x>i.width-c.width||r.y>i.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>t.width||c.height>t.height||a.x>t.width-c.width||a.y>t.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const m=i.data,y=t.data;if(m===y)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<c.height;x++){const T=((r.y+x)*i.width+r.x)*f,E=((a.y+x)*t.width+a.x)*f;for(let C=0;C<c.width*f;C++)y[E+C]=m[T+C]}return t}class tu{constructor(t,r){eu(this,t,1,r)}resize(t){wh(this,t,1)}clone(){return new tu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,a,c,f){Lc(t,r,a,c,f,1)}}class wn{constructor(t,r){eu(this,t,4,r)}resize(t){wh(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new wn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,a,c,f){Lc(t,r,a,c,f,4)}}function ll(i){const t={},r=i.resolution||256,a=i.clips?i.clips.length:1,c=i.image||new wn({width:r,height:a});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const f=(m,y,x)=>{t[i.evaluationKey]=x;const T=i.expression.evaluate(t);c.data[m+y+0]=Math.floor(255*T.r/T.a),c.data[m+y+1]=Math.floor(255*T.g/T.a),c.data[m+y+2]=Math.floor(255*T.b/T.a),c.data[m+y+3]=Math.floor(255*T.a)};if(i.clips)for(let m=0,y=0;m<a;++m,y+=4*r)for(let x=0,T=0;x<r;x++,T+=4){const E=x/(r-1),{start:C,end:z}=i.clips[m];f(y,T,C*(1-E)+z*E)}else for(let m=0,y=0;m<r;m++,y+=4)f(0,y,m/(r-1));return c}Je("AlphaImage",tu),Je("RGBAImage",wn);const ju="big-fb";class bh extends e{createBucket(t){return new ad(t)}constructor(t){super(t,xh),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ll({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(ju)&&this.heatmapFbos.delete(ju)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let ld;var ud={get paint(){return ld=ld||new sn({"hillshade-illumination-direction":new at(be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new at(be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new at(be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new at(be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new at(be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new at(be.paint_hillshade["hillshade-accent-color"])})}};class cd extends e{constructor(t){super(t,ud)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const hd=d([{name:"a_pos",components:2,type:"Int16"}],4),{members:dd}=hd;function Sh(i,t,r=2){const a=t&&t.length,c=a?t[0]*r:i.length;let f=pd(i,0,c,r,!0);const m=[];if(!f||f.next===f.prev)return m;let y,x,T;if(a&&(f=function(E,C,z,F){const N=[];for(let U=0,K=C.length;U<K;U++){const ee=pd(E,C[U]*F,U<K-1?C[U+1]*F:E.length,F,!1);ee===ee.next&&(ee.steiner=!0),N.push(xd(ee))}N.sort(yd);for(let U=0;U<N.length;U++)z=Th(N[U],z);return z}(i,t,f,r)),i.length>80*r){y=1/0,x=1/0;let E=-1/0,C=-1/0;for(let z=r;z<c;z+=r){const F=i[z],N=i[z+1];F<y&&(y=F),N<x&&(x=N),F>E&&(E=F),N>C&&(C=N)}T=Math.max(E-y,C-x),T=T!==0?32767/T:0}return wr(f,m,r,y,x,T,0),m}function pd(i,t,r,a,c){let f;if(c===function(m,y,x,T){let E=0;for(let C=y,z=x-T;C<x;C+=T)E+=(m[z]-m[C])*(m[C+1]+m[z+1]),z=C;return E}(i,t,r,a)>0)for(let m=t;m<r;m+=a)f=Ih(m/a|0,i[m],i[m+1],f);else for(let m=r-a;m>=t;m-=a)f=Ih(m/a|0,i[m],i[m+1],f);return f&&$u(f,f.next)&&(Pa(f),f=f.next),f}function fr(i,t){if(!i)return i;t||(t=i);let r,a=i;do if(r=!1,a.steiner||!$u(a,a.next)&&ji(a.prev,a,a.next)!==0)a=a.next;else{if(Pa(a),a=t=a.prev,a===a.next)break;r=!0}while(r||a!==t);return t}function wr(i,t,r,a,c,f,m){if(!i)return;!m&&f&&function(x,T,E,C){let z=x;do z.z===0&&(z.z=Uu(z.x,z.y,T,E,C)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==x);z.prevZ.nextZ=null,z.prevZ=null,function(F){let N,U=1;do{let K,ee=F;F=null;let ge=null;for(N=0;ee;){N++;let ne=ee,de=0;for(let Ae=0;Ae<U&&(de++,ne=ne.nextZ,ne);Ae++);let ke=U;for(;de>0||ke>0&&ne;)de!==0&&(ke===0||!ne||ee.z<=ne.z)?(K=ee,ee=ee.nextZ,de--):(K=ne,ne=ne.nextZ,ke--),ge?ge.nextZ=K:F=K,K.prevZ=ge,ge=K;ee=ne}ge.nextZ=null,U*=2}while(N>1)}(z)}(i,a,c,f);let y=i;for(;i.prev!==i.next;){const x=i.prev,T=i.next;if(f?md(i,a,c,f):fd(i))t.push(x.i,i.i,T.i),Pa(i),i=T.next,y=T.next;else if((i=T)===y){m?m===1?wr(i=gd(fr(i),t),t,r,a,c,f,2):m===2&&_d(i,t,r,a,c,f):wr(fr(i),t,r,a,c,f,1);break}}}function fd(i){const t=i.prev,r=i,a=i.next;if(ji(t,r,a)>=0)return!1;const c=t.x,f=r.x,m=a.x,y=t.y,x=r.y,T=a.y,E=c<f?c<m?c:m:f<m?f:m,C=y<x?y<T?y:T:x<T?x:T,z=c>f?c>m?c:m:f>m?f:m,F=y>x?y>T?y:T:x>T?x:T;let N=a.next;for(;N!==t;){if(N.x>=E&&N.x<=z&&N.y>=C&&N.y<=F&&ul(c,y,f,x,m,T,N.x,N.y)&&ji(N.prev,N,N.next)>=0)return!1;N=N.next}return!0}function md(i,t,r,a){const c=i.prev,f=i,m=i.next;if(ji(c,f,m)>=0)return!1;const y=c.x,x=f.x,T=m.x,E=c.y,C=f.y,z=m.y,F=y<x?y<T?y:T:x<T?x:T,N=E<C?E<z?E:z:C<z?C:z,U=y>x?y>T?y:T:x>T?x:T,K=E>C?E>z?E:z:C>z?C:z,ee=Uu(F,N,t,r,a),ge=Uu(U,K,t,r,a);let ne=i.prevZ,de=i.nextZ;for(;ne&&ne.z>=ee&&de&&de.z<=ge;){if(ne.x>=F&&ne.x<=U&&ne.y>=N&&ne.y<=K&&ne!==c&&ne!==m&&ul(y,E,x,C,T,z,ne.x,ne.y)&&ji(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,de.x>=F&&de.x<=U&&de.y>=N&&de.y<=K&&de!==c&&de!==m&&ul(y,E,x,C,T,z,de.x,de.y)&&ji(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;ne&&ne.z>=ee;){if(ne.x>=F&&ne.x<=U&&ne.y>=N&&ne.y<=K&&ne!==c&&ne!==m&&ul(y,E,x,C,T,z,ne.x,ne.y)&&ji(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;de&&de.z<=ge;){if(de.x>=F&&de.x<=U&&de.y>=N&&de.y<=K&&de!==c&&de!==m&&ul(y,E,x,C,T,z,de.x,de.y)&&ji(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function gd(i,t){let r=i;do{const a=r.prev,c=r.next.next;!$u(a,c)&&Rc(a,r,r.next,c)&&iu(a,c)&&iu(c,a)&&(t.push(a.i,r.i,c.i),Pa(r),Pa(r.next),r=i=c),r=r.next}while(r!==i);return fr(r)}function _d(i,t,r,a,c,f){let m=i;do{let y=m.next.next;for(;y!==m.prev;){if(m.i!==y.i&&kh(m,y)){let x=Bc(m,y);return m=fr(m,m.next),x=fr(x,x.next),wr(m,t,r,a,c,f,0),void wr(x,t,r,a,c,f,0)}y=y.next}m=m.next}while(m!==i)}function yd(i,t){return i.x-t.x}function Th(i,t){const r=function(c,f){let m=f;const y=c.x,x=c.y;let T,E=-1/0;do{if(x<=m.y&&x>=m.next.y&&m.next.y!==m.y){const U=m.x+(x-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(U<=y&&U>E&&(E=U,T=m.x<m.next.x?m:m.next,U===y))return T}m=m.next}while(m!==f);if(!T)return null;const C=T,z=T.x,F=T.y;let N=1/0;m=T;do{if(y>=m.x&&m.x>=z&&y!==m.x&&ul(x<F?y:E,x,z,F,x<F?E:y,x,m.x,m.y)){const U=Math.abs(x-m.y)/(y-m.x);iu(m,c)&&(U<N||U===N&&(m.x>T.x||m.x===T.x&&vd(T,m)))&&(T=m,N=U)}m=m.next}while(m!==C);return T}(i,t);if(!r)return t;const a=Bc(r,i);return fr(a,a.next),fr(r,r.next)}function vd(i,t){return ji(i.prev,i,t.prev)<0&&ji(t.next,i,i.next)<0}function Uu(i,t,r,a,c){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*c|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-a)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function xd(i){let t=i,r=i;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==i);return r}function ul(i,t,r,a,c,f,m,y){return(c-m)*(t-y)>=(i-m)*(f-y)&&(i-m)*(a-y)>=(r-m)*(t-y)&&(r-m)*(f-y)>=(c-m)*(a-y)}function kh(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(r,a){let c=r;do{if(c.i!==r.i&&c.next.i!==r.i&&c.i!==a.i&&c.next.i!==a.i&&Rc(c,c.next,r,a))return!0;c=c.next}while(c!==r);return!1}(i,t)&&(iu(i,t)&&iu(t,i)&&function(r,a){let c=r,f=!1;const m=(r.x+a.x)/2,y=(r.y+a.y)/2;do c.y>y!=c.next.y>y&&c.next.y!==c.y&&m<(c.next.x-c.x)*(y-c.y)/(c.next.y-c.y)+c.x&&(f=!f),c=c.next;while(c!==r);return f}(i,t)&&(ji(i.prev,i,t.prev)||ji(i,t.prev,t))||$u(i,t)&&ji(i.prev,i,i.next)>0&&ji(t.prev,t,t.next)>0)}function ji(i,t,r){return(t.y-i.y)*(r.x-t.x)-(t.x-i.x)*(r.y-t.y)}function $u(i,t){return i.x===t.x&&i.y===t.y}function Rc(i,t,r,a){const c=Fc(ji(i,t,r)),f=Fc(ji(i,t,a)),m=Fc(ji(r,a,i)),y=Fc(ji(r,a,t));return c!==f&&m!==y||!(c!==0||!cl(i,r,t))||!(f!==0||!cl(i,a,t))||!(m!==0||!cl(r,i,a))||!(y!==0||!cl(r,t,a))}function cl(i,t,r){return t.x<=Math.max(i.x,r.x)&&t.x>=Math.min(i.x,r.x)&&t.y<=Math.max(i.y,r.y)&&t.y>=Math.min(i.y,r.y)}function Fc(i){return i>0?1:i<0?-1:0}function iu(i,t){return ji(i.prev,i,i.next)<0?ji(i,t,i.next)>=0&&ji(i,i.prev,t)>=0:ji(i,t,i.prev)<0||ji(i,i.next,t)<0}function Bc(i,t){const r=Ns(i.i,i.x,i.y),a=Ns(t.i,t.x,t.y),c=i.next,f=t.prev;return i.next=t,t.prev=i,r.next=c,c.prev=r,a.next=r,r.prev=a,f.next=a,a.prev=f,a}function Ih(i,t,r,a){const c=Ns(i,t,r);return a?(c.next=a.next,c.prev=a,a.next.prev=c,a.next=c):(c.prev=c,c.next=c),c}function Pa(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Ns(i,t,r){return{i,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Eh(i,t,r){const a=r.patternDependencies;let c=!1;for(const f of t){const m=f.paint.get(`${i}-pattern`);m.isConstant()||(c=!0);const y=m.constantOr(null);y&&(c=!0,a[y.to]=!0,a[y.from]=!0)}return c}function Oc(i,t,r,a,c){const f=c.patternDependencies;for(const m of t){const y=m.paint.get(`${i}-pattern`).value;if(y.kind!=="constant"){let x=y.evaluate({zoom:a-1},r,{},c.availableImages),T=y.evaluate({zoom:a},r,{},c.availableImages),E=y.evaluate({zoom:a+1},r,{},c.availableImages);x=x&&x.name?x.name:x,T=T&&T.name?T.name:T,E=E&&E.name?E.name:E,f[x]=!0,f[T]=!0,f[E]=!0,r.patterns[m.id]={min:x,mid:T,max:E}}}return r}class qu{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new vr,this.indexArray=new Ar,this.indexArray2=new Rs,this.programConfigurations=new Dr(t.layers,t.zoom),this.segments=new ai,this.segments2=new ai,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,a){this.hasPattern=Eh("fill",this.layers,r);const c=this.layers[0].layout.get("fill-sort-key"),f=!c.isConstant(),m=[];for(const{feature:y,id:x,index:T,sourceLayerIndex:E}of t){const C=this.layers[0]._featureFilter.needGeometry,z=Ca(y,C);if(!this.layers[0]._featureFilter.filter(new Dt(this.zoom),z,a))continue;const F=f?c.evaluate(z,{},a,r.availableImages):void 0,N={id:x,properties:y.properties,type:y.type,sourceLayerIndex:E,index:T,geometry:C?z.geometry:Ea(y),patterns:{},sortKey:F};m.push(N)}f&&m.sort((y,x)=>y.sortKey-x.sortKey);for(const y of m){const{geometry:x,index:T,sourceLayerIndex:E}=y;if(this.hasPattern){const C=Oc("fill",this.layers,y,this.zoom,r);this.patternFeatures.push(C)}else this.addFeature(y,x,T,a,{});r.featureIndex.insert(t[T].feature,x,T,E,this.index)}}update(t,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a)}addFeatures(t,r,a){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,dd),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,a,c,f){for(const m of Pl(r,500)){let y=0;for(const F of m)y+=F.length;const x=this.segments.prepareSegment(y,this.layoutVertexArray,this.indexArray),T=x.vertexLength,E=[],C=[];for(const F of m){if(F.length===0)continue;F!==m[0]&&C.push(E.length/2);const N=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),U=N.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(U+F.length-1,U),E.push(F[0].x),E.push(F[0].y);for(let K=1;K<F.length;K++)this.layoutVertexArray.emplaceBack(F[K].x,F[K].y),this.indexArray2.emplaceBack(U+K-1,U+K),E.push(F[K].x),E.push(F[K].y);N.vertexLength+=F.length,N.primitiveLength+=F.length}const z=Sh(E,C);for(let F=0;F<z.length;F+=3)this.indexArray.emplaceBack(T+z[F],T+z[F+1],T+z[F+2]);x.vertexLength+=y,x.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,f,c)}}let Ch,Ph;Je("FillBucket",qu,{omit:["layers","patternFeatures"]});var Zu={get paint(){return Ph=Ph||new sn({"fill-antialias":new at(be.paint_fill["fill-antialias"]),"fill-opacity":new st(be.paint_fill["fill-opacity"]),"fill-color":new st(be.paint_fill["fill-color"]),"fill-outline-color":new st(be.paint_fill["fill-outline-color"]),"fill-translate":new at(be.paint_fill["fill-translate"]),"fill-translate-anchor":new at(be.paint_fill["fill-translate-anchor"]),"fill-pattern":new Wo(be.paint_fill["fill-pattern"])})},get layout(){return Ch=Ch||new sn({"fill-sort-key":new st(be.layout_fill["fill-sort-key"])})}};class an extends e{constructor(t){super(t,Zu)}recalculate(t,r){super.recalculate(t,r);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new qu(t)}queryRadius(){return Jl(this.paint.get("fill-translate"))}queryIntersectsFeature(t,r,a,c,f,m,y){return Wl(Vu(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,y),c)}isTileClipped(){return!0}}const ip=d([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),rp=d([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Nc}=ip;var Wi={},np=nt,ct=Vs;function Vs(i,t,r,a,c){this.properties={},this.extent=r,this.type=0,this._pbf=i,this._geometry=-1,this._keys=a,this._values=c,i.readFields(Mh,this,t)}function Mh(i,t,r){i==1?t.id=r.readVarint():i==2?function(a,c){for(var f=a.readVarint()+a.pos;a.pos<f;){var m=c._keys[a.readVarint()],y=c._values[a.readVarint()];c.properties[m]=y}}(r,t):i==3?t.type=r.readVarint():i==4&&(t._geometry=r.pos)}function wd(i){for(var t,r,a=0,c=0,f=i.length,m=f-1;c<f;m=c++)a+=((r=i[m]).x-(t=i[c]).x)*(t.y+r.y);return a}Vs.types=["Unknown","Point","LineString","Polygon"],Vs.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,r=i.readVarint()+i.pos,a=1,c=0,f=0,m=0,y=[];i.pos<r;){if(c<=0){var x=i.readVarint();a=7&x,c=x>>3}if(c--,a===1||a===2)f+=i.readSVarint(),m+=i.readSVarint(),a===1&&(t&&y.push(t),t=[]),t.push(new np(f,m));else{if(a!==7)throw new Error("unknown command "+a);t&&t.push(t[0].clone())}}return t&&y.push(t),y},Vs.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,r=1,a=0,c=0,f=0,m=1/0,y=-1/0,x=1/0,T=-1/0;i.pos<t;){if(a<=0){var E=i.readVarint();r=7&E,a=E>>3}if(a--,r===1||r===2)(c+=i.readSVarint())<m&&(m=c),c>y&&(y=c),(f+=i.readSVarint())<x&&(x=f),f>T&&(T=f);else if(r!==7)throw new Error("unknown command "+r)}return[m,x,y,T]},Vs.prototype.toGeoJSON=function(i,t,r){var a,c,f=this.extent*Math.pow(2,r),m=this.extent*i,y=this.extent*t,x=this.loadGeometry(),T=Vs.types[this.type];function E(F){for(var N=0;N<F.length;N++){var U=F[N];F[N]=[360*(U.x+m)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(U.y+y)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(a=0;a<x.length;a++)C[a]=x[a][0];E(x=C);break;case 2:for(a=0;a<x.length;a++)E(x[a]);break;case 3:for(x=function(F){var N=F.length;if(N<=1)return[F];for(var U,K,ee=[],ge=0;ge<N;ge++){var ne=wd(F[ge]);ne!==0&&(K===void 0&&(K=ne<0),K===ne<0?(U&&ee.push(U),U=[F[ge]]):U.push(F[ge]))}return U&&ee.push(U),ee}(x),a=0;a<x.length;a++)for(c=0;c<x[a].length;c++)E(x[a][c])}x.length===1?x=x[0]:T="Multi"+T;var z={type:"Feature",geometry:{type:T,coordinates:x},properties:this.properties};return"id"in this&&(z.id=this.id),z};var sp=ct,ru=Gu;function Gu(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(zh,this,t),this.length=this._features.length}function zh(i,t,r){i===15?t.version=r.readVarint():i===1?t.name=r.readString():i===5?t.extent=r.readVarint():i===2?t._features.push(r.pos):i===3?t._keys.push(r.readString()):i===4&&t._values.push(function(a){for(var c=null,f=a.readVarint()+a.pos;a.pos<f;){var m=a.readVarint()>>3;c=m===1?a.readString():m===2?a.readFloat():m===3?a.readDouble():m===4?a.readVarint64():m===5?a.readVarint():m===6?a.readSVarint():m===7?a.readBoolean():null}return c}(r))}Gu.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new sp(this._pbf,t,this.extent,this._keys,this._values)};var bd=ru;function Sd(i,t,r){if(i===3){var a=new bd(r,r.readVarint()+r.pos);a.length&&(t[a.name]=a)}}Wi.VectorTile=function(i,t){this.layers=i.readFields(Sd,{},t)},Wi.VectorTileFeature=ct,Wi.VectorTileLayer=ru;const Td=Wi.VectorTileFeature.types,Hu=Math.pow(2,13);function hl(i,t,r,a,c,f,m,y){i.emplaceBack(t,r,2*Math.floor(a*Hu)+m,c*Hu*2,f*Hu*2,Math.round(y))}class br{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Jn,this.centroidVertexArray=new Ai,this.indexArray=new Ar,this.programConfigurations=new Dr(t.layers,t.zoom),this.segments=new ai,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,a){this.features=[],this.hasPattern=Eh("fill-extrusion",this.layers,r);for(const{feature:c,id:f,index:m,sourceLayerIndex:y}of t){const x=this.layers[0]._featureFilter.needGeometry,T=Ca(c,x);if(!this.layers[0]._featureFilter.filter(new Dt(this.zoom),T,a))continue;const E={id:f,sourceLayerIndex:y,index:m,geometry:x?T.geometry:Ea(c),properties:c.properties,type:c.type,patterns:{}};this.hasPattern?this.features.push(Oc("fill-extrusion",this.layers,E,this.zoom,r)):this.addFeature(E,E.geometry,m,a,{}),r.featureIndex.insert(c,E.geometry,m,y,this.index,!0)}}addFeatures(t,r,a){for(const c of this.features){const{geometry:f}=c;this.addFeature(c,f,c.index,r,a)}}update(t,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Nc),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,rp.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,a,c,f){for(const m of Pl(r,500)){const y={x:0,y:0,vertexCount:0};let x=0;for(const N of m)x+=N.length;let T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const N of m){if(N.length===0||Ma(N))continue;let U=0;for(let K=0;K<N.length;K++){const ee=N[K];if(K>=1){const ge=N[K-1];if(!js(ee,ge)){T.vertexLength+4>ai.MAX_VERTEX_ARRAY_LENGTH&&(T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ne=ee.sub(ge)._perp()._unit(),de=ge.dist(ee);U+de>32768&&(U=0),hl(this.layoutVertexArray,ee.x,ee.y,ne.x,ne.y,0,0,U),hl(this.layoutVertexArray,ee.x,ee.y,ne.x,ne.y,0,1,U),y.x+=2*ee.x,y.y+=2*ee.y,y.vertexCount+=2,U+=de,hl(this.layoutVertexArray,ge.x,ge.y,ne.x,ne.y,0,0,U),hl(this.layoutVertexArray,ge.x,ge.y,ne.x,ne.y,0,1,U),y.x+=2*ge.x,y.y+=2*ge.y,y.vertexCount+=2;const ke=T.vertexLength;this.indexArray.emplaceBack(ke,ke+2,ke+1),this.indexArray.emplaceBack(ke+1,ke+2,ke+3),T.vertexLength+=4,T.primitiveLength+=2}}}}if(T.vertexLength+x>ai.MAX_VERTEX_ARRAY_LENGTH&&(T=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray)),Td[t.type]!=="Polygon")continue;const E=[],C=[],z=T.vertexLength;for(const N of m)if(N.length!==0){N!==m[0]&&C.push(E.length/2);for(let U=0;U<N.length;U++){const K=N[U];hl(this.layoutVertexArray,K.x,K.y,0,0,1,1,0),y.x+=K.x,y.y+=K.y,y.vertexCount+=1,E.push(K.x),E.push(K.y)}}const F=Sh(E,C);for(let N=0;N<F.length;N+=3)this.indexArray.emplaceBack(z+F[N],z+F[N+2],z+F[N+1]);T.primitiveLength+=F.length/3,T.vertexLength+=x;for(let N=0;N<y.vertexCount;N++){const U=Math.floor(y.x/y.vertexCount),K=Math.floor(y.y/y.vertexCount);this.centroidVertexArray.emplaceBack(U,K)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,f,c)}}function js(i,t){return i.x===t.x&&(i.x<0||i.x>$i)||i.y===t.y&&(i.y<0||i.y>$i)}function Ma(i){return i.every(t=>t.x<0)||i.every(t=>t.x>$i)||i.every(t=>t.y<0)||i.every(t=>t.y>$i)}let Ah;Je("FillExtrusionBucket",br,{omit:["layers","features"]});var kd={get paint(){return Ah=Ah||new sn({"fill-extrusion-opacity":new at(be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new st(be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new at(be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new at(be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Wo(be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new st(be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new st(be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new at(be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Us extends e{constructor(t){super(t,kd)}createBucket(t){return new br(t)}queryRadius(){return Jl(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,r,a,c,f,m,y,x){const T=Vu(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,y),E=this.paint.get("fill-extrusion-height").evaluate(r,a),C=this.paint.get("fill-extrusion-base").evaluate(r,a),z=function(N,U,K,ee){const ge=[];for(const ne of N){const de=[ne.x,ne.y,0,1];al(de,de,U),ge.push(new we(de[0]/de[3],de[1]/de[3]))}return ge}(T,x),F=function(N,U,K,ee){const ge=[],ne=[],de=ee[8]*U,ke=ee[9]*U,Ae=ee[10]*U,Ye=ee[11]*U,yt=ee[8]*K,Ke=ee[9]*K,He=ee[10]*K,ht=ee[11]*K;for(const rt of N){const et=[],Ee=[];for(const dt of rt){const ut=dt.x,Et=dt.y,Di=ee[0]*ut+ee[4]*Et+ee[12],Ci=ee[1]*ut+ee[5]*Et+ee[13],Fr=ee[2]*ut+ee[6]*Et+ee[14],wo=ee[3]*ut+ee[7]*Et+ee[15],un=Fr+Ae,Br=wo+Ye,Fn=Di+yt,Bn=Ci+Ke,On=Fr+He,tr=wo+ht,Or=new we((Di+de)/Br,(Ci+ke)/Br);Or.z=un/Br,et.push(Or);const Sn=new we(Fn/tr,Bn/tr);Sn.z=On/tr,Ee.push(Sn)}ge.push(et),ne.push(Ee)}return[ge,ne]}(c,C,E,x);return function(N,U,K){let ee=1/0;Wl(K,U)&&(ee=$s(K,U[0]));for(let ge=0;ge<U.length;ge++){const ne=U[ge],de=N[ge];for(let ke=0;ke<ne.length-1;ke++){const Ae=ne[ke],Ye=[Ae,ne[ke+1],de[ke+1],de[ke],Ae];fh(K,Ye)&&(ee=Math.min(ee,$s(K,Ye)))}}return ee!==1/0&&ee}(F[0],F[1],z)}}function nu(i,t){return i.x*t.x+i.y*t.y}function $s(i,t){if(i.length===1){let r=0;const a=t[r++];let c;for(;!c||a.equals(c);)if(c=t[r++],!c)return 1/0;for(;r<t.length;r++){const f=t[r],m=i[0],y=c.sub(a),x=f.sub(a),T=m.sub(a),E=nu(y,y),C=nu(y,x),z=nu(x,x),F=nu(T,y),N=nu(T,x),U=E*z-C*C,K=(z*F-C*N)/U,ee=(E*N-C*F)/U,ge=a.z*(1-K-ee)+c.z*K+f.z*ee;if(isFinite(ge))return ge}return 1/0}{let r=1/0;for(const a of t)r=Math.min(r,a.z);return r}}const op=d([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Id}=op,Ed=d([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Cd}=Ed,Pd=Wi.VectorTileFeature.types,ap=Math.cos(Math.PI/180*37.5),Wu=Math.pow(2,14)/.5;class Xu{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new on,this.layoutVertexArray2=new Yn,this.indexArray=new Ar,this.programConfigurations=new Dr(t.layers,t.zoom),this.segments=new ai,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,a){this.hasPattern=Eh("line",this.layers,r);const c=this.layers[0].layout.get("line-sort-key"),f=!c.isConstant(),m=[];for(const{feature:y,id:x,index:T,sourceLayerIndex:E}of t){const C=this.layers[0]._featureFilter.needGeometry,z=Ca(y,C);if(!this.layers[0]._featureFilter.filter(new Dt(this.zoom),z,a))continue;const F=f?c.evaluate(z,{},a):void 0,N={id:x,properties:y.properties,type:y.type,sourceLayerIndex:E,index:T,geometry:C?z.geometry:Ea(y),patterns:{},sortKey:F};m.push(N)}f&&m.sort((y,x)=>y.sortKey-x.sortKey);for(const y of m){const{geometry:x,index:T,sourceLayerIndex:E}=y;if(this.hasPattern){const C=Oc("line",this.layers,y,this.zoom,r);this.patternFeatures.push(C)}else this.addFeature(y,x,T,a,{});r.featureIndex.insert(t[T].feature,x,T,E,this.index)}}update(t,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,a)}addFeatures(t,r,a){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Cd)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Id),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,a,c,f){const m=this.layers[0].layout,y=m.get("line-join").evaluate(t,{}),x=m.get("line-cap"),T=m.get("line-miter-limit"),E=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const C of r)this.addLine(C,t,y,x,T,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,f,c)}addLine(t,r,a,c,f,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ee=0;ee<t.length-1;ee++)this.totalDistance+=t[ee].dist(t[ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=Pd[r.type]==="Polygon";let x=t.length;for(;x>=2&&t[x-1].equals(t[x-2]);)x--;let T=0;for(;T<x-1&&t[T].equals(t[T+1]);)T++;if(x<(y?3:2))return;a==="bevel"&&(f=1.05);const E=this.overscaling<=16?15*$i/(512*this.overscaling):0,C=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let z,F,N,U,K;this.e1=this.e2=-1,y&&(z=t[x-2],K=t[T].sub(z)._unit()._perp());for(let ee=T;ee<x;ee++){if(N=ee===x-1?y?t[T+1]:void 0:t[ee+1],N&&t[ee].equals(N))continue;K&&(U=K),z&&(F=z),z=t[ee],K=N?N.sub(z)._unit()._perp():U,U=U||K;let ge=U.add(K);ge.x===0&&ge.y===0||ge._unit();const ne=U.x*K.x+U.y*K.y,de=ge.x*K.x+ge.y*K.y,ke=de!==0?1/de:1/0,Ae=2*Math.sqrt(2-2*de),Ye=de<ap&&F&&N,yt=U.x*K.y-U.y*K.x>0;if(Ye&&ee>T){const ht=z.dist(F);if(ht>2*E){const rt=z.sub(z.sub(F)._mult(E/ht)._round());this.updateDistance(F,rt),this.addCurrentVertex(rt,U,0,0,C),F=rt}}const Ke=F&&N;let He=Ke?a:y?"butt":c;if(Ke&&He==="round"&&(ke<m?He="miter":ke<=2&&(He="fakeround")),He==="miter"&&ke>f&&(He="bevel"),He==="bevel"&&(ke>2&&(He="flipbevel"),ke<f&&(He="miter")),F&&this.updateDistance(F,z),He==="miter")ge._mult(ke),this.addCurrentVertex(z,ge,0,0,C);else if(He==="flipbevel"){if(ke>100)ge=K.mult(-1);else{const ht=ke*U.add(K).mag()/U.sub(K).mag();ge._perp()._mult(ht*(yt?-1:1))}this.addCurrentVertex(z,ge,0,0,C),this.addCurrentVertex(z,ge.mult(-1),0,0,C)}else if(He==="bevel"||He==="fakeround"){const ht=-Math.sqrt(ke*ke-1),rt=yt?ht:0,et=yt?0:ht;if(F&&this.addCurrentVertex(z,U,rt,et,C),He==="fakeround"){const Ee=Math.round(180*Ae/Math.PI/20);for(let dt=1;dt<Ee;dt++){let ut=dt/Ee;if(ut!==.5){const Di=ut-.5;ut+=ut*Di*(ut-1)*((1.0904+ne*(ne*(3.55645-1.43519*ne)-3.2452))*Di*Di+(.848013+ne*(.215638*ne-1.06021)))}const Et=K.sub(U)._mult(ut)._add(U)._unit()._mult(yt?-1:1);this.addHalfVertex(z,Et.x,Et.y,!1,yt,0,C)}}N&&this.addCurrentVertex(z,K,-rt,-et,C)}else if(He==="butt")this.addCurrentVertex(z,ge,0,0,C);else if(He==="square"){const ht=F?1:-1;this.addCurrentVertex(z,ge,ht,ht,C)}else He==="round"&&(F&&(this.addCurrentVertex(z,U,0,0,C),this.addCurrentVertex(z,U,1,1,C,!0)),N&&(this.addCurrentVertex(z,K,-1,-1,C,!0),this.addCurrentVertex(z,K,0,0,C)));if(Ye&&ee<x-1){const ht=z.dist(N);if(ht>2*E){const rt=z.add(N.sub(z)._mult(E/ht)._round());this.updateDistance(z,rt),this.addCurrentVertex(rt,K,0,0,C),z=rt}}}}addCurrentVertex(t,r,a,c,f,m=!1){const y=r.y*c-r.x,x=-r.y-r.x*c;this.addHalfVertex(t,r.x+r.y*a,r.y-r.x*a,m,!1,a,f),this.addHalfVertex(t,y,x,m,!0,-c,f),this.distance>Wu/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,a,c,f,m))}addHalfVertex({x:t,y:r},a,c,f,m,y,x){const T=.5*(this.lineClips?this.scaledDistance*(Wu-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(f?1:0),(r<<1)+(m?1:0),Math.round(63*a)+128,Math.round(63*c)+128,1+(y===0?0:y<0?-1:1)|(63&T)<<2,T>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const E=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),x.primitiveLength++),m?this.e2=E:this.e1=E}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let ts,ui;Je("LineBucket",Xu,{omit:["layers","patternFeatures"]});var Sr={get paint(){return ui=ui||new sn({"line-opacity":new st(be.paint_line["line-opacity"]),"line-color":new st(be.paint_line["line-color"]),"line-translate":new at(be.paint_line["line-translate"]),"line-translate-anchor":new at(be.paint_line["line-translate-anchor"]),"line-width":new st(be.paint_line["line-width"]),"line-gap-width":new st(be.paint_line["line-gap-width"]),"line-offset":new st(be.paint_line["line-offset"]),"line-blur":new st(be.paint_line["line-blur"]),"line-dasharray":new rl(be.paint_line["line-dasharray"]),"line-pattern":new Wo(be.paint_line["line-pattern"]),"line-gradient":new nl(be.paint_line["line-gradient"])})},get layout(){return ts=ts||new sn({"line-cap":new at(be.layout_line["line-cap"]),"line-join":new st(be.layout_line["line-join"]),"line-miter-limit":new at(be.layout_line["line-miter-limit"]),"line-round-limit":new at(be.layout_line["line-round-limit"]),"line-sort-key":new st(be.layout_line["line-sort-key"])})}};class mr extends st{possiblyEvaluate(t,r){return r=new Dt(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,a,c){return r=Wt({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,a,c)}}let gr;class is extends e{constructor(t){super(t,Sr),this.gradientVersion=0,gr||(gr=new mr(Sr.paint.properties["line-width"].specification),gr.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(a){return a._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof Mo,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=gr.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Xu(t)}queryRadius(t){const r=t,a=dl(Kl("line-width",this,r),Kl("line-gap-width",this,r)),c=Kl("line-offset",this,r);return a/2+Math.abs(c)+Jl(this.paint.get("line-translate"))}queryIntersectsFeature(t,r,a,c,f,m,y){const x=Vu(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,y),T=y/2*dl(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),E=this.paint.get("line-offset").evaluate(r,a);return E&&(c=function(C,z){const F=[];for(let N=0;N<C.length;N++){const U=C[N],K=[];for(let ee=0;ee<U.length;ee++){const ge=U[ee-1],ne=U[ee],de=U[ee+1],ke=ee===0?new we(0,0):ne.sub(ge)._unit()._perp(),Ae=ee===U.length-1?new we(0,0):de.sub(ne)._unit()._perp(),Ye=ke._add(Ae)._unit(),yt=Ye.x*Ae.x+Ye.y*Ae.y;yt!==0&&Ye._mult(1/yt),K.push(Ye._mult(z)._add(ne))}F.push(K)}return F}(c,E*y)),function(C,z,F){for(let N=0;N<z.length;N++){const U=z[N];if(C.length>=3){for(let K=0;K<U.length;K++)if(ol(C,U[K]))return!0}if(rd(C,U,F))return!0}return!1}(x,c,T)}isTileClipped(){return!0}}function dl(i,t){return t>0?t+2*i:i}const Tr=d([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ku=d([{name:"a_projected_pos",components:3,type:"Float32"}],4);d([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const pl=d([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);d([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ju=d([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Dh=d([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Yu(i,t,r){return i.sections.forEach(a=>{a.text=function(c,f,m){const y=f.layout.get("text-transform").evaluate(m,{});return y==="uppercase"?c=c.toLocaleUpperCase():y==="lowercase"&&(c=c.toLocaleLowerCase()),nn.applyArabicShaping&&(c=nn.applyArabicShaping(c)),c}(a.text,t,r)}),i}d([{name:"triangle",components:3,type:"Uint16"}]),d([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),d([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),d([{type:"Float32",name:"offsetX"}]),d([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),d([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Lr={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Xi=24,fl=mi,_o=function(i,t,r,a,c){var f,m,y=8*c-a-1,x=(1<<y)-1,T=x>>1,E=-7,C=c-1,z=-1,F=i[t+C];for(C+=z,f=F&(1<<-E)-1,F>>=-E,E+=y;E>0;f=256*f+i[t+C],C+=z,E-=8);for(m=f&(1<<-E)-1,f>>=-E,E+=a;E>0;m=256*m+i[t+C],C+=z,E-=8);if(f===0)f=1-T;else{if(f===x)return m?NaN:1/0*(F?-1:1);m+=Math.pow(2,a),f-=T}return(F?-1:1)*m*Math.pow(2,f-a)},Qu=function(i,t,r,a,c,f){var m,y,x,T=8*f-c-1,E=(1<<T)-1,C=E>>1,z=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,F=0,N=1,U=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(y=isNaN(t)?1:0,m=E):(m=Math.floor(Math.log(t)/Math.LN2),t*(x=Math.pow(2,-m))<1&&(m--,x*=2),(t+=m+C>=1?z/x:z*Math.pow(2,1-C))*x>=2&&(m++,x/=2),m+C>=E?(y=0,m=E):m+C>=1?(y=(t*x-1)*Math.pow(2,c),m+=C):(y=t*Math.pow(2,C-1)*Math.pow(2,c),m=0));c>=8;i[r+F]=255&y,F+=N,y/=256,c-=8);for(m=m<<c|y,T+=c;T>0;i[r+F]=255&m,F+=N,m/=256,T-=8);i[r+F-N]|=128*U};function mi(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}mi.Varint=0,mi.Fixed64=1,mi.Bytes=2,mi.Fixed32=5;var yo=4294967296,ec=1/yo,Jo=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function xs(i){return i.type===mi.Bytes?i.readVarint()+i.pos:i.pos+1}function vo(i,t,r){return r?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function Vc(i,t,r){var a=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(a);for(var c=r.pos-1;c>=i;c--)r.buf[c+a]=r.buf[c]}function jc(i,t){for(var r=0;r<i.length;r++)t.writeVarint(i[r])}function Uc(i,t){for(var r=0;r<i.length;r++)t.writeSVarint(i[r])}function bn(i,t){for(var r=0;r<i.length;r++)t.writeFloat(i[r])}function za(i,t){for(var r=0;r<i.length;r++)t.writeDouble(i[r])}function qs(i,t){for(var r=0;r<i.length;r++)t.writeBoolean(i[r])}function Ln(i,t){for(var r=0;r<i.length;r++)t.writeFixed32(i[r])}function Md(i,t){for(var r=0;r<i.length;r++)t.writeSFixed32(i[r])}function Lh(i,t){for(var r=0;r<i.length;r++)t.writeFixed64(i[r])}function Rh(i,t){for(var r=0;r<i.length;r++)t.writeSFixed64(i[r])}function $c(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function rs(i,t,r){i[r]=t,i[r+1]=t>>>8,i[r+2]=t>>>16,i[r+3]=t>>>24}function Fh(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}mi.prototype={destroy:function(){this.buf=null},readFields:function(i,t,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),c=a>>3,f=this.pos;this.type=7&a,i(c,t,this),this.pos===f&&this.skip(a)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=$c(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Fh(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=$c(this.buf,this.pos)+$c(this.buf,this.pos+4)*yo;return this.pos+=8,i},readSFixed64:function(){var i=$c(this.buf,this.pos)+Fh(this.buf,this.pos+4)*yo;return this.pos+=8,i},readFloat:function(){var i=_o(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=_o(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,r,a=this.buf;return t=127&(r=a[this.pos++]),r<128?t:(t|=(127&(r=a[this.pos++]))<<7,r<128?t:(t|=(127&(r=a[this.pos++]))<<14,r<128?t:(t|=(127&(r=a[this.pos++]))<<21,r<128?t:function(c,f,m){var y,x,T=m.buf;if(y=(112&(x=T[m.pos++]))>>4,x<128||(y|=(127&(x=T[m.pos++]))<<3,x<128)||(y|=(127&(x=T[m.pos++]))<<10,x<128)||(y|=(127&(x=T[m.pos++]))<<17,x<128)||(y|=(127&(x=T[m.pos++]))<<24,x<128)||(y|=(1&(x=T[m.pos++]))<<31,x<128))return vo(c,y,f);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=a[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&Jo?function(r,a,c){return Jo.decode(r.subarray(a,c))}(this.buf,t,i):function(r,a,c){for(var f="",m=a;m<c;){var y,x,T,E=r[m],C=null,z=E>239?4:E>223?3:E>191?2:1;if(m+z>c)break;z===1?E<128&&(C=E):z===2?(192&(y=r[m+1]))==128&&(C=(31&E)<<6|63&y)<=127&&(C=null):z===3?(x=r[m+2],(192&(y=r[m+1]))==128&&(192&x)==128&&((C=(15&E)<<12|(63&y)<<6|63&x)<=2047||C>=55296&&C<=57343)&&(C=null)):z===4&&(x=r[m+2],T=r[m+3],(192&(y=r[m+1]))==128&&(192&x)==128&&(192&T)==128&&((C=(15&E)<<18|(63&y)<<12|(63&x)<<6|63&T)<=65535||C>=1114112)&&(C=null)),C===null?(C=65533,z=1):C>65535&&(C-=65536,f+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),f+=String.fromCharCode(C),m+=z}return f}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==mi.Bytes)return i.push(this.readVarint(t));var r=xs(this);for(i=i||[];this.pos<r;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==mi.Bytes)return i.push(this.readSVarint());var t=xs(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==mi.Bytes)return i.push(this.readBoolean());var t=xs(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==mi.Bytes)return i.push(this.readFloat());var t=xs(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==mi.Bytes)return i.push(this.readDouble());var t=xs(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==mi.Bytes)return i.push(this.readFixed32());var t=xs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==mi.Bytes)return i.push(this.readSFixed32());var t=xs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==mi.Bytes)return i.push(this.readFixed64());var t=xs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==mi.Bytes)return i.push(this.readSFixed64());var t=xs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===mi.Varint)for(;this.buf[this.pos++]>127;);else if(t===mi.Bytes)this.pos=this.readVarint()+this.pos;else if(t===mi.Fixed32)this.pos+=4;else{if(t!==mi.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),rs(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),rs(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),rs(this.buf,-1&i,this.pos),rs(this.buf,Math.floor(i*ec),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),rs(this.buf,-1&i,this.pos),rs(this.buf,Math.floor(i*ec),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,r){var a,c;if(t>=0?(a=t%4294967296|0,c=t/4294967296|0):(c=~(-t/4294967296),4294967295^(a=~(-t%4294967296))?a=a+1|0:(a=0,c=c+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(f,m,y){y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,f>>>=7,y.buf[y.pos++]=127&f|128,y.buf[y.pos]=127&(f>>>=7)}(a,0,r),function(f,m){var y=(7&f)<<4;m.buf[m.pos++]|=y|((f>>>=3)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f)))))}(c,r)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(a,c,f){for(var m,y,x=0;x<c.length;x++){if((m=c.charCodeAt(x))>55295&&m<57344){if(!y){m>56319||x+1===c.length?(a[f++]=239,a[f++]=191,a[f++]=189):y=m;continue}if(m<56320){a[f++]=239,a[f++]=191,a[f++]=189,y=m;continue}m=y-55296<<10|m-56320|65536,y=null}else y&&(a[f++]=239,a[f++]=191,a[f++]=189,y=null);m<128?a[f++]=m:(m<2048?a[f++]=m>>6|192:(m<65536?a[f++]=m>>12|224:(a[f++]=m>>18|240,a[f++]=m>>12&63|128),a[f++]=m>>6&63|128),a[f++]=63&m|128)}return f}(this.buf,i,this.pos);var r=this.pos-t;r>=128&&Vc(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(i){this.realloc(4),Qu(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),Qu(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=i[r]},writeRawMessage:function(i,t){this.pos++;var r=this.pos;i(t,this);var a=this.pos-r;a>=128&&Vc(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(i,t,r){this.writeTag(i,mi.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,jc,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,Uc,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,qs,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,bn,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,za,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,Ln,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,Md,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,Lh,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,Rh,t)},writeBytesField:function(i,t){this.writeTag(i,mi.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,mi.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,mi.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,mi.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,mi.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,mi.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,mi.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,mi.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,mi.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,mi.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};var tc=ze(fl);const Yo=3;function Bh(i,t,r){i===1&&r.readMessage(ml,t)}function ml(i,t,r){if(i===3){const{id:a,bitmap:c,width:f,height:m,left:y,top:x,advance:T}=r.readMessage(zd,{});t.push({id:a,bitmap:new tu({width:f+2*Yo,height:m+2*Yo},c),metrics:{width:f,height:m,left:y,top:x,advance:T}})}}function zd(i,t,r){i===1?t.id=r.readVarint():i===2?t.bitmap=r.readBytes():i===3?t.width=r.readVarint():i===4?t.height=r.readVarint():i===5?t.left=r.readSVarint():i===6?t.top=r.readSVarint():i===7&&(t.advance=r.readVarint())}const Oh=Yo;function qc(i){let t=0,r=0;for(const m of i)t+=m.w*m.h,r=Math.max(r,m.w);i.sort((m,y)=>y.h-m.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let c=0,f=0;for(const m of i)for(let y=a.length-1;y>=0;y--){const x=a[y];if(!(m.w>x.w||m.h>x.h)){if(m.x=x.x,m.y=x.y,f=Math.max(f,m.y+m.h),c=Math.max(c,m.x+m.w),m.w===x.w&&m.h===x.h){const T=a.pop();y<a.length&&(a[y]=T)}else m.h===x.h?(x.x+=m.w,x.w-=m.w):m.w===x.w?(x.y+=m.h,x.h-=m.h):(a.push({x:x.x+m.w,y:x.y,w:x.w-m.w,h:m.h}),x.y+=m.h,x.h-=m.h);break}}return{w:c,h:f,fill:t/(c*f)||0}}const Rr=1;class Nh{constructor(t,{pixelRatio:r,version:a,stretchX:c,stretchY:f,content:m,textFitWidth:y,textFitHeight:x}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=c,this.stretchY=f,this.content=m,this.version=a,this.textFitWidth=y,this.textFitHeight=x}get tl(){return[this.paddedRect.x+Rr,this.paddedRect.y+Rr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Rr,this.paddedRect.y+this.paddedRect.h-Rr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Rr)/this.pixelRatio,(this.paddedRect.h-2*Rr)/this.pixelRatio]}}class Ad{constructor(t,r){const a={},c={};this.haveRenderCallbacks=[];const f=[];this.addImages(t,a,f),this.addImages(r,c,f);const{w:m,h:y}=qc(f),x=new wn({width:m||1,height:y||1});for(const T in t){const E=t[T],C=a[T].paddedRect;wn.copy(E.data,x,{x:0,y:0},{x:C.x+Rr,y:C.y+Rr},E.data)}for(const T in r){const E=r[T],C=c[T].paddedRect,z=C.x+Rr,F=C.y+Rr,N=E.data.width,U=E.data.height;wn.copy(E.data,x,{x:0,y:0},{x:z,y:F},E.data),wn.copy(E.data,x,{x:0,y:U-1},{x:z,y:F-1},{width:N,height:1}),wn.copy(E.data,x,{x:0,y:0},{x:z,y:F+U},{width:N,height:1}),wn.copy(E.data,x,{x:N-1,y:0},{x:z-1,y:F},{width:1,height:U}),wn.copy(E.data,x,{x:0,y:0},{x:z+N,y:F},{width:1,height:U})}this.image=x,this.iconPositions=a,this.patternPositions=c}addImages(t,r,a){for(const c in t){const f=t[c],m={x:0,y:0,w:f.data.width+2*Rr,h:f.data.height+2*Rr};a.push(m),r[c]=new Nh(m,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in t.updatedImages)this.patchUpdatedImage(this.iconPositions[a],t.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],t.getImage(a),r)}patchUpdatedImage(t,r,a){if(!t||!r||t.version===r.version)return;t.version=r.version;const[c,f]=t.tl;a.update(r.data,void 0,{x:c,y:f})}}var Qo;Je("ImagePosition",Nh),Je("ImageAtlas",Ad),D.ah=void 0,(Qo=D.ah||(D.ah={}))[Qo.none=0]="none",Qo[Qo.horizontal=1]="horizontal",Qo[Qo.vertical=2]="vertical",Qo[Qo.horizontalOnly=3]="horizontalOnly";const su=-17;class Zs{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,r){const a=new Zs;return a.scale=t||1,a.fontStack=r,a}static forImage(t){const r=new Zs;return r.imageName=t,r}}class ou{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const a=new ou;for(let c=0;c<t.sections.length;c++){const f=t.sections[c];f.image?a.addImageSection(f):a.addTextSection(f,r)}return a}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let r="";for(let a=0;a<t.length;a++){const c=t.charCodeAt(a+1)||null,f=t.charCodeAt(a-1)||null;r+=c&&Gl(c)&&!Lr[t[a+1]]||f&&Gl(f)&&!Lr[t[a-1]]||!Lr[t[a]]?t[a]:Lr[t[a]]}return r}(this.text)}trim(){let t=0;for(let a=0;a<this.text.length&&ic[this.text.charCodeAt(a)];a++)t++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=t&&ic[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const a=new ou;return a.text=this.text.substring(t,r),a.sectionIndex=this.sectionIndex.slice(t,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}addTextSection(t,r){this.text+=t.text,this.sections.push(Zs.forText(t.scale,t.fontStack||r));const a=this.sections.length-1;for(let c=0;c<t.text.length;++c)this.sectionIndex.push(a)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void bi("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(Zs.forImage(r)),this.sectionIndex.push(this.sections.length-1)):bi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ea(i,t,r,a,c,f,m,y,x,T,E,C,z,F,N){const U=ou.fromFeature(i,c);let K;C===D.ah.vertical&&U.verticalizePunctuation();const{processBidirectionalText:ee,processStyledBidirectionalText:ge}=nn;if(ee&&U.sections.length===1){K=[];const ke=ee(U.toString(),$h(U,T,f,t,a,F));for(const Ae of ke){const Ye=new ou;Ye.text=Ae,Ye.sections=U.sections;for(let yt=0;yt<Ae.length;yt++)Ye.sectionIndex.push(0);K.push(Ye)}}else if(ge){K=[];const ke=ge(U.text,U.sectionIndex,$h(U,T,f,t,a,F));for(const Ae of ke){const Ye=new ou;Ye.text=Ae[0],Ye.sectionIndex=Ae[1],Ye.sections=U.sections,K.push(Ye)}}else K=function(ke,Ae){const Ye=[],yt=ke.text;let Ke=0;for(const He of Ae)Ye.push(ke.substring(Ke,He)),Ke=He;return Ke<yt.length&&Ye.push(ke.substring(Ke,yt.length)),Ye}(U,$h(U,T,f,t,a,F));const ne=[],de={positionedLines:ne,text:U.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:C,iconsInText:!1,verticalizable:!1};return function(ke,Ae,Ye,yt,Ke,He,ht,rt,et,Ee,dt,ut){let Et=0,Di=su,Ci=0,Fr=0;const wo=rt==="right"?1:rt==="left"?0:.5;let un=0;for(const tr of Ke){tr.trim();const Or=tr.getMaxScale(),Sn=(Or-1)*Xi,cn={positionedGlyphs:[],lineOffset:0};ke.positionedLines[un]=cn;const Nn=cn.positionedGlyphs;let hn=0;if(!tr.length()){Di+=He,++un;continue}for(let ss=0;ss<tr.length();ss++){const ci=tr.getSection(ss),Fi=tr.getSectionIndex(ss),Ni=tr.getCharCode(ss);let ws=0,Ki=null,th=null,Da=null,La=Xi;const bo=!(et===D.ah.horizontal||!dt&&!Sa(Ni)||dt&&(ic[Ni]||(Br=Ni,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Br)))));if(ci.imageName){const Ws=yt[ci.imageName];if(!Ws)continue;Da=ci.imageName,ke.iconsInText=ke.iconsInText||!0,th=Ws.paddedRect;const Kr=Ws.displaySize;ci.scale=ci.scale*Xi/ut,Ki={width:Kr[0],height:Kr[1],left:Rr,top:-Oh,advance:bo?Kr[1]:Kr[0]},ws=Sn+(Xi-Kr[1]*ci.scale),La=Ki.advance;const _l=bo?Kr[0]*ci.scale-Xi*Or:Kr[1]*ci.scale-Xi*Or;_l>0&&_l>hn&&(hn=_l)}else{const Ws=Ye[ci.fontStack],Kr=Ws&&Ws[Ni];if(Kr&&Kr.rect)th=Kr.rect,Ki=Kr.metrics;else{const _l=Ae[ci.fontStack],Jh=_l&&_l[Ni];if(!Jh)continue;Ki=Jh.metrics}ws=(Or-ci.scale)*Xi}bo?(ke.verticalizable=!0,Nn.push({glyph:Ni,imageName:Da,x:Et,y:Di+ws,vertical:bo,scale:ci.scale,fontStack:ci.fontStack,sectionIndex:Fi,metrics:Ki,rect:th}),Et+=La*ci.scale+Ee):(Nn.push({glyph:Ni,imageName:Da,x:Et,y:Di+ws,vertical:bo,scale:ci.scale,fontStack:ci.fontStack,sectionIndex:Fi,metrics:Ki,rect:th}),Et+=Ki.advance*ci.scale+Ee)}Nn.length!==0&&(Ci=Math.max(Et-Ee,Ci),qh(Nn,0,Nn.length-1,wo,hn)),Et=0;const Hs=He*Or+hn;cn.lineOffset=Math.max(hn,Sn),Di+=Hs,Fr=Math.max(Hs,Fr),++un}var Br;const Fn=Di-su,{horizontalAlign:Bn,verticalAlign:On}=Rn(ht);(function(tr,Or,Sn,cn,Nn,hn,Hs,ss,ci){const Fi=(Or-Sn)*Nn;let Ni=0;Ni=hn!==Hs?-ss*cn-su:(-cn*ci+.5)*Hs;for(const ws of tr)for(const Ki of ws.positionedGlyphs)Ki.x+=Fi,Ki.y+=Ni})(ke.positionedLines,wo,Bn,On,Ci,Fr,He,Fn,Ke.length),ke.top+=-On*Fn,ke.bottom=ke.top+Fn,ke.left+=-Bn*Ci,ke.right=ke.left+Ci}(de,t,r,a,K,m,y,x,C,T,z,N),!function(ke){for(const Ae of ke)if(Ae.positionedGlyphs.length!==0)return!1;return!0}(ne)&&de}const ic={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Qi={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},lp={40:!0};function Vh(i,t,r,a,c,f){if(t.imageName){const m=a[t.imageName];return m?m.displaySize[0]*t.scale*Xi/f+c:0}{const m=r[t.fontStack],y=m&&m[i];return y?y.metrics.advance*t.scale+c:0}}function Dd(i,t,r,a){const c=Math.pow(i-t,2);return a?i<t?c/2:2*c:c+Math.abs(r)*r}function up(i,t,r){let a=0;return i===10&&(a-=1e4),r&&(a+=150),i!==40&&i!==65288||(a+=50),t!==41&&t!==65289||(a+=50),a}function jh(i,t,r,a,c,f){let m=null,y=Dd(t,r,c,f);for(const x of a){const T=Dd(t-x.x,r,c,f)+x.badness;T<=y&&(m=x,y=T)}return{index:i,x:t,priorBreak:m,badness:y}}function Uh(i){return i?Uh(i.priorBreak).concat(i.index):[]}function $h(i,t,r,a,c,f){if(!i)return[];const m=[],y=function(C,z,F,N,U,K){let ee=0;for(let ge=0;ge<C.length();ge++){const ne=C.getSection(ge);ee+=Vh(C.getCharCode(ge),ne,N,U,z,K)}return ee/Math.max(1,Math.ceil(ee/F))}(i,t,r,a,c,f),x=i.text.indexOf("")>=0;let T=0;for(let C=0;C<i.length();C++){const z=i.getSection(C),F=i.getCharCode(C);if(ic[F]||(T+=Vh(F,z,a,c,t,f)),C<i.length()-1){const N=!((E=F)<11904)&&(!!Pt["CJK Compatibility Forms"](E)||!!Pt["CJK Compatibility"](E)||!!Pt["CJK Strokes"](E)||!!Pt["CJK Symbols and Punctuation"](E)||!!Pt["Enclosed CJK Letters and Months"](E)||!!Pt["Halfwidth and Fullwidth Forms"](E)||!!Pt["Ideographic Description Characters"](E)||!!Pt["Vertical Forms"](E)||zn.test(String.fromCodePoint(E)));(Qi[F]||N||z.imageName||C!==i.length()-2&&lp[i.getCharCode(C+1)])&&m.push(jh(C+1,T,y,m,up(F,i.getCharCode(C+1),N&&x),!1))}}var E;return Uh(jh(i.length(),T,y,m,0,!0))}function Rn(i){let t=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function qh(i,t,r,a,c){if(!a&&!c)return;const f=i[r],m=(i[r].x+f.metrics.advance*f.scale)*a;for(let y=t;y<=r;y++)i[y].x-=m,i[y].y+=c}function cp(i,t,r){const{horizontalAlign:a,verticalAlign:c}=Rn(r),f=t[0]-i.displaySize[0]*a,m=t[1]-i.displaySize[1]*c;return{image:i,top:m,bottom:m+i.displaySize[1],left:f,right:f+i.displaySize[0]}}function ta(i){var t,r;let a=i.left,c=i.top,f=i.right-a,m=i.bottom-c;const y=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",x=(r=i.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",T=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(x==="proportional"){if(y==="stretchOnly"&&f/m<T||y==="proportional"){const E=Math.ceil(m*T);a*=E/f,f=E}}else if(y==="proportional"&&x==="stretchOnly"&&T!==0&&f/m>T){const E=Math.ceil(f/T);c*=E/m,m=E}return{x1:a,y1:c,x2:a+f,y2:c+m}}function rc(i,t,r,a,c,f){const m=i.image;let y;if(m.content){const K=m.content,ee=m.pixelRatio||1;y=[K[0]/ee,K[1]/ee,m.displaySize[0]-K[2]/ee,m.displaySize[1]-K[3]/ee]}const x=t.left*f,T=t.right*f;let E,C,z,F;r==="width"||r==="both"?(F=c[0]+x-a[3],C=c[0]+T+a[1]):(F=c[0]+(x+T-m.displaySize[0])/2,C=F+m.displaySize[0]);const N=t.top*f,U=t.bottom*f;return r==="height"||r==="both"?(E=c[1]+N-a[0],z=c[1]+U+a[2]):(E=c[1]+(N+U-m.displaySize[1])/2,z=E+m.displaySize[1]),{image:m,top:E,right:C,bottom:z,left:F,collisionPadding:y}}const Gs=255,ns=128,xo=Gs*ns;function Zc(i,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Dt(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:c}=r;let f=0;for(;f<a.length&&a[f]<=i;)f++;f=Math.max(0,f-1);let m=f;for(;m<a.length&&a[m]<i+1;)m++;m=Math.min(a.length-1,m);const y=a[f],x=a[m];return r.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:x,interpolationType:c}:{kind:"camera",minZoom:y,maxZoom:x,minSize:r.evaluate(new Dt(y)),maxSize:r.evaluate(new Dt(x)),interpolationType:c}}}function Zh(i,t,r){let a="never";const c=i.get(t);return c?a=c:i.get(r)&&(a="always"),a}const Gh=Wi.VectorTileFeature.types,hp=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function nc(i,t,r,a,c,f,m,y,x,T,E,C,z){const F=y?Math.min(xo,Math.round(y[0])):0,N=y?Math.min(xo,Math.round(y[1])):0;i.emplaceBack(t,r,Math.round(32*a),Math.round(32*c),f,m,(F<<1)+(x?1:0),N,16*T,16*E,256*C,256*z)}function Gc(i,t,r){i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r)}function Hc(i){for(const t of i.sections)if(zi(t.text))return!0;return!1}class au{constructor(t){this.layoutVertexArray=new fo,this.indexArray=new Ar,this.programConfigurations=t,this.segments=new ai,this.dynamicLayoutVertexArray=new An,this.opacityVertexArray=new _s,this.hasVisibleVertices=!1,this.placedSymbolArray=new bt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,a,c){this.isEmpty()||(a&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Tr.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Ku.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,hp,!0),this.opacityVertexBuffer.itemSize=1),(a||c)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Je("SymbolBuffers",au);class Wc{constructor(t,r,a){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new a,this.segments=new ai,this.collisionVertexArray=new Dn}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,pl.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Je("CollisionBuffers",Wc);class Aa{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(m=>m.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=yh([]),this.placementViewportMatrix=yh([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Zc(this.zoom,r["text-size"]),this.iconSizeData=Zc(this.zoom,r["icon-size"]);const a=this.layers[0].layout,c=a.get("symbol-sort-key"),f=a.get("symbol-z-order");this.canOverlap=Zh(a,"text-overlap","text-allow-overlap")!=="never"||Zh(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(m=>D.ah[m])),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=t.sourceID}createArrays(){this.text=new au(new Dr(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new au(new Dr(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Vt,this.lineVertexArray=new Ti,this.symbolInstances=new Mt,this.textAnchorOffsets=new vn}calculateGlyphDependencies(t,r,a,c,f){for(let m=0;m<t.length;m++)if(r[t.charCodeAt(m)]=!0,(a||c)&&f){const y=Lr[t.charAt(m)];y&&(r[y.charCodeAt(0)]=!0)}}populate(t,r,a){const c=this.layers[0],f=c.layout,m=f.get("text-font"),y=f.get("text-field"),x=f.get("icon-image"),T=(y.value.kind!=="constant"||y.value.value instanceof Yr&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),E=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,C=f.get("symbol-sort-key");if(this.features=[],!T&&!E)return;const z=r.iconDependencies,F=r.glyphDependencies,N=r.availableImages,U=new Dt(this.zoom);for(const{feature:K,id:ee,index:ge,sourceLayerIndex:ne}of t){const de=c._featureFilter.needGeometry,ke=Ca(K,de);if(!c._featureFilter.filter(U,ke,a))continue;let Ae,Ye;if(de||(ke.geometry=Ea(K)),T){const Ke=c.getValueAndResolveTokens("text-field",ke,a,N),He=Yr.factory(Ke),ht=this.hasRTLText=this.hasRTLText||Hc(He);(!ht||nn.getRTLTextPluginStatus()==="unavailable"||ht&&nn.isParsed())&&(Ae=Yu(He,c,ke))}if(E){const Ke=c.getValueAndResolveTokens("icon-image",ke,a,N);Ye=Ke instanceof Pr?Ke:Pr.fromString(Ke)}if(!Ae&&!Ye)continue;const yt=this.sortFeaturesByKey?C.evaluate(ke,{},a):void 0;if(this.features.push({id:ee,text:Ae,icon:Ye,index:ge,sourceLayerIndex:ne,geometry:ke.geometry,properties:K.properties,type:Gh[K.type],sortKey:yt}),Ye&&(z[Ye.name]=!0),Ae){const Ke=m.evaluate(ke,{},a).join(","),He=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(D.ah.vertical)>=0;for(const ht of Ae.sections)if(ht.image)z[ht.image.name]=!0;else{const rt=Qa(Ae.toString()),et=ht.fontStack||Ke,Ee=F[et]=F[et]||{};this.calculateGlyphDependencies(ht.text,Ee,He,this.allowVerticalPlacement,rt)}}}f.get("symbol-placement")==="line"&&(this.features=function(K){const ee={},ge={},ne=[];let de=0;function ke(Ke){ne.push(K[Ke]),de++}function Ae(Ke,He,ht){const rt=ge[Ke];return delete ge[Ke],ge[He]=rt,ne[rt].geometry[0].pop(),ne[rt].geometry[0]=ne[rt].geometry[0].concat(ht[0]),rt}function Ye(Ke,He,ht){const rt=ee[He];return delete ee[He],ee[Ke]=rt,ne[rt].geometry[0].shift(),ne[rt].geometry[0]=ht[0].concat(ne[rt].geometry[0]),rt}function yt(Ke,He,ht){const rt=ht?He[0][He[0].length-1]:He[0][0];return`${Ke}:${rt.x}:${rt.y}`}for(let Ke=0;Ke<K.length;Ke++){const He=K[Ke],ht=He.geometry,rt=He.text?He.text.toString():null;if(!rt){ke(Ke);continue}const et=yt(rt,ht),Ee=yt(rt,ht,!0);if(et in ge&&Ee in ee&&ge[et]!==ee[Ee]){const dt=Ye(et,Ee,ht),ut=Ae(et,Ee,ne[dt].geometry);delete ee[et],delete ge[Ee],ge[yt(rt,ne[ut].geometry,!0)]=ut,ne[dt].geometry=null}else et in ge?Ae(et,Ee,ht):Ee in ee?Ye(et,Ee,ht):(ke(Ke),ee[et]=de-1,ge[Ee]=de-1)}return ne.filter(Ke=>Ke.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((K,ee)=>K.sortKey-ee.sortKey)}update(t,r,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,a),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const a=this.lineVertexArray.length;if(t.segment!==void 0){let c=t.dist(r[t.segment+1]),f=t.dist(r[t.segment]);const m={};for(let y=t.segment+1;y<r.length;y++)m[y]={x:r[y].x,y:r[y].y,tileUnitDistanceFromAnchor:c},y<r.length-1&&(c+=r[y+1].dist(r[y]));for(let y=t.segment||0;y>=0;y--)m[y]={x:r[y].x,y:r[y].y,tileUnitDistanceFromAnchor:f},y>0&&(f+=r[y-1].dist(r[y]));for(let y=0;y<r.length;y++){const x=m[y];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(t,r,a,c,f,m,y,x,T,E,C,z){const F=t.indexArray,N=t.layoutVertexArray,U=t.segments.prepareSegment(4*r.length,N,F,this.canOverlap?m.sortKey:void 0),K=this.glyphOffsetArray.length,ee=U.vertexLength,ge=this.allowVerticalPlacement&&y===D.ah.vertical?Math.PI/2:0,ne=m.text&&m.text.sections;for(let de=0;de<r.length;de++){const{tl:ke,tr:Ae,bl:Ye,br:yt,tex:Ke,pixelOffsetTL:He,pixelOffsetBR:ht,minFontScaleX:rt,minFontScaleY:et,glyphOffset:Ee,isSDF:dt,sectionIndex:ut}=r[de],Et=U.vertexLength,Di=Ee[1];nc(N,x.x,x.y,ke.x,Di+ke.y,Ke.x,Ke.y,a,dt,He.x,He.y,rt,et),nc(N,x.x,x.y,Ae.x,Di+Ae.y,Ke.x+Ke.w,Ke.y,a,dt,ht.x,He.y,rt,et),nc(N,x.x,x.y,Ye.x,Di+Ye.y,Ke.x,Ke.y+Ke.h,a,dt,He.x,ht.y,rt,et),nc(N,x.x,x.y,yt.x,Di+yt.y,Ke.x+Ke.w,Ke.y+Ke.h,a,dt,ht.x,ht.y,rt,et),Gc(t.dynamicLayoutVertexArray,x,ge),F.emplaceBack(Et,Et+1,Et+2),F.emplaceBack(Et+1,Et+2,Et+3),U.vertexLength+=4,U.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ee[0]),de!==r.length-1&&ut===r[de+1].sectionIndex||t.programConfigurations.populatePaintArrays(N.length,m,m.index,{},z,ne&&ne[ut])}t.placedSymbolArray.emplaceBack(x.x,x.y,K,this.glyphOffsetArray.length-K,ee,T,E,x.segment,a?a[0]:0,a?a[1]:0,c[0],c[1],y,0,!1,0,C)}_addCollisionDebugVertex(t,r,a,c,f,m){return r.emplaceBack(0,0),t.emplaceBack(a.x,a.y,c,f,Math.round(m.x),Math.round(m.y))}addCollisionDebugVertices(t,r,a,c,f,m,y){const x=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),T=x.vertexLength,E=f.layoutVertexArray,C=f.collisionVertexArray,z=y.anchorX,F=y.anchorY;this._addCollisionDebugVertex(E,C,m,z,F,new we(t,r)),this._addCollisionDebugVertex(E,C,m,z,F,new we(a,r)),this._addCollisionDebugVertex(E,C,m,z,F,new we(a,c)),this._addCollisionDebugVertex(E,C,m,z,F,new we(t,c)),x.vertexLength+=4;const N=f.indexArray;N.emplaceBack(T,T+1),N.emplaceBack(T+1,T+2),N.emplaceBack(T+2,T+3),N.emplaceBack(T+3,T),x.primitiveLength+=4}addDebugCollisionBoxes(t,r,a,c){for(let f=t;f<r;f++){const m=this.collisionBoxArray.get(f);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,c?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Wc(zr,Ju.members,Rs),this.iconCollisionBox=new Wc(zr,Ju.members,Rs);for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,a,c,f,m,y,x,T){const E={};for(let C=r;C<a;C++){const z=t.get(C);E.textBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},E.textFeatureIndex=z.featureIndex;break}for(let C=c;C<f;C++){const z=t.get(C);E.verticalTextBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},E.verticalTextFeatureIndex=z.featureIndex;break}for(let C=m;C<y;C++){const z=t.get(C);E.iconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},E.iconFeatureIndex=z.featureIndex;break}for(let C=x;C<T;C++){const z=t.get(C);E.verticalIconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},E.verticalIconFeatureIndex=z.featureIndex;break}return E}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const a=t.placedSymbolArray.get(r),c=a.vertexStartIndex+4*a.numGlyphs;for(let f=a.vertexStartIndex;f<c;f+=4)t.indexArray.emplaceBack(f,f+1,f+2),t.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),a=Math.cos(t),c=[],f=[],m=[];for(let y=0;y<this.symbolInstances.length;++y){m.push(y);const x=this.symbolInstances.get(y);c.push(0|Math.round(r*x.anchorX+a*x.anchorY)),f.push(x.featureIndex)}return m.sort((y,x)=>c[y]-c[x]||f[x]-f[y]),m}addToSortKeyRanges(t,r){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((c,f,m)=>{c>=0&&m.indexOf(c)===f&&this.addIndicesForPlacedSymbol(this.text,c)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Hh,Xc;Je("SymbolBucket",Aa,{omit:["layers","collisionBoxArray","features","compareText"]}),Aa.MAX_GLYPHS=65535,Aa.addDynamicAttributes=Gc;var lu={get paint(){return Xc=Xc||new sn({"icon-opacity":new st(be.paint_symbol["icon-opacity"]),"icon-color":new st(be.paint_symbol["icon-color"]),"icon-halo-color":new st(be.paint_symbol["icon-halo-color"]),"icon-halo-width":new st(be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new st(be.paint_symbol["icon-halo-blur"]),"icon-translate":new at(be.paint_symbol["icon-translate"]),"icon-translate-anchor":new at(be.paint_symbol["icon-translate-anchor"]),"text-opacity":new st(be.paint_symbol["text-opacity"]),"text-color":new st(be.paint_symbol["text-color"],{runtimeType:Er,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new st(be.paint_symbol["text-halo-color"]),"text-halo-width":new st(be.paint_symbol["text-halo-width"]),"text-halo-blur":new st(be.paint_symbol["text-halo-blur"]),"text-translate":new at(be.paint_symbol["text-translate"]),"text-translate-anchor":new at(be.paint_symbol["text-translate-anchor"])})},get layout(){return Hh=Hh||new sn({"symbol-placement":new at(be.layout_symbol["symbol-placement"]),"symbol-spacing":new at(be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new at(be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new st(be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new at(be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new at(be.layout_symbol["icon-allow-overlap"]),"icon-overlap":new at(be.layout_symbol["icon-overlap"]),"icon-ignore-placement":new at(be.layout_symbol["icon-ignore-placement"]),"icon-optional":new at(be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new at(be.layout_symbol["icon-rotation-alignment"]),"icon-size":new st(be.layout_symbol["icon-size"]),"icon-text-fit":new at(be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new at(be.layout_symbol["icon-text-fit-padding"]),"icon-image":new st(be.layout_symbol["icon-image"]),"icon-rotate":new st(be.layout_symbol["icon-rotate"]),"icon-padding":new st(be.layout_symbol["icon-padding"]),"icon-keep-upright":new at(be.layout_symbol["icon-keep-upright"]),"icon-offset":new st(be.layout_symbol["icon-offset"]),"icon-anchor":new st(be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new at(be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new at(be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new at(be.layout_symbol["text-rotation-alignment"]),"text-field":new st(be.layout_symbol["text-field"]),"text-font":new st(be.layout_symbol["text-font"]),"text-size":new st(be.layout_symbol["text-size"]),"text-max-width":new st(be.layout_symbol["text-max-width"]),"text-line-height":new at(be.layout_symbol["text-line-height"]),"text-letter-spacing":new st(be.layout_symbol["text-letter-spacing"]),"text-justify":new st(be.layout_symbol["text-justify"]),"text-radial-offset":new st(be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new at(be.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new st(be.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new st(be.layout_symbol["text-anchor"]),"text-max-angle":new at(be.layout_symbol["text-max-angle"]),"text-writing-mode":new at(be.layout_symbol["text-writing-mode"]),"text-rotate":new st(be.layout_symbol["text-rotate"]),"text-padding":new at(be.layout_symbol["text-padding"]),"text-keep-upright":new at(be.layout_symbol["text-keep-upright"]),"text-transform":new st(be.layout_symbol["text-transform"]),"text-offset":new st(be.layout_symbol["text-offset"]),"text-allow-overlap":new at(be.layout_symbol["text-allow-overlap"]),"text-overlap":new at(be.layout_symbol["text-overlap"]),"text-ignore-placement":new at(be.layout_symbol["text-ignore-placement"]),"text-optional":new at(be.layout_symbol["text-optional"])})}};class Kc{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Qs,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Je("FormatSectionOverride",Kc,{omit:["defaultValue"]});class gl extends e{constructor(t){super(t,lu)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const c=[];for(const f of a)c.indexOf(f)<0&&c.push(f);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,a,c){const f=this.layout.get(t).evaluate(r,{},a,c),m=this._unevaluatedLayout._values[t];return m.isDataDriven()||Zr(m.value)||!f?f:function(y,x){return x.replace(/{([^{}]+)}/g,(T,E)=>y&&E in y?String(y[E]):"")}(r.properties,f)}createBucket(t){return new Aa(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of lu.paint.overridableProperties){if(!gl.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),a=new Kc(r),c=new Rl(a,r.property.specification);let f=null;f=r.value.kind==="constant"||r.value.kind==="source"?new ga("source",c):new No("composite",c,r.value.zoomStops),this.paint._values[t]=new Hr(r.property,f,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&gl.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const a=t.get("text-field"),c=lu.paint.properties[r];let f=!1;const m=y=>{for(const x of y)if(c.overrides&&c.overrides.hasOverride(x))return void(f=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Yr)m(a.value.value.sections);else if(a.value.kind==="source"){const y=T=>{f||(T instanceof $n&&xi(T.value)===Un?m(T.value.sections):T instanceof zo?m(T.sections):T.eachChild(y))},x=a.value;x._styleExpression&&y(x._styleExpression.expression)}return f}}let Wh;var dp={get paint(){return Wh=Wh||new sn({"background-color":new at(be.paint_background["background-color"]),"background-pattern":new rl(be.paint_background["background-pattern"]),"background-opacity":new at(be.paint_background["background-opacity"])})}};class Jc extends e{constructor(t){super(t,dp)}}let Ld;var sc={get paint(){return Ld=Ld||new sn({"raster-opacity":new at(be.paint_raster["raster-opacity"]),"raster-hue-rotate":new at(be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new at(be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new at(be.paint_raster["raster-brightness-max"]),"raster-saturation":new at(be.paint_raster["raster-saturation"]),"raster-contrast":new at(be.paint_raster["raster-contrast"]),"raster-resampling":new at(be.paint_raster["raster-resampling"]),"raster-fade-duration":new at(be.paint_raster["raster-fade-duration"])})}};class pp extends e{constructor(t){super(t,sc)}}class Yc extends e{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class n{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const o=63710088e-1;class h{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new h(Gt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,a=this.lat*r,c=t.lat*r,f=Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos((t.lng-this.lng)*r);return o*Math.acos(Math.min(f,1))}static convert(t){if(t instanceof h)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new h(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new h(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const _=2*Math.PI*o;function b(i){return _*Math.cos(i*Math.PI/180)}function k(i){return(180+i)/360}function O(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Q(i,t){return i/b(t)}function se(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Se{constructor(t,r,a=0){this.x=+t,this.y=+r,this.z=+a}static fromLngLat(t,r=0){const a=h.convert(t);return new Se(k(a.lng),O(a.lat),Q(r,a.lat))}toLngLat(){return new h(360*this.x-180,se(this.y))}toAltitude(){return this.z*b(se(this.y))}meterInMercatorCoordinateUnits(){return 1/_*(t=se(this.y),1/Math.cos(t*Math.PI/180));var t}}function Re(i,t,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[i*a-2*Math.PI*6378137/2,t*a-2*Math.PI*6378137/2]}class Be{constructor(t,r,a){if(!function(c,f,m){return!(c<0||c>25||m<0||m>=Math.pow(2,c)||f<0||f>=Math.pow(2,c))}(t,r,a))throw new Error(`x=${r}, y=${a}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=a,this.key=lt(0,t,t,r,a)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,a){const c=(m=this.y,y=this.z,x=Re(256*(f=this.x),256*(m=Math.pow(2,y)-m-1),y),T=Re(256*(f+1),256*(m+1),y),x[0]+","+x[1]+","+T[0]+","+T[1]);var f,m,y,x,T;const E=function(C,z,F){let N,U="";for(let K=C;K>0;K--)N=1<<K-1,U+=(z&N?1:0)+(F&N?2:0);return U}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,E).replace(/{bbox-epsg-3857}/g,c)}isChildOf(t){const r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){const r=Math.pow(2,this.z);return new we((t.x*r-this.x)*$i,(t.y*r-this.y)*$i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class De{constructor(t,r){this.wrap=t,this.canonical=r,this.key=lt(t,r.z,r.z,r.x,r.y)}}class Xe{constructor(t,r,a,c,f){if(t<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${a}`);this.overscaledZ=t,this.wrap=r,this.canonical=new Be(a,+c,+f),this.key=lt(r,t,a,c,f)}clone(){return new Xe(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-t;return t>this.canonical.z?new Xe(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Xe(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-t;return t>this.canonical.z?lt(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):lt(this.wrap*+r,t,t,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new Xe(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,a=2*this.canonical.x,c=2*this.canonical.y;return[new Xe(r,this.wrap,r,a,c),new Xe(r,this.wrap,r,a+1,c),new Xe(r,this.wrap,r,a,c+1),new Xe(r,this.wrap,r,a+1,c+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Xe(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Xe(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new De(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Se(t.x-this.wrap,t.y))}}function lt(i,t,r,a,c){(i*=2)<0&&(i=-1*i-1);const f=1<<r;return(f*f*i+f*c+a).toString(36)+r.toString(36)+t.toString(36)}Je("CanonicalTileID",Be),Je("OverscaledTileID",Xe,{omit:["posMatrix"]});class ft{constructor(t,r,a,c=1,f=1,m=1,y=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&!["mapbox","terrarium","custom"].includes(a))return void bi(`"${a}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const x=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),a){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=c,this.greenFactor=f,this.blueFactor=m,this.baseShift=y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let T=0;T<x;T++)this.data[this._idx(-1,T)]=this.data[this._idx(0,T)],this.data[this._idx(x,T)]=this.data[this._idx(x-1,T)],this.data[this._idx(T,-1)]=this.data[this._idx(T,0)],this.data[this._idx(T,x)]=this.data[this._idx(T,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let T=0;T<x;T++)for(let E=0;E<x;E++){const C=this.get(T,E);C>this.max&&(this.max=C),C<this.min&&(this.min=C)}}get(t,r){const a=new Uint8Array(this.data.buffer),c=4*this._idx(t,r);return this.unpack(a[c],a[c+1],a[c+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,a){return t*this.redFactor+r*this.greenFactor+a*this.blueFactor-this.baseShift}getPixels(){return new wn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,a){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let c=r*this.dim,f=r*this.dim+this.dim,m=a*this.dim,y=a*this.dim+this.dim;switch(r){case-1:c=f-1;break;case 1:f=c+1}switch(a){case-1:m=y-1;break;case 1:y=m+1}const x=-r*this.dim,T=-a*this.dim;for(let E=m;E<y;E++)for(let C=c;C<f;C++)this.data[this._idx(C,E)]=t.data[this._idx(C+x,E+T)]}}Je("DEMData",ft);class er{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const a=t[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class ye{constructor(t,r,a,c,f){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=a,t._y=c,this.properties=t.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class ue{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new qo($i,16,0),this.grid3D=new qo($i,16,0),this.featureIndexArray=new or,this.promoteId=r}insert(t,r,a,c,f,m){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,c,f);const x=m?this.grid3D:this.grid;for(let T=0;T<r.length;T++){const E=r[T],C=[1/0,1/0,-1/0,-1/0];for(let z=0;z<E.length;z++){const F=E[z];C[0]=Math.min(C[0],F.x),C[1]=Math.min(C[1],F.y),C[2]=Math.max(C[2],F.x),C[3]=Math.max(C[3],F.y)}C[0]<$i&&C[1]<$i&&C[2]>=0&&C[3]>=0&&x.insert(y,C[0],C[1],C[2],C[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Wi.VectorTile(new tc(this.rawTileData)).layers,this.sourceLayerCoder=new er(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,a,c){this.loadVTLayers();const f=t.params||{},m=$i/t.tileSize/t.scale,y=Hn(f.filter),x=t.queryGeometry,T=t.queryPadding*m,E=qe(x),C=this.grid.query(E.minX-T,E.minY-T,E.maxX+T,E.maxY+T),z=qe(t.cameraQueryGeometry),F=this.grid3D.query(z.minX-T,z.minY-T,z.maxX+T,z.maxY+T,(K,ee,ge,ne)=>function(de,ke,Ae,Ye,yt){for(const He of de)if(ke<=He.x&&Ae<=He.y&&Ye>=He.x&&yt>=He.y)return!0;const Ke=[new we(ke,Ae),new we(ke,yt),new we(Ye,yt),new we(Ye,Ae)];if(de.length>2){for(const He of Ke)if(ol(de,He))return!0}for(let He=0;He<de.length-1;He++)if(nd(de[He],de[He+1],Ke))return!0;return!1}(t.cameraQueryGeometry,K-T,ee-T,ge+T,ne+T));for(const K of F)C.push(K);C.sort(gt);const N={};let U;for(let K=0;K<C.length;K++){const ee=C[K];if(ee===U)continue;U=ee;const ge=this.featureIndexArray.get(ee);let ne=null;this.loadMatchingFeature(N,ge.bucketIndex,ge.sourceLayerIndex,ge.featureIndex,y,f.layers,f.availableImages,r,a,c,(de,ke,Ae)=>(ne||(ne=Ea(de)),ke.queryIntersectsFeature(x,de,Ae,ne,this.z,t.transform,m,t.pixelPosMatrix)))}return N}loadMatchingFeature(t,r,a,c,f,m,y,x,T,E,C){const z=this.bucketLayerIDs[r];if(m&&!function(K,ee){for(let ge=0;ge<K.length;ge++)if(ee.indexOf(K[ge])>=0)return!0;return!1}(m,z))return;const F=this.sourceLayerCoder.decode(a),N=this.vtLayers[F].feature(c);if(f.needGeometry){const K=Ca(N,!0);if(!f.filter(new Dt(this.tileID.overscaledZ),K,this.tileID.canonical))return}else if(!f.filter(new Dt(this.tileID.overscaledZ),N))return;const U=this.getId(N,F);for(let K=0;K<z.length;K++){const ee=z[K];if(m&&m.indexOf(ee)<0)continue;const ge=x[ee];if(!ge)continue;let ne={};U&&E&&(ne=E.getState(ge.sourceLayer||"_geojsonTileLayer",U));const de=Wt({},T[ee]);de.paint=xe(de.paint,ge.paint,N,ne,y),de.layout=xe(de.layout,ge.layout,N,ne,y);const ke=!C||C(N,ge,ne);if(!ke)continue;const Ae=new ye(N,this.z,this.x,this.y,U);Ae.layer=de;let Ye=t[ee];Ye===void 0&&(Ye=t[ee]=[]),Ye.push({featureIndex:c,feature:Ae,intersectionZ:ke})}}lookupSymbolFeatures(t,r,a,c,f,m,y,x){const T={};this.loadVTLayers();const E=Hn(f);for(const C of t)this.loadMatchingFeature(T,a,c,C,E,m,y,x,r);return T}hasLayer(t){for(const r of this.bucketLayerIDs)for(const a of r)if(t===a)return!0;return!1}getId(t,r){let a=t.id;return this.promoteId&&(a=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof a=="boolean"&&(a=Number(a))),a}}function xe(i,t,r,a,c){return Ji(i,(f,m)=>{const y=t instanceof Ho?t.get(m):null;return y&&y.evaluate?y.evaluate(r,a,c):y})}function qe(i){let t=1/0,r=1/0,a=-1/0,c=-1/0;for(const f of i)t=Math.min(t,f.x),r=Math.min(r,f.y),a=Math.max(a,f.x),c=Math.max(c,f.y);return{minX:t,minY:r,maxX:a,maxY:c}}function gt(i,t){return t-i}function Tt(i,t,r,a,c){const f=[];for(let m=0;m<i.length;m++){const y=i[m];let x;for(let T=0;T<y.length-1;T++){let E=y[T],C=y[T+1];E.x<t&&C.x<t||(E.x<t?E=new we(t,E.y+(t-E.x)/(C.x-E.x)*(C.y-E.y))._round():C.x<t&&(C=new we(t,E.y+(t-E.x)/(C.x-E.x)*(C.y-E.y))._round()),E.y<r&&C.y<r||(E.y<r?E=new we(E.x+(r-E.y)/(C.y-E.y)*(C.x-E.x),r)._round():C.y<r&&(C=new we(E.x+(r-E.y)/(C.y-E.y)*(C.x-E.x),r)._round()),E.x>=a&&C.x>=a||(E.x>=a?E=new we(a,E.y+(a-E.x)/(C.x-E.x)*(C.y-E.y))._round():C.x>=a&&(C=new we(a,E.y+(a-E.x)/(C.x-E.x)*(C.y-E.y))._round()),E.y>=c&&C.y>=c||(E.y>=c?E=new we(E.x+(c-E.y)/(C.y-E.y)*(C.x-E.x),c)._round():C.y>=c&&(C=new we(E.x+(c-E.y)/(C.y-E.y)*(C.x-E.x),c)._round()),x&&E.equals(x[x.length-1])||(x=[E],f.push(x)),x.push(C)))))}}return f}Je("FeatureIndex",ue,{omit:["rawTileData","sourceLayerCoder"]});class _t extends we{constructor(t,r,a,c){super(t,r),this.angle=a,c!==void 0&&(this.segment=c)}clone(){return new _t(this.x,this.y,this.angle,this.segment)}}function Lt(i,t,r,a,c){if(t.segment===void 0||r===0)return!0;let f=t,m=t.segment+1,y=0;for(;y>-r/2;){if(m--,m<0)return!1;y-=i[m].dist(f),f=i[m]}y+=i[m].dist(i[m+1]),m++;const x=[];let T=0;for(;y<r/2;){const E=i[m],C=i[m+1];if(!C)return!1;let z=i[m-1].angleTo(E)-E.angleTo(C);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:y,angleDelta:z}),T+=z;y-x[0].distance>a;)T-=x.shift().angleDelta;if(T>c)return!1;m++,y+=E.dist(C)}return!0}function kr(i){let t=0;for(let r=0;r<i.length-1;r++)t+=i[r].dist(i[r+1]);return t}function gi(i,t,r){return i?.6*t*r:0}function ia(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function fp(i,t,r,a,c,f){const m=gi(r,c,f),y=ia(r,a)*f;let x=0;const T=kr(i)/2;for(let E=0;E<i.length-1;E++){const C=i[E],z=i[E+1],F=C.dist(z);if(x+F>T){const N=(T-x)/F,U=Gi.number(C.x,z.x,N),K=Gi.number(C.y,z.y,N),ee=new _t(U,K,z.angleTo(C),E);return ee._round(),!m||Lt(i,ee,y,m,t)?ee:void 0}x+=F}}function Yf(i,t,r,a,c,f,m,y,x){const T=gi(a,f,m),E=ia(a,c),C=E*m,z=i[0].x===0||i[0].x===x||i[0].y===0||i[0].y===x;return t-C<t/4&&(t=C+t/4),Xp(i,z?t/2*y%t:(E/2+2*f)*m*y%t,t,T,r,C,z,!1,x)}function Xp(i,t,r,a,c,f,m,y,x){const T=f/2,E=kr(i);let C=0,z=t-r,F=[];for(let N=0;N<i.length-1;N++){const U=i[N],K=i[N+1],ee=U.dist(K),ge=K.angleTo(U);for(;z+r<C+ee;){z+=r;const ne=(z-C)/ee,de=Gi.number(U.x,K.x,ne),ke=Gi.number(U.y,K.y,ne);if(de>=0&&de<x&&ke>=0&&ke<x&&z-T>=0&&z+T<=E){const Ae=new _t(de,ke,ge,N);Ae._round(),a&&!Lt(i,Ae,f,a,c)||F.push(Ae)}}C+=ee}return y||F.length||m||(F=Xp(i,C/2,r,a,c,f,m,!0,x)),F}Je("Anchor",_t);const Qc=Rr;function Kp(i,t,r,a){const c=[],f=i.image,m=f.pixelRatio,y=f.paddedRect.w-2*Qc,x=f.paddedRect.h-2*Qc;let T={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const E=f.stretchX||[[0,y]],C=f.stretchY||[[0,x]],z=(Ee,dt)=>Ee+dt[1]-dt[0],F=E.reduce(z,0),N=C.reduce(z,0),U=y-F,K=x-N;let ee=0,ge=F,ne=0,de=N,ke=0,Ae=U,Ye=0,yt=K;if(f.content&&a){const Ee=f.content,dt=Ee[2]-Ee[0],ut=Ee[3]-Ee[1];(f.textFitWidth||f.textFitHeight)&&(T=ta(i)),ee=Rd(E,0,Ee[0]),ne=Rd(C,0,Ee[1]),ge=Rd(E,Ee[0],Ee[2]),de=Rd(C,Ee[1],Ee[3]),ke=Ee[0]-ee,Ye=Ee[1]-ne,Ae=dt-ge,yt=ut-de}const Ke=T.x1,He=T.y1,ht=T.x2-Ke,rt=T.y2-He,et=(Ee,dt,ut,Et)=>{const Di=Fd(Ee.stretch-ee,ge,ht,Ke),Ci=Bd(Ee.fixed-ke,Ae,Ee.stretch,F),Fr=Fd(dt.stretch-ne,de,rt,He),wo=Bd(dt.fixed-Ye,yt,dt.stretch,N),un=Fd(ut.stretch-ee,ge,ht,Ke),Br=Bd(ut.fixed-ke,Ae,ut.stretch,F),Fn=Fd(Et.stretch-ne,de,rt,He),Bn=Bd(Et.fixed-Ye,yt,Et.stretch,N),On=new we(Di,Fr),tr=new we(un,Fr),Or=new we(un,Fn),Sn=new we(Di,Fn),cn=new we(Ci/m,wo/m),Nn=new we(Br/m,Bn/m),hn=t*Math.PI/180;if(hn){const ci=Math.sin(hn),Fi=Math.cos(hn),Ni=[Fi,-ci,ci,Fi];On._matMult(Ni),tr._matMult(Ni),Sn._matMult(Ni),Or._matMult(Ni)}const Hs=Ee.stretch+Ee.fixed,ss=dt.stretch+dt.fixed;return{tl:On,tr,bl:Sn,br:Or,tex:{x:f.paddedRect.x+Qc+Hs,y:f.paddedRect.y+Qc+ss,w:ut.stretch+ut.fixed-Hs,h:Et.stretch+Et.fixed-ss},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:cn,pixelOffsetBR:Nn,minFontScaleX:Ae/m/ht,minFontScaleY:yt/m/rt,isSDF:r}};if(a&&(f.stretchX||f.stretchY)){const Ee=Jp(E,U,F),dt=Jp(C,K,N);for(let ut=0;ut<Ee.length-1;ut++){const Et=Ee[ut],Di=Ee[ut+1];for(let Ci=0;Ci<dt.length-1;Ci++)c.push(et(Et,dt[Ci],Di,dt[Ci+1]))}}else c.push(et({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:x+1}));return c}function Rd(i,t,r){let a=0;for(const c of i)a+=Math.max(t,Math.min(r,c[1]))-Math.max(t,Math.min(r,c[0]));return a}function Jp(i,t,r){const a=[{fixed:-Qc,stretch:0}];for(const[c,f]of i){const m=a[a.length-1];a.push({fixed:c-m.stretch,stretch:m.stretch}),a.push({fixed:c-m.stretch,stretch:m.stretch+(f-c)})}return a.push({fixed:t+Qc,stretch:r}),a}function Fd(i,t,r,a){return i/t*r+a}function Bd(i,t,r,a){return i-t*r/a}class Od{constructor(t,r,a,c,f,m,y,x,T,E){var C;if(this.boxStartIndex=t.length,T){let z=m.top,F=m.bottom;const N=m.collisionPadding;N&&(z-=N[1],F+=N[3]);let U=F-z;U>0&&(U=Math.max(10,U),this.circleDiameter=U)}else{const z=!((C=m.image)===null||C===void 0)&&C.content&&(m.image.textFitWidth||m.image.textFitHeight)?ta(m):{x1:m.left,y1:m.top,x2:m.right,y2:m.bottom};z.y1=z.y1*y-x[0],z.y2=z.y2*y+x[2],z.x1=z.x1*y-x[3],z.x2=z.x2*y+x[1];const F=m.collisionPadding;if(F&&(z.x1-=F[0]*y,z.y1-=F[1]*y,z.x2+=F[2]*y,z.y2+=F[3]*y),E){const N=new we(z.x1,z.y1),U=new we(z.x2,z.y1),K=new we(z.x1,z.y2),ee=new we(z.x2,z.y2),ge=E*Math.PI/180;N._rotate(ge),U._rotate(ge),K._rotate(ge),ee._rotate(ge),z.x1=Math.min(N.x,U.x,K.x,ee.x),z.x2=Math.max(N.x,U.x,K.x,ee.x),z.y1=Math.min(N.y,U.y,K.y,ee.y),z.y2=Math.max(N.y,U.y,K.y,ee.y)}t.emplaceBack(r.x,r.y,z.x1,z.y1,z.x2,z.y2,a,c,f)}this.boxEndIndex=t.length}}class Qf{constructor(t=[],r=(a,c)=>a<c?-1:a>c?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:a}=this,c=r[t];for(;t>0;){const f=t-1>>1,m=r[f];if(a(c,m)>=0)break;r[t]=m,t=f}r[t]=c}_down(t){const{data:r,compare:a}=this,c=this.length>>1,f=r[t];for(;t<c;){let m=1+(t<<1);const y=m+1;if(y<this.length&&a(r[y],r[m])<0&&(m=y),a(r[m],f)>=0)break;r[t]=r[m],t=m}r[t]=f}}function em(i,t=1,r=!1){let a=1/0,c=1/0,f=-1/0,m=-1/0;const y=i[0];for(let F=0;F<y.length;F++){const N=y[F];(!F||N.x<a)&&(a=N.x),(!F||N.y<c)&&(c=N.y),(!F||N.x>f)&&(f=N.x),(!F||N.y>m)&&(m=N.y)}const x=Math.min(f-a,m-c);let T=x/2;const E=new Qf([],tm);if(x===0)return new we(a,c);for(let F=a;F<f;F+=x)for(let N=c;N<m;N+=x)E.push(new eh(F+T,N+T,T,i));let C=function(F){let N=0,U=0,K=0;const ee=F[0];for(let ge=0,ne=ee.length,de=ne-1;ge<ne;de=ge++){const ke=ee[ge],Ae=ee[de],Ye=ke.x*Ae.y-Ae.x*ke.y;U+=(ke.x+Ae.x)*Ye,K+=(ke.y+Ae.y)*Ye,N+=3*Ye}return new eh(U/N,K/N,0,F)}(i),z=E.length;for(;E.length;){const F=E.pop();(F.d>C.d||!C.d)&&(C=F,r&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,z)),F.max-C.d<=t||(T=F.h/2,E.push(new eh(F.p.x-T,F.p.y-T,T,i)),E.push(new eh(F.p.x+T,F.p.y-T,T,i)),E.push(new eh(F.p.x-T,F.p.y+T,T,i)),E.push(new eh(F.p.x+T,F.p.y+T,T,i)),z+=4)}return r&&(console.log(`num probes: ${z}`),console.log(`best distance: ${C.d}`)),C.p}function tm(i,t){return t.max-i.max}function eh(i,t,r,a){this.p=new we(i,t),this.h=r,this.d=function(c,f){let m=!1,y=1/0;for(let x=0;x<f.length;x++){const T=f[x];for(let E=0,C=T.length,z=C-1;E<C;z=E++){const F=T[E],N=T[z];F.y>c.y!=N.y>c.y&&c.x<(N.x-F.x)*(c.y-F.y)/(N.y-F.y)+F.x&&(m=!m),y=Math.min(y,Dc(c,F,N))}}return(m?1:-1)*Math.sqrt(y)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}var ln;D.aq=void 0,(ln=D.aq||(D.aq={}))[ln.center=1]="center",ln[ln.left=2]="left",ln[ln.right=3]="right",ln[ln.top=4]="top",ln[ln.bottom=5]="bottom",ln[ln["top-left"]=6]="top-left",ln[ln["top-right"]=7]="top-right",ln[ln["bottom-left"]=8]="bottom-left",ln[ln["bottom-right"]=9]="bottom-right";const uu=7,mp=Number.POSITIVE_INFINITY;function Yp(i,t){return t[1]!==mp?function(r,a,c){let f=0,m=0;switch(a=Math.abs(a),c=Math.abs(c),r){case"top-right":case"top-left":case"top":m=c-uu;break;case"bottom-right":case"bottom-left":case"bottom":m=-c+uu}switch(r){case"top-right":case"bottom-right":case"right":f=-a;break;case"top-left":case"bottom-left":case"left":f=a}return[f,m]}(i,t[0],t[1]):function(r,a){let c=0,f=0;a<0&&(a=0);const m=a/Math.SQRT2;switch(r){case"top-right":case"top-left":f=m-uu;break;case"bottom-right":case"bottom-left":f=-m+uu;break;case"bottom":f=-a+uu;break;case"top":f=a-uu}switch(r){case"top-right":case"bottom-right":c=-m;break;case"top-left":case"bottom-left":c=m;break;case"left":c=a;break;case"right":c=-a}return[c,f]}(i,t[0])}function Qp(i,t,r){var a;const c=i.layout,f=(a=c.get("text-variable-anchor-offset"))===null||a===void 0?void 0:a.evaluate(t,{},r);if(f){const y=f.values,x=[];for(let T=0;T<y.length;T+=2){const E=x[T]=y[T],C=y[T+1].map(z=>z*Xi);E.startsWith("top")?C[1]-=uu:E.startsWith("bottom")&&(C[1]+=uu),x[T+1]=C}return new gn(x)}const m=c.get("text-variable-anchor");if(m){let y;y=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(t,{},r)*Xi,mp]:c.get("text-offset").evaluate(t,{},r).map(T=>T*Xi);const x=[];for(const T of m)x.push(T,Yp(T,y));return new gn(x)}return null}function gp(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function im(i,t,r,a,c,f,m,y,x,T,E){let C=f.textMaxSize.evaluate(t,{});C===void 0&&(C=m);const z=i.layers[0].layout,F=z.get("icon-offset").evaluate(t,{},E),N=tf(r.horizontal),U=m/24,K=i.tilePixelRatio*U,ee=i.tilePixelRatio*C/24,ge=i.tilePixelRatio*y,ne=i.tilePixelRatio*z.get("symbol-spacing"),de=z.get("text-padding")*i.tilePixelRatio,ke=function(Ee,dt,ut,Et=1){const Di=Ee.get("icon-padding").evaluate(dt,{},ut),Ci=Di&&Di.values;return[Ci[0]*Et,Ci[1]*Et,Ci[2]*Et,Ci[3]*Et]}(z,t,E,i.tilePixelRatio),Ae=z.get("text-max-angle")/180*Math.PI,Ye=z.get("text-rotation-alignment")!=="viewport"&&z.get("symbol-placement")!=="point",yt=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Ke=z.get("symbol-placement"),He=ne/2,ht=z.get("icon-text-fit");let rt;a&&ht!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(rt=rc(a,r.vertical,ht,z.get("icon-text-fit-padding"),F,U)),N&&(a=rc(a,N,ht,z.get("icon-text-fit-padding"),F,U)));const et=(Ee,dt)=>{dt.x<0||dt.x>=$i||dt.y<0||dt.y>=$i||function(ut,Et,Di,Ci,Fr,wo,un,Br,Fn,Bn,On,tr,Or,Sn,cn,Nn,hn,Hs,ss,ci,Fi,Ni,ws,Ki,th){const Da=ut.addToLineVertexArray(Et,Di);let La,bo,Ws,Kr,_l=0,Jh=0,of=0,af=0,Tp=-1,kp=-1;const yl={};let lf=ka("");if(ut.allowVerticalPlacement&&Ci.vertical){const Tn=Br.layout.get("text-rotate").evaluate(Fi,{},Ki)+90;Ws=new Od(Fn,Et,Bn,On,tr,Ci.vertical,Or,Sn,cn,Tn),un&&(Kr=new Od(Fn,Et,Bn,On,tr,un,hn,Hs,cn,Tn))}if(Fr){const Tn=Br.layout.get("icon-rotate").evaluate(Fi,{}),Xs=Br.layout.get("icon-text-fit")!=="none",oc=Kp(Fr,Tn,ws,Xs),na=un?Kp(un,Tn,ws,Xs):void 0;bo=new Od(Fn,Et,Bn,On,tr,Fr,hn,Hs,!1,Tn),_l=4*oc.length;const ac=ut.iconSizeData;let Ra=null;ac.kind==="source"?(Ra=[ns*Br.layout.get("icon-size").evaluate(Fi,{})],Ra[0]>xo&&bi(`${ut.layerIds[0]}: Value for "icon-size" is >= ${Gs}. Reduce your "icon-size".`)):ac.kind==="composite"&&(Ra=[ns*Ni.compositeIconSizes[0].evaluate(Fi,{},Ki),ns*Ni.compositeIconSizes[1].evaluate(Fi,{},Ki)],(Ra[0]>xo||Ra[1]>xo)&&bi(`${ut.layerIds[0]}: Value for "icon-size" is >= ${Gs}. Reduce your "icon-size".`)),ut.addSymbols(ut.icon,oc,Ra,ci,ss,Fi,D.ah.none,Et,Da.lineStartIndex,Da.lineLength,-1,Ki),Tp=ut.icon.placedSymbolArray.length-1,na&&(Jh=4*na.length,ut.addSymbols(ut.icon,na,Ra,ci,ss,Fi,D.ah.vertical,Et,Da.lineStartIndex,Da.lineLength,-1,Ki),kp=ut.icon.placedSymbolArray.length-1)}const uf=Object.keys(Ci.horizontal);for(const Tn of uf){const Xs=Ci.horizontal[Tn];if(!La){lf=ka(Xs.text);const na=Br.layout.get("text-rotate").evaluate(Fi,{},Ki);La=new Od(Fn,Et,Bn,On,tr,Xs,Or,Sn,cn,na)}const oc=Xs.positionedLines.length===1;if(of+=ef(ut,Et,Xs,wo,Br,cn,Fi,Nn,Da,Ci.vertical?D.ah.horizontal:D.ah.horizontalOnly,oc?uf:[Tn],yl,Tp,Ni,Ki),oc)break}Ci.vertical&&(af+=ef(ut,Et,Ci.vertical,wo,Br,cn,Fi,Nn,Da,D.ah.vertical,["vertical"],yl,kp,Ni,Ki));const sm=La?La.boxStartIndex:ut.collisionBoxArray.length,om=La?La.boxEndIndex:ut.collisionBoxArray.length,am=Ws?Ws.boxStartIndex:ut.collisionBoxArray.length,lm=Ws?Ws.boxEndIndex:ut.collisionBoxArray.length,um=bo?bo.boxStartIndex:ut.collisionBoxArray.length,cm=bo?bo.boxEndIndex:ut.collisionBoxArray.length,hm=Kr?Kr.boxStartIndex:ut.collisionBoxArray.length,dm=Kr?Kr.boxEndIndex:ut.collisionBoxArray.length;let ra=-1;const Vd=(Tn,Xs)=>Tn&&Tn.circleDiameter?Math.max(Tn.circleDiameter,Xs):Xs;ra=Vd(La,ra),ra=Vd(Ws,ra),ra=Vd(bo,ra),ra=Vd(Kr,ra);const cf=ra>-1?1:0;cf&&(ra*=th/Xi),ut.glyphOffsetArray.length>=Aa.MAX_GLYPHS&&bi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Fi.sortKey!==void 0&&ut.addToSortKeyRanges(ut.symbolInstances.length,Fi.sortKey);const pm=Qp(Br,Fi,Ki),[fm,mm]=function(Tn,Xs){const oc=Tn.length,na=Xs==null?void 0:Xs.values;if((na==null?void 0:na.length)>0)for(let ac=0;ac<na.length;ac+=2){const Ra=na[ac+1];Tn.emplaceBack(D.aq[na[ac]],Ra[0],Ra[1])}return[oc,Tn.length]}(ut.textAnchorOffsets,pm);ut.symbolInstances.emplaceBack(Et.x,Et.y,yl.right>=0?yl.right:-1,yl.center>=0?yl.center:-1,yl.left>=0?yl.left:-1,yl.vertical||-1,Tp,kp,lf,sm,om,am,lm,um,cm,hm,dm,Bn,of,af,_l,Jh,cf,0,Or,ra,fm,mm)}(i,dt,Ee,r,a,c,rt,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,K,[de,de,de,de],Ye,x,ge,ke,yt,F,t,f,T,E,m)};if(Ke==="line")for(const Ee of Tt(t.geometry,0,0,$i,$i)){const dt=Yf(Ee,ne,Ae,r.vertical||N,a,24,ee,i.overscaling,$i);for(const ut of dt)N&&rm(i,N.text,He,ut)||et(Ee,ut)}else if(Ke==="line-center"){for(const Ee of t.geometry)if(Ee.length>1){const dt=fp(Ee,Ae,r.vertical||N,a,24,ee);dt&&et(Ee,dt)}}else if(t.type==="Polygon")for(const Ee of Pl(t.geometry,0)){const dt=em(Ee,16);et(Ee[0],new _t(dt.x,dt.y,0))}else if(t.type==="LineString")for(const Ee of t.geometry)et(Ee,new _t(Ee[0].x,Ee[0].y,0));else if(t.type==="Point")for(const Ee of t.geometry)for(const dt of Ee)et([dt],new _t(dt.x,dt.y,0))}function ef(i,t,r,a,c,f,m,y,x,T,E,C,z,F,N){const U=function(ge,ne,de,ke,Ae,Ye,yt,Ke){const He=ke.layout.get("text-rotate").evaluate(Ye,{})*Math.PI/180,ht=[];for(const rt of ne.positionedLines)for(const et of rt.positionedGlyphs){if(!et.rect)continue;const Ee=et.rect||{};let dt=Oh+1,ut=!0,Et=1,Di=0;const Ci=(Ae||Ke)&&et.vertical,Fr=et.metrics.advance*et.scale/2;if(Ke&&ne.verticalizable&&(Di=rt.lineOffset/2-(et.imageName?-(Xi-et.metrics.width*et.scale)/2:(et.scale-1)*Xi)),et.imageName){const ci=yt[et.imageName];ut=ci.sdf,Et=ci.pixelRatio,dt=Rr/Et}const wo=Ae?[et.x+Fr,et.y]:[0,0];let un=Ae?[0,0]:[et.x+Fr+de[0],et.y+de[1]-Di],Br=[0,0];Ci&&(Br=un,un=[0,0]);const Fn=et.metrics.isDoubleResolution?2:1,Bn=(et.metrics.left-dt)*et.scale-Fr+un[0],On=(-et.metrics.top-dt)*et.scale+un[1],tr=Bn+Ee.w/Fn*et.scale/Et,Or=On+Ee.h/Fn*et.scale/Et,Sn=new we(Bn,On),cn=new we(tr,On),Nn=new we(Bn,Or),hn=new we(tr,Or);if(Ci){const ci=new we(-Fr,Fr-su),Fi=-Math.PI/2,Ni=Xi/2-Fr,ws=new we(5-su-Ni,-(et.imageName?Ni:0)),Ki=new we(...Br);Sn._rotateAround(Fi,ci)._add(ws)._add(Ki),cn._rotateAround(Fi,ci)._add(ws)._add(Ki),Nn._rotateAround(Fi,ci)._add(ws)._add(Ki),hn._rotateAround(Fi,ci)._add(ws)._add(Ki)}if(He){const ci=Math.sin(He),Fi=Math.cos(He),Ni=[Fi,-ci,ci,Fi];Sn._matMult(Ni),cn._matMult(Ni),Nn._matMult(Ni),hn._matMult(Ni)}const Hs=new we(0,0),ss=new we(0,0);ht.push({tl:Sn,tr:cn,bl:Nn,br:hn,tex:Ee,writingMode:ne.writingMode,glyphOffset:wo,sectionIndex:et.sectionIndex,isSDF:ut,pixelOffsetTL:Hs,pixelOffsetBR:ss,minFontScaleX:0,minFontScaleY:0})}return ht}(0,r,y,c,f,m,a,i.allowVerticalPlacement),K=i.textSizeData;let ee=null;K.kind==="source"?(ee=[ns*c.layout.get("text-size").evaluate(m,{})],ee[0]>xo&&bi(`${i.layerIds[0]}: Value for "text-size" is >= ${Gs}. Reduce your "text-size".`)):K.kind==="composite"&&(ee=[ns*F.compositeTextSizes[0].evaluate(m,{},N),ns*F.compositeTextSizes[1].evaluate(m,{},N)],(ee[0]>xo||ee[1]>xo)&&bi(`${i.layerIds[0]}: Value for "text-size" is >= ${Gs}. Reduce your "text-size".`)),i.addSymbols(i.text,U,ee,y,f,m,T,t,x.lineStartIndex,x.lineLength,z,N);for(const ge of E)C[ge]=i.text.placedSymbolArray.length-1;return 4*U.length}function tf(i){for(const t in i)return i[t];return null}function rm(i,t,r,a){const c=i.compareText;if(t in c){const f=c[t];for(let m=f.length-1;m>=0;m--)if(a.dist(f[m])<r)return!0}else c[t]=[];return c[t].push(a),!1}const rf=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class _p{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,a]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=a>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const f=rf[15&a];if(!f)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(t,2,1),[y]=new Uint32Array(t,4,1);return new _p(y,m,f,t)}constructor(t,r=64,a=Float64Array,c){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const f=rf.indexOf(this.ArrayType),m=2*t*this.ArrayType.BYTES_PER_ELEMENT,y=t*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-y%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${a}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+x,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+m+y+x),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+x,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=t,this.coords[this._pos++]=r,a}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return yp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,a,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:m,nodeSize:y}=this,x=[0,f.length-1,0],T=[];for(;x.length;){const E=x.pop()||0,C=x.pop()||0,z=x.pop()||0;if(C-z<=y){for(let K=z;K<=C;K++){const ee=m[2*K],ge=m[2*K+1];ee>=t&&ee<=a&&ge>=r&&ge<=c&&T.push(f[K])}continue}const F=z+C>>1,N=m[2*F],U=m[2*F+1];N>=t&&N<=a&&U>=r&&U<=c&&T.push(f[F]),(E===0?t<=N:r<=U)&&(x.push(z),x.push(F-1),x.push(1-E)),(E===0?a>=N:c>=U)&&(x.push(F+1),x.push(C),x.push(1-E))}return T}within(t,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:f,nodeSize:m}=this,y=[0,c.length-1,0],x=[],T=a*a;for(;y.length;){const E=y.pop()||0,C=y.pop()||0,z=y.pop()||0;if(C-z<=m){for(let K=z;K<=C;K++)sf(f[2*K],f[2*K+1],t,r)<=T&&x.push(c[K]);continue}const F=z+C>>1,N=f[2*F],U=f[2*F+1];sf(N,U,t,r)<=T&&x.push(c[F]),(E===0?t-a<=N:r-a<=U)&&(y.push(z),y.push(F-1),y.push(1-E)),(E===0?t+a>=N:r+a>=U)&&(y.push(F+1),y.push(C),y.push(1-E))}return x}}function yp(i,t,r,a,c,f){if(c-a<=r)return;const m=a+c>>1;nf(i,t,m,a,c,f),yp(i,t,r,a,m-1,1-f),yp(i,t,r,m+1,c,1-f)}function nf(i,t,r,a,c,f){for(;c>a;){if(c-a>600){const T=c-a+1,E=r-a+1,C=Math.log(T),z=.5*Math.exp(2*C/3),F=.5*Math.sqrt(C*z*(T-z)/T)*(E-T/2<0?-1:1);nf(i,t,r,Math.max(a,Math.floor(r-E*z/T+F)),Math.min(c,Math.floor(r+(T-E)*z/T+F)),f)}const m=t[2*r+f];let y=a,x=c;for(Xh(i,t,a,r),t[2*c+f]>m&&Xh(i,t,a,c);y<x;){for(Xh(i,t,y,x),y++,x--;t[2*y+f]<m;)y++;for(;t[2*x+f]>m;)x--}t[2*a+f]===m?Xh(i,t,a,x):(x++,Xh(i,t,x,c)),x<=r&&(a=x+1),r<=x&&(c=x-1)}}function Xh(i,t,r,a){vp(i,r,a),vp(t,2*r,2*a),vp(t,2*r+1,2*a+1)}function vp(i,t,r){const a=i[t];i[t]=i[r],i[r]=a}function sf(i,t,r,a){const c=i-r,f=t-a;return c*c+f*f}var xp;D.bg=void 0,(xp=D.bg||(D.bg={})).create="create",xp.load="load",xp.fullLoad="fullLoad";let Nd=null,Kh=[];const wp=1e3/60,bp="loadTime",Sp="fullLoadTime",nm={mark(i){performance.mark(i)},frame(i){const t=i;Nd!=null&&Kh.push(t-Nd),Nd=t},clearMetrics(){Nd=null,Kh=[],performance.clearMeasures(bp),performance.clearMeasures(Sp);for(const i in D.bg)performance.clearMarks(D.bg[i])},getPerformanceMetrics(){performance.measure(bp,D.bg.create,D.bg.load),performance.measure(Sp,D.bg.create,D.bg.fullLoad);const i=performance.getEntriesByName(bp)[0].duration,t=performance.getEntriesByName(Sp)[0].duration,r=Kh.length,a=1/(Kh.reduce((f,m)=>f+m,0)/r/1e3),c=Kh.filter(f=>f>wp).reduce((f,m)=>f+(m-wp)/wp,0);return{loadTime:i,fullLoadTime:t,fps:a,percentDroppedFrames:c/(r+c)*100,totalFrames:r}}};D.$=class extends I{},D.A=Yl,D.B=Mu,D.C=function(i){if(ir==null){const t=i.navigator?i.navigator.userAgent:null;ir=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return ir},D.D=at,D.E=So,D.F=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new n(()=>this.process()),this.subscription=function(r,a,c,f){return r.addEventListener(a,c,!1),{unsubscribe:()=>{r.removeEventListener(a,c,!1)}}}(this.target,"message",r=>this.receive(r)),this.globalScope=ur(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}sendAsync(i,t){return new Promise((r,a)=>{const c=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[c]={resolve:r,reject:a},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[c];const y={id:c,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(y)},{once:!0});const f=[],m=Object.assign(Object.assign({},i),{id:c,sourceMapId:this.mapId,origin:location.origin,data:gs(i.data,f)});this.target.postMessage(m,{transfer:f})})}receive(i){const t=i.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];const a=this.abortControllers[r];return delete this.abortControllers[r],void(a&&a.abort())}if(ur(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return g(this,void 0,void 0,function*(){if(t.type==="<response>"){const c=this.resolveRejects[i];return delete this.resolveRejects[i],c?void(t.error?c.reject(Gr(t.error)):c.resolve(Gr(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=Gr(t.data),a=new AbortController;this.abortControllers[i]=a;try{const c=yield this.messageHandlers[t.type](t.sourceMapId,r,a);this.completeTask(i,null,c)}catch(c){this.completeTask(i,c)}})}completeTask(i,t,r){const a=[];delete this.abortControllers[i];const c={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?gs(t):null,data:gs(r,a)};this.target.postMessage(c,{transfer:a})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},D.G=Jt,D.H=function(){var i=new Yl(16);return Yl!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},D.I=Nh,D.J=function(i,t,r){var a,c,f,m,y,x,T,E,C,z,F,N,U=r[0],K=r[1],ee=r[2];return t===i?(i[12]=t[0]*U+t[4]*K+t[8]*ee+t[12],i[13]=t[1]*U+t[5]*K+t[9]*ee+t[13],i[14]=t[2]*U+t[6]*K+t[10]*ee+t[14],i[15]=t[3]*U+t[7]*K+t[11]*ee+t[15]):(c=t[1],f=t[2],m=t[3],y=t[4],x=t[5],T=t[6],E=t[7],C=t[8],z=t[9],F=t[10],N=t[11],i[0]=a=t[0],i[1]=c,i[2]=f,i[3]=m,i[4]=y,i[5]=x,i[6]=T,i[7]=E,i[8]=C,i[9]=z,i[10]=F,i[11]=N,i[12]=a*U+y*K+C*ee+t[12],i[13]=c*U+x*K+z*ee+t[13],i[14]=f*U+T*K+F*ee+t[14],i[15]=m*U+E*K+N*ee+t[15]),i},D.K=function(i,t,r){var a=r[0],c=r[1],f=r[2];return i[0]=t[0]*a,i[1]=t[1]*a,i[2]=t[2]*a,i[3]=t[3]*a,i[4]=t[4]*c,i[5]=t[5]*c,i[6]=t[6]*c,i[7]=t[7]*c,i[8]=t[8]*f,i[9]=t[9]*f,i[10]=t[10]*f,i[11]=t[11]*f,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},D.L=vh,D.M=function(i,t){const r={};for(let a=0;a<t.length;a++){const c=t[a];c in i&&(r[c]=i[c])}return r},D.N=h,D.O=k,D.P=we,D.Q=O,D.R=wn,D.S=Xe,D.T=po,D.U=Yt,D.V=_i,D.W=xt,D.X=$i,D.Y=d,D.Z=Se,D._=g,D.a=Ot,D.a$=function(i,t){var r=i[0],a=i[1],c=i[2],f=i[3],m=i[4],y=i[5],x=i[6],T=i[7],E=i[8],C=i[9],z=i[10],F=i[11],N=i[12],U=i[13],K=i[14],ee=i[15],ge=t[0],ne=t[1],de=t[2],ke=t[3],Ae=t[4],Ye=t[5],yt=t[6],Ke=t[7],He=t[8],ht=t[9],rt=t[10],et=t[11],Ee=t[12],dt=t[13],ut=t[14],Et=t[15];return Math.abs(r-ge)<=Xr*Math.max(1,Math.abs(r),Math.abs(ge))&&Math.abs(a-ne)<=Xr*Math.max(1,Math.abs(a),Math.abs(ne))&&Math.abs(c-de)<=Xr*Math.max(1,Math.abs(c),Math.abs(de))&&Math.abs(f-ke)<=Xr*Math.max(1,Math.abs(f),Math.abs(ke))&&Math.abs(m-Ae)<=Xr*Math.max(1,Math.abs(m),Math.abs(Ae))&&Math.abs(y-Ye)<=Xr*Math.max(1,Math.abs(y),Math.abs(Ye))&&Math.abs(x-yt)<=Xr*Math.max(1,Math.abs(x),Math.abs(yt))&&Math.abs(T-Ke)<=Xr*Math.max(1,Math.abs(T),Math.abs(Ke))&&Math.abs(E-He)<=Xr*Math.max(1,Math.abs(E),Math.abs(He))&&Math.abs(C-ht)<=Xr*Math.max(1,Math.abs(C),Math.abs(ht))&&Math.abs(z-rt)<=Xr*Math.max(1,Math.abs(z),Math.abs(rt))&&Math.abs(F-et)<=Xr*Math.max(1,Math.abs(F),Math.abs(et))&&Math.abs(N-Ee)<=Xr*Math.max(1,Math.abs(N),Math.abs(Ee))&&Math.abs(U-dt)<=Xr*Math.max(1,Math.abs(U),Math.abs(dt))&&Math.abs(K-ut)<=Xr*Math.max(1,Math.abs(K),Math.abs(ut))&&Math.abs(ee-Et)<=Xr*Math.max(1,Math.abs(ee),Math.abs(Et))},D.a0=ai,D.a1=Be,D.a2=Fe,D.a3=i=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(r=>{t.onloadstart=()=>{r(t)};for(const a of i){const c=window.document.createElement("source");rr(a)||(t.crossOrigin="Anonymous"),c.src=a,t.appendChild(c)}})},D.a4=function(){return yi++},D.a5=$e,D.a6=Aa,D.a7=Hn,D.a8=Ca,D.a9=ye,D.aA=function(i){if(i.type==="custom")return new Yc(i);switch(i.type){case"background":return new Jc(i);case"circle":return new tp(i);case"fill":return new an(i);case"fill-extrusion":return new Us(i);case"heatmap":return new bh(i);case"hillshade":return new cd(i);case"line":return new is(i);case"raster":return new pp(i);case"symbol":return new gl(i)}},D.aB=Kt,D.aC=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let r=[];try{if(!ei(i.version,t.version))return[{command:"setStyle",args:[t]}];ei(i.center,t.center)||r.push({command:"setCenter",args:[t.center]}),ei(i.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),ei(i.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),ei(i.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),ei(i.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),ei(i.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),ei(i.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),ei(i.light,t.light)||r.push({command:"setLight",args:[t.light]}),ei(i.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),ei(i.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),ei(i.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});const a={},c=[];(function(m,y,x,T){let E;for(E in y=y||{},m=m||{})Object.prototype.hasOwnProperty.call(m,E)&&(Object.prototype.hasOwnProperty.call(y,E)||us(E,x,T));for(E in y)Object.prototype.hasOwnProperty.call(y,E)&&(Object.prototype.hasOwnProperty.call(m,E)?ei(m[E],y[E])||(m[E].type==="geojson"&&y[E].type==="geojson"&&To(m,y,E)?Ii(x,{command:"setGeoJSONSourceData",args:[E,y[E].data]}):cs(E,y,x,T)):ls(E,y,x))})(i.sources,t.sources,c,a);const f=[];i.layers&&i.layers.forEach(m=>{"source"in m&&a[m.source]?r.push({command:"removeLayer",args:[m.id]}):f.push(m)}),r=r.concat(c),function(m,y,x){y=y||[];const T=(m=m||[]).map(aa),E=y.map(aa),C=m.reduce(ko,{}),z=y.reduce(ko,{}),F=T.slice(),N=Object.create(null);let U,K,ee,ge,ne;for(let de=0,ke=0;de<T.length;de++)U=T[de],Object.prototype.hasOwnProperty.call(z,U)?ke++:(Ii(x,{command:"removeLayer",args:[U]}),F.splice(F.indexOf(U,ke),1));for(let de=0,ke=0;de<E.length;de++)U=E[E.length-1-de],F[F.length-1-de]!==U&&(Object.prototype.hasOwnProperty.call(C,U)?(Ii(x,{command:"removeLayer",args:[U]}),F.splice(F.lastIndexOf(U,F.length-ke),1)):ke++,ge=F[F.length-de],Ii(x,{command:"addLayer",args:[z[U],ge]}),F.splice(F.length-de,0,U),N[U]=!0);for(let de=0;de<E.length;de++)if(U=E[de],K=C[U],ee=z[U],!N[U]&&!ei(K,ee))if(ei(K.source,ee.source)&&ei(K["source-layer"],ee["source-layer"])&&ei(K.type,ee.type)){for(ne in pn(K.layout,ee.layout,x,U,null,"setLayoutProperty"),pn(K.paint,ee.paint,x,U,null,"setPaintProperty"),ei(K.filter,ee.filter)||Ii(x,{command:"setFilter",args:[U,ee.filter]}),ei(K.minzoom,ee.minzoom)&&ei(K.maxzoom,ee.maxzoom)||Ii(x,{command:"setLayerZoomRange",args:[U,ee.minzoom,ee.maxzoom]}),K)Object.prototype.hasOwnProperty.call(K,ne)&&ne!=="layout"&&ne!=="paint"&&ne!=="filter"&&ne!=="metadata"&&ne!=="minzoom"&&ne!=="maxzoom"&&(ne.indexOf("paint.")===0?pn(K[ne],ee[ne],x,U,ne.slice(6),"setPaintProperty"):ei(K[ne],ee[ne])||Ii(x,{command:"setLayerProperty",args:[U,ne,ee[ne]]}));for(ne in ee)Object.prototype.hasOwnProperty.call(ee,ne)&&!Object.prototype.hasOwnProperty.call(K,ne)&&ne!=="layout"&&ne!=="paint"&&ne!=="filter"&&ne!=="metadata"&&ne!=="minzoom"&&ne!=="maxzoom"&&(ne.indexOf("paint.")===0?pn(K[ne],ee[ne],x,U,ne.slice(6),"setPaintProperty"):ei(K[ne],ee[ne])||Ii(x,{command:"setLayerProperty",args:[U,ne,ee[ne]]}))}else Ii(x,{command:"removeLayer",args:[U]}),ge=F[F.lastIndexOf(U)+1],Ii(x,{command:"addLayer",args:[ee,ge]})}(f,t.layers,r)}catch(a){console.warn("Unable to compute style diff:",a),r=[{command:"setStyle",args:[t]}]}return r},D.aD=function(i){const t=[],r=i.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},D.aE=function i(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let a=0;a<t.length;a++)if(!i(t[a],r[a]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(const a in t)if(!i(t[a],r[a]))return!1;return!0}return t===r},D.aF=Ji,D.aG=Vr,D.aH=class extends fi{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},D.aI=Yi,D.aJ=class extends fi{constructor(i,t){super(i,t),this.current=Fu}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},D.aK=xr,D.aL=Ru,D.aM=It,D.aN=class extends fi{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},D.aO=class extends fi{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},D.aP=function(i,t,r,a,c,f,m){var y=1/(t-r),x=1/(a-c),T=1/(f-m);return i[0]=-2*y,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*x,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*T,i[11]=0,i[12]=(t+r)*y,i[13]=(c+a)*x,i[14]=(m+f)*T,i[15]=1,i},D.aQ=sd,D.aR=class extends H{},D.aS=Dh,D.aT=class extends ce{},D.aU=ju,D.aV=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},D.aW=ll,D.aX=Ai,D.aY=Ar,D.aZ=class extends Oe{},D.a_=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},D.aa=function(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,c,f)=>{const m=c||f;return t[a]=!m||m.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},D.ab=function(i,t){const r=[];for(const a in i)a in t||r.push(a);return r},D.ac=At,D.ad=function(i,t,r){var a=Math.sin(r),c=Math.cos(r),f=t[0],m=t[1],y=t[2],x=t[3],T=t[4],E=t[5],C=t[6],z=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=f*c+T*a,i[1]=m*c+E*a,i[2]=y*c+C*a,i[3]=x*c+z*a,i[4]=T*c-f*a,i[5]=E*c-m*a,i[6]=C*c-y*a,i[7]=z*c-x*a,i},D.ae=function(i){var t=new Yl(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},D.af=al,D.ag=function(i,t){let r=0,a=0;if(i.kind==="constant")a=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:c,minZoom:f,maxZoom:m}=i,y=c?At(hr.interpolationFactor(c,t,f,m),0,1):0;i.kind==="camera"?a=Gi.number(i.minSize,i.maxSize,y):r=y}return{uSizeT:r,uSize:a}},D.ai=function(i,{uSize:t,uSizeT:r},{lowerSize:a,upperSize:c}){return i.kind==="source"?a/ns:i.kind==="composite"?Gi.number(a/ns,c/ns,r):t},D.aj=Gc,D.ak=function(i,t,r,a){const c=t.y-i.y,f=t.x-i.x,m=a.y-r.y,y=a.x-r.x,x=m*f-y*c;if(x===0)return null;const T=(y*(i.y-r.y)-m*(i.x-r.x))/x;return new we(i.x+T*f,i.y+T*c)},D.al=Tt,D.am=fh,D.an=yh,D.ao=function(i){let t=1/0,r=1/0,a=-1/0,c=-1/0;for(const f of i)t=Math.min(t,f.x),r=Math.min(r,f.y),a=Math.max(a,f.x),c=Math.max(c,f.y);return[t,r,a,c]},D.ap=Xi,D.ar=Zh,D.as=function(i,t){var r=t[0],a=t[1],c=t[2],f=t[3],m=t[4],y=t[5],x=t[6],T=t[7],E=t[8],C=t[9],z=t[10],F=t[11],N=t[12],U=t[13],K=t[14],ee=t[15],ge=r*y-a*m,ne=r*x-c*m,de=r*T-f*m,ke=a*x-c*y,Ae=a*T-f*y,Ye=c*T-f*x,yt=E*U-C*N,Ke=E*K-z*N,He=E*ee-F*N,ht=C*K-z*U,rt=C*ee-F*U,et=z*ee-F*K,Ee=ge*et-ne*rt+de*ht+ke*He-Ae*Ke+Ye*yt;return Ee?(i[0]=(y*et-x*rt+T*ht)*(Ee=1/Ee),i[1]=(c*rt-a*et-f*ht)*Ee,i[2]=(U*Ye-K*Ae+ee*ke)*Ee,i[3]=(z*Ae-C*Ye-F*ke)*Ee,i[4]=(x*He-m*et-T*Ke)*Ee,i[5]=(r*et-c*He+f*Ke)*Ee,i[6]=(K*de-N*Ye-ee*ne)*Ee,i[7]=(E*Ye-z*de+F*ne)*Ee,i[8]=(m*rt-y*He+T*yt)*Ee,i[9]=(a*He-r*rt-f*yt)*Ee,i[10]=(N*Ae-U*de+ee*ge)*Ee,i[11]=(C*de-E*Ae-F*ge)*Ee,i[12]=(y*Ke-m*ht-x*yt)*Ee,i[13]=(r*ht-a*Ke+c*yt)*Ee,i[14]=(U*ne-N*ke-K*ge)*Ee,i[15]=(E*ke-C*ne+z*ge)*Ee,i):null},D.at=gp,D.au=Rn,D.av=_p,D.aw=function(){const i={},t=be.$version;for(const r in be.$root){const a=be.$root[r];if(a.required){let c=null;c=r==="version"?t:a.type==="array"?[]:{},c!=null&&(i[r]=c)}}return i},D.ax=Zo,D.ay=Ht,D.az=function(i){i=i.slice();const t=Object.create(null);for(let r=0;r<i.length;r++)t[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=oa(i[r],t[i[r].ref]));return i},D.b=hi,D.b0=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},D.b1=function(i,t,r){return i[0]=t[0]*r[0],i[1]=t[1]*r[1],i[2]=t[2]*r[2],i[3]=t[3]*r[3],i},D.b2=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},D.b3=Gt,D.b4=De,D.b5=Q,D.b6=function(i,t,r,a,c){var f,m=1/Math.tan(t/2);return i[0]=m/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,c!=null&&c!==1/0?(i[10]=(c+a)*(f=1/(a-c)),i[14]=2*c*a*f):(i[10]=-1,i[14]=-2*a),i},D.b7=function(i,t,r){var a=Math.sin(r),c=Math.cos(r),f=t[4],m=t[5],y=t[6],x=t[7],T=t[8],E=t[9],C=t[10],z=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=f*c+T*a,i[5]=m*c+E*a,i[6]=y*c+C*a,i[7]=x*c+z*a,i[8]=T*c-f*a,i[9]=E*c-m*a,i[10]=C*c-y*a,i[11]=z*c-x*a,i},D.b8=vt,D.b9=zt,D.bA=fl,D.bB=function(i){return i.message===Me},D.bC=ao,D.bD=nn,D.ba=function(i){return i*Math.PI/180},D.bb=function(i,t){const{x:r,y:a}=Se.fromLngLat(t);return!(i<0||i>25||a<0||a>=1||r<0||r>=1)},D.bc=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},D.bd=class extends S{},D.be=o,D.bf=nm,D.bh=Xt,D.bi=function(i,t){Ot.REGISTERED_PROTOCOLS[i]=t},D.bj=function(i){delete Ot.REGISTERED_PROTOCOLS[i]},D.bk=function(i,t){const r={};for(let c=0;c<i.length;c++){const f=t&&t[i[c].id]||uo(i[c]);t&&(t[i[c].id]=f);let m=r[f];m||(m=r[f]=[]),m.push(i[c])}const a=[];for(const c in r)a.push(r[c]);return a},D.bl=Je,D.bm=er,D.bn=ue,D.bo=Ad,D.bp=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=$i/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0],r=t.layout,a=t._unevaluatedLayout._values,c={layoutIconSize:a["icon-size"].possiblyEvaluate(new Dt(i.bucket.zoom+1),i.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new Dt(i.bucket.zoom+1),i.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new Dt(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:T,maxZoom:E}=i.bucket.textSizeData;c.compositeTextSizes=[a["text-size"].possiblyEvaluate(new Dt(T),i.canonical),a["text-size"].possiblyEvaluate(new Dt(E),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:T,maxZoom:E}=i.bucket.iconSizeData;c.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new Dt(T),i.canonical),a["icon-size"].possiblyEvaluate(new Dt(E),i.canonical)]}const f=r.get("text-line-height")*Xi,m=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",y=r.get("text-keep-upright"),x=r.get("text-size");for(const T of i.bucket.features){const E=r.get("text-font").evaluate(T,{},i.canonical).join(","),C=x.evaluate(T,{},i.canonical),z=c.layoutTextSize.evaluate(T,{},i.canonical),F=c.layoutIconSize.evaluate(T,{},i.canonical),N={horizontal:{},vertical:void 0},U=T.text;let K,ee=[0,0];if(U){const de=U.toString(),ke=r.get("text-letter-spacing").evaluate(T,{},i.canonical)*Xi,Ae=dh(de)?ke:0,Ye=r.get("text-anchor").evaluate(T,{},i.canonical),yt=Qp(t,T,i.canonical);if(!yt){const rt=r.get("text-radial-offset").evaluate(T,{},i.canonical);ee=rt?Yp(Ye,[rt*Xi,mp]):r.get("text-offset").evaluate(T,{},i.canonical).map(et=>et*Xi)}let Ke=m?"center":r.get("text-justify").evaluate(T,{},i.canonical);const He=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(T,{},i.canonical)*Xi:1/0,ht=()=>{i.bucket.allowVerticalPlacement&&Qa(de)&&(N.vertical=ea(U,i.glyphMap,i.glyphPositions,i.imagePositions,E,He,f,Ye,"left",Ae,ee,D.ah.vertical,!0,z,C))};if(!m&&yt){const rt=new Set;if(Ke==="auto")for(let Ee=0;Ee<yt.values.length;Ee+=2)rt.add(gp(yt.values[Ee]));else rt.add(Ke);let et=!1;for(const Ee of rt)if(!N.horizontal[Ee])if(et)N.horizontal[Ee]=N.horizontal[0];else{const dt=ea(U,i.glyphMap,i.glyphPositions,i.imagePositions,E,He,f,"center",Ee,Ae,ee,D.ah.horizontal,!1,z,C);dt&&(N.horizontal[Ee]=dt,et=dt.positionedLines.length===1)}ht()}else{Ke==="auto"&&(Ke=gp(Ye));const rt=ea(U,i.glyphMap,i.glyphPositions,i.imagePositions,E,He,f,Ye,Ke,Ae,ee,D.ah.horizontal,!1,z,C);rt&&(N.horizontal[Ke]=rt),ht(),Qa(de)&&m&&y&&(N.vertical=ea(U,i.glyphMap,i.glyphPositions,i.imagePositions,E,He,f,Ye,Ke,Ae,ee,D.ah.vertical,!1,z,C))}}let ge=!1;if(T.icon&&T.icon.name){const de=i.imageMap[T.icon.name];de&&(K=cp(i.imagePositions[T.icon.name],r.get("icon-offset").evaluate(T,{},i.canonical),r.get("icon-anchor").evaluate(T,{},i.canonical)),ge=!!de.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=ge:i.bucket.sdfIcons!==ge&&bi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(de.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ne=tf(N.horizontal)||N.vertical;i.bucket.iconsInText=!!ne&&ne.iconsInText,(ne||K)&&im(i.bucket,T,N,K,i.imageMap,c,z,F,ee,ge,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},D.bq=Xu,D.br=qu,D.bs=br,D.bt=Wi,D.bu=tc,D.bv=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},D.bw=function(i,t,r,a,c){return g(this,void 0,void 0,function*(){if(_i())try{return yield xt(i,t,r,a,c)}catch{}return function(f,m,y,x,T){const E=f.width,C=f.height;tt&&fe||(tt=new OffscreenCanvas(E,C),fe=tt.getContext("2d",{willReadFrequently:!0})),tt.width=E,tt.height=C,fe.drawImage(f,0,0,E,C);const z=fe.getImageData(m,y,x,T);return fe.clearRect(0,0,E,C),z.data}(i,t,r,a,c)})},D.bx=ft,D.by=ze,D.bz=nt,D.c=Bt,D.d=i=>g(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),D.e=Wt,D.f=i=>new Promise((t,r)=>{const a=new Image;a.onload=()=>{t(a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame(()=>{a.src=Qe})},a.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const c=new Blob([new Uint8Array(i)],{type:"image/png"});a.src=i.byteLength?URL.createObjectURL(c):Qe}),D.g=qt,D.h=(i,t)=>vi(Wt(i,{type:"json"}),t),D.i=ur,D.j=as,D.k=Vn,D.l=(i,t)=>vi(Wt(i,{type:"arrayBuffer"}),t),D.m=vi,D.n=function(i){return new tc(i).readFields(Bh,[])},D.o=tu,D.p=qc,D.q=sn,D.r=$l,D.s=rr,D.t=Au,D.u=fs,D.v=be,D.w=bi,D.x=function([i,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(r),y:i*Math.sin(t)*Math.sin(r),z:i*Math.cos(r)}},D.y=Gi,D.z=Dt}),me("worker",["./shared"],function(D){class g{constructor(R){this.keyCache={},R&&this.replace(R)}replace(R){this._layerConfigs={},this._layers={},this.update(R,[])}update(R,L){for(const W of R){this._layerConfigs[W.id]=W;const re=this._layers[W.id]=D.aA(W);re._featureFilter=D.a7(re.filter),this.keyCache[W.id]&&delete this.keyCache[W.id]}for(const W of L)delete this.keyCache[W],delete this._layerConfigs[W],delete this._layers[W];this.familiesBySource={};const V=D.bk(Object.values(this._layerConfigs),this.keyCache);for(const W of V){const re=W.map(ve=>this._layers[ve.id]),le=re[0];if(le.visibility==="none")continue;const pe=le.source||"";let te=this.familiesBySource[pe];te||(te=this.familiesBySource[pe]={});const Te=le.sourceLayer||"_geojsonTileLayer";let Pe=te[Te];Pe||(Pe=te[Te]=[]),Pe.push(re)}}}class ze{constructor(R){const L={},V=[];for(const pe in R){const te=R[pe],Te=L[pe]={};for(const Pe in te){const ve=te[+Pe];if(!ve||ve.bitmap.width===0||ve.bitmap.height===0)continue;const Ne={x:0,y:0,w:ve.bitmap.width+2,h:ve.bitmap.height+2};V.push(Ne),Te[Pe]={rect:Ne,metrics:ve.metrics}}}const{w:W,h:re}=D.p(V),le=new D.o({width:W||1,height:re||1});for(const pe in R){const te=R[pe];for(const Te in te){const Pe=te[+Te];if(!Pe||Pe.bitmap.width===0||Pe.bitmap.height===0)continue;const ve=L[pe][Te].rect;D.o.copy(Pe.bitmap,le,{x:0,y:0},{x:ve.x+1,y:ve.y+1},Pe.bitmap)}}this.image=le,this.positions=L}}D.bl("GlyphAtlas",ze);class nt{constructor(R){this.tileID=new D.S(R.tileID.overscaledZ,R.tileID.wrap,R.tileID.canonical.z,R.tileID.canonical.x,R.tileID.canonical.y),this.uid=R.uid,this.zoom=R.zoom,this.pixelRatio=R.pixelRatio,this.tileSize=R.tileSize,this.source=R.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=R.showCollisionBoxes,this.collectResourceTiming=!!R.collectResourceTiming,this.returnDependencies=!!R.returnDependencies,this.promoteId=R.promoteId,this.inFlightDependencies=[]}parse(R,L,V,W){return D._(this,void 0,void 0,function*(){this.status="parsing",this.data=R,this.collisionBoxArray=new D.a5;const re=new D.bm(Object.keys(R.layers).sort()),le=new D.bn(this.tileID,this.promoteId);le.bucketLayerIDs=[];const pe={},te={featureIndex:le,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:V},Te=L.familiesBySource[this.source];for(const Ut in Te){const di=R.layers[Ut];if(!di)continue;di.version===1&&D.w(`Vector tile source "${this.source}" layer "${Ut}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Pi=re.encode(Ut),sr=[];for(let cr=0;cr<di.length;cr++){const Ur=di.feature(cr),la=le.getId(Ur,Ut);sr.push({feature:Ur,id:la,index:cr,sourceLayerIndex:Pi})}for(const cr of Te[Ut]){const Ur=cr[0];Ur.source!==this.source&&D.w(`layer.source = ${Ur.source} does not equal this.source = ${this.source}`),Ur.minzoom&&this.zoom<Math.floor(Ur.minzoom)||Ur.maxzoom&&this.zoom>=Ur.maxzoom||Ur.visibility!=="none"&&(Ze(cr,this.zoom,V),(pe[Ur.id]=Ur.createBucket({index:le.bucketLayerIDs.length,layers:cr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Pi,sourceID:this.source})).populate(sr,te,this.tileID.canonical),le.bucketLayerIDs.push(cr.map(la=>la.id)))}}const Pe=D.aF(te.glyphDependencies,Ut=>Object.keys(Ut).map(Number));this.inFlightDependencies.forEach(Ut=>Ut==null?void 0:Ut.abort()),this.inFlightDependencies=[];let ve=Promise.resolve({});if(Object.keys(Pe).length){const Ut=new AbortController;this.inFlightDependencies.push(Ut),ve=W.sendAsync({type:"GG",data:{stacks:Pe,source:this.source,tileID:this.tileID,type:"glyphs"}},Ut)}const Ne=Object.keys(te.iconDependencies);let ot=Promise.resolve({});if(Ne.length){const Ut=new AbortController;this.inFlightDependencies.push(Ut),ot=W.sendAsync({type:"GI",data:{icons:Ne,source:this.source,tileID:this.tileID,type:"icons"}},Ut)}const pt=Object.keys(te.patternDependencies);let ti=Promise.resolve({});if(pt.length){const Ut=new AbortController;this.inFlightDependencies.push(Ut),ti=W.sendAsync({type:"GI",data:{icons:pt,source:this.source,tileID:this.tileID,type:"patterns"}},Ut)}const[Ct,ii,Rt]=yield Promise.all([ve,ot,ti]),qi=new ze(Ct),Bi=new D.bo(ii,Rt);for(const Ut in pe){const di=pe[Ut];di instanceof D.a6?(Ze(di.layers,this.zoom,V),D.bp({bucket:di,glyphMap:Ct,glyphPositions:qi.positions,imageMap:ii,imagePositions:Bi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):di.hasPattern&&(di instanceof D.bq||di instanceof D.br||di instanceof D.bs)&&(Ze(di.layers,this.zoom,V),di.addFeatures(te,this.tileID.canonical,Bi.patternPositions))}return this.status="done",{buckets:Object.values(pe).filter(Ut=>!Ut.isEmpty()),featureIndex:le,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:qi.image,imageAtlas:Bi,glyphMap:this.returnDependencies?Ct:null,iconMap:this.returnDependencies?ii:null,glyphPositions:this.returnDependencies?qi.positions:null}})}}function Ze(J,R,L){const V=new D.z(R);for(const W of J)W.recalculate(V,L)}class we{constructor(R,L,V){this.actor=R,this.layerIndex=L,this.availableImages=V,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(R,L){return D._(this,void 0,void 0,function*(){const V=yield D.l(R.request,L);try{return{vectorTile:new D.bt.VectorTile(new D.bu(V.data)),rawData:V.data,cacheControl:V.cacheControl,expires:V.expires}}catch(W){const re=new Uint8Array(V.data);let le=`Unable to parse the tile at ${R.request.url}, `;throw le+=re[0]===31&&re[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${W.message}`,new Error(le)}})}loadTile(R){return D._(this,void 0,void 0,function*(){const L=R.uid,V=!!(R&&R.request&&R.request.collectResourceTiming)&&new D.bv(R.request),W=new nt(R);this.loading[L]=W;const re=new AbortController;W.abort=re;try{const le=yield this.loadVectorTile(R,re);if(delete this.loading[L],!le)return null;const pe=le.rawData,te={};le.expires&&(te.expires=le.expires),le.cacheControl&&(te.cacheControl=le.cacheControl);const Te={};if(V){const ve=V.finish();ve&&(Te.resourceTiming=JSON.parse(JSON.stringify(ve)))}W.vectorTile=le.vectorTile;const Pe=W.parse(le.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[L]=W,this.fetching[L]={rawTileData:pe,cacheControl:te,resourceTiming:Te};try{const ve=yield Pe;return D.e({rawTileData:pe.slice(0)},ve,te,Te)}finally{delete this.fetching[L]}}catch(le){throw delete this.loading[L],W.status="done",this.loaded[L]=W,le}})}reloadTile(R){return D._(this,void 0,void 0,function*(){const L=R.uid;if(!this.loaded||!this.loaded[L])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const V=this.loaded[L];if(V.showCollisionBoxes=R.showCollisionBoxes,V.status==="parsing"){const W=yield V.parse(V.vectorTile,this.layerIndex,this.availableImages,this.actor);let re;if(this.fetching[L]){const{rawTileData:le,cacheControl:pe,resourceTiming:te}=this.fetching[L];delete this.fetching[L],re=D.e({rawTileData:le.slice(0)},W,pe,te)}else re=W;return re}if(V.status==="done"&&V.vectorTile)return V.parse(V.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(R){return D._(this,void 0,void 0,function*(){const L=this.loading,V=R.uid;L&&L[V]&&L[V].abort&&(L[V].abort.abort(),delete L[V])})}removeTile(R){return D._(this,void 0,void 0,function*(){this.loaded&&this.loaded[R.uid]&&delete this.loaded[R.uid]})}}class he{constructor(){this.loaded={}}loadTile(R){return D._(this,void 0,void 0,function*(){const{uid:L,encoding:V,rawImageData:W,redFactor:re,greenFactor:le,blueFactor:pe,baseShift:te}=R,Te=W.width+2,Pe=W.height+2,ve=D.b(W)?new D.R({width:Te,height:Pe},yield D.bw(W,-1,-1,Te,Pe)):W,Ne=new D.bx(L,ve,V,re,le,pe,te);return this.loaded=this.loaded||{},this.loaded[L]=Ne,Ne})}removeTile(R){const L=this.loaded,V=R.uid;L&&L[V]&&delete L[V]}}function Zt(J,R){if(J.length!==0){jt(J[0],R);for(var L=1;L<J.length;L++)jt(J[L],!R)}}function jt(J,R){for(var L=0,V=0,W=0,re=J.length,le=re-1;W<re;le=W++){var pe=(J[W][0]-J[le][0])*(J[le][1]+J[W][1]),te=L+pe;V+=Math.abs(L)>=Math.abs(pe)?L-te+pe:pe-te+L,L=te}L+V>=0!=!!R&&J.reverse()}var Ft=D.by(function J(R,L){var V,W=R&&R.type;if(W==="FeatureCollection")for(V=0;V<R.features.length;V++)J(R.features[V],L);else if(W==="GeometryCollection")for(V=0;V<R.geometries.length;V++)J(R.geometries[V],L);else if(W==="Feature")J(R.geometry,L);else if(W==="Polygon")Zt(R.coordinates,L);else if(W==="MultiPolygon")for(V=0;V<R.coordinates.length;V++)Zt(R.coordinates[V],L);return R});const mt=D.bt.VectorTileFeature.prototype.toGeoJSON;var Yt={exports:{}},_i=D.bz,vt=D.bt.VectorTileFeature,zt=At;function At(J,R){this.options=R||{},this.features=J,this.length=J.length}function Gt(J,R){this.id=typeof J.id=="number"?J.id:void 0,this.type=J.type,this.rawGeometry=J.type===1?[J.geometry]:J.geometry,this.properties=J.tags,this.extent=R||4096}At.prototype.feature=function(J){return new Gt(this.features[J],this.options.extent)},Gt.prototype.loadGeometry=function(){var J=this.rawGeometry;this.geometry=[];for(var R=0;R<J.length;R++){for(var L=J[R],V=[],W=0;W<L.length;W++)V.push(new _i(L[W][0],L[W][1]));this.geometry.push(V)}return this.geometry},Gt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var J=this.geometry,R=1/0,L=-1/0,V=1/0,W=-1/0,re=0;re<J.length;re++)for(var le=J[re],pe=0;pe<le.length;pe++){var te=le[pe];R=Math.min(R,te.x),L=Math.max(L,te.x),V=Math.min(V,te.y),W=Math.max(W,te.y)}return[R,V,L,W]},Gt.prototype.toGeoJSON=vt.prototype.toGeoJSON;var Wt=D.bA,yi=zt;function Ji(J){var R=new Wt;return function(L,V){for(var W in L.layers)V.writeMessage(3,Vr,L.layers[W])}(J,R),R.finish()}function Vr(J,R){var L;R.writeVarintField(15,J.version||1),R.writeStringField(1,J.name||""),R.writeVarintField(5,J.extent||4096);var V={keys:[],values:[],keycache:{},valuecache:{}};for(L=0;L<J.length;L++)V.feature=J.feature(L),R.writeMessage(2,Kt,V);var W=V.keys;for(L=0;L<W.length;L++)R.writeStringField(3,W[L]);var re=V.values;for(L=0;L<re.length;L++)R.writeMessage(4,ir,re[L])}function Kt(J,R){var L=J.feature;L.id!==void 0&&R.writeVarintField(1,L.id),R.writeMessage(2,dn,J),R.writeVarintField(3,L.type),R.writeMessage(4,ur,L)}function dn(J,R){var L=J.feature,V=J.keys,W=J.values,re=J.keycache,le=J.valuecache;for(var pe in L.properties){var te=L.properties[pe],Te=re[pe];if(te!==null){Te===void 0&&(V.push(pe),re[pe]=Te=V.length-1),R.writeVarint(Te);var Pe=typeof te;Pe!=="string"&&Pe!=="boolean"&&Pe!=="number"&&(te=JSON.stringify(te));var ve=Pe+":"+te,Ne=le[ve];Ne===void 0&&(W.push(te),le[ve]=Ne=W.length-1),R.writeVarint(Ne)}}}function bi(J,R){return(R<<3)+(7&J)}function Li(J){return J<<1^J>>31}function ur(J,R){for(var L=J.loadGeometry(),V=J.type,W=0,re=0,le=L.length,pe=0;pe<le;pe++){var te=L[pe],Te=1;V===1&&(Te=te.length),R.writeVarint(bi(1,Te));for(var Pe=V===3?te.length-1:te.length,ve=0;ve<Pe;ve++){ve===1&&V!==1&&R.writeVarint(bi(2,Pe-1));var Ne=te[ve].x-W,ot=te[ve].y-re;R.writeVarint(Li(Ne)),R.writeVarint(Li(ot)),W+=Ne,re+=ot}V===3&&R.writeVarint(bi(7,1))}}function ir(J,R){var L=typeof J;L==="string"?R.writeStringField(1,J):L==="boolean"?R.writeBooleanField(7,J):L==="number"&&(J%1!=0?R.writeDoubleField(3,J):J<0?R.writeSVarintField(6,J):R.writeVarintField(5,J))}Yt.exports=Ji,Yt.exports.fromVectorTileJs=Ji,Yt.exports.fromGeojsonVt=function(J,R){R=R||{};var L={};for(var V in J)L[V]=new yi(J[V].features,R),L[V].name=V,L[V].version=R.version,L[V].extent=R.extent;return Ji({layers:L})},Yt.exports.GeoJSONWrapper=yi;var hi=D.by(Yt.exports);const Qe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:J=>J},xt=Math.fround||(tt=new Float32Array(1),J=>(tt[0]=+J,tt[0]));var tt;const fe=3,Me=5,Bt=6;class Ot{constructor(R){this.options=Object.assign(Object.create(Qe),R),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(R){const{log:L,minZoom:V,maxZoom:W}=this.options;L&&console.time("total time");const re=`prepare ${R.length} points`;L&&console.time(re),this.points=R;const le=[];for(let te=0;te<R.length;te++){const Te=R[te];if(!Te.geometry)continue;const[Pe,ve]=Te.geometry.coordinates,Ne=xt(Xt(Pe)),ot=xt(Ht(ve));le.push(Ne,ot,1/0,te,-1,1),this.options.reduce&&le.push(0)}let pe=this.trees[W+1]=this._createTree(le);L&&console.timeEnd(re);for(let te=W;te>=V;te--){const Te=+Date.now();pe=this.trees[te]=this._createTree(this._cluster(pe,te)),L&&console.log("z%d: %d clusters in %dms",te,pe.numItems,+Date.now()-Te)}return L&&console.timeEnd("total time"),this}getClusters(R,L){let V=((R[0]+180)%360+360)%360-180;const W=Math.max(-90,Math.min(90,R[1]));let re=R[2]===180?180:((R[2]+180)%360+360)%360-180;const le=Math.max(-90,Math.min(90,R[3]));if(R[2]-R[0]>=360)V=-180,re=180;else if(V>re){const ve=this.getClusters([V,W,180,le],L),Ne=this.getClusters([-180,W,re,le],L);return ve.concat(Ne)}const pe=this.trees[this._limitZoom(L)],te=pe.range(Xt(V),Ht(le),Xt(re),Ht(W)),Te=pe.data,Pe=[];for(const ve of te){const Ne=this.stride*ve;Pe.push(Te[Ne+Me]>1?qt(Te,Ne,this.clusterProps):this.points[Te[Ne+fe]])}return Pe}getChildren(R){const L=this._getOriginId(R),V=this._getOriginZoom(R),W="No cluster with the specified id.",re=this.trees[V];if(!re)throw new Error(W);const le=re.data;if(L*this.stride>=le.length)throw new Error(W);const pe=this.options.radius/(this.options.extent*Math.pow(2,V-1)),te=re.within(le[L*this.stride],le[L*this.stride+1],pe),Te=[];for(const Pe of te){const ve=Pe*this.stride;le[ve+4]===R&&Te.push(le[ve+Me]>1?qt(le,ve,this.clusterProps):this.points[le[ve+fe]])}if(Te.length===0)throw new Error(W);return Te}getLeaves(R,L,V){const W=[];return this._appendLeaves(W,R,L=L||10,V=V||0,0),W}getTile(R,L,V){const W=this.trees[this._limitZoom(R)],re=Math.pow(2,R),{extent:le,radius:pe}=this.options,te=pe/le,Te=(V-te)/re,Pe=(V+1+te)/re,ve={features:[]};return this._addTileFeatures(W.range((L-te)/re,Te,(L+1+te)/re,Pe),W.data,L,V,re,ve),L===0&&this._addTileFeatures(W.range(1-te/re,Te,1,Pe),W.data,re,V,re,ve),L===re-1&&this._addTileFeatures(W.range(0,Te,te/re,Pe),W.data,-1,V,re,ve),ve.features.length?ve:null}getClusterExpansionZoom(R){let L=this._getOriginZoom(R)-1;for(;L<=this.options.maxZoom;){const V=this.getChildren(R);if(L++,V.length!==1)break;R=V[0].properties.cluster_id}return L}_appendLeaves(R,L,V,W,re){const le=this.getChildren(L);for(const pe of le){const te=pe.properties;if(te&&te.cluster?re+te.point_count<=W?re+=te.point_count:re=this._appendLeaves(R,te.cluster_id,V,W,re):re<W?re++:R.push(pe),R.length===V)break}return re}_createTree(R){const L=new D.av(R.length/this.stride|0,this.options.nodeSize,Float32Array);for(let V=0;V<R.length;V+=this.stride)L.add(R[V],R[V+1]);return L.finish(),L.data=R,L}_addTileFeatures(R,L,V,W,re,le){for(const pe of R){const te=pe*this.stride,Te=L[te+Me]>1;let Pe,ve,Ne;if(Te)Pe=Jt(L,te,this.clusterProps),ve=L[te],Ne=L[te+1];else{const ti=this.points[L[te+fe]];Pe=ti.properties;const[Ct,ii]=ti.geometry.coordinates;ve=Xt(Ct),Ne=Ht(ii)}const ot={type:1,geometry:[[Math.round(this.options.extent*(ve*re-V)),Math.round(this.options.extent*(Ne*re-W))]],tags:Pe};let pt;pt=Te||this.options.generateId?L[te+fe]:this.points[L[te+fe]].id,pt!==void 0&&(ot.id=pt),le.features.push(ot)}}_limitZoom(R){return Math.max(this.options.minZoom,Math.min(Math.floor(+R),this.options.maxZoom+1))}_cluster(R,L){const{radius:V,extent:W,reduce:re,minPoints:le}=this.options,pe=V/(W*Math.pow(2,L)),te=R.data,Te=[],Pe=this.stride;for(let ve=0;ve<te.length;ve+=Pe){if(te[ve+2]<=L)continue;te[ve+2]=L;const Ne=te[ve],ot=te[ve+1],pt=R.within(te[ve],te[ve+1],pe),ti=te[ve+Me];let Ct=ti;for(const ii of pt){const Rt=ii*Pe;te[Rt+2]>L&&(Ct+=te[Rt+Me])}if(Ct>ti&&Ct>=le){let ii,Rt=Ne*ti,qi=ot*ti,Bi=-1;const Ut=((ve/Pe|0)<<5)+(L+1)+this.points.length;for(const di of pt){const Pi=di*Pe;if(te[Pi+2]<=L)continue;te[Pi+2]=L;const sr=te[Pi+Me];Rt+=te[Pi]*sr,qi+=te[Pi+1]*sr,te[Pi+4]=Ut,re&&(ii||(ii=this._map(te,ve,!0),Bi=this.clusterProps.length,this.clusterProps.push(ii)),re(ii,this._map(te,Pi)))}te[ve+4]=Ut,Te.push(Rt/Ct,qi/Ct,1/0,Ut,-1,Ct),re&&Te.push(Bi)}else{for(let ii=0;ii<Pe;ii++)Te.push(te[ve+ii]);if(Ct>1)for(const ii of pt){const Rt=ii*Pe;if(!(te[Rt+2]<=L)){te[Rt+2]=L;for(let qi=0;qi<Pe;qi++)Te.push(te[Rt+qi])}}}}return Te}_getOriginId(R){return R-this.points.length>>5}_getOriginZoom(R){return(R-this.points.length)%32}_map(R,L,V){if(R[L+Me]>1){const le=this.clusterProps[R[L+Bt]];return V?Object.assign({},le):le}const W=this.points[R[L+fe]].properties,re=this.options.map(W);return V&&re===W?Object.assign({},re):re}}function qt(J,R,L){return{type:"Feature",id:J[R+fe],properties:Jt(J,R,L),geometry:{type:"Point",coordinates:[(V=J[R],360*(V-.5)),vi(J[R+1])]}};var V}function Jt(J,R,L){const V=J[R+Me],W=V>=1e4?`${Math.round(V/1e3)}k`:V>=1e3?Math.round(V/100)/10+"k":V,re=J[R+Bt],le=re===-1?{}:Object.assign({},L[re]);return Object.assign(le,{cluster:!0,cluster_id:J[R+fe],point_count:V,point_count_abbreviated:W})}function Xt(J){return J/360+.5}function Ht(J){const R=Math.sin(J*Math.PI/180),L=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return L<0?0:L>1?1:L}function vi(J){const R=(180-360*J)*Math.PI/180;return 360*Math.atan(Math.exp(R))/Math.PI-90}function rr(J,R,L,V){let W=V;const re=R+(L-R>>1);let le,pe=L-R;const te=J[R],Te=J[R+1],Pe=J[L],ve=J[L+1];for(let Ne=R+3;Ne<L;Ne+=3){const ot=Ys(J[Ne],J[Ne+1],te,Te,Pe,ve);if(ot>W)le=Ne,W=ot;else if(ot===W){const pt=Math.abs(Ne-re);pt<pe&&(le=Ne,pe=pt)}}W>V&&(le-R>3&&rr(J,R,le,V),J[le+2]=W,L-le>3&&rr(J,le,L,V))}function Ys(J,R,L,V,W,re){let le=W-L,pe=re-V;if(le!==0||pe!==0){const te=((J-L)*le+(R-V)*pe)/(le*le+pe*pe);te>1?(L=W,V=re):te>0&&(L+=le*te,V+=pe*te)}return le=J-L,pe=R-V,le*le+pe*pe}function os(J,R,L,V){const W={id:J??null,type:R,geometry:L,tags:V,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(R==="Point"||R==="MultiPoint"||R==="LineString")Vn(W,L);else if(R==="Polygon")Vn(W,L[0]);else if(R==="MultiLineString")for(const re of L)Vn(W,re);else if(R==="MultiPolygon")for(const re of L)Vn(W,re[0]);return W}function Vn(J,R){for(let L=0;L<R.length;L+=3)J.minX=Math.min(J.minX,R[L]),J.minY=Math.min(J.minY,R[L+1]),J.maxX=Math.max(J.maxX,R[L]),J.maxY=Math.max(J.maxY,R[L+1])}function as(J,R,L,V){if(!R.geometry)return;const W=R.geometry.coordinates;if(W&&W.length===0)return;const re=R.geometry.type,le=Math.pow(L.tolerance/((1<<L.maxZoom)*L.extent),2);let pe=[],te=R.id;if(L.promoteId?te=R.properties[L.promoteId]:L.generateId&&(te=V||0),re==="Point")So(W,pe);else if(re==="MultiPoint")for(const Te of W)So(Te,pe);else if(re==="LineString")be(W,pe,le,!1);else if(re==="MultiLineString"){if(L.lineMetrics){for(const Te of W)pe=[],be(Te,pe,le,!1),J.push(os(te,"LineString",pe,R.properties));return}Ss(W,pe,le,!1)}else if(re==="Polygon")Ss(W,pe,le,!0);else{if(re!=="MultiPolygon"){if(re==="GeometryCollection"){for(const Te of R.geometry.geometries)as(J,{id:te,geometry:Te,properties:R.properties},L,V);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Te of W){const Pe=[];Ss(Te,Pe,le,!0),pe.push(Pe)}}J.push(os(te,re,pe,R.properties))}function So(J,R){R.push(oa(J[0]),ei(J[1]),0)}function be(J,R,L,V){let W,re,le=0;for(let te=0;te<J.length;te++){const Te=oa(J[te][0]),Pe=ei(J[te][1]);R.push(Te,Pe,0),te>0&&(le+=V?(W*Pe-Te*re)/2:Math.sqrt(Math.pow(Te-W,2)+Math.pow(Pe-re,2))),W=Te,re=Pe}const pe=R.length-3;R[2]=1,rr(R,0,pe,L),R[pe+2]=1,R.size=Math.abs(le),R.start=0,R.end=R.size}function Ss(J,R,L,V){for(let W=0;W<J.length;W++){const re=[];be(J[W],re,L,V),R.push(re)}}function oa(J){return J/360+.5}function ei(J){const R=Math.sin(J*Math.PI/180),L=.5-.25*Math.log((1+R)/(1-R))/Math.PI;return L<0?0:L>1?1:L}function Ii(J,R,L,V,W,re,le,pe){if(V/=R,re>=(L/=R)&&le<V)return J;if(le<L||re>=V)return null;const te=[];for(const Te of J){const Pe=Te.geometry;let ve=Te.type;const Ne=W===0?Te.minX:Te.minY,ot=W===0?Te.maxX:Te.maxY;if(Ne>=L&&ot<V){te.push(Te);continue}if(ot<L||Ne>=V)continue;let pt=[];if(ve==="Point"||ve==="MultiPoint")ls(Pe,pt,L,V,W);else if(ve==="LineString")us(Pe,pt,L,V,W,!1,pe.lineMetrics);else if(ve==="MultiLineString")To(Pe,pt,L,V,W,!1);else if(ve==="Polygon")To(Pe,pt,L,V,W,!0);else if(ve==="MultiPolygon")for(const ti of Pe){const Ct=[];To(ti,Ct,L,V,W,!0),Ct.length&&pt.push(Ct)}if(pt.length){if(pe.lineMetrics&&ve==="LineString"){for(const ti of pt)te.push(os(Te.id,ve,ti,Te.tags));continue}ve!=="LineString"&&ve!=="MultiLineString"||(pt.length===1?(ve="LineString",pt=pt[0]):ve="MultiLineString"),ve!=="Point"&&ve!=="MultiPoint"||(ve=pt.length===3?"Point":"MultiPoint"),te.push(os(Te.id,ve,pt,Te.tags))}}return te.length?te:null}function ls(J,R,L,V,W){for(let re=0;re<J.length;re+=3){const le=J[re+W];le>=L&&le<=V&&pn(R,J[re],J[re+1],J[re+2])}}function us(J,R,L,V,W,re,le){let pe=cs(J);const te=W===0?aa:ko;let Te,Pe,ve=J.start;for(let Ct=0;Ct<J.length-3;Ct+=3){const ii=J[Ct],Rt=J[Ct+1],qi=J[Ct+2],Bi=J[Ct+3],Ut=J[Ct+4],di=W===0?ii:Rt,Pi=W===0?Bi:Ut;let sr=!1;le&&(Te=Math.sqrt(Math.pow(ii-Bi,2)+Math.pow(Rt-Ut,2))),di<L?Pi>L&&(Pe=te(pe,ii,Rt,Bi,Ut,L),le&&(pe.start=ve+Te*Pe)):di>V?Pi<V&&(Pe=te(pe,ii,Rt,Bi,Ut,V),le&&(pe.start=ve+Te*Pe)):pn(pe,ii,Rt,qi),Pi<L&&di>=L&&(Pe=te(pe,ii,Rt,Bi,Ut,L),sr=!0),Pi>V&&di<=V&&(Pe=te(pe,ii,Rt,Bi,Ut,V),sr=!0),!re&&sr&&(le&&(pe.end=ve+Te*Pe),R.push(pe),pe=cs(J)),le&&(ve+=Te)}let Ne=J.length-3;const ot=J[Ne],pt=J[Ne+1],ti=W===0?ot:pt;ti>=L&&ti<=V&&pn(pe,ot,pt,J[Ne+2]),Ne=pe.length-3,re&&Ne>=3&&(pe[Ne]!==pe[0]||pe[Ne+1]!==pe[1])&&pn(pe,pe[0],pe[1],pe[2]),pe.length&&R.push(pe)}function cs(J){const R=[];return R.size=J.size,R.start=J.start,R.end=J.end,R}function To(J,R,L,V,W,re){for(const le of J)us(le,R,L,V,W,re,!1)}function pn(J,R,L,V){J.push(R,L,V)}function aa(J,R,L,V,W,re){const le=(re-R)/(V-R);return pn(J,re,L+(W-L)*le,1),le}function ko(J,R,L,V,W,re){const le=(re-L)/(W-L);return pn(J,R+(V-R)*le,re,1),le}function Fe(J,R){const L=[];for(let V=0;V<J.length;V++){const W=J[V],re=W.type;let le;if(re==="Point"||re==="MultiPoint"||re==="LineString")le=jn(W.geometry,R);else if(re==="MultiLineString"||re==="Polygon"){le=[];for(const pe of W.geometry)le.push(jn(pe,R))}else if(re==="MultiPolygon"){le=[];for(const pe of W.geometry){const te=[];for(const Te of pe)te.push(jn(Te,R));le.push(te)}}L.push(os(W.id,re,le,W.tags))}return L}function jn(J,R){const L=[];L.size=J.size,J.start!==void 0&&(L.start=J.start,L.end=J.end);for(let V=0;V<J.length;V+=3)L.push(J[V]+R,J[V+1],J[V+2]);return L}function nr(J,R){if(J.transformed)return J;const L=1<<J.z,V=J.x,W=J.y;for(const re of J.features){const le=re.geometry,pe=re.type;if(re.geometry=[],pe===1)for(let te=0;te<le.length;te+=2)re.geometry.push(Jr(le[te],le[te+1],R,L,V,W));else for(let te=0;te<le.length;te++){const Te=[];for(let Pe=0;Pe<le[te].length;Pe+=2)Te.push(Jr(le[te][Pe],le[te][Pe+1],R,L,V,W));re.geometry.push(Te)}}return J.transformed=!0,J}function Jr(J,R,L,V,W,re){return[Math.round(L*(J*V-W)),Math.round(L*(R*V-re))]}function Qs(J,R,L,V,W){const re=R===W.maxZoom?0:W.tolerance/((1<<R)*W.extent),le={features:[],numPoints:0,numSimplified:0,numFeatures:J.length,source:null,x:L,y:V,z:R,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const pe of J)Ue(le,pe,re,W);return le}function Ue(J,R,L,V){const W=R.geometry,re=R.type,le=[];if(J.minX=Math.min(J.minX,R.minX),J.minY=Math.min(J.minY,R.minY),J.maxX=Math.max(J.maxX,R.maxX),J.maxY=Math.max(J.maxY,R.maxY),re==="Point"||re==="MultiPoint")for(let pe=0;pe<W.length;pe+=3)le.push(W[pe],W[pe+1]),J.numPoints++,J.numSimplified++;else if(re==="LineString")Nt(le,W,J,L,!1,!1);else if(re==="MultiLineString"||re==="Polygon")for(let pe=0;pe<W.length;pe++)Nt(le,W[pe],J,L,re==="Polygon",pe===0);else if(re==="MultiPolygon")for(let pe=0;pe<W.length;pe++){const te=W[pe];for(let Te=0;Te<te.length;Te++)Nt(le,te[Te],J,L,!0,Te===0)}if(le.length){let pe=R.tags||null;if(re==="LineString"&&V.lineMetrics){pe={};for(const Te in R.tags)pe[Te]=R.tags[Te];pe.mapbox_clip_start=W.start/W.size,pe.mapbox_clip_end=W.end/W.size}const te={geometry:le,type:re==="Polygon"||re==="MultiPolygon"?3:re==="LineString"||re==="MultiLineString"?2:1,tags:pe};R.id!==null&&(te.id=R.id),J.features.push(te)}}function Nt(J,R,L,V,W,re){const le=V*V;if(V>0&&R.size<(W?le:V))return void(L.numPoints+=R.length/3);const pe=[];for(let te=0;te<R.length;te+=3)(V===0||R[te+2]>le)&&(L.numSimplified++,pe.push(R[te],R[te+1])),L.numPoints++;W&&function(te,Te){let Pe=0;for(let ve=0,Ne=te.length,ot=Ne-2;ve<Ne;ot=ve,ve+=2)Pe+=(te[ve]-te[ot])*(te[ve+1]+te[ot+1]);if(Pe>0===Te)for(let ve=0,Ne=te.length;ve<Ne/2;ve+=2){const ot=te[ve],pt=te[ve+1];te[ve]=te[Ne-2-ve],te[ve+1]=te[Ne-1-ve],te[Ne-2-ve]=ot,te[Ne-1-ve]=pt}}(pe,re),J.push(pe)}const wt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Er{constructor(R,L){const V=(L=this.options=function(re,le){for(const pe in le)re[pe]=le[pe];return re}(Object.create(wt),L)).debug;if(V&&console.time("preprocess data"),L.maxZoom<0||L.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(L.promoteId&&L.generateId)throw new Error("promoteId and generateId cannot be used together.");let W=function(re,le){const pe=[];if(re.type==="FeatureCollection")for(let te=0;te<re.features.length;te++)as(pe,re.features[te],le,te);else as(pe,re.type==="Feature"?re:{geometry:re},le);return pe}(R,L);this.tiles={},this.tileCoords=[],V&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",L.indexMaxZoom,L.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),W=function(re,le){const pe=le.buffer/le.extent;let te=re;const Te=Ii(re,1,-1-pe,pe,0,-1,2,le),Pe=Ii(re,1,1-pe,2+pe,0,-1,2,le);return(Te||Pe)&&(te=Ii(re,1,-pe,1+pe,0,-1,2,le)||[],Te&&(te=Fe(Te,1).concat(te)),Pe&&(te=te.concat(Fe(Pe,-1)))),te}(W,L),W.length&&this.splitTile(W,0,0,0),V&&(W.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(R,L,V,W,re,le,pe){const te=[R,L,V,W],Te=this.options,Pe=Te.debug;for(;te.length;){W=te.pop(),V=te.pop(),L=te.pop(),R=te.pop();const ve=1<<L,Ne=fn(L,V,W);let ot=this.tiles[Ne];if(!ot&&(Pe>1&&console.time("creation"),ot=this.tiles[Ne]=Qs(R,L,V,W,Te),this.tileCoords.push({z:L,x:V,y:W}),Pe)){Pe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",L,V,W,ot.numFeatures,ot.numPoints,ot.numSimplified),console.timeEnd("creation"));const sr=`z${L}`;this.stats[sr]=(this.stats[sr]||0)+1,this.total++}if(ot.source=R,re==null){if(L===Te.indexMaxZoom||ot.numPoints<=Te.indexMaxPoints)continue}else{if(L===Te.maxZoom||L===re)continue;if(re!=null){const sr=re-L;if(V!==le>>sr||W!==pe>>sr)continue}}if(ot.source=null,R.length===0)continue;Pe>1&&console.time("clipping");const pt=.5*Te.buffer/Te.extent,ti=.5-pt,Ct=.5+pt,ii=1+pt;let Rt=null,qi=null,Bi=null,Ut=null,di=Ii(R,ve,V-pt,V+Ct,0,ot.minX,ot.maxX,Te),Pi=Ii(R,ve,V+ti,V+ii,0,ot.minX,ot.maxX,Te);R=null,di&&(Rt=Ii(di,ve,W-pt,W+Ct,1,ot.minY,ot.maxY,Te),qi=Ii(di,ve,W+ti,W+ii,1,ot.minY,ot.maxY,Te),di=null),Pi&&(Bi=Ii(Pi,ve,W-pt,W+Ct,1,ot.minY,ot.maxY,Te),Ut=Ii(Pi,ve,W+ti,W+ii,1,ot.minY,ot.maxY,Te),Pi=null),Pe>1&&console.timeEnd("clipping"),te.push(Rt||[],L+1,2*V,2*W),te.push(qi||[],L+1,2*V,2*W+1),te.push(Bi||[],L+1,2*V+1,2*W),te.push(Ut||[],L+1,2*V+1,2*W+1)}}getTile(R,L,V){R=+R,L=+L,V=+V;const W=this.options,{extent:re,debug:le}=W;if(R<0||R>24)return null;const pe=1<<R,te=fn(R,L=L+pe&pe-1,V);if(this.tiles[te])return nr(this.tiles[te],re);le>1&&console.log("drilling down to z%d-%d-%d",R,L,V);let Te,Pe=R,ve=L,Ne=V;for(;!Te&&Pe>0;)Pe--,ve>>=1,Ne>>=1,Te=this.tiles[fn(Pe,ve,Ne)];return Te&&Te.source?(le>1&&(console.log("found parent tile z%d-%d-%d",Pe,ve,Ne),console.time("drilling down")),this.splitTile(Te.source,Pe,ve,Ne,R,L,V),le>1&&console.timeEnd("drilling down"),this.tiles[te]?nr(this.tiles[te],re):null):null}}function fn(J,R,L){return 32*((1<<J)*L+R)+J}function kt(J,R){return R?J.properties[R]:J.id}function In(J,R){if(J==null)return!0;if(J.type==="Feature")return kt(J,R)!=null;if(J.type==="FeatureCollection"){const L=new Set;for(const V of J.features){const W=kt(V,R);if(W==null||L.has(W))return!1;L.add(W)}return!0}return!1}function Un(J,R){const L=new Map;if(J!=null)if(J.type==="Feature")L.set(kt(J,R),J);else for(const V of J.features)L.set(kt(V,R),V);return L}class mn extends we{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(R,L){return D._(this,void 0,void 0,function*(){const V=R.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const W=this._geoJSONIndex.getTile(V.z,V.x,V.y);if(!W)return null;const re=new class{constructor(pe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=D.X,this.length=pe.length,this._features=pe}feature(pe){return new class{constructor(te){this._feature=te,this.extent=D.X,this.type=te.type,this.properties=te.tags,"id"in te&&!isNaN(te.id)&&(this.id=parseInt(te.id,10))}loadGeometry(){if(this._feature.type===1){const te=[];for(const Te of this._feature.geometry)te.push([new D.P(Te[0],Te[1])]);return te}{const te=[];for(const Te of this._feature.geometry){const Pe=[];for(const ve of Te)Pe.push(new D.P(ve[0],ve[1]));te.push(Pe)}return te}}toGeoJSON(te,Te,Pe){return mt.call(this,te,Te,Pe)}}(this._features[pe])}}(W.features);let le=hi(re);return le.byteOffset===0&&le.byteLength===le.buffer.byteLength||(le=new Uint8Array(le)),{vectorTile:re,rawData:le.buffer}})}loadData(R){return D._(this,void 0,void 0,function*(){var L;(L=this._pendingRequest)===null||L===void 0||L.abort();const V=!!(R&&R.request&&R.request.collectResourceTiming)&&new D.bv(R.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(R,this._pendingRequest),this._geoJSONIndex=R.cluster?new Ot(function({superclusterOptions:le,clusterProperties:pe}){if(!pe||!le)return le;const te={},Te={},Pe={accumulated:null,zoom:0},ve={properties:null},Ne=Object.keys(pe);for(const ot of Ne){const[pt,ti]=pe[ot],Ct=D.bC(ti),ii=D.bC(typeof pt=="string"?[pt,["accumulated"],["get",ot]]:pt);te[ot]=Ct.value,Te[ot]=ii.value}return le.map=ot=>{ve.properties=ot;const pt={};for(const ti of Ne)pt[ti]=te[ti].evaluate(Pe,ve);return pt},le.reduce=(ot,pt)=>{ve.properties=pt;for(const ti of Ne)Pe.accumulated=ot[ti],ot[ti]=Te[ti].evaluate(Pe,ve)},le}(R)).load((yield this._pendingData).features):(W=yield this._pendingData,new Er(W,R.geojsonVtOptions)),this.loaded={};const re={};if(V){const le=V.finish();le&&(re.resourceTiming={},re.resourceTiming[R.source]=JSON.parse(JSON.stringify(le)))}return re}catch(re){if(delete this._pendingRequest,D.bB(re))return{abandoned:!0};throw re}var W})}getData(){return D._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(R){const L=this.loaded;return L&&L[R.uid]?super.reloadTile(R):this.loadTile(R)}loadAndProcessGeoJSON(R,L){return D._(this,void 0,void 0,function*(){let V=yield this.loadGeoJSON(R,L);if(delete this._pendingRequest,typeof V!="object")throw new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`);if(Ft(V,!0),R.filter){const W=D.bC(R.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(W.result==="error")throw new Error(W.value.map(le=>`${le.key}: ${le.message}`).join(", "));V={type:"FeatureCollection",features:V.features.filter(le=>W.value.evaluate({zoom:0},le))}}return V})}loadGeoJSON(R,L){return D._(this,void 0,void 0,function*(){const{promoteId:V}=R;if(R.request){const W=yield D.h(R.request,L);return this._dataUpdateable=In(W.data,V)?Un(W.data,V):void 0,W.data}if(typeof R.data=="string")try{const W=JSON.parse(R.data);return this._dataUpdateable=In(W,V)?Un(W,V):void 0,W}catch{throw new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`)}if(!R.dataDiff)throw new Error(`Input data given to '${R.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${R.source}`);return function(W,re,le){var pe,te,Te,Pe;if(re.removeAll&&W.clear(),re.remove)for(const ve of re.remove)W.delete(ve);if(re.add)for(const ve of re.add){const Ne=kt(ve,le);Ne!=null&&W.set(Ne,ve)}if(re.update)for(const ve of re.update){let Ne=W.get(ve.id);if(Ne==null)continue;const ot=!ve.removeAllProperties&&(((pe=ve.removeProperties)===null||pe===void 0?void 0:pe.length)>0||((te=ve.addOrUpdateProperties)===null||te===void 0?void 0:te.length)>0);if((ve.newGeometry||ve.removeAllProperties||ot)&&(Ne=Object.assign({},Ne),W.set(ve.id,Ne),ot&&(Ne.properties=Object.assign({},Ne.properties))),ve.newGeometry&&(Ne.geometry=ve.newGeometry),ve.removeAllProperties)Ne.properties={};else if(((Te=ve.removeProperties)===null||Te===void 0?void 0:Te.length)>0)for(const pt of ve.removeProperties)Object.prototype.hasOwnProperty.call(Ne.properties,pt)&&delete Ne.properties[pt];if(((Pe=ve.addOrUpdateProperties)===null||Pe===void 0?void 0:Pe.length)>0)for(const{key:pt,value:ti}of ve.addOrUpdateProperties)Ne.properties[pt]=ti}}(this._dataUpdateable,R.dataDiff,V),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(R){return D._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(R){return this._geoJSONIndex.getClusterExpansionZoom(R.clusterId)}getClusterChildren(R){return this._geoJSONIndex.getChildren(R.clusterId)}getClusterLeaves(R){return this._geoJSONIndex.getLeaves(R.clusterId,R.limit,R.offset)}}class jr{constructor(R){this.self=R,this.actor=new D.F(R),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(L,V)=>{if(this.externalWorkerSourceTypes[L])throw new Error(`Worker source with name "${L}" already registered.`);this.externalWorkerSourceTypes[L]=V},this.self.addProtocol=D.bi,this.self.removeProtocol=D.bj,this.self.registerRTLTextPlugin=L=>{if(D.bD.isParsed())throw new Error("RTL text plugin already registered.");D.bD.setMethods(L)},this.actor.registerMessageHandler("LDT",(L,V)=>this._getDEMWorkerSource(L,V.source).loadTile(V)),this.actor.registerMessageHandler("RDT",(L,V)=>D._(this,void 0,void 0,function*(){this._getDEMWorkerSource(L,V.source).removeTile(V)})),this.actor.registerMessageHandler("GCEZ",(L,V)=>D._(this,void 0,void 0,function*(){return this._getWorkerSource(L,V.type,V.source).getClusterExpansionZoom(V)})),this.actor.registerMessageHandler("GCC",(L,V)=>D._(this,void 0,void 0,function*(){return this._getWorkerSource(L,V.type,V.source).getClusterChildren(V)})),this.actor.registerMessageHandler("GCL",(L,V)=>D._(this,void 0,void 0,function*(){return this._getWorkerSource(L,V.type,V.source).getClusterLeaves(V)})),this.actor.registerMessageHandler("LD",(L,V)=>this._getWorkerSource(L,V.type,V.source).loadData(V)),this.actor.registerMessageHandler("GD",(L,V)=>this._getWorkerSource(L,V.type,V.source).getData()),this.actor.registerMessageHandler("LT",(L,V)=>this._getWorkerSource(L,V.type,V.source).loadTile(V)),this.actor.registerMessageHandler("RT",(L,V)=>this._getWorkerSource(L,V.type,V.source).reloadTile(V)),this.actor.registerMessageHandler("AT",(L,V)=>this._getWorkerSource(L,V.type,V.source).abortTile(V)),this.actor.registerMessageHandler("RMT",(L,V)=>this._getWorkerSource(L,V.type,V.source).removeTile(V)),this.actor.registerMessageHandler("RS",(L,V)=>D._(this,void 0,void 0,function*(){if(!this.workerSources[L]||!this.workerSources[L][V.type]||!this.workerSources[L][V.type][V.source])return;const W=this.workerSources[L][V.type][V.source];delete this.workerSources[L][V.type][V.source],W.removeSource!==void 0&&W.removeSource(V)})),this.actor.registerMessageHandler("RM",L=>D._(this,void 0,void 0,function*(){delete this.layerIndexes[L],delete this.availableImages[L],delete this.workerSources[L],delete this.demWorkerSources[L]})),this.actor.registerMessageHandler("SR",(L,V)=>D._(this,void 0,void 0,function*(){this.referrer=V})),this.actor.registerMessageHandler("SRPS",(L,V)=>this._syncRTLPluginState(L,V)),this.actor.registerMessageHandler("IS",(L,V)=>D._(this,void 0,void 0,function*(){this.self.importScripts(V)})),this.actor.registerMessageHandler("SI",(L,V)=>this._setImages(L,V)),this.actor.registerMessageHandler("UL",(L,V)=>D._(this,void 0,void 0,function*(){this._getLayerIndex(L).update(V.layers,V.removedIds)})),this.actor.registerMessageHandler("SL",(L,V)=>D._(this,void 0,void 0,function*(){this._getLayerIndex(L).replace(V)}))}_setImages(R,L){return D._(this,void 0,void 0,function*(){this.availableImages[R]=L;for(const V in this.workerSources[R]){const W=this.workerSources[R][V];for(const re in W)W[re].availableImages=L}})}_syncRTLPluginState(R,L){return D._(this,void 0,void 0,function*(){if(D.bD.isParsed())return D.bD.getState();if(L.pluginStatus!=="loading")return D.bD.setState(L),L;const V=L.pluginURL;if(this.self.importScripts(V),D.bD.isParsed()){const W={pluginStatus:"loaded",pluginURL:V};return D.bD.setState(W),W}throw D.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${V}`)})}_getAvailableImages(R){let L=this.availableImages[R];return L||(L=[]),L}_getLayerIndex(R){let L=this.layerIndexes[R];return L||(L=this.layerIndexes[R]=new g),L}_getWorkerSource(R,L,V){if(this.workerSources[R]||(this.workerSources[R]={}),this.workerSources[R][L]||(this.workerSources[R][L]={}),!this.workerSources[R][L][V]){const W={sendAsync:(re,le)=>(re.targetMapId=R,this.actor.sendAsync(re,le))};switch(L){case"vector":this.workerSources[R][L][V]=new we(W,this._getLayerIndex(R),this._getAvailableImages(R));break;case"geojson":this.workerSources[R][L][V]=new mn(W,this._getLayerIndex(R),this._getAvailableImages(R));break;default:this.workerSources[R][L][V]=new this.externalWorkerSourceTypes[L](W,this._getLayerIndex(R),this._getAvailableImages(R))}}return this.workerSources[R][L][V]}_getDEMWorkerSource(R,L){return this.demWorkerSources[R]||(this.demWorkerSources[R]={}),this.demWorkerSources[R][L]||(this.demWorkerSources[R][L]=new he),this.demWorkerSources[R][L]}}return D.i(self)&&(self.worker=new jr(self)),jr}),me("index",["exports","./shared"],function(D,g){var ze="4.7.1";let nt,Ze;const we={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:p=>new Promise((e,s)=>{const l=requestAnimationFrame(e);p.signal.addEventListener("abort",()=>{cancelAnimationFrame(l),s(g.c())})}),getImageData(p,e=0){return this.getImageCanvasContext(p).getImageData(-e,-e,p.width+2*e,p.height+2*e)},getImageCanvasContext(p){const e=window.document.createElement("canvas"),s=e.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return e.width=p.width,e.height=p.height,s.drawImage(p,0,0,p.width,p.height),s},resolveURL:p=>(nt||(nt=document.createElement("a")),nt.href=p,nt.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Ze==null&&(Ze=matchMedia("(prefers-reduced-motion: reduce)")),Ze.matches)}};class he{static testProp(e){if(!he.docStyle)return e[0];for(let s=0;s<e.length;s++)if(e[s]in he.docStyle)return e[s];return e[0]}static create(e,s,l){const u=window.document.createElement(e);return s!==void 0&&(u.className=s),l&&l.appendChild(u),u}static createNS(e,s){return window.document.createElementNS(e,s)}static disableDrag(){he.docStyle&&he.selectProp&&(he.userSelect=he.docStyle[he.selectProp],he.docStyle[he.selectProp]="none")}static enableDrag(){he.docStyle&&he.selectProp&&(he.docStyle[he.selectProp]=he.userSelect)}static setTransform(e,s){e.style[he.transformProp]=s}static addEventListener(e,s,l,u={}){e.addEventListener(s,l,"passive"in u?u:u.capture)}static removeEventListener(e,s,l,u={}){e.removeEventListener(s,l,"passive"in u?u:u.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",he.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",he.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",he.suppressClickInternal,!0)},0)}static getScale(e){const s=e.getBoundingClientRect();return{x:s.width/e.offsetWidth||1,y:s.height/e.offsetHeight||1,boundingClientRect:s}}static getPoint(e,s,l){const u=s.boundingClientRect;return new g.P((l.clientX-u.left)/s.x-e.clientLeft,(l.clientY-u.top)/s.y-e.clientTop)}static mousePos(e,s){const l=he.getScale(e);return he.getPoint(e,l,s)}static touchPos(e,s){const l=[],u=he.getScale(e);for(let d=0;d<s.length;d++)l.push(he.getPoint(e,u,s[d]));return l}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}he.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,he.selectProp=he.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),he.transformProp=he.testProp(["transform","WebkitTransform"]);const Zt={supported:!1,testSupport:function(p){!mt&&Ft&&(Yt?_i(p):jt=p)}};let jt,Ft,mt=!1,Yt=!1;function _i(p){const e=p.createTexture();p.bindTexture(p.TEXTURE_2D,e);try{if(p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,Ft),p.isContextLost())return;Zt.supported=!0}catch{}p.deleteTexture(e),mt=!0}var vt;typeof document<"u"&&(Ft=document.createElement("img"),Ft.onload=()=>{jt&&_i(jt),jt=null,Yt=!0},Ft.onerror=()=>{mt=!0,jt=null},Ft.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(p){let e,s,l,u;p.resetRequestQueue=()=>{e=[],s=0,l=0,u={}},p.addThrottleControl=S=>{const I=l++;return u[I]=S,I},p.removeThrottleControl=S=>{delete u[S],v()},p.getImage=(S,I,P=!0)=>new Promise((M,B)=>{Zt.supported&&(S.headers||(S.headers={}),S.headers.accept="image/webp,*/*"),g.e(S,{type:"image"}),e.push({abortController:I,requestParameters:S,supportImageRefresh:P,state:"queued",onError:j=>{B(j)},onSuccess:j=>{M(j)}}),v()});const d=S=>g._(this,void 0,void 0,function*(){S.state="running";const{requestParameters:I,supportImageRefresh:P,onError:M,onSuccess:B,abortController:j}=S,q=P===!1&&!g.i(self)&&!g.g(I.url)&&(!I.headers||Object.keys(I.headers).reduce((Y,ie)=>Y&&ie==="accept",!0));s++;const G=q?w(I,j):g.m(I,j);try{const Y=yield G;delete S.abortController,S.state="completed",Y.data instanceof HTMLImageElement||g.b(Y.data)?B(Y):Y.data&&B({data:yield(X=Y.data,typeof createImageBitmap=="function"?g.d(X):g.f(X)),cacheControl:Y.cacheControl,expires:Y.expires})}catch(Y){delete S.abortController,M(Y)}finally{s--,v()}var X}),v=()=>{const S=(()=>{for(const I of Object.keys(u))if(u[I]())return!0;return!1})()?g.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:g.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let I=s;I<S&&e.length>0;I++){const P=e.shift();P.abortController.signal.aborted?I--:d(P)}},w=(S,I)=>new Promise((P,M)=>{const B=new Image,j=S.url,q=S.credentials;q&&q==="include"?B.crossOrigin="use-credentials":(q&&q==="same-origin"||!g.s(j))&&(B.crossOrigin="anonymous"),I.signal.addEventListener("abort",()=>{B.src="",M(g.c())}),B.fetchPriority="high",B.onload=()=>{B.onerror=B.onload=null,P({data:B})},B.onerror=()=>{B.onerror=B.onload=null,I.signal.aborted||M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},B.src=j})}(vt||(vt={})),vt.resetRequestQueue();class zt{constructor(e){this._transformRequestFn=e}transformRequest(e,s){return this._transformRequestFn&&this._transformRequestFn(e,s)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function At(p){var e=new g.A(3);return e[0]=p[0],e[1]=p[1],e[2]=p[2],e}var Gt,Wt=function(p,e,s){return p[0]=e[0]-s[0],p[1]=e[1]-s[1],p[2]=e[2]-s[2],p};Gt=new g.A(3),g.A!=Float32Array&&(Gt[0]=0,Gt[1]=0,Gt[2]=0);var yi=function(p){var e=p[0],s=p[1];return e*e+s*s};function Ji(p){const e=[];if(typeof p=="string")e.push({id:"default",url:p});else if(p&&p.length>0){const s=[];for(const{id:l,url:u}of p){const d=`${l}${u}`;s.indexOf(d)===-1&&(s.push(d),e.push({id:l,url:u}))}}return e}function Vr(p,e,s){const l=p.split("?");return l[0]+=`${e}${s}`,l.join("?")}(function(){var p=new g.A(2);g.A!=Float32Array&&(p[0]=0,p[1]=0)})();class Kt{constructor(e,s,l,u){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(s,u)}update(e,s,l){const{width:u,height:d}=e,v=!(this.size&&this.size[0]===u&&this.size[1]===d||l),{context:w}=this,{gl:S}=w;if(this.useMipmap=!!(s&&s.useMipmap),S.bindTexture(S.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!s||s.premultiply!==!1)),v)this.size=[u,d],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||g.b(e)?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,e):S.texImage2D(S.TEXTURE_2D,0,this.format,u,d,0,this.format,S.UNSIGNED_BYTE,e.data);else{const{x:I,y:P}=l||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||g.b(e)?S.texSubImage2D(S.TEXTURE_2D,0,I,P,S.RGBA,S.UNSIGNED_BYTE,e):S.texSubImage2D(S.TEXTURE_2D,0,I,P,u,d,S.RGBA,S.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&S.generateMipmap(S.TEXTURE_2D)}bind(e,s,l){const{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),l!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=d.LINEAR),e!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,l||e),this.filter=e),s!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,s),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function dn(p){const{userImage:e}=p;return!!(e&&e.render&&e.render())&&(p.data.replace(new Uint8Array(e.data.buffer)),!0)}class bi extends g.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new g.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:s,promiseResolve:l}of this.requestors)l(this._getImagesForIds(s));this.requestors=[]}}getImage(e){const s=this.images[e];if(s&&!s.data&&s.spriteData){const l=s.spriteData;s.data=new g.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),s.spriteData=null}return s}addImage(e,s){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,s)&&(this.images[e]=s)}_validate(e,s){let l=!0;const u=s.data||s.spriteData;return this._validateStretch(s.stretchX,u&&u.width)||(this.fire(new g.j(new Error(`Image "${e}" has invalid "stretchX" value`))),l=!1),this._validateStretch(s.stretchY,u&&u.height)||(this.fire(new g.j(new Error(`Image "${e}" has invalid "stretchY" value`))),l=!1),this._validateContent(s.content,s)||(this.fire(new g.j(new Error(`Image "${e}" has invalid "content" value`))),l=!1),l}_validateStretch(e,s){if(!e)return!0;let l=0;for(const u of e){if(u[0]<l||u[1]<u[0]||s<u[1])return!1;l=u[1]}return!0}_validateContent(e,s){if(!e)return!0;if(e.length!==4)return!1;const l=s.spriteData,u=l&&l.width||s.data.width,d=l&&l.height||s.data.height;return!(e[0]<0||u<e[0]||e[1]<0||d<e[1]||e[2]<0||u<e[2]||e[3]<0||d<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,s,l=!0){const u=this.getImage(e);if(l&&(u.data.width!==s.data.width||u.data.height!==s.data.height))throw new Error(`size mismatch between old image (${u.data.width}x${u.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=u.version+1,this.images[e]=s,this.updatedImages[e]=!0}removeImage(e){const s=this.images[e];delete this.images[e],delete this.patterns[e],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((s,l)=>{let u=!0;if(!this.isLoaded())for(const d of e)this.images[d]||(u=!1);this.isLoaded()||u?s(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:s})})}_getImagesForIds(e){const s={};for(const l of e){let u=this.getImage(l);u||(this.fire(new g.k("styleimagemissing",{id:l})),u=this.getImage(l)),u?s[l]={data:u.data.clone(),pixelRatio:u.pixelRatio,sdf:u.sdf,version:u.version,stretchX:u.stretchX,stretchY:u.stretchY,content:u.content,textFitWidth:u.textFitWidth,textFitHeight:u.textFitHeight,hasRenderCallback:!!(u.userImage&&u.userImage.render)}:g.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:e,height:s}=this.atlasImage;return{width:e,height:s}}getPattern(e){const s=this.patterns[e],l=this.getImage(e);if(!l)return null;if(s&&s.position.version===l.version)return s.position;if(s)s.position.version=l.version;else{const u={w:l.data.width+2,h:l.data.height+2,x:0,y:0},d=new g.I(u,l);this.patterns[e]={bin:u,position:d}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const s=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Kt(e,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const d in this.patterns)e.push(this.patterns[d].bin);const{w:s,h:l}=g.p(e),u=this.atlasImage;u.resize({width:s||1,height:l||1});for(const d in this.patterns){const{bin:v}=this.patterns[d],w=v.x+1,S=v.y+1,I=this.getImage(d).data,P=I.width,M=I.height;g.R.copy(I,u,{x:0,y:0},{x:w,y:S},{width:P,height:M}),g.R.copy(I,u,{x:0,y:M-1},{x:w,y:S-1},{width:P,height:1}),g.R.copy(I,u,{x:0,y:0},{x:w,y:S+M},{width:P,height:1}),g.R.copy(I,u,{x:P-1,y:0},{x:w-1,y:S},{width:1,height:M}),g.R.copy(I,u,{x:0,y:0},{x:w+P,y:S},{width:1,height:M})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const s of e){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const l=this.getImage(s);l||g.w(`Image with ID: "${s}" was not found`),dn(l)&&this.updateImage(s,l)}}}const Li=1e20;function ur(p,e,s,l,u,d,v,w,S){for(let I=e;I<e+l;I++)ir(p,s*d+I,d,u,v,w,S);for(let I=s;I<s+u;I++)ir(p,I*d+e,1,l,v,w,S)}function ir(p,e,s,l,u,d,v){d[0]=0,v[0]=-Li,v[1]=Li,u[0]=p[e];for(let w=1,S=0,I=0;w<l;w++){u[w]=p[e+w*s];const P=w*w;do{const M=d[S];I=(u[w]-u[M]+P-M*M)/(w-M)/2}while(I<=v[S]&&--S>-1);S++,d[S]=w,v[S]=I,v[S+1]=Li}for(let w=0,S=0;w<l;w++){for(;v[S+1]<w;)S++;const I=d[S],P=w-I;p[e+w*s]=u[I]+P*P}}class hi{constructor(e,s){this.requestManager=e,this.localIdeographFontFamily=s,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return g._(this,void 0,void 0,function*(){const s=[];for(const d in e)for(const v of e[d])s.push(this._getAndCacheGlyphsPromise(d,v));const l=yield Promise.all(s),u={};for(const{stack:d,id:v,glyph:w}of l)u[d]||(u[d]={}),u[d][v]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return u})}_getAndCacheGlyphsPromise(e,s){return g._(this,void 0,void 0,function*(){let l=this.entries[e];l||(l=this.entries[e]={glyphs:{},requests:{},ranges:{}});let u=l.glyphs[s];if(u!==void 0)return{stack:e,id:s,glyph:u};if(u=this._tinySDF(l,e,s),u)return l.glyphs[s]=u,{stack:e,id:s,glyph:u};const d=Math.floor(s/256);if(256*d>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[d])return{stack:e,id:s,glyph:u};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[d]){const w=hi.loadGlyphRange(e,d,this.url,this.requestManager);l.requests[d]=w}const v=yield l.requests[d];for(const w in v)this._doesCharSupportLocalGlyph(+w)||(l.glyphs[+w]=v[+w]);return l.ranges[d]=!0,{stack:e,id:s,glyph:v[s]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,s,l){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let d=e.tinySDF;if(!d){let w="400";/bold/i.test(s)?w="900":/medium/i.test(s)?w="500":/light/i.test(s)&&(w="200"),d=e.tinySDF=new hi.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:w})}const v=d.draw(String.fromCharCode(l));return{id:l,bitmap:new g.o({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}}hi.loadGlyphRange=function(p,e,s,l){return g._(this,void 0,void 0,function*(){const u=256*e,d=u+255,v=l.transformRequest(s.replace("{fontstack}",p).replace("{range}",`${u}-${d}`),"Glyphs"),w=yield g.l(v,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${e}, ${u}-${d}`);const S={};for(const I of g.n(w.data))S[I.id]=I;return S})},hi.TinySDF=class{constructor({fontSize:p=24,buffer:e=3,radius:s=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:d="normal",fontStyle:v="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=s;const w=this.size=p+4*e,S=this._createCanvas(w),I=this.ctx=S.getContext("2d",{willReadFrequently:!0});I.font=`${v} ${d} ${p}px ${u}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(p){const e=document.createElement("canvas");return e.width=e.height=p,e}draw(p){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:d}=this.ctx.measureText(p),v=Math.ceil(s),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-u))),S=Math.min(this.size-this.buffer,v+Math.ceil(l)),I=w+2*this.buffer,P=S+2*this.buffer,M=Math.max(I*P,0),B=new Uint8ClampedArray(M),j={data:B,width:I,height:P,glyphWidth:w,glyphHeight:S,glyphTop:v,glyphLeft:0,glyphAdvance:e};if(w===0||S===0)return j;const{ctx:q,buffer:G,gridInner:X,gridOuter:Y}=this;q.clearRect(G,G,w,S),q.fillText(p,G,G+v);const ie=q.getImageData(G,G,w,S);Y.fill(Li,0,M),X.fill(0,0,M);for(let H=0;H<S;H++)for(let oe=0;oe<w;oe++){const ce=ie.data[4*(H*w+oe)+3]/255;if(ce===0)continue;const _e=(H+G)*I+oe+G;if(ce===1)Y[_e]=0,X[_e]=Li;else{const Ce=.5-ce;Y[_e]=Ce>0?Ce*Ce:0,X[_e]=Ce<0?Ce*Ce:0}}ur(Y,0,0,I,P,I,this.f,this.v,this.z),ur(X,G,G,w,S,I,this.f,this.v,this.z);for(let H=0;H<M;H++){const oe=Math.sqrt(Y[H])-Math.sqrt(X[H]);B[H]=Math.round(255-255*(oe/this.radius+this.cutoff))}return j}};class Qe{constructor(){this.specification=g.v.light.position}possiblyEvaluate(e,s){return g.x(e.expression.evaluate(s))}interpolate(e,s,l){return{x:g.y.number(e.x,s.x,l),y:g.y.number(e.y,s.y,l),z:g.y.number(e.z,s.z,l)}}}let xt;class tt extends g.E{constructor(e){super(),xt=xt||new g.q({anchor:new g.D(g.v.light.anchor),position:new Qe,color:new g.D(g.v.light.color),intensity:new g.D(g.v.light.intensity)}),this._transitionable=new g.T(xt),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,s={}){if(!this._validate(g.r,e,s))for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,l){return(!l||l.validate!==!1)&&g.t(this,e.call(g.u,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:g.v}))}}const fe=new g.q({"sky-color":new g.D(g.v.sky["sky-color"]),"horizon-color":new g.D(g.v.sky["horizon-color"]),"fog-color":new g.D(g.v.sky["fog-color"]),"fog-ground-blend":new g.D(g.v.sky["fog-ground-blend"]),"horizon-fog-blend":new g.D(g.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new g.D(g.v.sky["sky-horizon-blend"]),"atmosphere-blend":new g.D(g.v.sky["atmosphere-blend"])});class Me extends g.E{constructor(e){super(),this._transitionable=new g.T(fe),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new g.z(0))}setSky(e,s={}){if(!this._validate(g.B,e,s)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,l={}){return(l==null?void 0:l.validate)!==!1&&g.t(this,e.call(g.u,g.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:g.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Bt{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,s){const l=e.join(",")+String(s);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(e,s)),this.dashEntry[l]}getDashRanges(e,s,l){const u=[];let d=e.length%2==1?-e[e.length-1]*l:0,v=e[0]*l,w=!0;u.push({left:d,right:v,isDash:w,zeroLength:e[0]===0});let S=e[0];for(let I=1;I<e.length;I++){w=!w;const P=e[I];d=S*l,S+=P,v=S*l,u.push({left:d,right:v,isDash:w,zeroLength:P===0})}return u}addRoundDash(e,s,l){const u=s/2;for(let d=-l;d<=l;d++){const v=this.width*(this.nextRow+l+d);let w=0,S=e[w];for(let I=0;I<this.width;I++){I/S.right>1&&(S=e[++w]);const P=Math.abs(I-S.left),M=Math.abs(I-S.right),B=Math.min(P,M);let j;const q=d/l*(u+1);if(S.isDash){const G=u-Math.abs(q);j=Math.sqrt(B*B+G*G)}else j=u-Math.sqrt(B*B+q*q);this.data[v+I]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(e){for(let w=e.length-1;w>=0;--w){const S=e[w],I=e[w+1];S.zeroLength?e.splice(w,1):I&&I.isDash===S.isDash&&(I.left=S.left,e.splice(w,1))}const s=e[0],l=e[e.length-1];s.isDash===l.isDash&&(s.left=l.left-this.width,l.right=s.right+this.width);const u=this.width*this.nextRow;let d=0,v=e[d];for(let w=0;w<this.width;w++){w/v.right>1&&(v=e[++d]);const S=Math.abs(w-v.left),I=Math.abs(w-v.right),P=Math.min(S,I);this.data[u+w]=Math.max(0,Math.min(255,(v.isDash?P:-P)+128))}}addDash(e,s){const l=s?7:0,u=2*l+1;if(this.nextRow+u>this.height)return g.w("LineAtlas out of space"),null;let d=0;for(let w=0;w<e.length;w++)d+=e[w];if(d!==0){const w=this.width/d,S=this.getDashRanges(e,this.width,w);s?this.addRoundDash(S,w,l):this.addRegularDash(S)}const v={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:d};return this.nextRow+=u,this.dirty=!0,v}bind(e){const s=e.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const Ot="maplibre_preloaded_worker_pool";class qt{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<qt.workerCount;)this.workers.push(new Worker(g.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ot]}numActive(){return Object.keys(this.active).length}}const Jt=Math.floor(we.hardwareConcurrency/2);let Xt,Ht;function vi(){return Xt||(Xt=new qt),Xt}qt.workerCount=g.C(globalThis)?Math.max(Math.min(Jt,3),1):1;class rr{constructor(e,s){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=s;const l=this.workerPool.acquire(s);for(let u=0;u<l.length;u++){const d=new g.F(l[u],s);d.name=`Worker ${u}`,this.actors.push(d)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,s){const l=[];for(const u of this.actors)l.push(u.sendAsync({type:e,data:s}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(s=>{s.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,s){for(const l of this.actors)l.registerMessageHandler(e,s)}}function Ys(){return Ht||(Ht=new rr(vi(),g.G),Ht.registerMessageHandler("GR",(p,e,s)=>g.m(e,s))),Ht}function os(p,e){const s=g.H();return g.J(s,s,[1,1,0]),g.K(s,s,[.5*p.width,.5*p.height,1]),g.L(s,s,p.calculatePosMatrix(e.toUnwrapped()))}function Vn(p,e,s,l,u,d){const v=function(M,B,j){if(M)for(const q of M){const G=B[q];if(G&&G.source===j&&G.type==="fill-extrusion")return!0}else for(const q in B){const G=B[q];if(G.source===j&&G.type==="fill-extrusion")return!0}return!1}(u&&u.layers,e,p.id),w=d.maxPitchScaleFactor(),S=p.tilesIn(l,w,v);S.sort(as);const I=[];for(const M of S)I.push({wrappedTileID:M.tileID.wrapped().key,queryResults:M.tile.queryRenderedFeatures(e,s,p._state,M.queryGeometry,M.cameraQueryGeometry,M.scale,u,d,w,os(p.transform,M.tileID))});const P=function(M){const B={},j={};for(const q of M){const G=q.queryResults,X=q.wrappedTileID,Y=j[X]=j[X]||{};for(const ie in G){const H=G[ie],oe=Y[ie]=Y[ie]||{},ce=B[ie]=B[ie]||[];for(const _e of H)oe[_e.featureIndex]||(oe[_e.featureIndex]=!0,ce.push(_e))}}return B}(I);for(const M in P)P[M].forEach(B=>{const j=B.feature,q=p.getFeatureState(j.layer["source-layer"],j.id);j.source=j.layer.source,j.layer["source-layer"]&&(j.sourceLayer=j.layer["source-layer"]),j.state=q});return P}function as(p,e){const s=p.tileID,l=e.tileID;return s.overscaledZ-l.overscaledZ||s.canonical.y-l.canonical.y||s.wrap-l.wrap||s.canonical.x-l.canonical.x}function So(p,e,s){return g._(this,void 0,void 0,function*(){let l=p;if(p.url?l=(yield g.h(e.transformRequest(p.url,"Source"),s)).data:yield we.frameAsync(s),!l)return null;const u=g.M(g.e(l,p),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(u.vectorLayerIds=l.vector_layers.map(d=>d.id)),u})}class be{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof g.N?new g.N(e.lng,e.lat):g.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof g.N?new g.N(e.lng,e.lat):g.N.convert(e),this}extend(e){const s=this._sw,l=this._ne;let u,d;if(e instanceof g.N)u=e,d=e;else{if(!(e instanceof be))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(be.convert(e)):this.extend(g.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(g.N.convert(e)):this;if(u=e._sw,d=e._ne,!u||!d)return this}return s||l?(s.lng=Math.min(u.lng,s.lng),s.lat=Math.min(u.lat,s.lat),l.lng=Math.max(d.lng,l.lng),l.lat=Math.max(d.lat,l.lat)):(this._sw=new g.N(u.lng,u.lat),this._ne=new g.N(d.lng,d.lat)),this}getCenter(){return new g.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new g.N(this.getWest(),this.getNorth())}getSouthEast(){return new g.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:l}=g.N.convert(e);let u=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){return e instanceof be?e:e&&new be(e)}static fromLngLat(e,s=0){const l=360*s/40075017,u=l/Math.cos(Math.PI/180*e.lat);return new be(new g.N(e.lng-u,e.lat-l),new g.N(e.lng+u,e.lat+l))}adjustAntiMeridian(){const e=new g.N(this._sw.lng,this._sw.lat),s=new g.N(this._ne.lng,this._ne.lat);return new be(e,e.lng>s.lng?new g.N(s.lng+360,s.lat):s)}}class Ss{constructor(e,s,l){this.bounds=be.convert(this.validateBounds(e)),this.minzoom=s||0,this.maxzoom=l||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const s=Math.pow(2,e.z),l=Math.floor(g.O(this.bounds.getWest())*s),u=Math.floor(g.Q(this.bounds.getNorth())*s),d=Math.ceil(g.O(this.bounds.getEast())*s),v=Math.ceil(g.Q(this.bounds.getSouth())*s);return e.x>=l&&e.x<d&&e.y>=u&&e.y<v}}class oa extends g.E{constructor(e,s,l,u){if(super(),this.id=e,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,g.e(this,g.M(s,["url","scheme","tileSize","promoteId"])),this._options=g.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}load(){return g._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new g.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield So(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(g.e(this,e),e.bounds&&(this.tileBounds=new Ss(e.bounds,this.minzoom,this.maxzoom)),this.fire(new g.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new g.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new g.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return g.e({},this._options)}loadTile(e){return g._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(s,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.request.collectResourceTiming=this._collectResourceTiming;let u="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((d,v)=>{e.reloadPromise={resolve:d,reject:v}})}else e.actor=this.dispatcher.getActor(),u="LT";e.abortController=new AbortController;try{const d=yield e.actor.sendAsync({type:u,data:l},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,d)}catch(d){if(delete e.abortController,e.aborted)return;if(d&&d.status!==404)throw d;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,s){if(s&&s.resourceTiming&&(e.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&e.setExpiryData(s),e.loadVectorData(s,this.map.painter),e.reloadPromise){const l=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(l.resolve).catch(l.reject)}}abortTile(e){return g._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return g._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ei extends g.E{constructor(e,s,l,u){super(),this.id=e,this.dispatcher=l,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=g.e({type:"raster"},s),g.e(this,g.M(s,["url","scheme","tileSize"]))}load(){return g._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new g.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield So(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(g.e(this,e),e.bounds&&(this.tileBounds=new Ss(e.bounds,this.minzoom,this.maxzoom)),this.fire(new g.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new g.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new g.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return g.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return g._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const l=yield vt.getImage(this.map._requestManager.transformRequest(s,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const u=this.map.painter.context,d=u.gl,v=l.data;e.texture=this.map.painter.getTileTexture(v.width),e.texture?e.texture.update(v,{useMipmap:!0}):(e.texture=new Kt(u,v,d.RGBA,{useMipmap:!0}),e.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}})}abortTile(e){return g._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return g._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class Ii extends ei{constructor(e,s,l,u){super(e,s,l,u),this.type="raster-dem",this.maxzoom=22,this._options=g.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(e){return g._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(s,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const u=yield vt.getImage(l,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){const d=u.data;this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const v=g.b(d)&&g.U()?d:yield this.readImageNow(d),w={type:this.type,uid:e.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const S=yield e.actor.sendAsync({type:"LDT",data:w});e.dem=S,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}})}readImageNow(e){return g._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&g.V()){const s=e.width+2,l=e.height+2;try{return new g.R({width:s,height:l},yield g.W(e,-1,-1,s,l))}catch{}}return we.getImageData(e,1)})}_getNeighboringTiles(e){const s=e.canonical,l=Math.pow(2,s.z),u=(s.x-1+l)%l,d=s.x===0?e.wrap-1:e.wrap,v=(s.x+1+l)%l,w=s.x+1===l?e.wrap+1:e.wrap,S={};return S[new g.S(e.overscaledZ,d,s.z,u,s.y).key]={backfilled:!1},S[new g.S(e.overscaledZ,w,s.z,v,s.y).key]={backfilled:!1},s.y>0&&(S[new g.S(e.overscaledZ,d,s.z,u,s.y-1).key]={backfilled:!1},S[new g.S(e.overscaledZ,e.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},S[new g.S(e.overscaledZ,w,s.z,v,s.y-1).key]={backfilled:!1}),s.y+1<l&&(S[new g.S(e.overscaledZ,d,s.z,u,s.y+1).key]={backfilled:!1},S[new g.S(e.overscaledZ,e.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},S[new g.S(e.overscaledZ,w,s.z,v,s.y+1).key]={backfilled:!1}),S}unloadTile(e){return g._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class ls extends g.E{constructor(e,s,l,u){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(u),this._data=s.data,this._options=g.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const d=g.X/this.tileSize;s.clusterMaxZoom!==void 0&&this.maxzoom<=s.clusterMaxZoom&&g.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${s.clusterMaxZoom}".`),this.workerOptions=g.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*d,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*d,extent:g.X,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:g.X,radius:(s.clusterRadius||50)*d,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return g._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return g._(this,void 0,void 0,function*(){const e=g.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,s,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:s,offset:l}})}_updateWorkerData(e){return g._(this,void 0,void 0,function*(){const s=g.e({type:this.type},this.workerOptions);e?s.dataDiff=e:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(we.resolveURL(this._data),"Source"),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new g.k("dataloading",{dataType:"source"}));try{const l=yield this.actor.sendAsync({type:"LD",data:s});if(this._pendingLoads--,this._removed||l.abandoned)return void this.fire(new g.k("dataabort",{dataType:"source"}));let u=null;l.resourceTiming&&l.resourceTiming[this.id]&&(u=l.resourceTiming[this.id].slice(0));const d={dataType:"source"};this._collectResourceTiming&&u&&u.length>0&&g.e(d,{resourceTiming:u}),this.fire(new g.k("data",Object.assign(Object.assign({},d),{sourceDataType:"metadata"}))),this.fire(new g.k("data",Object.assign(Object.assign({},d),{sourceDataType:"content"})))}catch(l){if(this._pendingLoads--,this._removed)return void this.fire(new g.k("dataabort",{dataType:"source"}));this.fire(new g.j(l))}})}loaded(){return this._pendingLoads===0}loadTile(e){return g._(this,void 0,void 0,function*(){const s=e.actor?"RT":"LT";e.actor=this.actor;const l={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const u=yield this.actor.sendAsync({type:s,data:l},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(u,this.map.painter,s==="RT")})}abortTile(e){return g._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return g._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return g.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var us=g.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class cs extends g.E{constructor(e,s,l,u){super(),this.id=e,this.dispatcher=l,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=s}load(e){return g._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new g.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield vt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,e&&(this.coordinates=e),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,this.fire(new g.j(s))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new g.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const s=e.map(g.Z.fromLngLat);this.tileID=function(u){let d=1/0,v=1/0,w=-1/0,S=-1/0;for(const B of u)d=Math.min(d,B.x),v=Math.min(v,B.y),w=Math.max(w,B.x),S=Math.max(S,B.y);const I=Math.max(w-d,S-v),P=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),M=Math.pow(2,P);return new g.a1(P,Math.floor((d+w)/2*M),Math.floor((v+S)/2*M))}(s),this.minzoom=this.maxzoom=this.tileID.z;const l=s.map(u=>this.tileID.getTilePoint(u)._round());return this._boundsArray=new g.$,this._boundsArray.emplaceBack(l[0].x,l[0].y,0,0),this._boundsArray.emplaceBack(l[1].x,l[1].y,g.X,0),this._boundsArray.emplaceBack(l[3].x,l[3].y,0,g.X),this._boundsArray.emplaceBack(l[2].x,l[2].y,g.X,g.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new g.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,us.members)),this.boundsSegments||(this.boundsSegments=g.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Kt(e,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const d=this.tiles[u];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture,l=!0)}l&&this.fire(new g.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return g._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class To extends cs{constructor(e,s,l,u){super(e,s,l,u),this.roundZoom=!0,this.type="video",this.options=s}load(){return g._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const s of e.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield g.a3(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new g.j(s))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const s=this.video.seekable;e<s.start(0)||e>s.end(0)?this.fire(new g.j(new g.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,us.members)),this.boundsSegments||(this.boundsSegments=g.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new Kt(e,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const d=this.tiles[u];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture,l=!0)}l&&this.fire(new g.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class pn extends cs{constructor(e,s,l,u){super(e,s,l,u),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(d=>!Array.isArray(d)||d.length!==2||d.some(v=>typeof v!="number"))||this.fire(new g.j(new g.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new g.j(new g.a2(`sources.${e}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new g.j(new g.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new g.j(new g.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new g.j(new g.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return g._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new g.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,l=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,us.members)),this.boundsSegments||(this.boundsSegments=g.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Kt(s,this.canvas,l.RGBA,{premultiply:!0});let u=!1;for(const d in this.tiles){const v=this.tiles[d];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,u=!0)}u&&this.fire(new g.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const aa={},ko=p=>{switch(p){case"geojson":return ls;case"image":return cs;case"raster":return ei;case"raster-dem":return Ii;case"vector":return oa;case"video":return To;case"canvas":return pn}return aa[p]},Fe="RTLPluginLoaded";class jn extends g.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ys()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(s=>{throw this.status="error",s})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return g._(this,arguments,void 0,function*(s,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=we.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return g._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new g.k(Fe))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let nr=null;function Jr(){return nr||(nr=new jn),nr}class Qs{constructor(e,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=g.a4(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const s=e+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,d){const v={};if(!d)return v;for(const w of u){const S=w.layerIds.map(I=>d.getLayer(I)).filter(Boolean);if(S.length!==0){w.layers=S,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(I=>S.filter(P=>P.id===I)[0]));for(const I of S)v[I.id]=w}}return v}(e.buckets,s.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const d=this.buckets[u];if(d instanceof g.a6){if(this.hasSymbolBuckets=!0,!l)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const d=this.buckets[u];if(d instanceof g.a6&&d.hasRTLText){this.hasRTLText=!0,Jr().lazyLoad();break}}this.queryPadding=0;for(const u in this.buckets){const d=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(u).queryRadius(d))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new g.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const u=this.buckets[l];u.uploadPending()&&u.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Kt(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Kt(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,l,u,d,v,w,S,I,P){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:d,scale:v,tileSize:this.tileSize,pixelPosMatrix:P,transform:S,params:w,queryPadding:this.queryPadding*I},e,s,l):{}}querySourceFeatures(e,s){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const u=l.loadVTLayers(),d=s&&s.sourceLayer?s.sourceLayer:"",v=u._geojsonTileLayer||u[d];if(!v)return;const w=g.a7(s&&s.filter),{z:S,x:I,y:P}=this.tileID.canonical,M={z:S,x:I,y:P};for(let B=0;B<v.length;B++){const j=v.feature(B);if(w.needGeometry){const X=g.a8(j,!0);if(!w.filter(new g.z(this.tileID.overscaledZ),X,this.tileID.canonical))continue}else if(!w.filter(new g.z(this.tileID.overscaledZ),j))continue;const q=l.getId(j,d),G=new g.a9(j,S,I,P,q);G.tile=M,e.push(G)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const l=g.aa(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let u=!1;if(this.expirationTime>l)u=!1;else if(s)if(this.expirationTime<s)u=!0;else{const d=this.expirationTime-s;d?this.expirationTime=l+Math.max(d,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!s.style.hasLayer(u))continue;const d=this.buckets[u],v=d.layers[0].sourceLayer||"_geojsonTileLayer",w=l[v],S=e[v];if(!w||!S||Object.keys(S).length===0)continue;d.update(S,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const I=s&&s.style&&s.style.getLayer(u);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(d)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<we.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=we.now()+e}setDependencies(e,s){const l={};for(const u of s)l[u]=!0;this.dependencies[e]=l}hasDependency(e,s){for(const l of e){const u=this.dependencies[l];if(u){for(const d of s)if(u[d])return!0}}return!1}}class Ue{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,l){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const d={value:s,timeout:void 0};if(l!==void 0&&(d.timeout=setTimeout(()=>{this.remove(e,d)},l)),this.data[u].push(d),this.order.push(u),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const l=e.wrapped().key,u=s===void 0?0:this.data[l].indexOf(s),d=this.data[l][u];return this.data[l].splice(u,1),d.timeout&&clearTimeout(d.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(d.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const l in this.data)for(const u of this.data[l])e(u.value)||s.push(u);for(const l of s)this.remove(l.value.tileID,l)}}class Nt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,l){const u=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},g.e(this.stateChanges[e][u],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const d in this.state[e])d!==u&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const d in this.state[e][u])l[d]||(this.deletedStates[e][u][d]=null)}else for(const d in l)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][d]===null&&delete this.deletedStates[e][u][d]}removeFeatureState(e,s,l){if(this.deletedStates[e]===null)return;const u=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&s!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][l]=null);else if(s!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(l in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][l]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,s){const l=String(s),u=g.e({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const d=this.deletedStates[e][s];if(d===null)return{};for(const v in d)delete u[v]}return u}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const l={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const d={};for(const v in this.stateChanges[u])this.state[u][v]||(this.state[u][v]={}),g.e(this.state[u][v],this.stateChanges[u][v]),d[v]=this.state[u][v];l[u]=d}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const d={};if(this.deletedStates[u]===null)for(const v in this.state[u])d[v]={},this.state[u][v]={};else for(const v in this.deletedStates[u]){if(this.deletedStates[u][v]===null)this.state[u][v]={};else for(const w of Object.keys(this.deletedStates[u][v]))delete this.state[u][v][w];d[v]=this.state[u][v]}l[u]=l[u]||{},g.e(l[u],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const u in e)e[u].setFeatureState(l,s)}}class wt extends g.E{constructor(e,s,l){super(),this.id=e,this.dispatcher=l,this.on("data",u=>this._dataHandler(u)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((u,d,v,w)=>{const S=new(ko(d.type))(u,d,v,w);if(S.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${S.id}`);return S})(e,s,l,this),this._tiles={},this._cache=new Ue(0,u=>this._unloadTile(u)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Nt,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const s=this._tiles[e];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,s,l){return g._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,s,l)}catch(u){e.state="errored",u.status!==404?this._source.fire(new g.j(u,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new g.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const l=this._tiles[s];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Er).map(e=>e.key)}getRenderableIds(e){const s=[];for(const l in this._tiles)this._isIdRenderable(l,e)&&s.push(this._tiles[l]);return e?s.sort((l,u)=>{const d=l.tileID,v=u.tileID,w=new g.P(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),S=new g.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-v.overscaledZ||S.y-w.y||S.x-w.x}).map(l=>l.tileID.key):s.map(l=>l.tileID).sort(Er).map(l=>l.key)}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,s){return g._(this,void 0,void 0,function*(){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=s),yield this._loadTile(l,e,s))})}_tileLoaded(e,s,l){e.timeAdded=we.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new g.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const s=this.getRenderableIds();for(let u=0;u<s.length;u++){const d=s[u];if(e.neighboringTiles&&e.neighboringTiles[d]){const v=this.getTileByID(d);l(e,v),l(v,e)}}function l(u,d){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let v=d.tileID.canonical.x-u.tileID.canonical.x;const w=d.tileID.canonical.y-u.tileID.canonical.y,S=Math.pow(2,u.tileID.canonical.z),I=d.tileID.key;v===0&&w===0||Math.abs(w)>1||(Math.abs(v)>1&&(Math.abs(v+S)===1?v+=S:Math.abs(v-S)===1&&(v-=S)),d.dem&&u.dem&&(u.dem.backfillBorder(d.dem,v,w),u.neighboringTiles&&u.neighboringTiles[I]&&(u.neighboringTiles[I].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,l,u){for(const d in this._tiles){let v=this._tiles[d];if(u[d]||!v.hasData()||v.tileID.overscaledZ<=s||v.tileID.overscaledZ>l)continue;let w=v.tileID;for(;v&&v.tileID.overscaledZ>s+1;){const I=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[I.key],v&&v.hasData()&&(w=I)}let S=w;for(;S.overscaledZ>s;)if(S=S.scaledTo(S.overscaledZ-1),e[S.key]){u[w.key]=w;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=s?l:null}for(let l=e.overscaledZ-1;l>=s;l--){const u=e.scaledTo(l),d=this._getLoadedTile(u);if(d)return d}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const s=Math.ceil(e.width/this._source.tileSize)+1,l=Math.ceil(e.height/this._source.tileSize)+1,u=Math.floor(s*l*(this._maxTileCacheZoomLevels===null?g.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),d=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(d)}handleWrapJump(e){const s=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,s){const l={};for(const u in this._tiles){const d=this._tiles[u];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+s),l[d.tileID.key]=d}this._tiles=l;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}_updateCoveredAndRetainedTiles(e,s,l,u,d,v){const w={},S={},I=Object.keys(e),P=we.now();for(const M of I){const B=e[M],j=this._tiles[M];if(!j||j.fadeEndTime!==0&&j.fadeEndTime<=P)continue;const q=this.findLoadedParent(B,s),G=this.findLoadedSibling(B),X=q||G||null;X&&(this._addTile(X.tileID),w[X.tileID.key]=X.tileID),S[M]=B}this._retainLoadedChildren(S,u,l,e);for(const M in w)e[M]||(this._coveredTiles[M]=!0,e[M]=w[M]);if(v){const M={},B={};for(const j of d)this._tiles[j.key].hasData()?M[j.key]=j:B[j.key]=j;for(const j in B){const q=B[j].children(this._source.maxzoom);this._tiles[q[0].key]&&this._tiles[q[1].key]&&this._tiles[q[2].key]&&this._tiles[q[3].key]&&(M[q[0].key]=e[q[0].key]=q[0],M[q[1].key]=e[q[1].key]=q[1],M[q[2].key]=e[q[2].key]=q[2],M[q[3].key]=e[q[3].key]=q[3],delete B[j])}for(const j in B){const q=B[j],G=this.findLoadedParent(q,this._source.minzoom),X=this.findLoadedSibling(q),Y=G||X||null;if(Y){M[Y.tileID.key]=e[Y.tileID.key]=Y.tileID;for(const ie in M)M[ie].isChildOf(Y.tileID)&&delete M[ie]}}for(const j in this._tiles)M[j]||(this._coveredTiles[j]=!0)}}update(e,s){if(!this._sourceLoaded||this._paused)return;let l;this.transform=e,this.terrain=s,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(P=>new g.S(P.canonical.z,P.wrap,P.canonical.z,P.canonical.x,P.canonical.y)):(l=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(l=l.filter(P=>this._source.hasTile(P)))):l=[];const u=e.coveringZoomLevel(this._source),d=Math.max(u-wt.maxOverzooming,this._source.minzoom),v=Math.max(u+wt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const P={};for(const M of l)if(M.canonical.z>this._source.minzoom){const B=M.scaledTo(M.canonical.z-1);P[B.key]=B;const j=M.scaledTo(Math.max(this._source.minzoom,Math.min(M.canonical.z,5)));P[j.key]=j}l=l.concat(Object.values(P))}const w=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new g.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const S=this._updateRetainedTiles(l,u);fn(this._source.type)&&this._updateCoveredAndRetainedTiles(S,d,v,u,l,s);for(const P in S)this._tiles[P].clearFadeHold();const I=g.ab(this._tiles,S);for(const P of I){const M=this._tiles[P];M.hasSymbolBuckets&&!M.holdingForFade()?M.setHoldDuration(this.map._fadeDuration):M.hasSymbolBuckets&&!M.symbolFadeFinished()||this._removeTile(P)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,s){var l;const u={},d={},v=Math.max(s-wt.maxOverzooming,this._source.minzoom),w=Math.max(s+wt.maxUnderzooming,this._source.minzoom),S={};for(const I of e){const P=this._addTile(I);u[I.key]=I,P.hasData()||s<this._source.maxzoom&&(S[I.key]=I)}this._retainLoadedChildren(S,s,w,u);for(const I of e){let P=this._tiles[I.key];if(P.hasData())continue;if(s+1>this._source.maxzoom){const B=I.children(this._source.maxzoom)[0],j=this.getTile(B);if(j&&j.hasData()){u[B.key]=B;continue}}else{const B=I.children(this._source.maxzoom);if(u[B[0].key]&&u[B[1].key]&&u[B[2].key]&&u[B[3].key])continue}let M=P.wasRequested();for(let B=I.overscaledZ-1;B>=v;--B){const j=I.scaledTo(B);if(d[j.key])break;if(d[j.key]=!0,P=this.getTile(j),!P&&M&&(P=this._addTile(j)),P){const q=P.hasData();if((q||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||M)&&(u[j.key]=j),M=P.wasRequested(),q)break}}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let l,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){l=this._loadedParentTiles[u.key];break}s.push(u.key);const d=u.scaledTo(u.overscaledZ-1);if(l=this._getLoadedTile(d),l)break;u=d}for(const d of s)this._loadedParentTiles[d]=l}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const s=this._tiles[e].tileID,l=this._getLoadedTile(s);this._loadedSiblingTiles[s.key]=l}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const l=s;return s||(s=new Qs(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(s,e.key,s.state)),s.uses++,this._tiles[e.key]=s,l||this._source.fire(new g.k("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=s.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(e){const s=e.sourceDataType;e.dataType==="source"&&s==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&s==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,s,l){const u=[],d=this.transform;if(!d)return u;const v=l?d.getCameraQueryGeometry(e):e,w=e.map(q=>d.pointCoordinate(q,this.terrain)),S=v.map(q=>d.pointCoordinate(q,this.terrain)),I=this.getIds();let P=1/0,M=1/0,B=-1/0,j=-1/0;for(const q of S)P=Math.min(P,q.x),M=Math.min(M,q.y),B=Math.max(B,q.x),j=Math.max(j,q.y);for(let q=0;q<I.length;q++){const G=this._tiles[I[q]];if(G.holdingForFade())continue;const X=G.tileID,Y=Math.pow(2,d.zoom-G.tileID.overscaledZ),ie=s*G.queryPadding*g.X/G.tileSize/Y,H=[X.getTilePoint(new g.Z(P,M)),X.getTilePoint(new g.Z(B,j))];if(H[0].x-ie<g.X&&H[0].y-ie<g.X&&H[1].x+ie>=0&&H[1].y+ie>=0){const oe=w.map(_e=>X.getTilePoint(_e)),ce=S.map(_e=>X.getTilePoint(_e));u.push({tile:G,tileID:X,queryGeometry:oe,cameraQueryGeometry:ce,scale:Y})}}return u}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);for(const l of s)l.posMatrix=this.transform.calculatePosMatrix(l.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(fn(this._source.type)){const e=we.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=e)return!0}return!1}setFeatureState(e,s,l){this._state.updateState(e=e||"_geojsonTileLayer",s,l)}removeFeatureState(e,s,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,l)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,l){const u=this._tiles[e];u&&u.setDependencies(s,l)}reloadTilesForDependencies(e,s){for(const l in this._tiles)this._tiles[l].hasDependency(e,s)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(e,s))}}function Er(p,e){const s=Math.abs(2*p.wrap)-+(p.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return p.overscaledZ-e.overscaledZ||l-s||e.canonical.y-p.canonical.y||e.canonical.x-p.canonical.x}function fn(p){return p==="raster"||p==="image"||p==="video"}wt.maxOverzooming=10,wt.maxUnderzooming=3;class kt{constructor(e,s){this.reset(e,s)}reset(e,s){this.points=e||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=g.ac(e,0,1);let s=1,l=this._distances[s];const u=e*this.paddedLength+this.padding;for(;l<u&&s<this._distances.length;)l=this._distances[++s];const d=s-1,v=this._distances[d],w=l-v,S=w>0?(u-v)/w:0;return this.points[d].mult(1-S).add(this.points[s].mult(S))}}function In(p,e){let s=!0;return p==="always"||p!=="never"&&e!=="never"||(s=!1),s}class Un{constructor(e,s,l){const u=this.boxCells=[],d=this.circleCells=[];this.xCellCount=Math.ceil(e/l),this.yCellCount=Math.ceil(s/l);for(let v=0;v<this.xCellCount*this.yCellCount;v++)u.push([]),d.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=s,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,s,l,u,d){this._forEachCell(s,l,u,d,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(d)}insertCircle(e,s,l,u){this._forEachCell(s-u,l-u,s+u,l+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(s),this.circles.push(l),this.circles.push(u)}_insertBoxCell(e,s,l,u,d,v){this.boxCells[d].push(v)}_insertCircleCell(e,s,l,u,d,v){this.circleCells[d].push(v)}_query(e,s,l,u,d,v,w){if(l<0||e>this.width||u<0||s>this.height)return[];const S=[];if(e<=0&&s<=0&&this.width<=l&&this.height<=u){if(d)return[{key:null,x1:e,y1:s,x2:l,y2:u}];for(let I=0;I<this.boxKeys.length;I++)S.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){const P=this.circles[3*I],M=this.circles[3*I+1],B=this.circles[3*I+2];S.push({key:this.circleKeys[I],x1:P-B,y1:M-B,x2:P+B,y2:M+B})}}else this._forEachCell(e,s,l,u,this._queryCell,S,{hitTest:d,overlapMode:v,seenUids:{box:{},circle:{}}},w);return S}query(e,s,l,u){return this._query(e,s,l,u,!1,null)}hitTest(e,s,l,u,d,v){return this._query(e,s,l,u,!0,d,v).length>0}hitTestCircle(e,s,l,u,d){const v=e-l,w=e+l,S=s-l,I=s+l;if(w<0||v>this.width||I<0||S>this.height)return!1;const P=[];return this._forEachCell(v,S,w,I,this._queryCellCircle,P,{hitTest:!0,overlapMode:u,circle:{x:e,y:s,radius:l},seenUids:{box:{},circle:{}}},d),P.length>0}_queryCell(e,s,l,u,d,v,w,S){const{seenUids:I,hitTest:P,overlapMode:M}=w,B=this.boxCells[d];if(B!==null){const q=this.bboxes;for(const G of B)if(!I.box[G]){I.box[G]=!0;const X=4*G,Y=this.boxKeys[G];if(e<=q[X+2]&&s<=q[X+3]&&l>=q[X+0]&&u>=q[X+1]&&(!S||S(Y))&&(!P||!In(M,Y.overlapMode))&&(v.push({key:Y,x1:q[X],y1:q[X+1],x2:q[X+2],y2:q[X+3]}),P))return!0}}const j=this.circleCells[d];if(j!==null){const q=this.circles;for(const G of j)if(!I.circle[G]){I.circle[G]=!0;const X=3*G,Y=this.circleKeys[G];if(this._circleAndRectCollide(q[X],q[X+1],q[X+2],e,s,l,u)&&(!S||S(Y))&&(!P||!In(M,Y.overlapMode))){const ie=q[X],H=q[X+1],oe=q[X+2];if(v.push({key:Y,x1:ie-oe,y1:H-oe,x2:ie+oe,y2:H+oe}),P)return!0}}}return!1}_queryCellCircle(e,s,l,u,d,v,w,S){const{circle:I,seenUids:P,overlapMode:M}=w,B=this.boxCells[d];if(B!==null){const q=this.bboxes;for(const G of B)if(!P.box[G]){P.box[G]=!0;const X=4*G,Y=this.boxKeys[G];if(this._circleAndRectCollide(I.x,I.y,I.radius,q[X+0],q[X+1],q[X+2],q[X+3])&&(!S||S(Y))&&!In(M,Y.overlapMode))return v.push(!0),!0}}const j=this.circleCells[d];if(j!==null){const q=this.circles;for(const G of j)if(!P.circle[G]){P.circle[G]=!0;const X=3*G,Y=this.circleKeys[G];if(this._circlesCollide(q[X],q[X+1],q[X+2],I.x,I.y,I.radius)&&(!S||S(Y))&&!In(M,Y.overlapMode))return v.push(!0),!0}}}_forEachCell(e,s,l,u,d,v,w,S){const I=this._convertToXCellCoord(e),P=this._convertToYCellCoord(s),M=this._convertToXCellCoord(l),B=this._convertToYCellCoord(u);for(let j=I;j<=M;j++)for(let q=P;q<=B;q++)if(d.call(this,e,s,l,u,this.xCellCount*q+j,v,w,S))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,s,l,u,d,v){const w=u-e,S=d-s,I=l+v;return I*I>w*w+S*S}_circleAndRectCollide(e,s,l,u,d,v,w){const S=(v-u)/2,I=Math.abs(e-(u+S));if(I>S+l)return!1;const P=(w-d)/2,M=Math.abs(s-(d+P));if(M>P+l)return!1;if(I<=S||M<=P)return!0;const B=I-S,j=M-P;return B*B+j*j<=l*l}}function mn(p,e,s,l,u){const d=g.H();return e?(g.K(d,d,[1/u,1/u,1]),s||g.ad(d,d,l.angle)):g.L(d,l.labelPlaneMatrix,p),d}function jr(p,e,s,l,u){if(e){const d=g.ae(p);return g.K(d,d,[u,u,1]),s||g.ad(d,d,-l.angle),d}return l.glCoordMatrix}function J(p,e,s,l){let u;l?(u=[p,e,l(p,e),1],g.af(u,u,s)):(u=[p,e,0,1],ti(u,u,s));const d=u[3];return{point:new g.P(u[0]/d,u[1]/d),signedDistanceFromCamera:d,isOccluded:!1}}function R(p,e){return .5+p/e*.5}function L(p,e){return p.x>=-e[0]&&p.x<=e[0]&&p.y>=-e[1]&&p.y<=e[1]}function V(p,e,s,l,u,d,v,w,S,I,P,M,B,j,q){const G=l?p.textSizeData:p.iconSizeData,X=g.ag(G,s.transform.zoom),Y=[256/s.width*2+1,256/s.height*2+1],ie=l?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;ie.clear();const H=p.lineVertexArray,oe=l?p.text.placedSymbolArray:p.icon.placedSymbolArray,ce=s.transform.width/s.transform.height;let _e=!1;for(let Ce=0;Ce<oe.length;Ce++){const Le=oe.get(Ce);if(Le.hidden||Le.writingMode===g.ah.vertical&&!_e){pt(Le.numGlyphs,ie);continue}_e=!1;const Ve=J(Le.anchorX,Le.anchorY,e,q);if(!L(Ve.point,Y)){pt(Le.numGlyphs,ie);continue}const We=R(s.transform.cameraToCenterDistance,Ve.signedDistanceFromCamera),je=g.ai(G,X,Le),Oe=v?je/We:je*We,it={getElevation:q,labelPlaneMatrix:u,lineVertexArray:H,pitchWithMap:v,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:I,tileAnchorPoint:new g.P(Le.anchorX,Le.anchorY),unwrappedTileID:P,width:M,height:B,translation:j},St=le(it,Le,Oe,!1,w,e,d,p.glyphOffsetArray,ie,ce,S);_e=St.useVertical,(St.notEnoughRoom||_e||St.needsFlipping&&le(it,Le,Oe,!0,w,e,d,p.glyphOffsetArray,ie,ce,S).notEnoughRoom)&&pt(Le.numGlyphs,ie)}l?p.text.dynamicLayoutVertexBuffer.updateData(ie):p.icon.dynamicLayoutVertexBuffer.updateData(ie)}function W(p,e,s,l,u,d,v,w){const S=d.glyphStartIndex+d.numGlyphs,I=d.lineStartIndex,P=d.lineStartIndex+d.lineLength,M=e.getoffsetX(d.glyphStartIndex),B=e.getoffsetX(S-1),j=Ne(p*M,s,l,u,d.segment,I,P,w,v);if(!j)return null;const q=Ne(p*B,s,l,u,d.segment,I,P,w,v);return q?w.projectionCache.anyProjectionOccluded?null:{first:j,last:q}:null}function re(p,e,s,l){return p===g.ah.horizontal&&Math.abs(s.y-e.y)>Math.abs(s.x-e.x)*l?{useVertical:!0}:(p===g.ah.vertical?e.y<s.y:e.x>s.x)?{needsFlipping:!0}:null}function le(p,e,s,l,u,d,v,w,S,I,P){const M=s/24,B=e.lineOffsetX*M,j=e.lineOffsetY*M;let q;if(e.numGlyphs>1){const G=e.glyphStartIndex+e.numGlyphs,X=e.lineStartIndex,Y=e.lineStartIndex+e.lineLength,ie=W(M,w,B,j,l,e,P,p);if(!ie)return{notEnoughRoom:!0};const H=J(ie.first.point.x,ie.first.point.y,v,p.getElevation).point,oe=J(ie.last.point.x,ie.last.point.y,v,p.getElevation).point;if(u&&!l){const ce=re(e.writingMode,H,oe,I);if(ce)return ce}q=[ie.first];for(let ce=e.glyphStartIndex+1;ce<G-1;ce++)q.push(Ne(M*w.getoffsetX(ce),B,j,l,e.segment,X,Y,p,P));q.push(ie.last)}else{if(u&&!l){const X=J(p.tileAnchorPoint.x,p.tileAnchorPoint.y,d,p.getElevation).point,Y=e.lineStartIndex+e.segment+1,ie=new g.P(p.lineVertexArray.getx(Y),p.lineVertexArray.gety(Y)),H=J(ie.x,ie.y,d,p.getElevation),oe=H.signedDistanceFromCamera>0?H.point:function(_e,Ce,Le,Ve,We,je){return pe(_e,Ce,Le,1,We,je)}(p.tileAnchorPoint,ie,X,0,d,p),ce=re(e.writingMode,X,oe,I);if(ce)return ce}const G=Ne(M*w.getoffsetX(e.glyphStartIndex),B,j,l,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,p,P);if(!G||p.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};q=[G]}for(const G of q)g.aj(S,G.point,G.angle);return{}}function pe(p,e,s,l,u,d){const v=p.add(p.sub(e)._unit()),w=u!==void 0?J(v.x,v.y,u,d.getElevation).point:Te(v.x,v.y,d).point,S=s.sub(w);return s.add(S._mult(l/S.mag()))}function te(p,e,s){const l=e.projectionCache;if(l.projections[p])return l.projections[p];const u=new g.P(e.lineVertexArray.getx(p),e.lineVertexArray.gety(p)),d=Te(u.x,u.y,e);if(d.signedDistanceFromCamera>0)return l.projections[p]=d.point,l.anyProjectionOccluded=l.anyProjectionOccluded||d.isOccluded,d.point;const v=p-s.direction;return function(w,S,I,P,M){return pe(w,S,I,P,void 0,M)}(s.distanceFromAnchor===0?e.tileAnchorPoint:new g.P(e.lineVertexArray.getx(v),e.lineVertexArray.gety(v)),u,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,e)}function Te(p,e,s){const l=p+s.translation[0],u=e+s.translation[1];let d;return!s.pitchWithMap&&s.projection.useSpecialProjectionForSymbols?(d=s.projection.projectTileCoordinates(l,u,s.unwrappedTileID,s.getElevation),d.point.x=(.5*d.point.x+.5)*s.width,d.point.y=(.5*-d.point.y+.5)*s.height):(d=J(l,u,s.labelPlaneMatrix,s.getElevation),d.isOccluded=!1),d}function Pe(p,e,s){return p._unit()._perp()._mult(e*s)}function ve(p,e,s,l,u,d,v,w,S){if(w.projectionCache.offsets[p])return w.projectionCache.offsets[p];const I=s.add(e);if(p+S.direction<l||p+S.direction>=u)return w.projectionCache.offsets[p]=I,I;const P=te(p+S.direction,w,S),M=Pe(P.sub(s),v,S.direction),B=s.add(M),j=P.add(M);return w.projectionCache.offsets[p]=g.ak(d,I,B,j)||I,w.projectionCache.offsets[p]}function Ne(p,e,s,l,u,d,v,w,S){const I=l?p-e:p+e;let P=I>0?1:-1,M=0;l&&(P*=-1,M=Math.PI),P<0&&(M+=Math.PI);let B,j=P>0?d+u:d+u+1;w.projectionCache.cachedAnchorPoint?B=w.projectionCache.cachedAnchorPoint:(B=Te(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=B);let q,G,X=B,Y=B,ie=0,H=0;const oe=Math.abs(I),ce=[];let _e;for(;ie+H<=oe;){if(j+=P,j<d||j>=v)return null;ie+=H,Y=X,G=q;const Ve={absOffsetX:oe,direction:P,distanceFromAnchor:ie,previousVertex:Y};if(X=te(j,w,Ve),s===0)ce.push(Y),_e=X.sub(Y);else{let We;const je=X.sub(Y);We=je.mag()===0?Pe(te(j+P,w,Ve).sub(X),s,P):Pe(je,s,P),G||(G=Y.add(We)),q=ve(j,We,X,d,v,G,s,w,Ve),ce.push(G),_e=q.sub(G)}H=_e.mag()}const Ce=_e._mult((oe-ie)/H)._add(G||Y),Le=M+Math.atan2(X.y-Y.y,X.x-Y.x);return ce.push(Ce),{point:Ce,angle:S?Le:0,path:ce}}const ot=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function pt(p,e){for(let s=0;s<p;s++){const l=e.length;e.resize(l+4),e.float32.set(ot,3*l)}}function ti(p,e,s){const l=e[0],u=e[1];return p[0]=s[0]*l+s[4]*u+s[12],p[1]=s[1]*l+s[5]*u+s[13],p[3]=s[3]*l+s[7]*u+s[15],p}const Ct=100;class ii{constructor(e,s,l=new Un(e.width+200,e.height+200,25),u=new Un(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=s,this.grid=l,this.ignoredGrid=u,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Ct,this.screenBottomBoundary=e.height+Ct,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,s,l,u,d,v,w,S,I,P,M){const B=e.anchorPointX+S[0],j=e.anchorPointY+S[1],q=this.projectAndGetPerspectiveRatio(u,B,j,d,P),G=l*q.perspectiveRatio;let X;if(v||w)X=this._projectCollisionBox(e,G,u,d,v,w,S,q,P,M);else{const ce=q.point.x+(M?M.x*G:0),_e=q.point.y+(M?M.y*G:0);X={allPointsOccluded:!1,box:[ce+e.x1*G,_e+e.y1*G,ce+e.x2*G,_e+e.y2*G]}}const[Y,ie,H,oe]=X.box;return this.mapProjection.useSpecialProjectionForSymbols&&(v?X.allPointsOccluded:this.mapProjection.isOccluded(B,j,d))||q.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(Y,ie,H,oe)||s!=="always"&&this.grid.hitTest(Y,ie,H,oe,s,I)?{box:[Y,ie,H,oe],placeable:!1,offscreen:!1}:{box:[Y,ie,H,oe],placeable:!0,offscreen:this.isOffscreen(Y,ie,H,oe)}}placeCollisionCircles(e,s,l,u,d,v,w,S,I,P,M,B,j,q,G,X){const Y=[],ie=new g.P(s.anchorX,s.anchorY),H=this.getPerspectiveRatio(v,ie.x,ie.y,w,X),oe=(M?d/H:d*H)/g.ap,ce={getElevation:X,labelPlaneMatrix:S,lineVertexArray:l,pitchWithMap:M,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:ie,unwrappedTileID:w,width:this.transform.width,height:this.transform.height,translation:G},_e=W(oe,u,s.lineOffsetX*oe,s.lineOffsetY*oe,!1,s,!1,ce);let Ce=!1,Le=!1,Ve=!0;if(_e){const We=.5*j*H+q,je=new g.P(-100,-100),Oe=new g.P(this.screenRightBoundary,this.screenBottomBoundary),it=new kt,St=_e.first,$e=_e.last;let Ge=[];for(let Mt=St.path.length-1;Mt>=1;Mt--)Ge.push(St.path[Mt]);for(let Mt=1;Mt<$e.path.length;Mt++)Ge.push($e.path[Mt]);const bt=2.5*We;if(I){const Mt=this.projectPathToScreenSpace(Ge,ce,I);Ge=Mt.some(Vt=>Vt.signedDistanceFromCamera<=0)?[]:Mt.map(Vt=>Vt.point)}let wi=[];if(Ge.length>0){const Mt=Ge[0].clone(),Vt=Ge[0].clone();for(let Ti=1;Ti<Ge.length;Ti++)Mt.x=Math.min(Mt.x,Ge[Ti].x),Mt.y=Math.min(Mt.y,Ge[Ti].y),Vt.x=Math.max(Vt.x,Ge[Ti].x),Vt.y=Math.max(Vt.y,Ge[Ti].y);wi=Mt.x>=je.x&&Vt.x<=Oe.x&&Mt.y>=je.y&&Vt.y<=Oe.y?[Ge]:Vt.x<je.x||Mt.x>Oe.x||Vt.y<je.y||Mt.y>Oe.y?[]:g.al([Ge],je.x,je.y,Oe.x,Oe.y)}for(const Mt of wi){it.reset(Mt,.25*We);let Vt=0;Vt=it.length<=.5*We?1:Math.ceil(it.paddedLength/bt)+1;for(let Ti=0;Ti<Vt;Ti++){const pr=Ti/Math.max(Vt-1,1),vn=it.lerp(pr),ki=vn.x+Ct,or=vn.y+Ct;Y.push(ki,or,We,0);const Ai=ki-We,Hi=or-We,vr=ki+We,Jn=or+We;if(Ve=Ve&&this.isOffscreen(Ai,Hi,vr,Jn),Le=Le||this.isInsideGrid(Ai,Hi,vr,Jn),e!=="always"&&this.grid.hitTestCircle(ki,or,We,e,B)&&(Ce=!0,!P))return{circles:[],offscreen:!1,collisionDetected:Ce}}}}return{circles:!P&&Ce||!Le||H<this.perspectiveRatioCutoff?[]:Y,offscreen:Ve,collisionDetected:Ce}}projectPathToScreenSpace(e,s,l){return e.map(u=>J(u.x,u.y,l,s.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let l=1/0,u=1/0,d=-1/0,v=-1/0;for(const P of e){const M=new g.P(P.x+Ct,P.y+Ct);l=Math.min(l,M.x),u=Math.min(u,M.y),d=Math.max(d,M.x),v=Math.max(v,M.y),s.push(M)}const w=this.grid.query(l,u,d,v).concat(this.ignoredGrid.query(l,u,d,v)),S={},I={};for(const P of w){const M=P.key;if(S[M.bucketInstanceId]===void 0&&(S[M.bucketInstanceId]={}),S[M.bucketInstanceId][M.featureIndex])continue;const B=[new g.P(P.x1,P.y1),new g.P(P.x2,P.y1),new g.P(P.x2,P.y2),new g.P(P.x1,P.y2)];g.am(s,B)&&(S[M.bucketInstanceId][M.featureIndex]=!0,I[M.bucketInstanceId]===void 0&&(I[M.bucketInstanceId]=[]),I[M.bucketInstanceId].push(M.featureIndex))}return I}insertCollisionBox(e,s,l,u,d,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:d,collisionGroupID:v,overlapMode:s},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,s,l,u,d,v){const w=l?this.ignoredGrid:this.grid,S={bucketInstanceId:u,featureIndex:d,collisionGroupID:v,overlapMode:s};for(let I=0;I<e.length;I+=4)w.insertCircle(S,e[I],e[I+1],e[I+2])}projectAndGetPerspectiveRatio(e,s,l,u,d){let v;d?(v=[s,l,d(s,l),1],g.af(v,v,e)):(v=[s,l,0,1],ti(v,v,e));const w=v[3];return{point:new g.P((v[0]/w+1)/2*this.transform.width+Ct,(-v[1]/w+1)/2*this.transform.height+Ct),perspectiveRatio:.5+this.transform.cameraToCenterDistance/w*.5,isOccluded:!1,signedDistanceFromCamera:w}}getPerspectiveRatio(e,s,l,u,d){const v=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(s,l,u,d):J(s,l,e,d);return .5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5}isOffscreen(e,s,l,u){return l<Ct||e>=this.screenRightBoundary||u<Ct||s>this.screenBottomBoundary}isInsideGrid(e,s,l,u){return l>=0&&e<this.gridRightBoundary&&u>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const e=g.an([]);return g.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,s,l,u,d,v,w,S,I,P){let M=new g.P(1,0),B=new g.P(0,1);const j=new g.P(e.anchorPointX+w[0],e.anchorPointY+w[1]);if(v&&!d){const Ve=this.projectAndGetPerspectiveRatio(l,j.x+1,j.y,u,I).point.sub(S.point).unit(),We=Math.atan(Ve.y/Ve.x)+(Ve.x<0?Math.PI:0),je=Math.sin(We),Oe=Math.cos(We);M=new g.P(Oe,je),B=new g.P(-je,Oe)}else if(!v&&d){const Ve=-this.transform.angle,We=Math.sin(Ve),je=Math.cos(Ve);M=new g.P(je,We),B=new g.P(-We,je)}let q=S.point,G=s;if(d){q=j;const Ve=this.transform.zoom-Math.floor(this.transform.zoom);G=Math.pow(2,-Ve),G*=this.mapProjection.getPitchedTextCorrection(this.transform,j,u),P||(G*=g.ac(.5+S.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}P&&(q=q.add(M.mult(P.x*G)).add(B.mult(P.y*G)));const X=e.x1*G,Y=e.x2*G,ie=(X+Y)/2,H=e.y1*G,oe=e.y2*G,ce=(H+oe)/2,_e=[{offsetX:X,offsetY:H},{offsetX:ie,offsetY:H},{offsetX:Y,offsetY:H},{offsetX:Y,offsetY:ce},{offsetX:Y,offsetY:oe},{offsetX:ie,offsetY:oe},{offsetX:X,offsetY:oe},{offsetX:X,offsetY:ce}];let Ce=[];for(const{offsetX:Ve,offsetY:We}of _e)Ce.push(new g.P(q.x+M.x*Ve+B.x*We,q.y+M.y*Ve+B.y*We));let Le=!1;if(d){const Ve=Ce.map(We=>this.projectAndGetPerspectiveRatio(l,We.x,We.y,u,I));Le=Ve.some(We=>!We.isOccluded),Ce=Ve.map(We=>We.point)}else Le=!0;return{box:g.ao(Ce),allPointsOccluded:!Le}}}function Rt(p,e,s){return e*(g.X/(p.tileSize*Math.pow(2,s-p.tileID.overscaledZ)))}class qi{constructor(e,s,l,u){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?s:-s))):u&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class Bi{constructor(e,s,l,u,d){this.text=new qi(e?e.text:null,s,l,d),this.icon=new qi(e?e.icon:null,s,u,d)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ut{constructor(e,s,l){this.text=e,this.icon=s,this.skipFade=l}}class di{constructor(){this.invProjMatrix=g.H(),this.viewportMatrix=g.H(),this.circles=[]}}class Pi{constructor(e,s,l,u,d){this.bucketInstanceId=e,this.featureIndex=s,this.sourceLayerIndex=l,this.bucketIndex=u,this.tileID=d}}class sr{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const s=++this.maxGroupID;this.collisionGroups[e]={ID:s,predicate:l=>l.collisionGroupID===s}}return this.collisionGroups[e]}}function cr(p,e,s,l,u){const{horizontalAlign:d,verticalAlign:v}=g.au(p);return new g.P(-(d-.5)*e+l[0]*u,-(v-.5)*s+l[1]*u)}class Ur{constructor(e,s,l,u,d,v){this.transform=e.clone(),this.terrain=l,this.collisionIndex=new ii(this.transform,s),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new sr(d),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const s=this.terrain;return s?(l,u)=>s.getElevation(e,l,u):null}getBucketParts(e,s,l,u){const d=l.getBucket(s),v=l.latestFeatureIndex;if(!d||!v||s.id!==d.layerIds[0])return;const w=l.collisionBoxArray,S=d.layers[0].layout,I=d.layers[0].paint,P=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),M=l.tileSize/g.X,B=l.tileID.toUnwrapped(),j=this.transform.calculatePosMatrix(B),q=S.get("text-pitch-alignment")==="map",G=S.get("text-rotation-alignment")==="map",X=Rt(l,1,this.transform.zoom),Y=this.collisionIndex.mapProjection.translatePosition(this.transform,l,I.get("text-translate"),I.get("text-translate-anchor")),ie=this.collisionIndex.mapProjection.translatePosition(this.transform,l,I.get("icon-translate"),I.get("icon-translate-anchor")),H=mn(j,q,G,this.transform,X);let oe=null;if(q){const _e=jr(j,q,G,this.transform,X);oe=g.L([],this.transform.labelPlaneMatrix,_e)}this.retainedQueryData[d.bucketInstanceId]=new Pi(d.bucketInstanceId,v,d.sourceLayerIndex,d.index,l.tileID);const ce={bucket:d,layout:S,translationText:Y,translationIcon:ie,posMatrix:j,unwrappedTileID:B,textLabelPlaneMatrix:H,labelToScreenMatrix:oe,scale:P,textPixelRatio:M,holdingForFade:l.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:g.ag(d.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(d.sourceID)};if(u)for(const _e of d.sortKeyRanges){const{sortKey:Ce,symbolInstanceStart:Le,symbolInstanceEnd:Ve}=_e;e.push({sortKey:Ce,symbolInstanceStart:Le,symbolInstanceEnd:Ve,parameters:ce})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:d.symbolInstances.length,parameters:ce})}attemptAnchorPlacement(e,s,l,u,d,v,w,S,I,P,M,B,j,q,G,X,Y,ie,H){const oe=g.aq[e.textAnchor],ce=[e.textOffset0,e.textOffset1],_e=cr(oe,l,u,ce,d),Ce=this.collisionIndex.placeCollisionBox(s,B,S,I,P,w,v,X,M.predicate,H,_e);if((!ie||this.collisionIndex.placeCollisionBox(ie,B,S,I,P,w,v,Y,M.predicate,H,_e).placeable)&&Ce.placeable){let Le;if(this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(Le=this.prevPlacement.variableOffsets[j.crossTileID].anchor),j.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[j.crossTileID]={textOffset:ce,width:l,height:u,anchor:oe,textBoxScale:d,prevAnchor:Le},this.markUsedJustification(q,oe,j,G),q.allowVerticalPlacement&&(this.markUsedOrientation(q,G,j),this.placedOrientations[j.crossTileID]=G),{shift:_e,placedGlyphBoxes:Ce}}}placeLayerBucketPart(e,s,l){const{bucket:u,layout:d,translationText:v,translationIcon:w,posMatrix:S,unwrappedTileID:I,textLabelPlaneMatrix:P,labelToScreenMatrix:M,textPixelRatio:B,holdingForFade:j,collisionBoxArray:q,partiallyEvaluatedTextSize:G,collisionGroup:X}=e.parameters,Y=d.get("text-optional"),ie=d.get("icon-optional"),H=g.ar(d,"text-overlap","text-allow-overlap"),oe=H==="always",ce=g.ar(d,"icon-overlap","icon-allow-overlap"),_e=ce==="always",Ce=d.get("text-rotation-alignment")==="map",Le=d.get("text-pitch-alignment")==="map",Ve=d.get("icon-text-fit")!=="none",We=d.get("symbol-z-order")==="viewport-y",je=oe&&(_e||!u.hasIconData()||ie),Oe=_e&&(oe||!u.hasTextData()||Y);!u.collisionArrays&&q&&u.deserializeCollisionBoxes(q);const it=this._getTerrainElevationFunc(this.retainedQueryData[u.bucketInstanceId].tileID),St=($e,Ge,bt)=>{var wi,Mt;if(s[$e.crossTileID])return;if(j)return void(this.placements[$e.crossTileID]=new Ut(!1,!1,!1));let Vt=!1,Ti=!1,pr=!0,vn=null,ki={box:null,placeable:!1,offscreen:null},or={box:null,placeable:!1,offscreen:null},Ai=null,Hi=null,vr=null,Jn=0,on=0,Yn=0;Ge.textFeatureIndex?Jn=Ge.textFeatureIndex:$e.useRuntimeCollisionCircles&&(Jn=$e.featureIndex),Ge.verticalTextFeatureIndex&&(on=Ge.verticalTextFeatureIndex);const xn=Ge.textBox;if(xn){const zr=ar=>{let Ri=g.ah.horizontal;if(u.allowVerticalPlacement&&!ar&&this.prevPlacement){const ai=this.prevPlacement.placedOrientations[$e.crossTileID];ai&&(this.placedOrientations[$e.crossTileID]=ai,Ri=ai,this.markUsedOrientation(u,Ri,$e))}return Ri},Dn=(ar,Ri)=>{if(u.allowVerticalPlacement&&$e.numVerticalGlyphVertices>0&&Ge.verticalTextBox){for(const ai of u.writingModes)if(ai===g.ah.vertical?(ki=Ri(),or=ki):ki=ar(),ki&&ki.placeable)break}else ki=ar()},Ar=$e.textAnchorOffsetStartIndex,Rs=$e.textAnchorOffsetEndIndex;if(Rs===Ar){const ar=(Ri,ai)=>{const Ei=this.collisionIndex.placeCollisionBox(Ri,H,B,S,I,Le,Ce,v,X.predicate,it);return Ei&&Ei.placeable&&(this.markUsedOrientation(u,ai,$e),this.placedOrientations[$e.crossTileID]=ai),Ei};Dn(()=>ar(xn,g.ah.horizontal),()=>{const Ri=Ge.verticalTextBox;return u.allowVerticalPlacement&&$e.numVerticalGlyphVertices>0&&Ri?ar(Ri,g.ah.vertical):{box:null,offscreen:null}}),zr(ki&&ki.placeable)}else{let ar=g.aq[(Mt=(wi=this.prevPlacement)===null||wi===void 0?void 0:wi.variableOffsets[$e.crossTileID])===null||Mt===void 0?void 0:Mt.anchor];const Ri=(Ei,Wr,mo)=>{const Fs=Ei.x2-Ei.x1,Ec=Ei.y2-Ei.y1,Hl=$e.textBoxScale,Oi=Ve&&ce==="never"?Wr:null;let ys=null,ka=H==="never"?1:2,Xo="never";ar&&ka++;for(let Ia=0;Ia<ka;Ia++){for(let Ko=Ar;Ko<Rs;Ko++){const Qn=u.textAnchorOffsets.get(Ko);if(ar&&Qn.textAnchor!==ar)continue;const fi=this.attemptAnchorPlacement(Qn,Ei,Fs,Ec,Hl,Ce,Le,B,S,I,X,Xo,$e,u,mo,v,w,Oi,it);if(fi&&(ys=fi.placedGlyphBoxes,ys&&ys.placeable))return Vt=!0,vn=fi.shift,ys}ar?ar=null:Xo=H}return l&&!ys&&(ys={box:this.collisionIndex.placeCollisionBox(xn,"always",B,S,I,Le,Ce,v,X.predicate,it,new g.P(0,0)).box,offscreen:!1,placeable:!1}),ys};Dn(()=>Ri(xn,Ge.iconBox,g.ah.horizontal),()=>{const Ei=Ge.verticalTextBox;return u.allowVerticalPlacement&&(!ki||!ki.placeable)&&$e.numVerticalGlyphVertices>0&&Ei?Ri(Ei,Ge.verticalIconBox,g.ah.vertical):{box:null,occluded:!0,offscreen:null}}),ki&&(Vt=ki.placeable,pr=ki.offscreen);const ai=zr(ki&&ki.placeable);if(!Vt&&this.prevPlacement){const Ei=this.prevPlacement.variableOffsets[$e.crossTileID];Ei&&(this.variableOffsets[$e.crossTileID]=Ei,this.markUsedJustification(u,Ei.anchor,$e,ai))}}}if(Ai=ki,Vt=Ai&&Ai.placeable,pr=Ai&&Ai.offscreen,$e.useRuntimeCollisionCircles){const zr=u.text.placedSymbolArray.get($e.centerJustifiedTextSymbolIndex),Dn=g.ai(u.textSizeData,G,zr),Ar=d.get("text-padding");Hi=this.collisionIndex.placeCollisionCircles(H,zr,u.lineVertexArray,u.glyphOffsetArray,Dn,S,I,P,M,l,Le,X.predicate,$e.collisionCircleDiameter,Ar,v,it),Hi.circles.length&&Hi.collisionDetected&&!l&&g.w("Collisions detected, but collision boxes are not shown"),Vt=oe||Hi.circles.length>0&&!Hi.collisionDetected,pr=pr&&Hi.offscreen}if(Ge.iconFeatureIndex&&(Yn=Ge.iconFeatureIndex),Ge.iconBox){const zr=Dn=>this.collisionIndex.placeCollisionBox(Dn,ce,B,S,I,Le,Ce,w,X.predicate,it,Ve&&vn?vn:void 0);or&&or.placeable&&Ge.verticalIconBox?(vr=zr(Ge.verticalIconBox),Ti=vr.placeable):(vr=zr(Ge.iconBox),Ti=vr.placeable),pr=pr&&vr.offscreen}const fo=Y||$e.numHorizontalGlyphVertices===0&&$e.numVerticalGlyphVertices===0,An=ie||$e.numIconVertices===0;fo||An?An?fo||(Ti=Ti&&Vt):Vt=Ti&&Vt:Ti=Vt=Ti&&Vt;const _s=Ti&&vr.placeable;if(Vt&&Ai.placeable&&this.collisionIndex.insertCollisionBox(Ai.box,H,d.get("text-ignore-placement"),u.bucketInstanceId,or&&or.placeable&&on?on:Jn,X.ID),_s&&this.collisionIndex.insertCollisionBox(vr.box,ce,d.get("icon-ignore-placement"),u.bucketInstanceId,Yn,X.ID),Hi&&Vt&&this.collisionIndex.insertCollisionCircles(Hi.circles,H,d.get("text-ignore-placement"),u.bucketInstanceId,Jn,X.ID),l&&this.storeCollisionData(u.bucketInstanceId,bt,Ge,Ai,vr,Hi),$e.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(u.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[$e.crossTileID]=new Ut(Vt||je,Ti||Oe,pr||u.justReloaded),s[$e.crossTileID]=!0};if(We){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const $e=u.getSortedSymbolIndexes(this.transform.angle);for(let Ge=$e.length-1;Ge>=0;--Ge){const bt=$e[Ge];St(u.symbolInstances.get(bt),u.collisionArrays[bt],bt)}}else for(let $e=e.symbolInstanceStart;$e<e.symbolInstanceEnd;$e++)St(u.symbolInstances.get($e),u.collisionArrays[$e],$e);if(l&&u.bucketInstanceId in this.collisionCircleArrays){const $e=this.collisionCircleArrays[u.bucketInstanceId];g.as($e.invProjMatrix,S),$e.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}storeCollisionData(e,s,l,u,d,v){if(l.textBox||l.iconBox){let w,S;this.collisionBoxArrays.has(e)?w=this.collisionBoxArrays.get(e):(w=new Map,this.collisionBoxArrays.set(e,w)),w.has(s)?S=w.get(s):(S={text:null,icon:null},w.set(s,S)),l.textBox&&(S.text=u.box),l.iconBox&&(S.icon=d.box)}if(v){let w=this.collisionCircleArrays[e];w===void 0&&(w=this.collisionCircleArrays[e]=new di);for(let S=0;S<v.circles.length;S+=4)w.circles.push(v.circles[S+0]),w.circles.push(v.circles[S+1]),w.circles.push(v.circles[S+2]),w.circles.push(v.collisionDetected?1:0)}}markUsedJustification(e,s,l,u){let d;d=u===g.ah.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[g.at(s)];const v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const w of v)w>=0&&(e.text.placedSymbolArray.get(w).crossTileID=d>=0&&w!==d?0:l.crossTileID)}markUsedOrientation(e,s,l){const u=s===g.ah.horizontal||s===g.ah.horizontalOnly?s:0,d=s===g.ah.vertical?s:0,v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const w of v)e.text.placedSymbolArray.get(w).placedOrientation=u;l.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=d)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let l=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const u=s?s.symbolFadeChange(e):1,d=s?s.opacities:{},v=s?s.variableOffsets:{},w=s?s.placedOrientations:{};for(const S in this.placements){const I=this.placements[S],P=d[S];P?(this.opacities[S]=new Bi(P,u,I.text,I.icon),l=l||I.text!==P.text.placed||I.icon!==P.icon.placed):(this.opacities[S]=new Bi(null,u,I.text,I.icon,I.skipFade),l=l||I.text||I.icon)}for(const S in d){const I=d[S];if(!this.opacities[S]){const P=new Bi(I,u,!1,!1);P.isHidden()||(this.opacities[S]=P,l=l||I.text.placed||I.icon.placed)}}for(const S in v)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=v[S]);for(const S in w)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=w[S]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:e)}updateLayerOpacities(e,s){const l={};for(const u of s){const d=u.getBucket(e);d&&u.latestFeatureIndex&&e.id===d.layerIds[0]&&this.updateBucketOpacities(d,u.tileID,l,u.collisionBoxArray)}}updateBucketOpacities(e,s,l,u){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const d=e.layers[0],v=d.layout,w=new Bi(null,0,!1,!1,!0),S=v.get("text-allow-overlap"),I=v.get("icon-allow-overlap"),P=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),M=v.get("text-rotation-alignment")==="map",B=v.get("text-pitch-alignment")==="map",j=v.get("icon-text-fit")!=="none",q=new Bi(null,0,S&&(I||!e.hasIconData()||v.get("icon-optional")),I&&(S||!e.hasTextData()||v.get("text-optional")),!0);!e.collisionArrays&&u&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(u);const G=(Y,ie,H)=>{for(let oe=0;oe<ie/4;oe++)Y.opacityVertexArray.emplaceBack(H);Y.hasVisibleVertices=Y.hasVisibleVertices||H!==$r},X=this.collisionBoxArrays.get(e.bucketInstanceId);for(let Y=0;Y<e.symbolInstances.length;Y++){const ie=e.symbolInstances.get(Y),{numHorizontalGlyphVertices:H,numVerticalGlyphVertices:oe,crossTileID:ce}=ie;let _e=this.opacities[ce];l[ce]?_e=w:_e||(_e=q,this.opacities[ce]=_e),l[ce]=!0;const Ce=ie.numIconVertices>0,Le=this.placedOrientations[ie.crossTileID],Ve=Le===g.ah.vertical,We=Le===g.ah.horizontal||Le===g.ah.horizontalOnly;if(H>0||oe>0){const Oe=Pr(_e.text);G(e.text,H,Ve?$r:Oe),G(e.text,oe,We?$r:Oe);const it=_e.text.isHidden();[ie.rightJustifiedTextSymbolIndex,ie.centerJustifiedTextSymbolIndex,ie.leftJustifiedTextSymbolIndex].forEach(Ge=>{Ge>=0&&(e.text.placedSymbolArray.get(Ge).hidden=it||Ve?1:0)}),ie.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ie.verticalPlacedTextSymbolIndex).hidden=it||We?1:0);const St=this.variableOffsets[ie.crossTileID];St&&this.markUsedJustification(e,St.anchor,ie,Le);const $e=this.placedOrientations[ie.crossTileID];$e&&(this.markUsedJustification(e,"left",ie,$e),this.markUsedOrientation(e,$e,ie))}if(Ce){const Oe=Pr(_e.icon),it=!(j&&ie.verticalPlacedIconSymbolIndex&&Ve);ie.placedIconSymbolIndex>=0&&(G(e.icon,ie.numIconVertices,it?Oe:$r),e.icon.placedSymbolArray.get(ie.placedIconSymbolIndex).hidden=_e.icon.isHidden()),ie.verticalPlacedIconSymbolIndex>=0&&(G(e.icon,ie.numVerticalIconVertices,it?$r:Oe),e.icon.placedSymbolArray.get(ie.verticalPlacedIconSymbolIndex).hidden=_e.icon.isHidden())}const je=X&&X.has(Y)?X.get(Y):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Oe=e.collisionArrays[Y];if(Oe){let it=new g.P(0,0);if(Oe.textBox||Oe.verticalTextBox){let St=!0;if(P){const $e=this.variableOffsets[ce];$e?(it=cr($e.anchor,$e.width,$e.height,$e.textOffset,$e.textBoxScale),M&&it._rotate(B?this.transform.angle:-this.transform.angle)):St=!1}if(Oe.textBox||Oe.verticalTextBox){let $e;Oe.textBox&&($e=Ve),Oe.verticalTextBox&&($e=We),la(e.textCollisionBox.collisionVertexArray,_e.text.placed,!St||$e,je.text,it.x,it.y)}}if(Oe.iconBox||Oe.verticalIconBox){const St=!!(!We&&Oe.verticalIconBox);let $e;Oe.iconBox&&($e=St),Oe.verticalIconBox&&($e=!St),la(e.iconCollisionBox.collisionVertexArray,_e.icon.placed,$e,je.icon,j?it.x:0,j?it.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const Y=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=Y.invProjMatrix,e.placementViewportMatrix=Y.viewportMatrix,e.collisionCircleArray=Y.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,s){const l=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*l>e}setStale(){this.stale=!0}}function la(p,e,s,l,u,d){l&&l.length!==0||(l=[0,0,0,0]);const v=l[0]-Ct,w=l[1]-Ct,S=l[2]-Ct,I=l[3]-Ct;p.emplaceBack(e?1:0,s?1:0,u||0,d||0,v,w),p.emplaceBack(e?1:0,s?1:0,u||0,d||0,S,w),p.emplaceBack(e?1:0,s?1:0,u||0,d||0,S,I),p.emplaceBack(e?1:0,s?1:0,u||0,d||0,v,I)}const It=Math.pow(2,25),hu=Math.pow(2,24),Fa=Math.pow(2,17),Yr=Math.pow(2,16),Cr=Math.pow(2,9),rh=Math.pow(2,8),gn=Math.pow(2,1);function Pr(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const e=p.placed?1:0,s=Math.floor(127*p.opacity);return s*It+e*hu+s*Fa+e*Yr+s*Cr+e*rh+s*gn+e}const $r=0;function Io(){return{isOccluded:(p,e,s)=>!1,getPitchedTextCorrection:(p,e,s)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(p,e,s,l){throw new Error("Not implemented.")},translatePosition:(p,e,s,l)=>function(u,d,v,w,S=!1){if(!v[0]&&!v[1])return[0,0];const I=S?w==="map"?u.angle:0:w==="viewport"?-u.angle:0;if(I){const P=Math.sin(I),M=Math.cos(I);v=[v[0]*M-v[1]*P,v[0]*P+v[1]*M]}return[S?v[0]:Rt(d,v[0],u.zoom),S?v[1]:Rt(d,v[1],u.zoom)]}(p,e,s,l),getCircleRadiusCorrection:p=>1}}class xi{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,s,l,u,d){const v=this._bucketParts;for(;this._currentTileIndex<e.length;)if(s.getBucketParts(v,u,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,d())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((w,S)=>w.sortKey-S.sortKey));this._currentPartIndex<v.length;)if(s.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,d())return!0;return!1}}class Ba{constructor(e,s,l,u,d,v,w,S){this.placement=new Ur(e,Io(),s,v,w,S),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=d,this._done=!1}isDone(){return this._done}continuePlacement(e,s,l){const u=we.now(),d=()=>!this._forceFullPlacement&&we.now()-u>2;for(;this._currentPlacementIndex>=0;){const v=s[e[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=w)&&(!v.maxzoom||v.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new xi(v)),this._inProgressLayer.continuePlacement(l[v.source],this.placement,this._showCollisionBoxes,v,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const $n=512/g.X/2;class Zi{constructor(e,s,l){this.tileID=e,this.bucketInstanceId=l,this._symbolsByKey={};const u=new Map;for(let d=0;d<s.length;d++){const v=s.get(d),w=v.key,S=u.get(w);S?S.push(v):u.set(w,[v])}for(const[d,v]of u){const w={positions:v.map(S=>({x:Math.floor(S.anchorX*$n),y:Math.floor(S.anchorY*$n)})),crossTileIDs:v.map(S=>S.crossTileID)};if(w.positions.length>128){const S=new g.av(w.positions.length,16,Uint16Array);for(const{x:I,y:P}of w.positions)S.add(I,P);S.finish(),delete w.positions,w.index=S}this._symbolsByKey[d]=w}}getScaledCoordinates(e,s){const{x:l,y:u,z:d}=this.tileID.canonical,{x:v,y:w,z:S}=s.canonical,I=$n/Math.pow(2,S-d),P=(w*g.X+e.anchorY)*I,M=u*g.X*$n;return{x:Math.floor((v*g.X+e.anchorX)*I-l*g.X*$n),y:Math.floor(P-M)}}findMatches(e,s,l){const u=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let d=0;d<e.length;d++){const v=e.get(d);if(v.crossTileID)continue;const w=this._symbolsByKey[v.key];if(!w)continue;const S=this.getScaledCoordinates(v,s);if(w.index){const I=w.index.range(S.x-u,S.y-u,S.x+u,S.y+u).sort();for(const P of I){const M=w.crossTileIDs[P];if(!l[M]){l[M]=!0,v.crossTileID=M;break}}}else if(w.positions)for(let I=0;I<w.positions.length;I++){const P=w.positions[I],M=w.crossTileIDs[I];if(Math.abs(P.x-S.x)<=u&&Math.abs(P.y-S.y)<=u&&!l[M]){l[M]=!0,v.crossTileID=M;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Eo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Qr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const s=Math.round((e-this.lng)/360);if(s!==0)for(const l in this.indexes){const u=this.indexes[l],d={};for(const v in u){const w=u[v];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+s),d[w.tileID.key]=w}this.indexes[l]=d}this.lng=e}addBucket(e,s,l){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let d=0;d<s.symbolInstances.length;d++)s.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const u=this.usedCrossTileIDs[e.overscaledZ];for(const d in this.indexes){const v=this.indexes[d];if(Number(d)>e.overscaledZ)for(const w in v){const S=v[w];S.tileID.isChildOf(e)&&S.findMatches(s.symbolInstances,e,u)}else{const w=v[e.scaledTo(Number(d)).key];w&&w.findMatches(s.symbolInstances,e,u)}}for(let d=0;d<s.symbolInstances.length;d++){const v=s.symbolInstances.get(d);v.crossTileID||(v.crossTileID=l.generate(),u[v.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Zi(e,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(e,s){for(const l of s.getCrossTileIDsLists())for(const u of l)delete this.usedCrossTileIDs[e][u]}removeStaleBuckets(e){let s=!1;for(const l in this.indexes){const u=this.indexes[l];for(const d in u)e[u[d].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,u[d]),delete u[d],s=!0)}return s}}class Co{constructor(){this.layerIndexes={},this.crossTileIDs=new Eo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,s,l){let u=this.layerIndexes[e.id];u===void 0&&(u=this.layerIndexes[e.id]=new Qr);let d=!1;const v={};u.handleWrapJump(l);for(const w of s){const S=w.getBucket(e);S&&e.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(w.tileID,S,this.crossTileIDs)&&(d=!0),v[S.bucketInstanceId]=!0)}return u.removeStaleBuckets(v)&&(d=!0),d}pruneUnusedLayers(e){const s={};e.forEach(l=>{s[l]=!0});for(const l in this.layerIndexes)s[l]||delete this.layerIndexes[l]}}const en=(p,e)=>g.t(p,e&&e.filter(s=>s.identifier!=="source.canvas")),nh=g.aw();class wl extends g.E{constructor(e,s={}){super(),this._rtlPluginLoaded=()=>{for(const l in this.sourceCaches){const u=this.sourceCaches[l].getSource().type;u!=="vector"&&u!=="geojson"||this.sourceCaches[l].reload()}},this.map=e,this.dispatcher=new rr(vi(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(l,u)=>this.getGlyphs(l,u)),this.dispatcher.registerMessageHandler("GI",(l,u)=>this.getImages(l,u)),this.imageManager=new bi,this.imageManager.setEventedParent(this),this.glyphManager=new hi(e._requestManager,s.localIdeographFontFamily),this.lineAtlas=new Bt(256,512),this.crossTileSymbolIndex=new Co,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new g.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",g.ay()),Jr().on(Fe,this._rtlPluginLoaded),this.on("data",l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const u=this.sourceCaches[l.sourceId];if(!u)return;const d=u.getSource();if(d&&d.vectorLayerIds)for(const v in this._layers){const w=this._layers[v];w.source===d.id&&this._validateLayer(w)}})}loadURL(e,s={},l){this.fire(new g.k("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const u=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const d=this._loadStyleRequest;g.h(u,this._loadStyleRequest).then(v=>{this._loadStyleRequest=null,this._load(v.data,s,l)}).catch(v=>{this._loadStyleRequest=null,v&&!d.signal.aborted&&this.fire(new g.j(v))})}loadJSON(e,s={},l){this.fire(new g.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,we.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(e,s,l)}).catch(()=>{})}loadEmpty(){this.fire(new g.k("dataloading",{dataType:"style"})),this._load(nh,{validate:!1})}_load(e,s,l){var u;const d=s.transformStyle?s.transformStyle(l,e):e;if(!s.validate||!en(this,g.u(d))){this._loaded=!0,this.stylesheet=d;for(const v in d.sources)this.addSource(v,d.sources[v],{validate:!1});d.sprite?this._loadSprite(d.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(d.glyphs),this._createLayers(),this.light=new tt(this.stylesheet.light),this.sky=new Me(this.stylesheet.sky),this.map.setTerrain((u=this.stylesheet.terrain)!==null&&u!==void 0?u:null),this.fire(new g.k("data",{dataType:"style"})),this.fire(new g.k("style.load"))}}_createLayers(){const e=g.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(s=>s.id),this._layers={},this._serializedLayers=null;for(const s of e){const l=g.aA(s);l.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=l}}_loadSprite(e,s=!1,l=void 0){let u;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(d,v,w,S){return g._(this,void 0,void 0,function*(){const I=Ji(d),P=w>1?"@2x":"",M={},B={};for(const{id:j,url:q}of I){const G=v.transformRequest(Vr(q,P,".json"),"SpriteJSON");M[j]=g.h(G,S);const X=v.transformRequest(Vr(q,P,".png"),"SpriteImage");B[j]=vt.getImage(X,S)}return yield Promise.all([...Object.values(M),...Object.values(B)]),function(j,q){return g._(this,void 0,void 0,function*(){const G={};for(const X in j){G[X]={};const Y=we.getImageCanvasContext((yield q[X]).data),ie=(yield j[X]).data;for(const H in ie){const{width:oe,height:ce,x:_e,y:Ce,sdf:Le,pixelRatio:Ve,stretchX:We,stretchY:je,content:Oe,textFitWidth:it,textFitHeight:St}=ie[H];G[X][H]={data:null,pixelRatio:Ve,sdf:Le,stretchX:We,stretchY:je,content:Oe,textFitWidth:it,textFitHeight:St,spriteData:{width:oe,height:ce,x:_e,y:Ce,context:Y}}}}return G})}(M,B)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(d=>{if(this._spriteRequest=null,d)for(const v in d){this._spritesImagesIds[v]=[];const w=this._spritesImagesIds[v]?this._spritesImagesIds[v].filter(S=>!(S in d)):[];for(const S of w)this.imageManager.removeImage(S),this._changedImages[S]=!0;for(const S in d[v]){const I=v==="default"?S:`${v}:${S}`;this._spritesImagesIds[v].push(I),I in this.imageManager.images?this.imageManager.updateImage(I,d[v][S],!1):this.imageManager.addImage(I,d[v][S]),s&&(this._changedImages[I]=!0)}}}).catch(d=>{this._spriteRequest=null,u=d,this.fire(new g.j(u))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new g.k("data",{dataType:"style"})),l&&l(u)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new g.k("data",{dataType:"style"}))}_validateLayer(e){const s=this.sourceCaches[e.source];if(!s)return;const l=e.sourceLayer;if(!l)return;const u=s.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(l)===-1)&&this.fire(new g.j(new Error(`Source layer "${l}" does not exist on source "${u.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,s=!1){const l=this._serializedAllLayers();if(!e||e.length===0)return Object.values(s?g.aB(l):l);const u=[];for(const d of e)if(l[d]){const v=s?g.aB(l[d]):l[d];u.push(v)}return u}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const s=Object.keys(this._layers);for(const l of s){const u=this._layers[l];u.type!=="custom"&&(e[l]=u.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const s=this._changed;if(s){const u=Object.keys(this._updatedLayers),d=Object.keys(this._removedLayers);(u.length||d.length)&&this._updateWorkerLayers(u,d);for(const v in this._updatedSources){const w=this._updatedSources[v];if(w==="reload")this._reloadSource(v);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const l={};for(const u in this.sourceCaches){const d=this.sourceCaches[u];l[u]=d.used,d.used=!1}for(const u of this._order){const d=this._layers[u];d.recalculate(e,this._availableImages),!d.isHidden(e.zoom)&&d.source&&(this.sourceCaches[d.source].used=!0)}for(const u in l){const d=this.sourceCaches[u];!!l[u]!=!!d.used&&d.fire(new g.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,s&&this.fire(new g.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,s={}){var l;this._checkLoaded();const u=this.serialize();if(e=s.transformStyle?s.transformStyle(u,e):e,((l=s.validate)===null||l===void 0||l)&&en(this,g.u(e)))return!1;(e=g.aB(e)).layers=g.az(e.layers);const d=g.aC(u,e),v=this._getOperationsToPerform(d);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(const w of v.operations)w();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const s=[],l=[];for(const u of e)switch(u.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":s.push(()=>this.addLayer.apply(this,u.args));break;case"removeLayer":s.push(()=>this.removeLayer.apply(this,u.args));break;case"setPaintProperty":s.push(()=>this.setPaintProperty.apply(this,u.args));break;case"setLayoutProperty":s.push(()=>this.setLayoutProperty.apply(this,u.args));break;case"setFilter":s.push(()=>this.setFilter.apply(this,u.args));break;case"addSource":s.push(()=>this.addSource.apply(this,u.args));break;case"removeSource":s.push(()=>this.removeSource.apply(this,u.args));break;case"setLayerZoomRange":s.push(()=>this.setLayerZoomRange.apply(this,u.args));break;case"setLight":s.push(()=>this.setLight.apply(this,u.args));break;case"setGeoJSONSourceData":s.push(()=>this.setGeoJSONSourceData.apply(this,u.args));break;case"setGlyphs":s.push(()=>this.setGlyphs.apply(this,u.args));break;case"setSprite":s.push(()=>this.setSprite.apply(this,u.args));break;case"setSky":s.push(()=>this.setSky.apply(this,u.args));break;case"setTerrain":s.push(()=>this.map.setTerrain.apply(this,u.args));break;case"setTransition":s.push(()=>{});break;default:l.push(u.command)}return{operations:s,unimplemented:l}}addImage(e,s){if(this.getImage(e))return this.fire(new g.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,s),this._afterImageUpdated(e)}updateImage(e,s){this.imageManager.updateImage(e,s)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new g.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new g.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,s,l={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(g.u.source,`sources.${e}`,s,null,l))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const u=this.sourceCaches[e]=new wt(e,s,this.dispatcher);u.style=this,u.setEventedParent(this,()=>({isSourceLoaded:u.loaded(),source:u.serialize(),sourceId:e})),u.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new g.j(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const s=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],s.fire(new g.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,s){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const l=this.sourceCaches[e].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(s),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,s,l={}){this._checkLoaded();const u=e.id;if(this.getLayer(u))return void this.fire(new g.j(new Error(`Layer "${u}" already exists on this map.`)));let d;if(e.type==="custom"){if(en(this,g.aD(e)))return;d=g.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(u,e.source),e=g.aB(e),e=g.e(e,{source:u})),this._validate(g.u.layer,`layers.${u}`,e,{arrayIndex:-1},l))return;d=g.aA(e),this._validateLayer(d),d.setEventedParent(this,{layer:{id:u}})}const v=s?this._order.indexOf(s):this._order.length;if(s&&v===-1)this.fire(new g.j(new Error(`Cannot add layer "${u}" before non-existing layer "${s}".`)));else{if(this._order.splice(v,0,u),this._layerOrderChanged=!0,this._layers[u]=d,this._removedLayers[u]&&d.source&&d.type!=="custom"){const w=this._removedLayers[u];delete this._removedLayers[u],w.type!==d.type?this._updatedSources[d.source]="clear":(this._updatedSources[d.source]="reload",this.sourceCaches[d.source].pause())}this._updateLayer(d),d.onAdd&&d.onAdd(this.map)}}moveLayer(e,s){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new g.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===s)return;const l=this._order.indexOf(e);this._order.splice(l,1);const u=s?this._order.indexOf(s):this._order.length;s&&u===-1?this.fire(new g.j(new Error(`Cannot move layer "${e}" before non-existing layer "${s}".`))):(this._order.splice(u,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const s=this._layers[e];if(!s)return void this.fire(new g.j(new Error(`Cannot remove non-existing layer "${e}".`)));s.setEventedParent(null);const l=this._order.indexOf(e);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=s,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],s.onRemove&&s.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,s,l){this._checkLoaded();const u=this.getLayer(e);u?u.minzoom===s&&u.maxzoom===l||(s!=null&&(u.minzoom=s),l!=null&&(u.maxzoom=l),this._updateLayer(u)):this.fire(new g.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,s,l={}){this._checkLoaded();const u=this.getLayer(e);if(u){if(!g.aE(u.filter,s))return s==null?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(g.u.filter,`layers.${u.id}.filter`,s,null,l)||(u.filter=g.aB(s),this._updateLayer(u)))}else this.fire(new g.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return g.aB(this.getLayer(e).filter)}setLayoutProperty(e,s,l,u={}){this._checkLoaded();const d=this.getLayer(e);d?g.aE(d.getLayoutProperty(s),l)||(d.setLayoutProperty(s,l,u),this._updateLayer(d)):this.fire(new g.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,s){const l=this.getLayer(e);if(l)return l.getLayoutProperty(s);this.fire(new g.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,s,l,u={}){this._checkLoaded();const d=this.getLayer(e);d?g.aE(d.getPaintProperty(s),l)||(d.setPaintProperty(s,l,u)&&this._updateLayer(d),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new g.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,s){return this.getLayer(e).getPaintProperty(s)}setFeatureState(e,s){this._checkLoaded();const l=e.source,u=e.sourceLayer,d=this.sourceCaches[l];if(d===void 0)return void this.fire(new g.j(new Error(`The source '${l}' does not exist in the map's style.`)));const v=d.getSource().type;v==="geojson"&&u?this.fire(new g.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||u?(e.id===void 0&&this.fire(new g.j(new Error("The feature id parameter must be provided."))),d.setFeatureState(u,e.id,s)):this.fire(new g.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,s){this._checkLoaded();const l=e.source,u=this.sourceCaches[l];if(u===void 0)return void this.fire(new g.j(new Error(`The source '${l}' does not exist in the map's style.`)));const d=u.getSource().type,v=d==="vector"?e.sourceLayer:void 0;d!=="vector"||v?s&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new g.j(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(v,e.id,s):this.fire(new g.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const s=e.source,l=e.sourceLayer,u=this.sourceCaches[s];if(u!==void 0)return u.getSource().type!=="vector"||l?(e.id===void 0&&this.fire(new g.j(new Error("The feature id parameter must be provided."))),u.getFeatureState(l,e.id)):void this.fire(new g.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new g.j(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return g.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=g.aF(this.sourceCaches,d=>d.serialize()),s=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,u=this.stylesheet;return g.aG({version:u.version,name:u.name,metadata:u.metadata,light:u.light,sky:u.sky,center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,sprite:u.sprite,glyphs:u.glyphs,transition:u.transition,sources:e,layers:s,terrain:l},d=>d!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const s=v=>this._layers[v].type==="fill-extrusion",l={},u=[];for(let v=this._order.length-1;v>=0;v--){const w=this._order[v];if(s(w)){l[w]=v;for(const S of e){const I=S[w];if(I)for(const P of I)u.push(P)}}}u.sort((v,w)=>w.intersectionZ-v.intersectionZ);const d=[];for(let v=this._order.length-1;v>=0;v--){const w=this._order[v];if(s(w))for(let S=u.length-1;S>=0;S--){const I=u[S].feature;if(l[I.layer.id]<v)break;d.push(I),u.pop()}else for(const S of e){const I=S[w];if(I)for(const P of I)d.push(P.feature)}}return d}queryRenderedFeatures(e,s,l){s&&s.filter&&this._validate(g.u.filter,"queryRenderedFeatures.filter",s.filter,null,s);const u={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new g.j(new Error("parameters.layers must be an Array."))),[];for(const w of s.layers){const S=this._layers[w];if(!S)return this.fire(new g.j(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];u[S.source]=!0}}const d=[];s.availableImages=this._availableImages;const v=this._serializedAllLayers();for(const w in this.sourceCaches)s.layers&&!u[w]||d.push(Vn(this.sourceCaches[w],this._layers,v,e,s,l));return this.placement&&d.push(function(w,S,I,P,M,B,j){const q={},G=B.queryRenderedSymbols(P),X=[];for(const Y of Object.keys(G).map(Number))X.push(j[Y]);X.sort(as);for(const Y of X){const ie=Y.featureIndex.lookupSymbolFeatures(G[Y.bucketInstanceId],S,Y.bucketIndex,Y.sourceLayerIndex,M.filter,M.layers,M.availableImages,w);for(const H in ie){const oe=q[H]=q[H]||[],ce=ie[H];ce.sort((_e,Ce)=>{const Le=Y.featureSortOrder;if(Le){const Ve=Le.indexOf(_e.featureIndex);return Le.indexOf(Ce.featureIndex)-Ve}return Ce.featureIndex-_e.featureIndex});for(const _e of ce)oe.push(_e)}}for(const Y in q)q[Y].forEach(ie=>{const H=ie.feature,oe=I[w[Y].source].getFeatureState(H.layer["source-layer"],H.id);H.source=H.layer.source,H.layer["source-layer"]&&(H.sourceLayer=H.layer["source-layer"]),H.state=oe});return q}(this._layers,v,this.sourceCaches,e,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(d)}querySourceFeatures(e,s){s&&s.filter&&this._validate(g.u.filter,"querySourceFeatures.filter",s.filter,null,s);const l=this.sourceCaches[e];return l?function(u,d){const v=u.getRenderableIds().map(I=>u.getTileByID(I)),w=[],S={};for(let I=0;I<v.length;I++){const P=v[I],M=P.tileID.canonical.key;S[M]||(S[M]=!0,P.querySourceFeatures(w,d))}return w}(l,s):[]}getLight(){return this.light.getLight()}setLight(e,s={}){this._checkLoaded();const l=this.light.getLight();let u=!1;for(const v in e)if(!g.aE(e[v],l[v])){u=!0;break}if(!u)return;const d={now:we.now(),transition:g.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,s),this.light.updateTransitions(d)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,s={}){const l=this.getSky();let u=!1;if(!e&&!l)return;if(e&&!l)u=!0;else if(!e&&l)u=!0;else for(const v in e)if(!g.aE(e[v],l[v])){u=!0;break}if(!u)return;const d={now:we.now(),transition:g.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,s),this.sky.updateTransitions(d)}_validate(e,s,l,u,d={}){return(!d||d.validate!==!1)&&en(this,e.call(g.u,g.e({key:s,style:this.serialize(),value:l,styleSpec:g.v},u)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Jr().off(Fe,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const l=this.sourceCaches[s];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const s in this.sourceCaches)this.sourceCaches[s].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,s,l,u,d=!1){let v=!1,w=!1;const S={};for(const I of this._order){const P=this._layers[I];if(P.type!=="symbol")continue;if(!S[P.source]){const B=this.sourceCaches[P.source];S[P.source]=B.getRenderableIds(!0).map(j=>B.getTileByID(j)).sort((j,q)=>q.tileID.overscaledZ-j.tileID.overscaledZ||(j.tileID.isLessThan(q.tileID)?-1:1))}const M=this.crossTileSymbolIndex.addLayer(P,S[P.source],e.center.lng);v=v||M}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((d=d||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(we.now(),e.zoom))&&(this.pauseablePlacement=new Ba(e,this.map.terrain,this._order,d,s,l,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(we.now()),w=!0),v&&this.pauseablePlacement.placement.setStale()),w||v)for(const I of this._order){const P=this._layers[I];P.type==="symbol"&&this.placement.updateLayerOpacities(P,S[P.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(we.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,s){return g._(this,void 0,void 0,function*(){const l=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const u=this.sourceCaches[s.source];return u&&u.setDependencies(s.tileID.key,s.type,s.icons),l})}getGlyphs(e,s){return g._(this,void 0,void 0,function*(){const l=yield this.glyphManager.getGlyphs(s.stacks),u=this.sourceCaches[s.source];return u&&u.setDependencies(s.tileID.key,s.type,[""]),l})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,s={}){this._checkLoaded(),e&&this._validate(g.u.glyphs,"glyphs",e,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,s,l={},u){this._checkLoaded();const d=[{id:e,url:s}],v=[...Ji(this.stylesheet.sprite),...d];this._validate(g.u.sprite,"sprite",v,null,l)||(this.stylesheet.sprite=v,this._loadSprite(d,!0,u))}removeSprite(e){this._checkLoaded();const s=Ji(this.stylesheet.sprite);if(s.find(l=>l.id===e)){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;s.splice(s.findIndex(l=>l.id===e),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new g.k("data",{dataType:"style"}))}else this.fire(new g.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Ji(this.stylesheet.sprite)}setSprite(e,s={},l){this._checkLoaded(),e&&this._validate(g.u.sprite,"sprite",e,null,s)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,l):(this._unloadSprite(),l&&l(null)))}}var Ts=g.Y([{name:"a_pos",type:"Int16",components:2}]);const ks={prelude:ri(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:ri(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:ri(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ri(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ri("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ri(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:ri(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ri("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ri("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ri("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:ri(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:ri(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:ri(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:ri(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ri(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ri(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ri(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ri(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:ri(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ri(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ri(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ri(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ri(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ri(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ri(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ri(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ri("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:ri("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:ri("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:ri("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function ri(p,e){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=e.match(/attribute ([\w]+) ([\w]+)/g),u=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),d=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=d?d.concat(u):u,w={};return{fragmentSource:p=p.replace(s,(S,I,P,M,B)=>(w[B]=!0,I==="define"?`
#ifndef HAS_UNIFORM_u_${B}
varying ${P} ${M} ${B};
#else
uniform ${P} ${M} u_${B};
#endif
`:`
#ifdef HAS_UNIFORM_u_${B}
    ${P} ${M} ${B} = u_${B};
#endif
`)),vertexSource:e=e.replace(s,(S,I,P,M,B)=>{const j=M==="float"?"vec2":"vec4",q=B.match(/color/)?"color":j;return w[B]?I==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${P} ${j} a_${B};
varying ${P} ${M} ${B};
#else
uniform ${P} ${M} u_${B};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${P} ${M} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = unpack_mix_${q}(a_${B}, u_${B}_t);
#else
    ${P} ${M} ${B} = u_${B};
#endif
`:I==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${P} ${j} a_${B};
#else
uniform ${P} ${M} u_${B};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${P} ${M} ${B} = a_${B};
#else
    ${P} ${M} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${P} ${M} ${B} = unpack_mix_${q}(a_${B}, u_${B}_t);
#else
    ${P} ${M} ${B} = u_${B};
#endif
`}),staticAttributes:l,staticUniforms:v}}class Po{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,s,l,u,d,v,w,S,I){this.context=e;let P=this.boundPaintVertexBuffers.length!==u.length;for(let M=0;!P&&M<u.length;M++)this.boundPaintVertexBuffers[M]!==u[M]&&(P=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==l||P||this.boundIndexBuffer!==d||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==S||this.boundDynamicVertexBuffer3!==I?this.freshBind(s,l,u,d,v,w,S,I):(e.bindVertexArray.set(this.vao),w&&w.bind(),d&&d.dynamicDraw&&d.bind(),S&&S.bind(),I&&I.bind())}freshBind(e,s,l,u,d,v,w,S){const I=e.numAttributes,P=this.context,M=P.gl;this.vao&&this.destroy(),this.vao=P.createVertexArray(),P.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=u,this.boundVertexOffset=d,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=S,s.enableAttributes(M,e);for(const B of l)B.enableAttributes(M,e);v&&v.enableAttributes(M,e),w&&w.enableAttributes(M,e),S&&S.enableAttributes(M,e),s.bind(),s.setVertexAttribPointers(M,e,d);for(const B of l)B.bind(),B.setVertexAttribPointers(M,e,d);v&&(v.bind(),v.setVertexAttribPointers(M,e,d)),u&&u.bind(),w&&(w.bind(),w.setVertexAttribPointers(M,e,d)),S&&(S.bind(),S.setVertexAttribPointers(M,e,d)),P.currentNumAttributes=I}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const du=(p,e,s,l,u)=>({u_matrix:p,u_texture:0,u_ele_delta:e,u_fog_matrix:s,u_fog_color:l?l.properties.get("fog-color"):g.aM.white,u_fog_ground_blend:l?l.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:l?l.calculateFogBlendOpacity(u):0,u_horizon_color:l?l.properties.get("horizon-color"):g.aM.white,u_horizon_fog_blend:l?l.properties.get("horizon-fog-blend"):1});function eo(p){const e=[];for(let s=0;s<p.length;s++){if(p[s]===null)continue;const l=p[s].split(" ");e.push(l.pop())}return e}class pi{constructor(e,s,l,u,d,v){const w=e.gl;this.program=w.createProgram();const S=eo(s.staticAttributes),I=l?l.getBinderAttributes():[],P=S.concat(I),M=ks.prelude.staticUniforms?eo(ks.prelude.staticUniforms):[],B=s.staticUniforms?eo(s.staticUniforms):[],j=l?l.getBinderUniforms():[],q=M.concat(B).concat(j),G=[];for(const _e of q)G.indexOf(_e)<0&&G.push(_e);const X=l?l.defines():[];d&&X.push("#define OVERDRAW_INSPECTOR;"),v&&X.push("#define TERRAIN3D;");const Y=X.concat(ks.prelude.fragmentSource,s.fragmentSource).join(`
`),ie=X.concat(ks.prelude.vertexSource,s.vertexSource).join(`
`),H=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(H,Y),w.compileShader(H),!w.getShaderParameter(H,w.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${w.getShaderInfoLog(H)}`);w.attachShader(this.program,H);const oe=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(oe,ie),w.compileShader(oe),!w.getShaderParameter(oe,w.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${w.getShaderInfoLog(oe)}`);w.attachShader(this.program,oe),this.attributes={};const ce={};this.numAttributes=P.length;for(let _e=0;_e<this.numAttributes;_e++)P[_e]&&(w.bindAttribLocation(this.program,_e,P[_e]),this.attributes[P[_e]]=_e);if(w.linkProgram(this.program),!w.getProgramParameter(this.program,w.LINK_STATUS))throw new Error(`Program failed to link: ${w.getProgramInfoLog(this.program)}`);w.deleteShader(oe),w.deleteShader(H);for(let _e=0;_e<G.length;_e++){const Ce=G[_e];if(Ce&&!ce[Ce]){const Le=w.getUniformLocation(this.program,Ce);Le&&(ce[Ce]=Le)}}this.fixedUniforms=u(e,ce),this.terrainUniforms=((_e,Ce)=>({u_depth:new g.aH(_e,Ce.u_depth),u_terrain:new g.aH(_e,Ce.u_terrain),u_terrain_dim:new g.aI(_e,Ce.u_terrain_dim),u_terrain_matrix:new g.aJ(_e,Ce.u_terrain_matrix),u_terrain_unpack:new g.aK(_e,Ce.u_terrain_unpack),u_terrain_exaggeration:new g.aI(_e,Ce.u_terrain_exaggeration)}))(e,ce),this.binderUniforms=l?l.getUniforms(e,ce):[]}draw(e,s,l,u,d,v,w,S,I,P,M,B,j,q,G,X,Y,ie){const H=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(l),e.setStencilMode(u),e.setColorMode(d),e.setCullFace(v),S){e.activeTexture.set(H.TEXTURE2),H.bindTexture(H.TEXTURE_2D,S.depthTexture),e.activeTexture.set(H.TEXTURE3),H.bindTexture(H.TEXTURE_2D,S.texture);for(const ce in this.terrainUniforms)this.terrainUniforms[ce].set(S[ce])}for(const ce in this.fixedUniforms)this.fixedUniforms[ce].set(w[ce]);G&&G.setUniforms(e,this.binderUniforms,j,{zoom:q});let oe=0;switch(s){case H.LINES:oe=2;break;case H.TRIANGLES:oe=3;break;case H.LINE_STRIP:oe=1}for(const ce of B.get()){const _e=ce.vaos||(ce.vaos={});(_e[I]||(_e[I]=new Po)).bind(e,this,P,G?G.getPaintVertexBuffers():[],M,ce.vertexOffset,X,Y,ie),H.drawElements(s,ce.primitiveLength*oe,H.UNSIGNED_SHORT,ce.primitiveOffset*oe*2)}}}function Oa(p,e,s){const l=1/Rt(s,1,e.transform.tileZoom),u=Math.pow(2,s.tileID.overscaledZ),d=s.tileSize*Math.pow(2,e.transform.tileZoom)/u,v=d*(s.tileID.canonical.x+s.tileID.wrap*u),w=d*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[l,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[v>>16,w>>16],u_pixel_coord_lower:[65535&v,65535&w]}}const ua=(p,e,s,l)=>{const u=e.style.light,d=u.properties.get("position"),v=[d.x,d.y,d.z],w=function(){var I=new g.A(9);return g.A!=Float32Array&&(I[1]=0,I[2]=0,I[3]=0,I[5]=0,I[6]=0,I[7]=0),I[0]=1,I[4]=1,I[8]=1,I}();u.properties.get("anchor")==="viewport"&&function(I,P){var M=Math.sin(P),B=Math.cos(P);I[0]=B,I[1]=M,I[2]=0,I[3]=-M,I[4]=B,I[5]=0,I[6]=0,I[7]=0,I[8]=1}(w,-e.transform.angle),function(I,P,M){var B=P[0],j=P[1],q=P[2];I[0]=B*M[0]+j*M[3]+q*M[6],I[1]=B*M[1]+j*M[4]+q*M[7],I[2]=B*M[2]+j*M[5]+q*M[8]}(v,v,w);const S=u.properties.get("color");return{u_matrix:p,u_lightpos:v,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[S.r,S.g,S.b],u_vertical_gradient:+s,u_opacity:l}},ca=(p,e,s,l,u,d,v)=>g.e(ua(p,e,s,l),Oa(d,e,v),{u_height_factor:-Math.pow(2,u.overscaledZ)/v.tileSize/8}),Mo=p=>({u_matrix:p}),pu=(p,e,s,l)=>g.e(Mo(p),Oa(s,e,l)),hc=(p,e)=>({u_matrix:p,u_world:e}),bl=(p,e,s,l,u)=>g.e(pu(p,e,s,l),{u_world:u}),Sl=(p,e,s,l)=>{const u=p.transform;let d,v;if(l.paint.get("circle-pitch-alignment")==="map"){const w=Rt(s,1,u.zoom);d=!0,v=[w,w]}else d=!1,v=u.pixelsToGLUnits;return{u_camera_to_center_distance:u.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_matrix:p.translatePosMatrix(e.posMatrix,s,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_pitch_with_map:+d,u_device_pixel_ratio:p.pixelRatio,u_extrude_scale:v}},tn=(p,e,s)=>({u_matrix:p,u_inv_matrix:e,u_camera_to_center_distance:s.cameraToCenterDistance,u_viewport_size:[s.width,s.height]}),En=(p,e,s=1)=>({u_matrix:p,u_color:e,u_overlay:0,u_overlay_scale:s}),Gi=p=>({u_matrix:p}),hr=(p,e,s,l)=>({u_matrix:p,u_extrude_scale:Rt(e,1,s),u_intensity:l}),to=(p,e,s,l)=>{const u=g.H();g.aP(u,0,p.width,p.height,0,0,1);const d=p.context.gl;return{u_matrix:u,u_world:[d.drawingBufferWidth,d.drawingBufferHeight],u_image:s,u_color_ramp:l,u_opacity:e.paint.get("heatmap-opacity")}};function qn(p,e){const s=Math.pow(2,e.canonical.z),l=e.canonical.y;return[new g.Z(0,l/s).toLngLat().lat,new g.Z(0,(l+1)/s).toLngLat().lat]}const Tl=(p,e,s,l)=>{const u=p.transform;return{u_matrix:Na(p,e,s,l),u_ratio:1/Rt(e,1,u.zoom),u_device_pixel_ratio:p.pixelRatio,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},fu=(p,e,s,l,u)=>g.e(Tl(p,e,s,u),{u_image:0,u_image_height:l}),hs=(p,e,s,l,u)=>{const d=p.transform,v=mu(e,d);return{u_matrix:Na(p,e,s,u),u_texsize:e.imageAtlasTexture.size,u_ratio:1/Rt(e,1,d.zoom),u_device_pixel_ratio:p.pixelRatio,u_image:0,u_scale:[v,l.fromScale,l.toScale],u_fade:l.t,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},sh=(p,e,s,l,u,d)=>{const v=p.lineAtlas,w=mu(e,p.transform),S=s.layout.get("line-cap")==="round",I=v.getDash(l.from,S),P=v.getDash(l.to,S),M=I.width*u.fromScale,B=P.width*u.toScale;return g.e(Tl(p,e,s,d),{u_patternscale_a:[w/M,-I.height/2],u_patternscale_b:[w/B,-P.height/2],u_sdfgamma:v.width/(256*Math.min(M,B)*p.pixelRatio)/2,u_image:0,u_tex_y_a:I.y,u_tex_y_b:P.y,u_mix:u.t})};function mu(p,e){return 1/Rt(p,1,e.tileZoom)}function Na(p,e,s,l){return p.translatePosMatrix(l?l.posMatrix:e.tileID.posMatrix,e,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const dc=(p,e,s,l,u)=>{return{u_matrix:p,u_tl_parent:e,u_scale_parent:s,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(v=u.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(d=u.paint.get("raster-contrast"),d>0?1/(1-d):1+d),u_spin_weights:oh(u.paint.get("raster-hue-rotate"))};var d,v};function oh(p){p*=Math.PI/180;const e=Math.sin(p),s=Math.cos(p);return[(2*s+1)/3,(-Math.sqrt(3)*e-s+1)/3,(Math.sqrt(3)*e-s+1)/3]}const ha=(p,e,s,l,u,d,v,w,S,I,P,M,B,j)=>{const q=v.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:q.cameraToCenterDistance,u_pitch:q.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:q.width/q.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:S,u_coord_matrix:I,u_is_text:+M,u_pitch_with_map:+l,u_is_along_line:u,u_is_variable_anchor:d,u_texsize:B,u_texture:0,u_translation:P,u_pitched_scale:j}},Is=(p,e,s,l,u,d,v,w,S,I,P,M,B,j,q)=>{const G=v.transform;return g.e(ha(p,e,s,l,u,d,v,w,S,I,P,M,B,q),{u_gamma_scale:l?Math.cos(G._pitch)*G.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:+j})},io=(p,e,s,l,u,d,v,w,S,I,P,M,B,j)=>g.e(Is(p,e,s,l,u,d,v,w,S,I,P,!0,M,!0,j),{u_texsize_icon:B,u_texture_icon:1}),zo=(p,e,s)=>({u_matrix:p,u_opacity:e,u_color:s}),gu=(p,e,s,l,u,d)=>g.e(function(v,w,S,I){const P=S.imageManager.getPattern(v.from.toString()),M=S.imageManager.getPattern(v.to.toString()),{width:B,height:j}=S.imageManager.getPixelSize(),q=Math.pow(2,I.tileID.overscaledZ),G=I.tileSize*Math.pow(2,S.transform.tileZoom)/q,X=G*(I.tileID.canonical.x+I.tileID.wrap*q),Y=G*I.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:P.tl,u_pattern_br_a:P.br,u_pattern_tl_b:M.tl,u_pattern_br_b:M.br,u_texsize:[B,j],u_mix:w.t,u_pattern_size_a:P.displaySize,u_pattern_size_b:M.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/Rt(I,1,S.transform.tileZoom),u_pixel_coord_upper:[X>>16,Y>>16],u_pixel_coord_lower:[65535&X,65535&Y]}}(l,d,s,u),{u_matrix:p,u_opacity:e}),_u={fillExtrusion:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_lightpos:new g.aN(p,e.u_lightpos),u_lightintensity:new g.aI(p,e.u_lightintensity),u_lightcolor:new g.aN(p,e.u_lightcolor),u_vertical_gradient:new g.aI(p,e.u_vertical_gradient),u_opacity:new g.aI(p,e.u_opacity)}),fillExtrusionPattern:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_lightpos:new g.aN(p,e.u_lightpos),u_lightintensity:new g.aI(p,e.u_lightintensity),u_lightcolor:new g.aN(p,e.u_lightcolor),u_vertical_gradient:new g.aI(p,e.u_vertical_gradient),u_height_factor:new g.aI(p,e.u_height_factor),u_image:new g.aH(p,e.u_image),u_texsize:new g.aO(p,e.u_texsize),u_pixel_coord_upper:new g.aO(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new g.aO(p,e.u_pixel_coord_lower),u_scale:new g.aN(p,e.u_scale),u_fade:new g.aI(p,e.u_fade),u_opacity:new g.aI(p,e.u_opacity)}),fill:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix)}),fillPattern:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_image:new g.aH(p,e.u_image),u_texsize:new g.aO(p,e.u_texsize),u_pixel_coord_upper:new g.aO(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new g.aO(p,e.u_pixel_coord_lower),u_scale:new g.aN(p,e.u_scale),u_fade:new g.aI(p,e.u_fade)}),fillOutline:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_world:new g.aO(p,e.u_world)}),fillOutlinePattern:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_world:new g.aO(p,e.u_world),u_image:new g.aH(p,e.u_image),u_texsize:new g.aO(p,e.u_texsize),u_pixel_coord_upper:new g.aO(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new g.aO(p,e.u_pixel_coord_lower),u_scale:new g.aN(p,e.u_scale),u_fade:new g.aI(p,e.u_fade)}),circle:(p,e)=>({u_camera_to_center_distance:new g.aI(p,e.u_camera_to_center_distance),u_scale_with_map:new g.aH(p,e.u_scale_with_map),u_pitch_with_map:new g.aH(p,e.u_pitch_with_map),u_extrude_scale:new g.aO(p,e.u_extrude_scale),u_device_pixel_ratio:new g.aI(p,e.u_device_pixel_ratio),u_matrix:new g.aJ(p,e.u_matrix)}),collisionBox:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_pixel_extrude_scale:new g.aO(p,e.u_pixel_extrude_scale)}),collisionCircle:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_inv_matrix:new g.aJ(p,e.u_inv_matrix),u_camera_to_center_distance:new g.aI(p,e.u_camera_to_center_distance),u_viewport_size:new g.aO(p,e.u_viewport_size)}),debug:(p,e)=>({u_color:new g.aL(p,e.u_color),u_matrix:new g.aJ(p,e.u_matrix),u_overlay:new g.aH(p,e.u_overlay),u_overlay_scale:new g.aI(p,e.u_overlay_scale)}),clippingMask:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix)}),heatmap:(p,e)=>({u_extrude_scale:new g.aI(p,e.u_extrude_scale),u_intensity:new g.aI(p,e.u_intensity),u_matrix:new g.aJ(p,e.u_matrix)}),heatmapTexture:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_world:new g.aO(p,e.u_world),u_image:new g.aH(p,e.u_image),u_color_ramp:new g.aH(p,e.u_color_ramp),u_opacity:new g.aI(p,e.u_opacity)}),hillshade:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_image:new g.aH(p,e.u_image),u_latrange:new g.aO(p,e.u_latrange),u_light:new g.aO(p,e.u_light),u_shadow:new g.aL(p,e.u_shadow),u_highlight:new g.aL(p,e.u_highlight),u_accent:new g.aL(p,e.u_accent)}),hillshadePrepare:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_image:new g.aH(p,e.u_image),u_dimension:new g.aO(p,e.u_dimension),u_zoom:new g.aI(p,e.u_zoom),u_unpack:new g.aK(p,e.u_unpack)}),line:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_ratio:new g.aI(p,e.u_ratio),u_device_pixel_ratio:new g.aI(p,e.u_device_pixel_ratio),u_units_to_pixels:new g.aO(p,e.u_units_to_pixels)}),lineGradient:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_ratio:new g.aI(p,e.u_ratio),u_device_pixel_ratio:new g.aI(p,e.u_device_pixel_ratio),u_units_to_pixels:new g.aO(p,e.u_units_to_pixels),u_image:new g.aH(p,e.u_image),u_image_height:new g.aI(p,e.u_image_height)}),linePattern:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_texsize:new g.aO(p,e.u_texsize),u_ratio:new g.aI(p,e.u_ratio),u_device_pixel_ratio:new g.aI(p,e.u_device_pixel_ratio),u_image:new g.aH(p,e.u_image),u_units_to_pixels:new g.aO(p,e.u_units_to_pixels),u_scale:new g.aN(p,e.u_scale),u_fade:new g.aI(p,e.u_fade)}),lineSDF:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_ratio:new g.aI(p,e.u_ratio),u_device_pixel_ratio:new g.aI(p,e.u_device_pixel_ratio),u_units_to_pixels:new g.aO(p,e.u_units_to_pixels),u_patternscale_a:new g.aO(p,e.u_patternscale_a),u_patternscale_b:new g.aO(p,e.u_patternscale_b),u_sdfgamma:new g.aI(p,e.u_sdfgamma),u_image:new g.aH(p,e.u_image),u_tex_y_a:new g.aI(p,e.u_tex_y_a),u_tex_y_b:new g.aI(p,e.u_tex_y_b),u_mix:new g.aI(p,e.u_mix)}),raster:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_tl_parent:new g.aO(p,e.u_tl_parent),u_scale_parent:new g.aI(p,e.u_scale_parent),u_buffer_scale:new g.aI(p,e.u_buffer_scale),u_fade_t:new g.aI(p,e.u_fade_t),u_opacity:new g.aI(p,e.u_opacity),u_image0:new g.aH(p,e.u_image0),u_image1:new g.aH(p,e.u_image1),u_brightness_low:new g.aI(p,e.u_brightness_low),u_brightness_high:new g.aI(p,e.u_brightness_high),u_saturation_factor:new g.aI(p,e.u_saturation_factor),u_contrast_factor:new g.aI(p,e.u_contrast_factor),u_spin_weights:new g.aN(p,e.u_spin_weights)}),symbolIcon:(p,e)=>({u_is_size_zoom_constant:new g.aH(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new g.aH(p,e.u_is_size_feature_constant),u_size_t:new g.aI(p,e.u_size_t),u_size:new g.aI(p,e.u_size),u_camera_to_center_distance:new g.aI(p,e.u_camera_to_center_distance),u_pitch:new g.aI(p,e.u_pitch),u_rotate_symbol:new g.aH(p,e.u_rotate_symbol),u_aspect_ratio:new g.aI(p,e.u_aspect_ratio),u_fade_change:new g.aI(p,e.u_fade_change),u_matrix:new g.aJ(p,e.u_matrix),u_label_plane_matrix:new g.aJ(p,e.u_label_plane_matrix),u_coord_matrix:new g.aJ(p,e.u_coord_matrix),u_is_text:new g.aH(p,e.u_is_text),u_pitch_with_map:new g.aH(p,e.u_pitch_with_map),u_is_along_line:new g.aH(p,e.u_is_along_line),u_is_variable_anchor:new g.aH(p,e.u_is_variable_anchor),u_texsize:new g.aO(p,e.u_texsize),u_texture:new g.aH(p,e.u_texture),u_translation:new g.aO(p,e.u_translation),u_pitched_scale:new g.aI(p,e.u_pitched_scale)}),symbolSDF:(p,e)=>({u_is_size_zoom_constant:new g.aH(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new g.aH(p,e.u_is_size_feature_constant),u_size_t:new g.aI(p,e.u_size_t),u_size:new g.aI(p,e.u_size),u_camera_to_center_distance:new g.aI(p,e.u_camera_to_center_distance),u_pitch:new g.aI(p,e.u_pitch),u_rotate_symbol:new g.aH(p,e.u_rotate_symbol),u_aspect_ratio:new g.aI(p,e.u_aspect_ratio),u_fade_change:new g.aI(p,e.u_fade_change),u_matrix:new g.aJ(p,e.u_matrix),u_label_plane_matrix:new g.aJ(p,e.u_label_plane_matrix),u_coord_matrix:new g.aJ(p,e.u_coord_matrix),u_is_text:new g.aH(p,e.u_is_text),u_pitch_with_map:new g.aH(p,e.u_pitch_with_map),u_is_along_line:new g.aH(p,e.u_is_along_line),u_is_variable_anchor:new g.aH(p,e.u_is_variable_anchor),u_texsize:new g.aO(p,e.u_texsize),u_texture:new g.aH(p,e.u_texture),u_gamma_scale:new g.aI(p,e.u_gamma_scale),u_device_pixel_ratio:new g.aI(p,e.u_device_pixel_ratio),u_is_halo:new g.aH(p,e.u_is_halo),u_translation:new g.aO(p,e.u_translation),u_pitched_scale:new g.aI(p,e.u_pitched_scale)}),symbolTextAndIcon:(p,e)=>({u_is_size_zoom_constant:new g.aH(p,e.u_is_size_zoom_constant),u_is_size_feature_constant:new g.aH(p,e.u_is_size_feature_constant),u_size_t:new g.aI(p,e.u_size_t),u_size:new g.aI(p,e.u_size),u_camera_to_center_distance:new g.aI(p,e.u_camera_to_center_distance),u_pitch:new g.aI(p,e.u_pitch),u_rotate_symbol:new g.aH(p,e.u_rotate_symbol),u_aspect_ratio:new g.aI(p,e.u_aspect_ratio),u_fade_change:new g.aI(p,e.u_fade_change),u_matrix:new g.aJ(p,e.u_matrix),u_label_plane_matrix:new g.aJ(p,e.u_label_plane_matrix),u_coord_matrix:new g.aJ(p,e.u_coord_matrix),u_is_text:new g.aH(p,e.u_is_text),u_pitch_with_map:new g.aH(p,e.u_pitch_with_map),u_is_along_line:new g.aH(p,e.u_is_along_line),u_is_variable_anchor:new g.aH(p,e.u_is_variable_anchor),u_texsize:new g.aO(p,e.u_texsize),u_texsize_icon:new g.aO(p,e.u_texsize_icon),u_texture:new g.aH(p,e.u_texture),u_texture_icon:new g.aH(p,e.u_texture_icon),u_gamma_scale:new g.aI(p,e.u_gamma_scale),u_device_pixel_ratio:new g.aI(p,e.u_device_pixel_ratio),u_is_halo:new g.aH(p,e.u_is_halo),u_translation:new g.aO(p,e.u_translation),u_pitched_scale:new g.aI(p,e.u_pitched_scale)}),background:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_opacity:new g.aI(p,e.u_opacity),u_color:new g.aL(p,e.u_color)}),backgroundPattern:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_opacity:new g.aI(p,e.u_opacity),u_image:new g.aH(p,e.u_image),u_pattern_tl_a:new g.aO(p,e.u_pattern_tl_a),u_pattern_br_a:new g.aO(p,e.u_pattern_br_a),u_pattern_tl_b:new g.aO(p,e.u_pattern_tl_b),u_pattern_br_b:new g.aO(p,e.u_pattern_br_b),u_texsize:new g.aO(p,e.u_texsize),u_mix:new g.aI(p,e.u_mix),u_pattern_size_a:new g.aO(p,e.u_pattern_size_a),u_pattern_size_b:new g.aO(p,e.u_pattern_size_b),u_scale_a:new g.aI(p,e.u_scale_a),u_scale_b:new g.aI(p,e.u_scale_b),u_pixel_coord_upper:new g.aO(p,e.u_pixel_coord_upper),u_pixel_coord_lower:new g.aO(p,e.u_pixel_coord_lower),u_tile_units_to_pixels:new g.aI(p,e.u_tile_units_to_pixels)}),terrain:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_texture:new g.aH(p,e.u_texture),u_ele_delta:new g.aI(p,e.u_ele_delta),u_fog_matrix:new g.aJ(p,e.u_fog_matrix),u_fog_color:new g.aL(p,e.u_fog_color),u_fog_ground_blend:new g.aI(p,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new g.aI(p,e.u_fog_ground_blend_opacity),u_horizon_color:new g.aL(p,e.u_horizon_color),u_horizon_fog_blend:new g.aI(p,e.u_horizon_fog_blend)}),terrainDepth:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_ele_delta:new g.aI(p,e.u_ele_delta)}),terrainCoords:(p,e)=>({u_matrix:new g.aJ(p,e.u_matrix),u_texture:new g.aH(p,e.u_texture),u_terrain_coords_id:new g.aI(p,e.u_terrain_coords_id),u_ele_delta:new g.aI(p,e.u_ele_delta)}),sky:(p,e)=>({u_sky_color:new g.aL(p,e.u_sky_color),u_horizon_color:new g.aL(p,e.u_horizon_color),u_horizon:new g.aI(p,e.u_horizon),u_sky_horizon_blend:new g.aI(p,e.u_sky_horizon_blend)})};class Cn{constructor(e,s,l){this.context=e;const u=e.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const kl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Va{constructor(e,s,l,u){this.length=s.length,this.attributes=l,this.itemSize=s.bytesPerElement,this.dynamicDraw=u,this.context=e;const d=e.gl;this.buffer=d.createBuffer(),e.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,s){for(let l=0;l<this.attributes.length;l++){const u=s.attributes[this.attributes[l].name];u!==void 0&&e.enableVertexAttribArray(u)}}setVertexAttribPointers(e,s,l){for(let u=0;u<this.attributes.length;u++){const d=this.attributes[u],v=s.attributes[d.name];v!==void 0&&e.vertexAttribPointer(v,d.components,e[kl[d.type]],!1,this.itemSize,d.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ro=new WeakMap;function qr(p){var e;if(ro.has(p))return ro.get(p);{const s=(e=p.getParameter(p.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return ro.set(p,s),s}}class ni{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ao extends ni{getDefault(){return g.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class pc extends ni{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Es extends ni{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Il extends ni{getDefault(){return[!0,!0,!0,!0]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class yu extends ni{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class _n extends ni{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Do extends ni{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const s=this.current;(e.func!==s.func||e.ref!==s.ref||e.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class ja extends ni{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class da extends ni{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=e,this.dirty=!1}}class fc extends ni{getDefault(){return[0,1]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class El extends ni{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=e,this.dirty=!1}}class Cl extends ni{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Zn extends ni{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.BLEND):s.disable(s.BLEND),this.current=e,this.dirty=!1}}class Ua extends ni{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class mc extends ni{getDefault(){return g.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class gc extends ni{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class $a extends ni{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=e,this.dirty=!1}}class Pl extends ni{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class vu extends ni{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class ah extends ni{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class _c extends ni{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class yc extends ni{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class vc extends ni{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class xu extends ni{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class wu extends ni{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Ml extends ni{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Cs extends ni{getDefault(){return null}set(e){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class bu extends ni{getDefault(){return null}set(e){var s;if(e===this.current&&!this.dirty)return;const l=this.gl;qr(l)?l.bindVertexArray(e):(s=l.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Su extends ni{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class qa extends ni{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class xc extends ni{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Za extends ni{constructor(e,s){super(e),this.context=e,this.parent=s}getDefault(){return null}}class Lo extends Za{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class zl extends Za{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class lh extends Za{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class uh{constructor(e,s,l,u,d){this.context=e,this.width=s,this.height=l;const v=e.gl,w=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new Lo(e,w),u)this.depthAttachment=d?new lh(e,w):new zl(e,w);else if(d)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,s=this.colorAttachment.get();if(s&&e.deleteTexture(s),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class Ui{constructor(e,s,l){this.blendFunction=e,this.blendColor=s,this.mask=l}}Ui.Replace=[1,0],Ui.disabled=new Ui(Ui.Replace,g.aM.transparent,[!1,!1,!1,!1]),Ui.unblended=new Ui(Ui.Replace,g.aM.transparent,[!0,!0,!0,!0]),Ui.alphaBlended=new Ui([1,771],g.aM.transparent,[!0,!0,!0,!0]);class ch{constructor(e){var s,l;if(this.gl=e,this.clearColor=new Ao(this),this.clearDepth=new pc(this),this.clearStencil=new Es(this),this.colorMask=new Il(this),this.depthMask=new yu(this),this.stencilMask=new _n(this),this.stencilFunc=new Do(this),this.stencilOp=new ja(this),this.stencilTest=new da(this),this.depthRange=new fc(this),this.depthTest=new El(this),this.depthFunc=new Cl(this),this.blend=new Zn(this),this.blendFunc=new Ua(this),this.blendColor=new mc(this),this.blendEquation=new gc(this),this.cullFace=new $a(this),this.cullFaceSide=new Pl(this),this.frontFace=new vu(this),this.program=new ah(this),this.activeTexture=new _c(this),this.viewport=new yc(this),this.bindFramebuffer=new vc(this),this.bindRenderbuffer=new xu(this),this.bindTexture=new wu(this),this.bindVertexBuffer=new Ml(this),this.bindElementBuffer=new Cs(this),this.bindVertexArray=new bu(this),this.pixelStoreUnpack=new Su(this),this.pixelStoreUnpackPremultiplyAlpha=new qa(this),this.pixelStoreUnpackFlipY=new xc(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),qr(e)){this.HALF_FLOAT=e.HALF_FLOAT;const u=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=e.RGBA16F)!==null&&s!==void 0?s:u==null?void 0:u.RGBA16F_EXT,this.RGB16F=(l=e.RGB16F)!==null&&l!==void 0?l:u==null?void 0:u.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const u=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=u==null?void 0:u.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,s){return new Cn(this,e,s)}createVertexBuffer(e,s,l){return new Va(this,e,s,l)}createRenderbuffer(e,s,l){const u=this.gl,d=u.createRenderbuffer();return this.bindRenderbuffer.set(d),u.renderbufferStorage(u.RENDERBUFFER,e,s,l),this.bindRenderbuffer.set(null),d}createFramebuffer(e,s,l,u){return new uh(this,e,s,l,u)}clear({color:e,depth:s,stencil:l}){const u=this.gl;let d=0;e&&(d|=u.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(d|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),l!==void 0&&(d|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),u.clear(d)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){g.aE(e.blendFunction,Ui.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return qr(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var s;return qr(this.gl)?this.gl.deleteVertexArray(e):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class $t{constructor(e,s,l){this.func=e,this.mask=s,this.range=l}}$t.ReadOnly=!1,$t.ReadWrite=!0,$t.disabled=new $t(519,$t.ReadOnly,[0,1]);const Tu=7680;class Si{constructor(e,s,l,u,d,v){this.test=e,this.ref=s,this.mask=l,this.fail=u,this.depthFail=d,this.pass=v}}Si.disabled=new Si({func:519,mask:0},0,0,Tu,Tu,Tu);class oi{constructor(e,s,l){this.enable=e,this.mode=s,this.frontFace=l}}let Gn;function Ga(p,e,s,l,u){const d=p.context,v=d.gl,w=p.useProgram("collisionBox"),S=[];let I=0,P=0;for(let Y=0;Y<l.length;Y++){const ie=l[Y],H=e.getTile(ie).getBucket(s);if(!H)continue;const oe=u?H.textCollisionBox:H.iconCollisionBox,ce=H.collisionCircleArray;if(ce.length>0){const _e=g.H();g.aQ(_e,H.placementInvProjMatrix,p.transform.glCoordMatrix),g.aQ(_e,_e,H.placementViewportMatrix),S.push({circleArray:ce,circleOffset:P,transform:ie.posMatrix,invTransform:_e,coord:ie}),I+=ce.length/4,P=I}oe&&w.draw(d,v.LINES,$t.disabled,Si.disabled,p.colorModeForRenderPass(),oi.disabled,{u_matrix:ie.posMatrix,u_pixel_extrude_scale:[1/(M=p.transform).width,1/M.height]},p.style.map.terrain&&p.style.map.terrain.getTerrainData(ie),s.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,null,p.transform.zoom,null,null,oe.collisionVertexBuffer)}var M;if(!u||!S.length)return;const B=p.useProgram("collisionCircle"),j=new g.aR;j.resize(4*I),j._trim();let q=0;for(const Y of S)for(let ie=0;ie<Y.circleArray.length/4;ie++){const H=4*ie,oe=Y.circleArray[H+0],ce=Y.circleArray[H+1],_e=Y.circleArray[H+2],Ce=Y.circleArray[H+3];j.emplace(q++,oe,ce,_e,Ce,0),j.emplace(q++,oe,ce,_e,Ce,1),j.emplace(q++,oe,ce,_e,Ce,2),j.emplace(q++,oe,ce,_e,Ce,3)}(!Gn||Gn.length<2*I)&&(Gn=function(Y){const ie=2*Y,H=new g.aT;H.resize(ie),H._trim();for(let oe=0;oe<ie;oe++){const ce=6*oe;H.uint16[ce+0]=4*oe+0,H.uint16[ce+1]=4*oe+1,H.uint16[ce+2]=4*oe+2,H.uint16[ce+3]=4*oe+2,H.uint16[ce+4]=4*oe+3,H.uint16[ce+5]=4*oe+0}return H}(I));const G=d.createIndexBuffer(Gn,!0),X=d.createVertexBuffer(j,g.aS.members,!0);for(const Y of S){const ie=tn(Y.transform,Y.invTransform,p.transform);B.draw(d,v.TRIANGLES,$t.disabled,Si.disabled,p.colorModeForRenderPass(),oi.disabled,ie,p.style.map.terrain&&p.style.map.terrain.getTerrainData(Y.coord),s.id,X,G,g.a0.simpleSegment(0,2*Y.circleOffset,Y.circleArray.length,Y.circleArray.length/2),null,p.transform.zoom,null,null,null)}X.destroy(),G.destroy()}oi.disabled=new oi(!1,1029,2305),oi.backCCW=new oi(!0,1029,2305);const Ha=g.an(new Float32Array(16));function no(p,e,s,l,u,d){const{horizontalAlign:v,verticalAlign:w}=g.au(p);return new g.P((-(v-.5)*e/u+l[0])*d,(-(w-.5)*s/u+l[1])*d)}function Ro(p,e,s,l,u,d){const v=e.tileAnchorPoint.add(new g.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let w=l.mult(d);s||(w=w.rotate(-u));const S=v.add(w);return J(S.x,S.y,e.labelPlaneMatrix,e.getElevation).point}if(s){const w=Te(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(p),S=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return p.add(l.rotate(S))}return p.add(l)}function yn(p,e,s,l,u,d,v,w,S,I,P,M,B,j){const q=p.text.placedSymbolArray,G=p.text.dynamicLayoutVertexArray,X=p.icon.dynamicLayoutVertexArray,Y={};G.clear();for(let ie=0;ie<q.length;ie++){const H=q.get(ie),oe=H.hidden||!H.crossTileID||p.allowVerticalPlacement&&!H.placedOrientation?null:l[H.crossTileID];if(oe){const ce=new g.P(H.anchorX,H.anchorY),_e={getElevation:j,width:u.width,height:u.height,labelPlaneMatrix:d,lineVertexArray:null,pitchWithMap:s,projection:P,projectionCache:null,tileAnchorPoint:ce,translation:M,unwrappedTileID:B},Ce=s?J(ce.x,ce.y,v,j):Te(ce.x,ce.y,_e),Le=R(u.cameraToCenterDistance,Ce.signedDistanceFromCamera);let Ve=g.ai(p.textSizeData,S,H)*Le/g.ap;s&&(Ve*=p.tilePixelRatio/w);const{width:We,height:je,anchor:Oe,textOffset:it,textBoxScale:St}=oe,$e=no(Oe,We,je,it,St,Ve),Ge=P.getPitchedTextCorrection(u,ce.add(new g.P(M[0],M[1])),B),bt=Ro(Ce.point,_e,e,$e,u.angle,Ge),wi=p.allowVerticalPlacement&&H.placedOrientation===g.ah.vertical?Math.PI/2:0;for(let Mt=0;Mt<H.numGlyphs;Mt++)g.aj(G,bt,wi);I&&H.associatedIconIndex>=0&&(Y[H.associatedIconIndex]={shiftedAnchor:bt,angle:wi})}else pt(H.numGlyphs,G)}if(I){X.clear();const ie=p.icon.placedSymbolArray;for(let H=0;H<ie.length;H++){const oe=ie.get(H);if(oe.hidden)pt(oe.numGlyphs,X);else{const ce=Y[H];if(ce)for(let _e=0;_e<oe.numGlyphs;_e++)g.aj(X,ce.shiftedAnchor,ce.angle);else pt(oe.numGlyphs,X)}}p.icon.dynamicLayoutVertexBuffer.updateData(X)}p.text.dynamicLayoutVertexBuffer.updateData(G)}function ku(p,e,s){return s.iconsInText&&e?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function so(p,e,s,l,u,d,v,w,S,I,P,M){const B=p.context,j=B.gl,q=p.transform,G=Io(),X=w==="map",Y=S==="map",ie=w!=="viewport"&&s.layout.get("symbol-placement")!=="point",H=X&&!Y&&!ie,oe=!Y&&ie,ce=!s.layout.get("symbol-sort-key").isConstant();let _e=!1;const Ce=p.depthModeForSublayer(0,$t.ReadOnly),Le=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ve=[],We=G.getCircleRadiusCorrection(q);for(const je of l){const Oe=e.getTile(je),it=Oe.getBucket(s);if(!it)continue;const St=u?it.text:it.icon;if(!St||!St.segments.get().length||!St.hasVisibleVertices)continue;const $e=St.programConfigurations.get(s.id),Ge=u||it.sdfIcons,bt=u?it.textSizeData:it.iconSizeData,wi=Y||q.pitch!==0,Mt=p.useProgram(ku(Ge,u,it),$e),Vt=g.ag(bt,q.zoom),Ti=p.style.map.terrain&&p.style.map.terrain.getTerrainData(je);let pr,vn,ki,or,Ai=[0,0],Hi=null;if(u)vn=Oe.glyphAtlasTexture,ki=j.LINEAR,pr=Oe.glyphAtlasTexture.size,it.iconsInText&&(Ai=Oe.imageAtlasTexture.size,Hi=Oe.imageAtlasTexture,or=wi||p.options.rotating||p.options.zooming||bt.kind==="composite"||bt.kind==="camera"?j.LINEAR:j.NEAREST);else{const Ei=s.layout.get("icon-size").constantOr(0)!==1||it.iconsNeedLinear;vn=Oe.imageAtlasTexture,ki=Ge||p.options.rotating||p.options.zooming||Ei||wi?j.LINEAR:j.NEAREST,pr=Oe.imageAtlasTexture.size}const vr=Rt(Oe,1,p.transform.zoom),Jn=oe?je.posMatrix:Ha,on=mn(Jn,Y,X,p.transform,vr),Yn=jr(Jn,Y,X,p.transform,vr),xn=jr(je.posMatrix,Y,X,p.transform,vr),fo=G.translatePosition(p.transform,Oe,d,v),An=Le&&it.hasTextData(),_s=s.layout.get("icon-text-fit")!=="none"&&An&&it.hasIconData();if(ie){const Ei=p.style.map.terrain?(mo,Fs)=>p.style.map.terrain.getElevation(je,mo,Fs):null,Wr=s.layout.get("text-rotation-alignment")==="map";V(it,je.posMatrix,p,u,on,xn,Y,I,Wr,G,je.toUnwrapped(),q.width,q.height,fo,Ei)}const zr=je.posMatrix,Dn=u&&Le||_s,Ar=ie||Dn?Ha:on,Rs=Yn,ar=Ge&&s.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ri;Ri=Ge?it.iconsInText?io(bt.kind,Vt,H,Y,ie,Dn,p,zr,Ar,Rs,fo,pr,Ai,We):Is(bt.kind,Vt,H,Y,ie,Dn,p,zr,Ar,Rs,fo,u,pr,!0,We):ha(bt.kind,Vt,H,Y,ie,Dn,p,zr,Ar,Rs,fo,u,pr,We);const ai={program:Mt,buffers:St,uniformValues:Ri,atlasTexture:vn,atlasTextureIcon:Hi,atlasInterpolation:ki,atlasInterpolationIcon:or,isSDF:Ge,hasHalo:ar};if(ce&&it.canOverlap){_e=!0;const Ei=St.segments.get();for(const Wr of Ei)Ve.push({segments:new g.a0([Wr]),sortKey:Wr.sortKey,state:ai,terrainData:Ti})}else Ve.push({segments:St.segments,sortKey:0,state:ai,terrainData:Ti})}_e&&Ve.sort((je,Oe)=>je.sortKey-Oe.sortKey);for(const je of Ve){const Oe=je.state;if(B.activeTexture.set(j.TEXTURE0),Oe.atlasTexture.bind(Oe.atlasInterpolation,j.CLAMP_TO_EDGE),Oe.atlasTextureIcon&&(B.activeTexture.set(j.TEXTURE1),Oe.atlasTextureIcon&&Oe.atlasTextureIcon.bind(Oe.atlasInterpolationIcon,j.CLAMP_TO_EDGE)),Oe.isSDF){const it=Oe.uniformValues;Oe.hasHalo&&(it.u_is_halo=1,Al(Oe.buffers,je.segments,s,p,Oe.program,Ce,P,M,it,je.terrainData)),it.u_is_halo=0}Al(Oe.buffers,je.segments,s,p,Oe.program,Ce,P,M,Oe.uniformValues,je.terrainData)}}function Al(p,e,s,l,u,d,v,w,S,I){const P=l.context;u.draw(P,P.gl.TRIANGLES,d,v,w,oi.disabled,S,I,s.id,p.layoutVertexBuffer,p.indexBuffer,e,s.paint,l.transform.zoom,p.programConfigurations.get(s.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function Fo(p,e,s,l){const u=p.context,d=u.gl,v=Si.disabled,w=new Ui([d.ONE,d.ONE],g.aM.transparent,[!0,!0,!0,!0]),S=e.getBucket(s);if(!S)return;const I=l.key;let P=s.heatmapFbos.get(I);P||(P=pa(u,e.tileSize,e.tileSize),s.heatmapFbos.set(I,P)),u.bindFramebuffer.set(P.framebuffer),u.viewport.set([0,0,e.tileSize,e.tileSize]),u.clear({color:g.aM.transparent});const M=S.programConfigurations.get(s.id),B=p.useProgram("heatmap",M),j=p.style.map.terrain.getTerrainData(l);B.draw(u,d.TRIANGLES,$t.disabled,v,w,oi.disabled,hr(l.posMatrix,e,p.transform.zoom,s.paint.get("heatmap-intensity")),j,s.id,S.layoutVertexBuffer,S.indexBuffer,S.segments,s.paint,p.transform.zoom,M)}function Dl(p,e,s){const l=p.context,u=l.gl;l.setColorMode(p.colorModeForRenderPass());const d=Bo(l,e),v=s.key,w=e.heatmapFbos.get(v);w&&(l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,w.colorAttachment.get()),l.activeTexture.set(u.TEXTURE1),d.bind(u.LINEAR,u.CLAMP_TO_EDGE),p.useProgram("heatmapTexture").draw(l,u.TRIANGLES,$t.disabled,Si.disabled,p.colorModeForRenderPass(),oi.disabled,to(p,e,0,1),null,e.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments,e.paint,p.transform.zoom),w.destroy(),e.heatmapFbos.delete(v))}function pa(p,e,s){var l,u;const d=p.gl,v=d.createTexture();d.bindTexture(d.TEXTURE_2D,v),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR);const w=(l=p.HALF_FLOAT)!==null&&l!==void 0?l:d.UNSIGNED_BYTE,S=(u=p.RGBA16F)!==null&&u!==void 0?u:d.RGBA;d.texImage2D(d.TEXTURE_2D,0,S,e,s,0,d.RGBA,w,null);const I=p.createFramebuffer(e,s,!1,!1);return I.colorAttachment.set(v),I}function Bo(p,e){return e.colorRampTexture||(e.colorRampTexture=new Kt(p,e.colorRamp,p.gl.RGBA)),e.colorRampTexture}function Ps(p,e,s,l,u){if(!s||!l||!l.imageAtlas)return;const d=l.imageAtlas.patternPositions;let v=d[s.to.toString()],w=d[s.from.toString()];if(!v&&w&&(v=w),!w&&v&&(w=v),!v||!w){const S=u.getPaintProperty(e);v=d[S],w=d[S]}v&&w&&p.setConstantPatternPositions(v,w)}function Oo(p,e,s,l,u,d,v){const w=p.context.gl,S="fill-pattern",I=s.paint.get(S),P=I&&I.constantOr(1),M=s.getCrossfadeParameters();let B,j,q,G,X;v?(j=P&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=w.LINES):(j=P?"fillPattern":"fill",B=w.TRIANGLES);const Y=I.constantOr(null);for(const ie of l){const H=e.getTile(ie);if(P&&!H.patternsLoaded())continue;const oe=H.getBucket(s);if(!oe)continue;const ce=oe.programConfigurations.get(s.id),_e=p.useProgram(j,ce),Ce=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ie);P&&(p.context.activeTexture.set(w.TEXTURE0),H.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),ce.updatePaintBuffers(M)),Ps(ce,S,Y,H,s);const Le=Ce?ie:null,Ve=p.translatePosMatrix(Le?Le.posMatrix:ie.posMatrix,H,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(v){G=oe.indexBuffer2,X=oe.segments2;const We=[w.drawingBufferWidth,w.drawingBufferHeight];q=j==="fillOutlinePattern"&&P?bl(Ve,p,M,H,We):hc(Ve,We)}else G=oe.indexBuffer,X=oe.segments,q=P?pu(Ve,p,M,H):Mo(Ve);_e.draw(p.context,B,u,p.stencilModeForClipping(ie),d,oi.disabled,q,Ce,s.id,oe.layoutVertexBuffer,G,X,s.paint,p.transform.zoom,ce)}}function oo(p,e,s,l,u,d,v){const w=p.context,S=w.gl,I="fill-extrusion-pattern",P=s.paint.get(I),M=P.constantOr(1),B=s.getCrossfadeParameters(),j=s.paint.get("fill-extrusion-opacity"),q=P.constantOr(null);for(const G of l){const X=e.getTile(G),Y=X.getBucket(s);if(!Y)continue;const ie=p.style.map.terrain&&p.style.map.terrain.getTerrainData(G),H=Y.programConfigurations.get(s.id),oe=p.useProgram(M?"fillExtrusionPattern":"fillExtrusion",H);M&&(p.context.activeTexture.set(S.TEXTURE0),X.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),H.updatePaintBuffers(B)),Ps(H,I,q,X,s);const ce=p.translatePosMatrix(G.posMatrix,X,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),_e=s.paint.get("fill-extrusion-vertical-gradient"),Ce=M?ca(ce,p,_e,j,G,B,X):ua(ce,p,_e,j);oe.draw(w,w.gl.TRIANGLES,u,d,v,oi.backCCW,Ce,ie,s.id,Y.layoutVertexBuffer,Y.indexBuffer,Y.segments,s.paint,p.transform.zoom,H,p.style.map.terrain&&Y.centroidVertexBuffer)}}function Ms(p,e,s,l,u,d,v){const w=p.context,S=w.gl,I=s.fbo;if(!I)return;const P=p.useProgram("hillshade"),M=p.style.map.terrain&&p.style.map.terrain.getTerrainData(e);w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,I.colorAttachment.get()),P.draw(w,S.TRIANGLES,u,d,v,oi.disabled,((B,j,q,G)=>{const X=q.paint.get("hillshade-shadow-color"),Y=q.paint.get("hillshade-highlight-color"),ie=q.paint.get("hillshade-accent-color");let H=q.paint.get("hillshade-illumination-direction")*(Math.PI/180);q.paint.get("hillshade-illumination-anchor")==="viewport"&&(H-=B.transform.angle);const oe=!B.options.moving;return{u_matrix:G?G.posMatrix:B.transform.calculatePosMatrix(j.tileID.toUnwrapped(),oe),u_image:0,u_latrange:qn(0,j.tileID),u_light:[q.paint.get("hillshade-exaggeration"),H],u_shadow:X,u_highlight:Y,u_accent:ie}})(p,s,l,M?e:null),M,l.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}function wc(p,e,s,l,u,d){const v=p.context,w=v.gl,S=e.dem;if(S&&S.data){const I=S.dim,P=S.stride,M=S.getPixels();if(v.activeTexture.set(w.TEXTURE1),v.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||p.getTileTexture(P),e.demTexture){const j=e.demTexture;j.update(M,{premultiply:!1}),j.bind(w.NEAREST,w.CLAMP_TO_EDGE)}else e.demTexture=new Kt(v,M,w.RGBA,{premultiply:!1}),e.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);v.activeTexture.set(w.TEXTURE0);let B=e.fbo;if(!B){const j=new Kt(v,{width:I,height:I,data:null},w.RGBA);j.bind(w.LINEAR,w.CLAMP_TO_EDGE),B=e.fbo=v.createFramebuffer(I,I,!0,!1),B.colorAttachment.set(j.texture)}v.bindFramebuffer.set(B.framebuffer),v.viewport.set([0,0,I,I]),p.useProgram("hillshadePrepare").draw(v,w.TRIANGLES,l,u,d,oi.disabled,((j,q)=>{const G=q.stride,X=g.H();return g.aP(X,0,g.X,-g.X,0,0,1),g.J(X,X,[0,-g.X,0]),{u_matrix:X,u_image:1,u_dimension:[G,G],u_zoom:j.overscaledZ,u_unpack:q.getUnpackVector()}})(e.tileID,S),null,s.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function Ll(p,e,s,l,u,d){const v=l.paint.get("raster-fade-duration");if(!d&&v>0){const w=we.now(),S=(w-p.timeAdded)/v,I=e?(w-e.timeAdded)/v:-1,P=s.getSource(),M=u.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),B=!e||Math.abs(e.tileID.overscaledZ-M)>Math.abs(p.tileID.overscaledZ-M),j=B&&p.refreshedUponExpiration?1:g.ac(B?S:1-I,0,1);return p.refreshedUponExpiration&&S>=1&&(p.refreshedUponExpiration=!1),e?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}const Qt=new g.aM(1,0,0,1),fa=new g.aM(0,1,0,1),bc=new g.aM(0,0,1,1),Iu=new g.aM(1,0,1,1),ma=new g.aM(0,1,1,1);function Sc(p,e,s,l){Wa(p,0,e+s/2,p.transform.width,s,l)}function Tc(p,e,s,l){Wa(p,e-s/2,0,s,p.transform.height,l)}function Wa(p,e,s,l,u,d){const v=p.context,w=v.gl;w.enable(w.SCISSOR_TEST),w.scissor(e*p.pixelRatio,s*p.pixelRatio,l*p.pixelRatio,u*p.pixelRatio),v.clear({color:d}),w.disable(w.SCISSOR_TEST)}function hh(p,e,s){const l=p.context,u=l.gl,d=s.posMatrix,v=p.useProgram("debug"),w=$t.disabled,S=Si.disabled,I=p.colorModeForRenderPass(),P="$debug",M=p.style.map.terrain&&p.style.map.terrain.getTerrainData(s);l.activeTexture.set(u.TEXTURE0);const B=e.getTileByID(s.key).latestRawTileData,j=Math.floor((B&&B.byteLength||0)/1024),q=e.getTile(s).tileSize,G=512/Math.min(q,512)*(s.overscaledZ/p.transform.zoom)*.5;let X=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(X+=` => ${s.overscaledZ}`),function(Y,ie){Y.initDebugOverlayCanvas();const H=Y.debugOverlayCanvas,oe=Y.context.gl,ce=Y.debugOverlayCanvas.getContext("2d");ce.clearRect(0,0,H.width,H.height),ce.shadowColor="white",ce.shadowBlur=2,ce.lineWidth=1.5,ce.strokeStyle="white",ce.textBaseline="top",ce.font="bold 36px Open Sans, sans-serif",ce.fillText(ie,5,5),ce.strokeText(ie,5,5),Y.debugOverlayTexture.update(H),Y.debugOverlayTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE)}(p,`${X} ${j}kB`),v.draw(l,u.TRIANGLES,w,S,Ui.alphaBlended,oi.disabled,En(d,g.aM.transparent,G),null,P,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments),v.draw(l,u.LINE_STRIP,w,S,I,oi.disabled,En(d,g.aM.red),M,P,p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments)}function Rl(p,e,s){const l=p.context,u=l.gl,d=p.colorModeForRenderPass(),v=new $t(u.LEQUAL,$t.ReadWrite,p.depthRangeFor3D),w=p.useProgram("terrain"),S=e.getTerrainMesh();l.bindFramebuffer.set(null),l.viewport.set([0,0,p.width,p.height]);for(const I of s){const P=p.renderToTexture.getTexture(I),M=e.getTerrainData(I.tileID);l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,P.texture);const B=p.transform.calculatePosMatrix(I.tileID.toUnwrapped()),j=e.getMeshFrameDelta(p.transform.zoom),q=p.transform.calculateFogMatrix(I.tileID.toUnwrapped()),G=du(B,j,q,p.style.sky,p.transform.pitch);w.draw(l,u.TRIANGLES,v,Si.disabled,d,oi.backCCW,G,M,"terrain",S.vertexBuffer,S.indexBuffer,S.segments)}}class Zr{constructor(e,s,l){this.vertexBuffer=e,this.indexBuffer=s,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class ao{constructor(e,s){this.context=new ch(e),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:g.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=wt.maxUnderzooming+wt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Co}resize(e,s,l){if(this.width=Math.floor(e*l),this.height=Math.floor(s*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const e=this.context,s=new g.aX;s.emplaceBack(0,0),s.emplaceBack(g.X,0),s.emplaceBack(0,g.X),s.emplaceBack(g.X,g.X),this.tileExtentBuffer=e.createVertexBuffer(s,Ts.members),this.tileExtentSegments=g.a0.simpleSegment(0,0,4,2);const l=new g.aX;l.emplaceBack(0,0),l.emplaceBack(g.X,0),l.emplaceBack(0,g.X),l.emplaceBack(g.X,g.X),this.debugBuffer=e.createVertexBuffer(l,Ts.members),this.debugSegments=g.a0.simpleSegment(0,0,4,5);const u=new g.$;u.emplaceBack(0,0,0,0),u.emplaceBack(g.X,0,g.X,0),u.emplaceBack(0,g.X,0,g.X),u.emplaceBack(g.X,g.X,g.X,g.X),this.rasterBoundsBuffer=e.createVertexBuffer(u,us.members),this.rasterBoundsSegments=g.a0.simpleSegment(0,0,4,2);const d=new g.aX;d.emplaceBack(0,0),d.emplaceBack(1,0),d.emplaceBack(0,1),d.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(d,Ts.members),this.viewportSegments=g.a0.simpleSegment(0,0,4,2);const v=new g.aZ;v.emplaceBack(0),v.emplaceBack(1),v.emplaceBack(3),v.emplaceBack(2),v.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(v);const w=new g.aY;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(w);const S=this.context.gl;this.stencilClearMode=new Si({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO)}clearStencil(){const e=this.context,s=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=g.H();g.aP(l,0,this.width,this.height,0,0,1),g.K(l,l,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,s.TRIANGLES,$t.disabled,this.stencilClearMode,Ui.disabled,oi.disabled,Gi(l),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,s){if(this.currentStencilSource===e.source||!e.isTileClipped()||!s||!s.length)return;this.currentStencilSource=e.source;const l=this.context,u=l.gl;this.nextStencilID+s.length>256&&this.clearStencil(),l.setColorMode(Ui.disabled),l.setDepthMode($t.disabled);const d=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const v of s){const w=this._tileClippingMaskIDs[v.key]=this.nextStencilID++,S=this.style.map.terrain&&this.style.map.terrain.getTerrainData(v);d.draw(l,u.TRIANGLES,$t.disabled,new Si({func:u.ALWAYS,mask:0},w,255,u.KEEP,u.KEEP,u.REPLACE),Ui.disabled,oi.disabled,Gi(v.posMatrix),S,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,s=this.context.gl;return new Si({func:s.NOTEQUAL,mask:255},e,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(e){const s=this.context.gl;return new Si({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(e){const s=this.context.gl,l=e.sort((v,w)=>w.overscaledZ-v.overscaledZ),u=l[l.length-1].overscaledZ,d=l[0].overscaledZ-u+1;if(d>1){this.currentStencilSource=void 0,this.nextStencilID+d>256&&this.clearStencil();const v={};for(let w=0;w<d;w++)v[w+u]=new Si({func:s.GEQUAL,mask:255},w+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=d,[v,l]}return[{[u]:Si.disabled},l]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new Ui([e.CONSTANT_COLOR,e.ONE],new g.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ui.unblended:Ui.alphaBlended}depthModeForSublayer(e,s,l){if(!this.opaquePassEnabledForLayer())return $t.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new $t(l||this.context.gl.LEQUAL,s,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,s){this.style=e,this.options=s,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(we.now()),this.imageManager.beginFrame();const l=this.style._order,u=this.style.sourceCaches,d={},v={},w={};for(const S in u){const I=u[S];I.used&&I.prepare(this.context),d[S]=I.getVisibleCoordinates(),v[S]=d[S].slice().reverse(),w[S]=I.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let S=0;S<l.length;S++)if(this.style._layers[l[S]].is3D()){this.opaquePassCutoff=S;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const S of l){const I=this.style._layers[S];if(!I.hasOffscreenPass()||I.isHidden(this.transform.zoom))continue;const P=v[I.source];(I.type==="custom"||P.length)&&this.renderLayer(this,u[I.source],I,P)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?g.aM.black:g.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(S,I){const P=S.context,M=P.gl,B=((Y,ie,H)=>({u_sky_color:Y.properties.get("sky-color"),u_horizon_color:Y.properties.get("horizon-color"),u_horizon:(ie.height/2+ie.getHorizon())*H,u_sky_horizon_blend:Y.properties.get("sky-horizon-blend")*ie.height/2*H}))(I,S.style.map.transform,S.pixelRatio),j=new $t(M.LEQUAL,$t.ReadWrite,[0,1]),q=Si.disabled,G=S.colorModeForRenderPass(),X=S.useProgram("sky");if(!I.mesh){const Y=new g.aX;Y.emplaceBack(-1,-1),Y.emplaceBack(1,-1),Y.emplaceBack(1,1),Y.emplaceBack(-1,1);const ie=new g.aY;ie.emplaceBack(0,1,2),ie.emplaceBack(0,2,3),I.mesh=new Zr(P.createVertexBuffer(Y,Ts.members),P.createIndexBuffer(ie),g.a0.simpleSegment(0,0,Y.length,ie.length))}X.draw(P,M.TRIANGLES,j,q,G,oi.disabled,B,void 0,"sky",I.mesh.vertexBuffer,I.mesh.indexBuffer,I.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const S=this.style._layers[l[this.currentLayer]],I=u[S.source],P=d[S.source];this._renderTileClippingMasks(S,P),this.renderLayer(this,I,S,P)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const S=this.style._layers[l[this.currentLayer]],I=u[S.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(S))continue;const P=(S.type==="symbol"?w:v)[S.source];this._renderTileClippingMasks(S,d[S.source]),this.renderLayer(this,I,S,P)}if(this.options.showTileBoundaries){const S=function(I,P){let M=null;const B=Object.values(I._layers).flatMap(X=>X.source&&!X.isHidden(P)?[I.sourceCaches[X.source]]:[]),j=B.filter(X=>X.getSource().type==="vector"),q=B.filter(X=>X.getSource().type!=="vector"),G=X=>{(!M||M.getSource().maxzoom<X.getSource().maxzoom)&&(M=X)};return j.forEach(X=>G(X)),M||q.forEach(X=>G(X)),M}(this.style,this.transform.zoom);S&&function(I,P,M){for(let B=0;B<M.length;B++)hh(I,P,M[B])}(this,S,S.getVisibleCoordinates())}this.options.showPadding&&function(S){const I=S.transform.padding;Sc(S,S.transform.height-(I.top||0),3,Qt),Sc(S,I.bottom||0,3,fa),Tc(S,I.left||0,3,bc),Tc(S,S.transform.width-(I.right||0),3,Iu);const P=S.transform.centerPoint;(function(M,B,j,q){Wa(M,B-1,j-10,2,20,q),Wa(M,B-10,j-1,20,2,q)})(S,P.x,S.transform.height-P.y,ma)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let u=this.terrainFacilitator.dirty;u||(u=e?!g.a_(s,l):!g.a$(s,l)),u||(u=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),u&&(g.b0(s,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(d,v){const w=d.context,S=w.gl,I=Ui.unblended,P=new $t(S.LEQUAL,$t.ReadWrite,[0,1]),M=v.getTerrainMesh(),B=v.sourceCache.getRenderableTiles(),j=d.useProgram("terrainDepth");w.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,d.width/devicePixelRatio,d.height/devicePixelRatio]),w.clear({color:g.aM.transparent,depth:1});for(const q of B){const G=v.getTerrainData(q.tileID),X={u_matrix:d.transform.calculatePosMatrix(q.tileID.toUnwrapped()),u_ele_delta:v.getMeshFrameDelta(d.transform.zoom)};j.draw(w,S.TRIANGLES,P,Si.disabled,I,oi.backCCW,X,G,"terrain",M.vertexBuffer,M.indexBuffer,M.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,d.width,d.height])}(this,this.style.map.terrain),function(d,v){const w=d.context,S=w.gl,I=Ui.unblended,P=new $t(S.LEQUAL,$t.ReadWrite,[0,1]),M=v.getTerrainMesh(),B=v.getCoordsTexture(),j=v.sourceCache.getRenderableTiles(),q=d.useProgram("terrainCoords");w.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,d.width/devicePixelRatio,d.height/devicePixelRatio]),w.clear({color:g.aM.transparent,depth:1}),v.coordsIndex=[];for(const G of j){const X=v.getTerrainData(G.tileID);w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,B.texture);const Y={u_matrix:d.transform.calculatePosMatrix(G.tileID.toUnwrapped()),u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(d.transform.zoom)};q.draw(w,S.TRIANGLES,P,Si.disabled,I,oi.backCCW,Y,X,"terrain",M.vertexBuffer,M.indexBuffer,M.segments),v.coordsIndex.push(G.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,d.width,d.height])}(this,this.style.map.terrain))}renderLayer(e,s,l,u){if(!l.isHidden(this.transform.zoom)&&(l.type==="background"||l.type==="custom"||(u||[]).length))switch(this.id=l.id,l.type){case"symbol":(function(d,v,w,S,I){if(d.renderPass!=="translucent")return;const P=Si.disabled,M=d.colorModeForRenderPass();(w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(B,j,q,G,X,Y,ie,H,oe){const ce=j.transform,_e=Io(),Ce=X==="map",Le=Y==="map";for(const Ve of B){const We=G.getTile(Ve),je=We.getBucket(q);if(!je||!je.text||!je.text.segments.get().length)continue;const Oe=g.ag(je.textSizeData,ce.zoom),it=Rt(We,1,j.transform.zoom),St=mn(Ve.posMatrix,Le,Ce,j.transform,it),$e=q.layout.get("icon-text-fit")!=="none"&&je.hasIconData();if(Oe){const Ge=Math.pow(2,ce.zoom-We.tileID.overscaledZ),bt=j.style.map.terrain?(Mt,Vt)=>j.style.map.terrain.getElevation(Ve,Mt,Vt):null,wi=_e.translatePosition(ce,We,ie,H);yn(je,Ce,Le,oe,ce,St,Ve.posMatrix,Ge,Oe,$e,_e,wi,Ve.toUnwrapped(),bt)}}}(S,d,w,v,w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),I),w.paint.get("icon-opacity").constantOr(1)!==0&&so(d,v,w,S,!1,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),w.layout.get("icon-rotation-alignment"),w.layout.get("icon-pitch-alignment"),w.layout.get("icon-keep-upright"),P,M),w.paint.get("text-opacity").constantOr(1)!==0&&so(d,v,w,S,!0,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.layout.get("text-keep-upright"),P,M),v.map.showCollisionBoxes&&(Ga(d,v,w,S,!0),Ga(d,v,w,S,!1))})(e,s,l,u,this.style.placement.variableOffsets);break;case"circle":(function(d,v,w,S){if(d.renderPass!=="translucent")return;const I=w.paint.get("circle-opacity"),P=w.paint.get("circle-stroke-width"),M=w.paint.get("circle-stroke-opacity"),B=!w.layout.get("circle-sort-key").isConstant();if(I.constantOr(1)===0&&(P.constantOr(1)===0||M.constantOr(1)===0))return;const j=d.context,q=j.gl,G=d.depthModeForSublayer(0,$t.ReadOnly),X=Si.disabled,Y=d.colorModeForRenderPass(),ie=[];for(let H=0;H<S.length;H++){const oe=S[H],ce=v.getTile(oe),_e=ce.getBucket(w);if(!_e)continue;const Ce=_e.programConfigurations.get(w.id),Le=d.useProgram("circle",Ce),Ve=_e.layoutVertexBuffer,We=_e.indexBuffer,je=d.style.map.terrain&&d.style.map.terrain.getTerrainData(oe),Oe={programConfiguration:Ce,program:Le,layoutVertexBuffer:Ve,indexBuffer:We,uniformValues:Sl(d,oe,ce,w),terrainData:je};if(B){const it=_e.segments.get();for(const St of it)ie.push({segments:new g.a0([St]),sortKey:St.sortKey,state:Oe})}else ie.push({segments:_e.segments,sortKey:0,state:Oe})}B&&ie.sort((H,oe)=>H.sortKey-oe.sortKey);for(const H of ie){const{programConfiguration:oe,program:ce,layoutVertexBuffer:_e,indexBuffer:Ce,uniformValues:Le,terrainData:Ve}=H.state;ce.draw(j,q.TRIANGLES,G,X,Y,oi.disabled,Le,Ve,w.id,_e,Ce,H.segments,w.paint,d.transform.zoom,oe)}})(e,s,l,u);break;case"heatmap":(function(d,v,w,S){if(w.paint.get("heatmap-opacity")===0)return;const I=d.context;if(d.style.map.terrain){for(const P of S){const M=v.getTile(P);v.hasRenderableParent(P)||(d.renderPass==="offscreen"?Fo(d,M,w,P):d.renderPass==="translucent"&&Dl(d,w,P))}I.viewport.set([0,0,d.width,d.height])}else d.renderPass==="offscreen"?function(P,M,B,j){const q=P.context,G=q.gl,X=Si.disabled,Y=new Ui([G.ONE,G.ONE],g.aM.transparent,[!0,!0,!0,!0]);(function(ie,H,oe){const ce=ie.gl;ie.activeTexture.set(ce.TEXTURE1),ie.viewport.set([0,0,H.width/4,H.height/4]);let _e=oe.heatmapFbos.get(g.aU);_e?(ce.bindTexture(ce.TEXTURE_2D,_e.colorAttachment.get()),ie.bindFramebuffer.set(_e.framebuffer)):(_e=pa(ie,H.width/4,H.height/4),oe.heatmapFbos.set(g.aU,_e))})(q,P,B),q.clear({color:g.aM.transparent});for(let ie=0;ie<j.length;ie++){const H=j[ie];if(M.hasRenderableParent(H))continue;const oe=M.getTile(H),ce=oe.getBucket(B);if(!ce)continue;const _e=ce.programConfigurations.get(B.id),Ce=P.useProgram("heatmap",_e),{zoom:Le}=P.transform;Ce.draw(q,G.TRIANGLES,$t.disabled,X,Y,oi.disabled,hr(H.posMatrix,oe,Le,B.paint.get("heatmap-intensity")),null,B.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,B.paint,P.transform.zoom,_e)}q.viewport.set([0,0,P.width,P.height])}(d,v,w,S):d.renderPass==="translucent"&&function(P,M){const B=P.context,j=B.gl;B.setColorMode(P.colorModeForRenderPass());const q=M.heatmapFbos.get(g.aU);q&&(B.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,q.colorAttachment.get()),B.activeTexture.set(j.TEXTURE1),Bo(B,M).bind(j.LINEAR,j.CLAMP_TO_EDGE),P.useProgram("heatmapTexture").draw(B,j.TRIANGLES,$t.disabled,Si.disabled,P.colorModeForRenderPass(),oi.disabled,to(P,M,0,1),null,M.id,P.viewportBuffer,P.quadTriangleIndexBuffer,P.viewportSegments,M.paint,P.transform.zoom))}(d,w)})(e,s,l,u);break;case"line":(function(d,v,w,S){if(d.renderPass!=="translucent")return;const I=w.paint.get("line-opacity"),P=w.paint.get("line-width");if(I.constantOr(1)===0||P.constantOr(1)===0)return;const M=d.depthModeForSublayer(0,$t.ReadOnly),B=d.colorModeForRenderPass(),j=w.paint.get("line-dasharray"),q=w.paint.get("line-pattern"),G=q.constantOr(1),X=w.paint.get("line-gradient"),Y=w.getCrossfadeParameters(),ie=G?"linePattern":j?"lineSDF":X?"lineGradient":"line",H=d.context,oe=H.gl;let ce=!0;for(const _e of S){const Ce=v.getTile(_e);if(G&&!Ce.patternsLoaded())continue;const Le=Ce.getBucket(w);if(!Le)continue;const Ve=Le.programConfigurations.get(w.id),We=d.context.program.get(),je=d.useProgram(ie,Ve),Oe=ce||je.program!==We,it=d.style.map.terrain&&d.style.map.terrain.getTerrainData(_e),St=q.constantOr(null);if(St&&Ce.imageAtlas){const bt=Ce.imageAtlas,wi=bt.patternPositions[St.to.toString()],Mt=bt.patternPositions[St.from.toString()];wi&&Mt&&Ve.setConstantPatternPositions(wi,Mt)}const $e=it?_e:null,Ge=G?hs(d,Ce,w,Y,$e):j?sh(d,Ce,w,j,Y,$e):X?fu(d,Ce,w,Le.lineClipsArray.length,$e):Tl(d,Ce,w,$e);if(G)H.activeTexture.set(oe.TEXTURE0),Ce.imageAtlasTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE),Ve.updatePaintBuffers(Y);else if(j&&(Oe||d.lineAtlas.dirty))H.activeTexture.set(oe.TEXTURE0),d.lineAtlas.bind(H);else if(X){const bt=Le.gradients[w.id];let wi=bt.texture;if(w.gradientVersion!==bt.version){let Mt=256;if(w.stepInterpolant){const Vt=v.getSource().maxzoom,Ti=_e.canonical.z===Vt?Math.ceil(1<<d.transform.maxZoom-_e.canonical.z):1;Mt=g.ac(g.aV(Le.maxLineLength/g.X*1024*Ti),256,H.maxTextureSize)}bt.gradient=g.aW({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:Mt,image:bt.gradient||void 0,clips:Le.lineClipsArray}),bt.texture?bt.texture.update(bt.gradient):bt.texture=new Kt(H,bt.gradient,oe.RGBA),bt.version=w.gradientVersion,wi=bt.texture}H.activeTexture.set(oe.TEXTURE0),wi.bind(w.stepInterpolant?oe.NEAREST:oe.LINEAR,oe.CLAMP_TO_EDGE)}je.draw(H,oe.TRIANGLES,M,d.stencilModeForClipping(_e),B,oi.disabled,Ge,it,w.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,w.paint,d.transform.zoom,Ve,Le.layoutVertexBuffer2),ce=!1}})(e,s,l,u);break;case"fill":(function(d,v,w,S){const I=w.paint.get("fill-color"),P=w.paint.get("fill-opacity");if(P.constantOr(1)===0)return;const M=d.colorModeForRenderPass(),B=w.paint.get("fill-pattern"),j=d.opaquePassEnabledForLayer()&&!B.constantOr(1)&&I.constantOr(g.aM.transparent).a===1&&P.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===j){const q=d.depthModeForSublayer(1,d.renderPass==="opaque"?$t.ReadWrite:$t.ReadOnly);Oo(d,v,w,S,q,M,!1)}if(d.renderPass==="translucent"&&w.paint.get("fill-antialias")){const q=d.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,$t.ReadOnly);Oo(d,v,w,S,q,M,!0)}})(e,s,l,u);break;case"fill-extrusion":(function(d,v,w,S){const I=w.paint.get("fill-extrusion-opacity");if(I!==0&&d.renderPass==="translucent"){const P=new $t(d.context.gl.LEQUAL,$t.ReadWrite,d.depthRangeFor3D);if(I!==1||w.paint.get("fill-extrusion-pattern").constantOr(1))oo(d,v,w,S,P,Si.disabled,Ui.disabled),oo(d,v,w,S,P,d.stencilModeFor3D(),d.colorModeForRenderPass());else{const M=d.colorModeForRenderPass();oo(d,v,w,S,P,Si.disabled,M)}}})(e,s,l,u);break;case"hillshade":(function(d,v,w,S){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;const I=d.context,P=d.depthModeForSublayer(0,$t.ReadOnly),M=d.colorModeForRenderPass(),[B,j]=d.renderPass==="translucent"?d.stencilConfigForOverlap(S):[{},S];for(const q of j){const G=v.getTile(q);G.needsHillshadePrepare!==void 0&&G.needsHillshadePrepare&&d.renderPass==="offscreen"?wc(d,G,w,P,Si.disabled,M):d.renderPass==="translucent"&&Ms(d,q,G,w,P,B[q.overscaledZ],M)}I.viewport.set([0,0,d.width,d.height])})(e,s,l,u);break;case"raster":(function(d,v,w,S){if(d.renderPass!=="translucent"||w.paint.get("raster-opacity")===0||!S.length)return;const I=d.context,P=I.gl,M=v.getSource(),B=d.useProgram("raster"),j=d.colorModeForRenderPass(),[q,G]=M instanceof cs?[{},S]:d.stencilConfigForOverlap(S),X=G[G.length-1].overscaledZ,Y=!d.options.moving;for(const ie of G){const H=d.depthModeForSublayer(ie.overscaledZ-X,w.paint.get("raster-opacity")===1?$t.ReadWrite:$t.ReadOnly,P.LESS),oe=v.getTile(ie);oe.registerFadeDuration(w.paint.get("raster-fade-duration"));const ce=v.findLoadedParent(ie,0),_e=v.findLoadedSibling(ie),Ce=Ll(oe,ce||_e||null,v,w,d.transform,d.style.map.terrain);let Le,Ve;const We=w.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;I.activeTexture.set(P.TEXTURE0),oe.texture.bind(We,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),I.activeTexture.set(P.TEXTURE1),ce?(ce.texture.bind(We,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),Le=Math.pow(2,ce.tileID.overscaledZ-oe.tileID.overscaledZ),Ve=[oe.tileID.canonical.x*Le%1,oe.tileID.canonical.y*Le%1]):oe.texture.bind(We,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),oe.texture.useMipmap&&I.extTextureFilterAnisotropic&&d.transform.pitch>20&&P.texParameterf(P.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax);const je=d.style.map.terrain&&d.style.map.terrain.getTerrainData(ie),Oe=je?ie:null,it=Oe?Oe.posMatrix:d.transform.calculatePosMatrix(ie.toUnwrapped(),Y),St=dc(it,Ve||[0,0],Le||1,Ce,w);M instanceof cs?B.draw(I,P.TRIANGLES,H,Si.disabled,j,oi.disabled,St,je,w.id,M.boundsBuffer,d.quadTriangleIndexBuffer,M.boundsSegments):B.draw(I,P.TRIANGLES,H,q[ie.overscaledZ],j,oi.disabled,St,je,w.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}})(e,s,l,u);break;case"background":(function(d,v,w,S){const I=w.paint.get("background-color"),P=w.paint.get("background-opacity");if(P===0)return;const M=d.context,B=M.gl,j=d.transform,q=j.tileSize,G=w.paint.get("background-pattern");if(d.isPatternMissing(G))return;const X=!G&&I.a===1&&P===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==X)return;const Y=Si.disabled,ie=d.depthModeForSublayer(0,X==="opaque"?$t.ReadWrite:$t.ReadOnly),H=d.colorModeForRenderPass(),oe=d.useProgram(G?"backgroundPattern":"background"),ce=S||j.coveringTiles({tileSize:q,terrain:d.style.map.terrain});G&&(M.activeTexture.set(B.TEXTURE0),d.imageManager.bind(d.context));const _e=w.getCrossfadeParameters();for(const Ce of ce){const Le=S?Ce.posMatrix:d.transform.calculatePosMatrix(Ce.toUnwrapped()),Ve=G?gu(Le,P,d,G,{tileID:Ce,tileSize:q},_e):zo(Le,P,I),We=d.style.map.terrain&&d.style.map.terrain.getTerrainData(Ce);oe.draw(M,B.TRIANGLES,ie,Y,H,oi.disabled,Ve,We,w.id,d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}})(e,0,l,u);break;case"custom":(function(d,v,w){const S=d.context,I=w.implementation;if(d.renderPass==="offscreen"){const P=I.prerender;P&&(d.setCustomLayerDefaults(),S.setColorMode(d.colorModeForRenderPass()),P.call(I,S.gl,d.transform.customLayerMatrix()),S.setDirty(),d.setBaseState())}else if(d.renderPass==="translucent"){d.setCustomLayerDefaults(),S.setColorMode(d.colorModeForRenderPass()),S.setStencilMode(Si.disabled);const P=I.renderingMode==="3d"?new $t(d.context.gl.LEQUAL,$t.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,$t.ReadOnly);S.setDepthMode(P),I.render(S.gl,d.transform.customLayerMatrix(),{farZ:d.transform.farZ,nearZ:d.transform.nearZ,fov:d.transform._fov,modelViewProjectionMatrix:d.transform.modelViewProjectionMatrix,projectionMatrix:d.transform.projectionMatrix}),S.setDirty(),d.setBaseState(),S.bindFramebuffer.set(null)}})(e,0,l)}}translatePosMatrix(e,s,l,u,d){if(!l[0]&&!l[1])return e;const v=d?u==="map"?this.transform.angle:0:u==="viewport"?-this.transform.angle:0;if(v){const I=Math.sin(v),P=Math.cos(v);l=[l[0]*P-l[1]*I,l[0]*I+l[1]*P]}const w=[d?l[0]:Rt(s,l[0],this.transform.zoom),d?l[1]:Rt(s,l[1],this.transform.zoom),0],S=new Float32Array(16);return g.J(S,e,w),S}saveTileTexture(e){const s=this._tileTextures[e.size[0]];s?s.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const s=this._tileTextures[e];return s&&s.length>0?s.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const s=this.imageManager.getPattern(e.from.toString()),l=this.imageManager.getPattern(e.to.toString());return!s||!l}useProgram(e,s){this.cache=this.cache||{};const l=e+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[l]||(this.cache[l]=new pi(this.context,ks[e],s,_u[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Kt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:s}=this.context.gl;return this.width!==e||this.height!==s}}class ga{constructor(e,s){this.points=e,this.planes=s}static fromInvProjectionMatrix(e,s,l){const u=Math.pow(2,l),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const S=1/(w=g.af([],w,e))[3]/s*u;return g.b1(w,w,[S,S,1/w[3],S])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const S=function(B,j){var q=j[0],G=j[1],X=j[2],Y=q*q+G*G+X*X;return Y>0&&(Y=1/Math.sqrt(Y)),B[0]=j[0]*Y,B[1]=j[1]*Y,B[2]=j[2]*Y,B}([],function(B,j,q){var G=j[0],X=j[1],Y=j[2],ie=q[0],H=q[1],oe=q[2];return B[0]=X*oe-Y*H,B[1]=Y*ie-G*oe,B[2]=G*H-X*ie,B}([],Wt([],d[w[0]],d[w[1]]),Wt([],d[w[2]],d[w[1]]))),I=-((P=S)[0]*(M=d[w[1]])[0]+P[1]*M[1]+P[2]*M[2]);var P,M;return S.concat(I)});return new ga(d,v)}}class No{constructor(e,s){this.min=e,this.max=s,this.center=function(l,u,d){return l[0]=.5*u[0],l[1]=.5*u[1],l[2]=.5*u[2],l}([],function(l,u,d){return l[0]=u[0]+d[0],l[1]=u[1]+d[1],l[2]=u[2]+d[2],l}([],this.min,this.max))}quadrant(e){const s=[e%2==0,e<2],l=At(this.min),u=At(this.max);for(let d=0;d<s.length;d++)l[d]=s[d]?this.min[d]:this.center[d],u[d]=s[d]?this.center[d]:this.max[d];return u[2]=this.max[2],new No(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let l=!0;for(let u=0;u<e.planes.length;u++){const d=e.planes[u];let v=0;for(let w=0;w<s.length;w++)g.b2(d,s[w])>=0&&v++;if(v===0)return 0;v!==s.length&&(l=!1)}if(l)return 2;for(let u=0;u<3;u++){let d=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let w=0;w<e.points.length;w++){const S=e.points[w][u]-this.min[u];d=Math.min(d,S),v=Math.max(v,S)}if(v<0||d>this.max[u]-this.min[u])return 0}return 1}}class _a{constructor(e=0,s=0,l=0,u=0){if(isNaN(e)||e<0||isNaN(s)||s<0||isNaN(l)||l<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=s,this.left=l,this.right=u}interpolate(e,s,l){return s.top!=null&&e.top!=null&&(this.top=g.y.number(e.top,s.top,l)),s.bottom!=null&&e.bottom!=null&&(this.bottom=g.y.number(e.bottom,s.bottom,l)),s.left!=null&&e.left!=null&&(this.left=g.y.number(e.left,s.left,l)),s.right!=null&&e.right!=null&&(this.right=g.y.number(e.right,s.right,l)),this}getCenter(e,s){const l=g.ac((this.left+e-this.right)/2,0,e),u=g.ac((this.top+s-this.bottom)/2,0,s);return new g.P(l,u)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new _a(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ya=85.051129;class lo{constructor(e,s,l,u,d){this.tileSize=512,this._renderWorldCopies=d===void 0||!!d,this._minZoom=e||0,this._maxZoom=s||22,this._minPitch=l??0,this._maxPitch=u??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new g.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new _a,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new lo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new g.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const s=-g.b3(e,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=function(){var l=new g.A(4);return g.A!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l}(),function(l,u,d){var v=u[0],w=u[1],S=u[2],I=u[3],P=Math.sin(d),M=Math.cos(d);l[0]=v*M+S*P,l[1]=w*M+I*P,l[2]=v*-P+S*M,l[3]=w*-P+I*M}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const s=g.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const s=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,s,l){this._unmodified=!1,this._edgeInsets.interpolate(e,s,l),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const s=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(e){const s=[new g.b4(0,e)];if(this._renderWorldCopies){const l=this.pointCoordinate(new g.P(0,0)),u=this.pointCoordinate(new g.P(this.width,0)),d=this.pointCoordinate(new g.P(this.width,this.height)),v=this.pointCoordinate(new g.P(0,this.height)),w=Math.floor(Math.min(l.x,u.x,d.x,v.x)),S=Math.floor(Math.max(l.x,u.x,d.x,v.x)),I=1;for(let P=w-I;P<=S+I;P++)P!==0&&s.push(new g.b4(P,e))}return s}coveringTiles(e){var s,l;let u=this.coveringZoomLevel(e);const d=u;if(e.minzoom!==void 0&&u<e.minzoom)return[];e.maxzoom!==void 0&&u>e.maxzoom&&(u=e.maxzoom);const v=this.pointCoordinate(this.getCameraPoint()),w=g.Z.fromLngLat(this.center),S=Math.pow(2,u),I=[S*v.x,S*v.y,0],P=[S*w.x,S*w.y,0],M=ga.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,u);let B=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(B=u);const j=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,q=H=>({aabb:new No([H*S,0,0],[(H+1)*S,S,0]),zoom:0,x:0,y:0,wrap:H,fullyVisible:!1}),G=[],X=[],Y=u,ie=e.reparseOverscaled?d:u;if(this._renderWorldCopies)for(let H=1;H<=3;H++)G.push(q(-H)),G.push(q(H));for(G.push(q(0));G.length>0;){const H=G.pop(),oe=H.x,ce=H.y;let _e=H.fullyVisible;if(!_e){const je=H.aabb.intersects(M);if(je===0)continue;_e=je===2}const Ce=e.terrain?I:P,Le=H.aabb.distanceX(Ce),Ve=H.aabb.distanceY(Ce),We=Math.max(Math.abs(Le),Math.abs(Ve));if(H.zoom===Y||We>j+(1<<Y-H.zoom)-2&&H.zoom>=B){const je=Y-H.zoom,Oe=I[0]-.5-(oe<<je),it=I[1]-.5-(ce<<je);X.push({tileID:new g.S(H.zoom===Y?ie:H.zoom,H.wrap,H.zoom,oe,ce),distanceSq:yi([P[0]-.5-oe,P[1]-.5-ce]),tileDistanceToCamera:Math.sqrt(Oe*Oe+it*it)})}else for(let je=0;je<4;je++){const Oe=(oe<<1)+je%2,it=(ce<<1)+(je>>1),St=H.zoom+1;let $e=H.aabb.quadrant(je);if(e.terrain){const Ge=new g.S(St,H.wrap,St,Oe,it),bt=e.terrain.getMinMaxElevation(Ge),wi=(s=bt.minElevation)!==null&&s!==void 0?s:this.elevation,Mt=(l=bt.maxElevation)!==null&&l!==void 0?l:this.elevation;$e=new No([$e.min[0],$e.min[1],wi],[$e.max[0],$e.max[1],Mt])}G.push({aabb:$e,zoom:St,x:Oe,y:it,wrap:H.wrap,fullyVisible:_e})}}return X.sort((H,oe)=>H.distanceSq-oe.distanceSq).map(H=>H.tileID)}resize(e,s){this.width=e,this.height=s,this.pixelsToGLUnits=[2/e,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const s=g.ac(e.lat,-85.051129,ya);return new g.P(g.O(e.lng)*this.worldSize,g.Q(s)*this.worldSize)}unproject(e){return new g.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const s=this.elevation,l=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,u=this.pointLocation(this.centerPoint,e),d=e.getElevationForLngLatZoom(u,this.tileZoom);if(!(this.elevation-d))return;const v=l+s-d,w=Math.cos(this._pitch)*this.cameraToCenterDistance/v/g.b5(1,u.lat),S=this.scaleZoom(w/this.tileSize);this._elevation=d,this._center=u,this.zoom=S}setLocationAtPoint(e,s){const l=this.pointCoordinate(s),u=this.pointCoordinate(this.centerPoint),d=this.locationCoordinate(e),v=new g.Z(d.x-(l.x-u.x),d.y-(l.y-u.y));this.center=this.coordinateLocation(v),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,s){return s?this.coordinatePoint(this.locationCoordinate(e),s.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,s){return this.coordinateLocation(this.pointCoordinate(e,s))}locationCoordinate(e){return g.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,s){if(s){const B=s.pointCoordinate(e);if(B!=null)return B}const l=[e.x,e.y,0,1],u=[e.x,e.y,1,1];g.af(l,l,this.pixelMatrixInverse),g.af(u,u,this.pixelMatrixInverse);const d=l[3],v=u[3],w=l[1]/d,S=u[1]/v,I=l[2]/d,P=u[2]/v,M=I===P?0:(0-I)/(P-I);return new g.Z(g.y.number(l[0]/d,u[0]/v,M)/this.worldSize,g.y.number(w,S,M)/this.worldSize)}coordinatePoint(e,s=0,l=this.pixelMatrix){const u=[e.x*this.worldSize,e.y*this.worldSize,s,1];return g.af(u,u,l),new g.P(u[0]/u[3],u[1]/u[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new be().extend(this.pointLocation(new g.P(0,e))).extend(this.pointLocation(new g.P(this.width,e))).extend(this.pointLocation(new g.P(this.width,this.height))).extend(this.pointLocation(new g.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new be([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,ya])}calculateTileMatrix(e){const s=e.canonical,l=this.worldSize/this.zoomScale(s.z),u=s.x+Math.pow(2,s.z)*e.wrap,d=g.an(new Float64Array(16));return g.J(d,d,[u*l,s.y*l,0]),g.K(d,d,[l/g.X,l/g.X,1]),d}calculatePosMatrix(e,s=!1){const l=e.key,u=s?this._alignedPosMatrixCache:this._posMatrixCache;if(u[l])return u[l];const d=this.calculateTileMatrix(e);return g.L(d,s?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,d),u[l]=new Float32Array(d),u[l]}calculateFogMatrix(e){const s=e.key,l=this._fogMatrixCache;if(l[s])return l[s];const u=this.calculateTileMatrix(e);return g.L(u,this.fogMatrix,u),l[s]=new Float32Array(u),l[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,s){s=g.ac(+s,this.minZoom,this.maxZoom);const l={center:new g.N(e.lng,e.lat),zoom:s};let u=this.lngRange;if(!this._renderWorldCopies&&u===null){const H=179.9999999999;u=[-H,H]}const d=this.tileSize*this.zoomScale(l.zoom);let v=0,w=d,S=0,I=d,P=0,M=0;const{x:B,y:j}=this.size;if(this.latRange){const H=this.latRange;v=g.Q(H[1])*d,w=g.Q(H[0])*d,w-v<j&&(P=j/(w-v))}u&&(S=g.b3(g.O(u[0])*d,0,d),I=g.b3(g.O(u[1])*d,0,d),I<S&&(I+=d),I-S<B&&(M=B/(I-S)));const{x:q,y:G}=this.project.call({worldSize:d},e);let X,Y;const ie=Math.max(M||0,P||0);if(ie){const H=new g.P(M?(I+S)/2:q,P?(w+v)/2:G);return l.center=this.unproject.call({worldSize:d},H).wrap(),l.zoom+=this.scaleZoom(ie),l}if(this.latRange){const H=j/2;G-H<v&&(Y=v+H),G+H>w&&(Y=w-H)}if(u){const H=(S+I)/2;let oe=q;this._renderWorldCopies&&(oe=g.b3(q,H-d/2,H+d/2));const ce=B/2;oe-ce<S&&(X=S+ce),oe+ce>I&&(X=I-ce)}if(X!==void 0||Y!==void 0){const H=new g.P(X??q,Y??G);l.center=this.unproject.call({worldSize:d},H).wrap()}return l}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:s,zoom:l}=this.getConstrained(this.center,this.zoom);this.center=s,this.zoom=l,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,s=this.point.x,l=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=g.b5(1,this.center.lat)*this.worldSize;let u=g.an(new Float64Array(16));g.K(u,u,[this.width/2,-this.height/2,1]),g.J(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=g.an(new Float64Array(16)),g.K(u,u,[1,-1,1]),g.J(u,u,[-1,-1,0]),g.K(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u;const d=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),v=Math.min(this.elevation,this.minElevationForCurrentTile),w=d-v*this._pixelPerMeter/Math.cos(this._pitch),S=v<0?w:d,I=Math.PI/2+this._pitch,P=this._fov*(.5+e.y/this.height),M=Math.sin(P)*S/Math.sin(g.ac(Math.PI-I-P,.01,Math.PI-.01)),B=this.getHorizon(),j=2*Math.atan(B/this.cameraToCenterDistance)*(.5+e.y/(2*B)),q=Math.sin(j)*S/Math.sin(g.ac(Math.PI-I-j,.01,Math.PI-.01)),G=Math.min(M,q);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*G+S),this.nearZ=this.height/50,u=new Float64Array(16),g.b6(u,this._fov,this.width/this.height,this.nearZ,this.farZ),u[8]=2*-e.x/this.width,u[9]=2*e.y/this.height,this.projectionMatrix=g.ae(u),g.K(u,u,[1,-1,1]),g.J(u,u,[0,0,-this.cameraToCenterDistance]),g.b7(u,u,this._pitch),g.ad(u,u,this.angle),g.J(u,u,[-s,-l,0]),this.mercatorMatrix=g.K([],u,[this.worldSize,this.worldSize,this.worldSize]),g.K(u,u,[1,1,this._pixelPerMeter]),this.pixelMatrix=g.L(new Float64Array(16),this.labelPlaneMatrix,u),g.J(u,u,[0,0,-this.elevation]),this.modelViewProjectionMatrix=u,this.invModelViewProjectionMatrix=g.as([],u),this.fogMatrix=new Float64Array(16),g.b6(this.fogMatrix,this._fov,this.width/this.height,d,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,g.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),g.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),g.b7(this.fogMatrix,this.fogMatrix,this._pitch),g.ad(this.fogMatrix,this.fogMatrix,this.angle),g.J(this.fogMatrix,this.fogMatrix,[-s,-l,0]),g.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),g.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=g.L(new Float64Array(16),this.labelPlaneMatrix,u);const X=this.width%2/2,Y=this.height%2/2,ie=Math.cos(this.angle),H=Math.sin(this.angle),oe=s-Math.round(s)+ie*X+H*Y,ce=l-Math.round(l)+ie*Y+H*X,_e=new Float64Array(u);if(g.J(_e,_e,[oe>.5?oe-1:oe,ce>.5?ce-1:ce,0]),this.alignedModelViewProjectionMatrix=_e,u=g.as(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new g.P(0,0)),s=[e.x*this.worldSize,e.y*this.worldSize,0,1];return g.af(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new g.P(0,e))}getCameraQueryGeometry(e){const s=this.getCameraPoint();if(e.length===1)return[e[0],s];{let l=s.x,u=s.y,d=s.x,v=s.y;for(const w of e)l=Math.min(l,w.x),u=Math.min(u,w.y),d=Math.max(d,w.x),v=Math.max(v,w.y);return[new g.P(l,u),new g.P(d,u),new g.P(d,v),new g.P(l,v),new g.P(l,u)]}}lngLatToCameraDepth(e,s){const l=this.locationCoordinate(e),u=[l.x*this.worldSize,l.y*this.worldSize,s,1];return g.af(u,u,this.modelViewProjectionMatrix),u[2]/u[3]}}function Fl(p,e){let s,l=!1,u=null,d=null;const v=()=>{u=null,l&&(p.apply(d,s),u=setTimeout(v,e),l=!1)};return(...w)=>(l=!0,d=this,s=w,u||v(),u)}class kc{constructor(e){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let l;return s.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(l=u)}),(l&&l[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(s.length>=3&&!s.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:l,pitch:+(s[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,s)},this._removeHash=()=>{const s=this._getCurrentHash();if(s.length===0)return;const l=s.join("/");let u=l;u.split("&").length>0&&(u=u.split("&")[0]),this._hashName&&(u=`${this._hashName}=${l}`);let d=window.location.hash.replace(u,"");d.startsWith("#&")?d=d.slice(0,1)+d.slice(2):d==="#"&&(d="");let v=window.location.href.replace(/(#.+)?$/,d);v=v.replace("&&","&"),window.history.replaceState(window.history.state,null,v)},this._updateHash=Fl(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const s=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,u=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),d=Math.pow(10,u),v=Math.round(s.lng*d)/d,w=Math.round(s.lat*d)/d,S=this._map.getBearing(),I=this._map.getPitch();let P="";if(P+=e?`/${v}/${w}/${l}`:`${l}/${w}/${v}`,(S||I)&&(P+="/"+Math.round(10*S)/10),I&&(P+=`/${Math.round(I)}`),this._hashName){const M=this._hashName;let B=!1;const j=window.location.hash.slice(1).split("&").map(q=>{const G=q.split("=")[0];return G===M?(B=!0,`${G}=${P}`):q}).filter(q=>q);return B||j.push(`${M}=${P}`),`#${j.join("&")}`}return`#${P}`}}const Hn={linearity:.3,easing:g.b8(0,0,.3,1)},Eu=g.e({deceleration:2500,maxSpeed:1400},Hn),va=g.e({deceleration:20,maxSpeed:1400},Hn),xa=g.e({deceleration:1e3,maxSpeed:360},Hn),Bl=g.e({deceleration:1e3,maxSpeed:90},Hn);class Xa{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:we.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,s=we.now();for(;e.length>0&&s-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new g.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:d}of this._inertiaBuffer)s.zoom+=d.zoomDelta||0,s.bearing+=d.bearingDelta||0,s.pitch+=d.pitchDelta||0,d.panDelta&&s.pan._add(d.panDelta),d.around&&(s.around=d.around),d.pinchAround&&(s.pinchAround=d.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(s.pan.mag()){const d=zs(s.pan.mag(),l,g.e({},Eu,e||{}));u.offset=s.pan.mult(d.amount/s.pan.mag()),u.center=this._map.transform.center,ds(u,d)}if(s.zoom){const d=zs(s.zoom,l,va);u.zoom=this._map.transform.zoom+d.amount,ds(u,d)}if(s.bearing){const d=zs(s.bearing,l,xa);u.bearing=this._map.transform.bearing+g.ac(d.amount,-179,179),ds(u,d)}if(s.pitch){const d=zs(s.pitch,l,Bl);u.pitch=this._map.transform.pitch+d.amount,ds(u,d)}if(u.zoom||u.bearing){const d=s.pinchAround===void 0?s.around:s.pinchAround;u.around=d?this._map.unproject(d):this._map.getCenter()}return this.clear(),g.e(u,{noMoveStart:!0})}}function ds(p,e){(!p.duration||p.duration<e.duration)&&(p.duration=e.duration,p.easing=e.easing)}function zs(p,e,s){const{maxSpeed:l,linearity:u,deceleration:d}=s,v=g.ac(p*u/(e/1e3),-l,l),w=Math.abs(v)/(d*u);return{easing:s.easing,duration:1e3*w,amount:v*(w/2)}}class Mr extends g.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l,u={}){const d=he.mousePos(s.getCanvas(),l),v=s.unproject(d);super(e,g.e({point:d,lngLat:v,originalEvent:l},u)),this._defaultPrevented=!1,this.target=s}}class uo extends g.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l){const u=e==="touchend"?l.changedTouches:l.touches,d=he.touchPos(s.getCanvasContainer(),u),v=d.map(S=>s.unproject(S)),w=d.reduce((S,I,P,M)=>S.add(I.div(M.length)),new g.P(0,0));super(e,{points:d,point:w,lngLats:v,lngLat:s.unproject(w),originalEvent:l}),this._defaultPrevented=!1}}class Ol extends g.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l){super(e,{originalEvent:l}),this._defaultPrevented=!1}}class Vi{constructor(e,s){this._map=e,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Ol(e.type,this._map,e))}mousedown(e,s){return this._mousedownPos=s,this._firePreventable(new Mr(e.type,this._map,e))}mouseup(e){this._map.fire(new Mr(e.type,this._map,e))}click(e,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new Mr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Mr(e.type,this._map,e))}mouseover(e){this._map.fire(new Mr(e.type,this._map,e))}mouseout(e){this._map.fire(new Mr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new uo(e.type,this._map,e))}touchmove(e){this._map.fire(new uo(e.type,this._map,e))}touchend(e){this._map.fire(new uo(e.type,this._map,e))}touchcancel(e){this._map.fire(new uo(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class co{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Mr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Mr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Mr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _r{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(g.P.convert(e),this._map.terrain)}}class Ka{constructor(e,s){this._map=e,this._tr=new _r(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,s){this.isEnabled()&&e.shiftKey&&e.button===0&&(he.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(e,s){if(!this._active)return;const l=s;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=l,this._box||(this._box=he.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const d=Math.min(u.x,l.x),v=Math.max(u.x,l.x),w=Math.min(u.y,l.y),S=Math.max(u.y,l.y);he.setTransform(this._box,`translate(${d}px,${w}px)`),this._box.style.width=v-d+"px",this._box.style.height=S-w+"px"}mouseupWindow(e,s){if(!this._active||e.button!==0)return;const l=this._startPos,u=s;if(this.reset(),he.suppressClick(),l.x!==u.x||l.y!==u.y)return this._map.fire(new g.k("boxzoomend",{originalEvent:e})),{cameraAnimation:d=>d.fitScreenCoordinates(l,u,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(he.remove(this._box),this._box=null),he.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,s){return this._map.fire(new g.k(e,{originalEvent:s}))}}function wa(p,e){if(p.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${p.length}, points ${e.length}`);const s={};for(let l=0;l<p.length;l++)s[p[l].identifier]=e[l];return s}class As{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,s,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),l.length===this.numTouches&&(this.centroid=function(u){const d=new g.P(0,0);for(const v of u)d._add(v);return d.div(u.length)}(s),this.touches=wa(l,s)))}touchmove(e,s,l){if(this.aborted||!this.centroid)return;const u=wa(l,s);for(const d in this.touches){const v=u[d];(!v||v.dist(this.touches[d])>30)&&(this.aborted=!0)}}touchend(e,s,l){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class ps{constructor(e){this.singleTap=new As(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,s,l){this.singleTap.touchstart(e,s,l)}touchmove(e,s,l){this.singleTap.touchmove(e,s,l)}touchend(e,s,l){const u=this.singleTap.touchend(e,s,l);if(u){const d=e.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(u)<30;if(d&&v||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class Vo{constructor(e){this._tr=new _r(e),this._zoomIn=new ps({numTouches:1,numTaps:2}),this._zoomOut=new ps({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,s,l){this._zoomIn.touchstart(e,s,l),this._zoomOut.touchstart(e,s,l)}touchmove(e,s,l){this._zoomIn.touchmove(e,s,l),this._zoomOut.touchmove(e,s,l)}touchend(e,s,l){const u=this._zoomIn.touchend(e,s,l),d=this._zoomOut.touchend(e,s,l),v=this._tr;return u?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(u)},{originalEvent:e})}):d?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(d)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class jo{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const s=this._moveFunction(...e);if(s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(e,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=s.length?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,s){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const u=s.length?s[0]:s;return!this._moved&&u.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=u,this._move(l,u))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&he.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ic={0:1,2:2};class ho{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const s=he.mouseButton(e);this._eventButton=s}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(s,l){const u=Ic[l];return s.buttons===void 0||(s.buttons&u)!==u}(e,this._eventButton)}isValidEndEvent(e){return he.mouseButton(e)===this._eventButton}}class Cu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const Ja=p=>{p.mousedown=p.dragStart,p.mousemoveWindow=p.dragMove,p.mouseup=p.dragEnd,p.contextmenu=e=>{e.preventDefault()}},Nl=({enable:p,clickTolerance:e,bearingDegreesPerPixelMoved:s=.8})=>{const l=new ho({checkCorrectEvent:u=>he.mouseButton(u)===0&&u.ctrlKey||he.mouseButton(u)===2});return new jo({clickTolerance:e,move:(u,d)=>({bearingDelta:(d.x-u.x)*s}),moveStateManager:l,enable:p,assignEvents:Ja})},li=({enable:p,clickTolerance:e,pitchDegreesPerPixelMoved:s=-.5})=>{const l=new ho({checkCorrectEvent:u=>he.mouseButton(u)===0&&u.ctrlKey||he.mouseButton(u)===2});return new jo({clickTolerance:e,move:(u,d)=>({pitchDelta:(d.y-u.y)*s}),moveStateManager:l,enable:p,assignEvents:Ja})};class Vl{constructor(e,s){this._clickTolerance=e.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new g.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,s,l){return this._calculateTransform(e,s,l)}touchmove(e,s,l){if(this._active){if(!this._shouldBePrevented(l.length))return e.preventDefault(),this._calculateTransform(e,s,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,s,l){this._calculateTransform(e,s,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,s,l){l.length>0&&(this._active=!0);const u=wa(l,s),d=new g.P(0,0),v=new g.P(0,0);let w=0;for(const I in u){const P=u[I],M=this._touches[I];M&&(d._add(P),v._add(P.sub(M)),w++,u[I]=P)}if(this._touches=u,this._shouldBePrevented(w)||!v.mag())return;const S=v.div(w);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:d.div(w),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,s,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([s[0],s[1]]))}touchmove(e,s,l){if(!this._firstTwoTouches)return;e.preventDefault();const[u,d]=this._firstTwoTouches,v=Ds(l,s,u),w=Ds(l,s,d);if(!v||!w)return;const S=this._aroundCenter?null:v.add(w).div(2);return this._move([v,w],S,e)}touchend(e,s,l){if(!this._firstTwoTouches)return;const[u,d]=this._firstTwoTouches,v=Ds(l,s,u),w=Ds(l,s,d);v&&w||(this._active&&he.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ds(p,e,s){for(let l=0;l<p.length;l++)if(p[l].identifier===s)return e[l]}function jl(p,e){return Math.log(p/e)/Math.LN2}class Ya extends Uo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,s){const l=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(jl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:jl(this._distance,l),pinchAround:s}}}function $o(p,e){return 180*p.angleWith(e)/Math.PI}class ba extends Uo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,s,l){const u=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:$o(this._vector,u),pinchAround:s}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const s=25/(Math.PI*this._minDiameter)*360,l=$o(e,this._startVector);return Math.abs(l)<s}}function Pn(p){return Math.abs(p.y)>Math.abs(p.x)}class Ul extends Uo{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,s,l){super.touchstart(e,s,l),this._currentTouchCount=l.length}_start(e){this._lastPoints=e,Pn(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,s,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const u=e[0].sub(this._lastPoints[0]),d=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(u,d,l.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(u.y+d.y)/2*-.5}):void 0}gestureBeginsVertically(e,s,l){if(this._valid!==void 0)return this._valid;const u=e.mag()>=2,d=s.mag()>=2;if(!u&&!d)return;if(!u||!d)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const v=e.y>0==s.y>0;return Pn(e)&&Pn(s)&&v}}const Wn={panStep:100,bearingStep:15,pitchStep:10};class Xn{constructor(e){this._tr=new _r(e);const s=Wn;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let s=0,l=0,u=0,d=0,v=0;switch(e.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:e.shiftKey?l=-1:(e.preventDefault(),d=-1);break;case 39:e.shiftKey?l=1:(e.preventDefault(),d=1);break;case 38:e.shiftKey?u=1:(e.preventDefault(),v=-1);break;case 40:e.shiftKey?u=-1:(e.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(l=0,u=0),{cameraAnimation:w=>{const S=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:Pu,zoom:s?Math.round(S.zoom)+s*(e.shiftKey?2:1):S.zoom,bearing:S.bearing+l*this._bearingStep,pitch:S.pitch+u*this._pitchStep,offset:[-d*this._panStep,-v*this._panStep],center:S.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Pu(p){return p*(2-p)}const rn=4.000244140625;class fs{constructor(e,s){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=e,this._tr=new _r(e),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let s=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const l=we.now(),u=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,s!==0&&s%rn==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(u*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),e.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=e,this._delta-=s,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=he.mousePos(this._map.getCanvas(),e),l=this._tr;this._around=s.y>l.transform.height/2-l.transform.getHorizon()?g.N.convert(this._aroundCenter?l.center:l.unproject(s)):g.N.convert(l.center),this._aroundPoint=l.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>rn?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&I!==0&&(I=1/I);const P=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(P*I))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,l=this._startZoom,u=this._easing;let d,v=!1;const w=we.now()-this._lastWheelEventTime;if(this._type==="wheel"&&l&&u&&w){const S=Math.min(w/200,1),I=u(S);d=g.y.number(l,s,I),S<1?this._frameId||(this._frameId=!0):v=!0}else d=s,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!v,zoomDelta:d-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let s=g.b9;if(this._prevEase){const l=this._prevEase,u=(we.now()-l.start)/l.duration,d=l.easing(u+.01)-l.easing(u),v=.27/Math.sqrt(d*d+1e-4)*.01,w=Math.sqrt(.0729-v*v);s=g.b8(v,w,.25,1)}return this._prevEase={start:we.now(),duration:e,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class $l{constructor(e,s){this._clickZoom=e,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Mu{constructor(e){this._tr=new _r(e),this.reset()}reset(){this._active=!1}dblclick(e,s){return e.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zu{constructor(){this._tap=new ps({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,s,l){if(!this._swipePoint)if(this._tapTime){const u=s[0],d=e.timeStamp-this._tapTime<500,v=this._tapPoint.dist(u)<30;d&&v?l.length>0&&(this._swipePoint=u,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(e,s,l)}touchmove(e,s,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const u=s[0],d=u.y-this._swipePoint.y;return this._swipePoint=u,e.preventDefault(),this._active=!0,{zoomDelta:d/128}}}else this._tap.touchmove(e,s,l)}touchend(e,s,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const u=this._tap.touchend(e,s,l);u&&(this._tapTime=e.timeStamp,this._tapPoint=u)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ql{constructor(e,s,l){this._el=e,this._mousePan=s,this._touchPan=l}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Au{constructor(e,s,l){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=s,this._mousePitch=l}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class qo{constructor(e,s,l,u){this._el=e,this._touchZoom=s,this._touchRotate=l,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ms{constructor(e,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=he.create("div","maplibregl-cooperative-gesture-screen",e);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),u=document.createElement("div");u.className="maplibregl-desktop-message",u.textContent=s,this._container.appendChild(u);const d=document.createElement("div");d.className="maplibregl-mobile-message",d.textContent=l,this._container.appendChild(d),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(he.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,s){this._enabled&&(this._map.fire(new g.k("cooperativegestureprevented",{gestureType:e,originalEvent:s})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Je=p=>p.zoom||p.drag||p.pitch||p.rotate;class Zl extends g.k{}function Mn(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Du{constructor(e,s){this.handleWindowEvent=u=>{this.handleEvent(u,`${u.type}Window`)},this.handleEvent=(u,d)=>{if(u.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=u.type==="renderFrame"?void 0:u,w={needsRenderFrame:!1},S={},I={},P=u.touches,M=P?this._getMapTouches(P):void 0,B=M?he.touchPos(this._map.getCanvas(),M):he.mousePos(this._map.getCanvas(),u);for(const{handlerName:G,handler:X,allowed:Y}of this._handlers){if(!X.isEnabled())continue;let ie;this._blockedByActive(I,Y,G)?X.reset():X[d||u.type]&&(ie=X[d||u.type](u,B,M),this.mergeHandlerResult(w,S,ie,G,v),ie&&ie.needsRenderFrame&&this._triggerRenderFrame()),(ie||X.isActive())&&(I[G]=X)}const j={};for(const G in this._previousActiveHandlers)I[G]||(j[G]=v);this._previousActiveHandlers=I,(Object.keys(j).length||Mn(w))&&(this._changes.push([w,S,j]),this._triggerRenderFrame()),(Object.keys(I).length||Mn(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:q}=w;q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],q(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Xa(e),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,d,v]of this._listeners)he.addEventListener(u,d,u===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[e,s,l]of this._listeners)he.removeEventListener(e,s,e===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(e){const s=this._map,l=s.getCanvasContainer();this._add("mapEvent",new Vi(s,e));const u=s.boxZoom=new Ka(s,e);this._add("boxZoom",u),e.interactive&&e.boxZoom&&u.enable();const d=s.cooperativeGestures=new ms(s,e.cooperativeGestures);this._add("cooperativeGestures",d),e.cooperativeGestures&&d.enable();const v=new Vo(s),w=new Mu(s);s.doubleClickZoom=new $l(w,v),this._add("tapZoom",v),this._add("clickZoom",w),e.interactive&&e.doubleClickZoom&&s.doubleClickZoom.enable();const S=new zu;this._add("tapDragZoom",S);const I=s.touchPitch=new Ul(s);this._add("touchPitch",I),e.interactive&&e.touchPitch&&s.touchPitch.enable(e.touchPitch);const P=Nl(e),M=li(e);s.dragRotate=new Au(e,P,M),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",M,["mouseRotate"]),e.interactive&&e.dragRotate&&s.dragRotate.enable();const B=(({enable:ie,clickTolerance:H})=>{const oe=new ho({checkCorrectEvent:ce=>he.mouseButton(ce)===0&&!ce.ctrlKey});return new jo({clickTolerance:H,move:(ce,_e)=>({around:_e,panDelta:_e.sub(ce)}),activateOnStart:!0,moveStateManager:oe,enable:ie,assignEvents:Ja})})(e),j=new Vl(e,s);s.dragPan=new ql(l,B,j),this._add("mousePan",B),this._add("touchPan",j,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&s.dragPan.enable(e.dragPan);const q=new ba,G=new Ya;s.touchZoomRotate=new qo(l,G,q,S),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",G,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&s.touchZoomRotate.enable(e.touchZoomRotate);const X=s.scrollZoom=new fs(s,()=>this._triggerRenderFrame());this._add("scrollZoom",X,["mousePan"]),e.interactive&&e.scrollZoom&&s.scrollZoom.enable(e.scrollZoom);const Y=s.keyboard=new Xn(s);this._add("keyboard",Y),e.interactive&&e.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new co(s))}_add(e,s,l){this._handlers.push({handlerName:e,handler:s,allowed:l}),this._handlersById[e]=s}stop(e){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Je(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,s,l){for(const u in e)if(u!==l&&(!s||s.indexOf(u)<0))return!0;return!1}_getMapTouches(e){const s=[];for(const l of e)this._el.contains(l.target)&&s.push(l);return s}mergeHandlerResult(e,s,l,u,d){if(!l)return;g.e(e,l);const v={handlerName:u,originalEvent:l.originalEvent||d};l.zoomDelta!==void 0&&(s.zoom=v),l.panDelta!==void 0&&(s.drag=v),l.pitchDelta!==void 0&&(s.pitch=v),l.bearingDelta!==void 0&&(s.rotate=v)}_applyChanges(){const e={},s={},l={};for(const[u,d,v]of this._changes)u.panDelta&&(e.panDelta=(e.panDelta||new g.P(0,0))._add(u.panDelta)),u.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+u.pitchDelta),u.around!==void 0&&(e.around=u.around),u.pinchAround!==void 0&&(e.pinchAround=u.pinchAround),u.noInertia&&(e.noInertia=u.noInertia),g.e(s,d),g.e(l,v);this._updateMapTransform(e,s,l),this._changes=[]}_updateMapTransform(e,s,l){const u=this._map,d=u._getTransformForUpdate(),v=u.terrain;if(!(Mn(e)||v&&this._terrainMovement))return this._fireEvents(s,l,!0);let{panDelta:w,zoomDelta:S,bearingDelta:I,pitchDelta:P,around:M,pinchAround:B}=e;B!==void 0&&(M=B),u._stop(!0),M=M||u.transform.centerPoint;const j=d.pointLocation(w?M.sub(w):M);I&&(d.bearing+=I),P&&(d.pitch+=P),S&&(d.zoom+=S),v?this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?d.center=d.pointLocation(d.centerPoint.sub(w)):d.setLocationAtPoint(j,M):(this._terrainMovement=!0,this._map._elevationFreeze=!0,d.setLocationAtPoint(j,M)):d.setLocationAtPoint(j,M),u._applyUpdatedTransform(d),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(s,l,!0)}_fireEvents(e,s,l){const u=Je(this._eventsInProgress),d=Je(e),v={};for(const M in e){const{originalEvent:B}=e[M];this._eventsInProgress[M]||(v[`${M}start`]=B),this._eventsInProgress[M]=e[M]}!u&&d&&this._fireEvent("movestart",d.originalEvent);for(const M in v)this._fireEvent(M,v[M]);d&&this._fireEvent("move",d.originalEvent);for(const M in e){const{originalEvent:B}=e[M];this._fireEvent(M,B)}const w={};let S;for(const M in this._eventsInProgress){const{handlerName:B,originalEvent:j}=this._eventsInProgress[M];this._handlersById[B].isActive()||(delete this._eventsInProgress[M],S=s[B]||j,w[`${M}end`]=S)}for(const M in w)this._fireEvent(M,w[M]);const I=Je(this._eventsInProgress),P=(u||d)&&!I;if(P&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const M=this._map._getTransformForUpdate();M.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(M)}if(l&&P){this._updatingCamera=!0;const M=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;!M||!M.essential&&we.prefersReducedMotion?(this._map.fire(new g.k("moveend",{originalEvent:S})),B(this._map.getBearing())&&this._map.resetNorth()):(B(M.bearing||this._map.getBearing())&&(M.bearing=0),M.freezeElevation=!0,this._map.easeTo(M,{originalEvent:S})),this._updatingCamera=!1}}_fireEvent(e,s){this._map.fire(new g.k(e,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new Zl("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class gs extends g.E{constructor(e,s){super(),this._renderFrameCallback=()=>{const l=Math.min((we.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=s.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new g.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,s){return this.jumpTo({center:e},s)}panBy(e,s,l){return e=g.P.convert(e).mult(-1),this.panTo(this.transform.center,g.e({offset:e},s),l)}panTo(e,s,l){return this.easeTo(g.e({center:e},s),l)}getZoom(){return this.transform.zoom}setZoom(e,s){return this.jumpTo({zoom:e},s),this}zoomTo(e,s,l){return this.easeTo(g.e({zoom:e},s),l)}zoomIn(e,s){return this.zoomTo(this.getZoom()+1,e,s),this}zoomOut(e,s){return this.zoomTo(this.getZoom()-1,e,s),this}getBearing(){return this.transform.bearing}setBearing(e,s){return this.jumpTo({bearing:e},s),this}getPadding(){return this.transform.padding}setPadding(e,s){return this.jumpTo({padding:e},s),this}rotateTo(e,s,l){return this.easeTo(g.e({bearing:e},s),l)}resetNorth(e,s){return this.rotateTo(0,g.e({duration:1e3},e),s),this}resetNorthPitch(e,s){return this.easeTo(g.e({bearing:0,pitch:0,duration:1e3},e),s),this}snapToNorth(e,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,s):this}getPitch(){return this.transform.pitch}setPitch(e,s){return this.jumpTo({pitch:e},s),this}cameraForBounds(e,s){e=be.convert(e).adjustAntiMeridian();const l=s&&s.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),l,s)}_cameraForBoxAndBearing(e,s,l,u){const d={top:0,bottom:0,right:0,left:0};if(typeof(u=g.e({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const je=u.padding;u.padding={top:je,bottom:je,right:je,left:je}}u.padding=g.e(d,u.padding);const v=this.transform,w=v.padding,S=new be(e,s),I=v.project(S.getNorthWest()),P=v.project(S.getNorthEast()),M=v.project(S.getSouthEast()),B=v.project(S.getSouthWest()),j=g.ba(-l),q=I.rotate(j),G=P.rotate(j),X=M.rotate(j),Y=B.rotate(j),ie=new g.P(Math.max(q.x,G.x,Y.x,X.x),Math.max(q.y,G.y,Y.y,X.y)),H=new g.P(Math.min(q.x,G.x,Y.x,X.x),Math.min(q.y,G.y,Y.y,X.y)),oe=ie.sub(H),ce=(v.width-(w.left+w.right+u.padding.left+u.padding.right))/oe.x,_e=(v.height-(w.top+w.bottom+u.padding.top+u.padding.bottom))/oe.y;if(_e<0||ce<0)return void g.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Ce=Math.min(v.scaleZoom(v.scale*Math.min(ce,_e)),u.maxZoom),Le=g.P.convert(u.offset),Ve=new g.P((u.padding.left-u.padding.right)/2,(u.padding.top-u.padding.bottom)/2).rotate(g.ba(l)),We=Le.add(Ve).mult(v.scale/v.zoomScale(Ce));return{center:v.unproject(I.add(M).div(2).sub(We)),zoom:Ce,bearing:l}}fitBounds(e,s,l){return this._fitInternal(this.cameraForBounds(e,s),s,l)}fitScreenCoordinates(e,s,l,u,d){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(g.P.convert(e)),this.transform.pointLocation(g.P.convert(s)),l,u),u,d)}_fitInternal(e,s,l){return e?(delete(s=g.e(e,s)).padding,s.linear?this.easeTo(s,l):this.flyTo(s,l)):this}jumpTo(e,s){this.stop();const l=this._getTransformForUpdate();let u=!1,d=!1,v=!1;return"zoom"in e&&l.zoom!==+e.zoom&&(u=!0,l.zoom=+e.zoom),e.center!==void 0&&(l.center=g.N.convert(e.center)),"bearing"in e&&l.bearing!==+e.bearing&&(d=!0,l.bearing=+e.bearing),"pitch"in e&&l.pitch!==+e.pitch&&(v=!0,l.pitch=+e.pitch),e.padding==null||l.isPaddingEqual(e.padding)||(l.padding=e.padding),this._applyUpdatedTransform(l),this.fire(new g.k("movestart",s)).fire(new g.k("move",s)),u&&this.fire(new g.k("zoomstart",s)).fire(new g.k("zoom",s)).fire(new g.k("zoomend",s)),d&&this.fire(new g.k("rotatestart",s)).fire(new g.k("rotate",s)).fire(new g.k("rotateend",s)),v&&this.fire(new g.k("pitchstart",s)).fire(new g.k("pitch",s)).fire(new g.k("pitchend",s)),this.fire(new g.k("moveend",s))}calculateCameraOptionsFromTo(e,s,l,u=0){const d=g.Z.fromLngLat(e,s),v=g.Z.fromLngLat(l,u),w=v.x-d.x,S=v.y-d.y,I=v.z-d.z,P=Math.hypot(w,S,I);if(P===0)throw new Error("Can't calculate camera options with same From and To");const M=Math.hypot(w,S),B=this.transform.scaleZoom(this.transform.cameraToCenterDistance/P/this.transform.tileSize),j=180*Math.atan2(w,-S)/Math.PI;let q=180*Math.acos(M/P)/Math.PI;return q=I<0?90-q:90+q,{center:v.toLngLat(),zoom:B,pitch:q,bearing:j}}easeTo(e,s){var l;this._stop(!1,e.easeId),((e=g.e({offset:[0,0],duration:500,easing:g.b9},e)).animate===!1||!e.essential&&we.prefersReducedMotion)&&(e.duration=0);const u=this._getTransformForUpdate(),d=u.zoom,v=u.bearing,w=u.pitch,S=u.padding,I="bearing"in e?this._normalizeBearing(e.bearing,v):v,P="pitch"in e?+e.pitch:w,M="padding"in e?e.padding:u.padding,B=g.P.convert(e.offset);let j=u.centerPoint.add(B);const q=u.pointLocation(j),{center:G,zoom:X}=u.getConstrained(g.N.convert(e.center||q),(l=e.zoom)!==null&&l!==void 0?l:d);this._normalizeCenter(G,u);const Y=u.project(q),ie=u.project(G).sub(Y),H=u.zoomScale(X-d);let oe,ce;e.around&&(oe=g.N.convert(e.around),ce=u.locationPoint(oe));const _e={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||X!==d,this._rotating=this._rotating||v!==I,this._pitching=this._pitching||P!==w,this._padding=!u.isPaddingEqual(M),this._easeId=e.easeId,this._prepareEase(s,e.noMoveStart,_e),this.terrain&&this._prepareElevation(G),this._ease(Ce=>{if(this._zooming&&(u.zoom=g.y.number(d,X,Ce)),this._rotating&&(u.bearing=g.y.number(v,I,Ce)),this._pitching&&(u.pitch=g.y.number(w,P,Ce)),this._padding&&(u.interpolatePadding(S,M,Ce),j=u.centerPoint.add(B)),this.terrain&&!e.freezeElevation&&this._updateElevation(Ce),oe)u.setLocationAtPoint(oe,ce);else{const Le=u.zoomScale(u.zoom-d),Ve=X>d?Math.min(2,H):Math.max(.5,H),We=Math.pow(Ve,1-Ce),je=u.unproject(Y.add(ie.mult(Ce*We)).mult(Le));u.setLocationAtPoint(u.renderWorldCopies?je.wrap():je,j)}this._applyUpdatedTransform(u),this._fireMoveEvents(s)},Ce=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s,Ce)},e),this}_prepareEase(e,s,l={}){this._moving=!0,s||l.moving||this.fire(new g.k("movestart",e)),this._zooming&&!l.zooming&&this.fire(new g.k("zoomstart",e)),this._rotating&&!l.rotating&&this.fire(new g.k("rotatestart",e)),this._pitching&&!l.pitching&&this.fire(new g.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&s!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(l-(s-(l*e+this._elevationStart))/(1-e)),this._elevationTarget=s}this.transform.elevation=g.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const s=e.getCameraPosition(),l=this.terrain.getElevationForLngLatZoom(s.lngLat,e.zoom);if(s.altitude<l){const u=this.calculateCameraOptionsFromTo(s.lngLat,l,e.center,e.elevation);return{pitch:u.pitch,zoom:u.zoom}}return{}}_applyUpdatedTransform(e){const s=[];if(this.terrain&&s.push(u=>this._elevateCameraIfInsideTerrain(u)),this.transformCameraUpdate&&s.push(u=>this.transformCameraUpdate(u)),!s.length)return;const l=e.clone();for(const u of s){const d=l.clone(),{center:v,zoom:w,pitch:S,bearing:I,elevation:P}=u(d);v&&(d.center=v),w!==void 0&&(d.zoom=w),S!==void 0&&(d.pitch=S),I!==void 0&&(d.bearing=I),P!==void 0&&(d.elevation=P),l.apply(d)}this.transform.apply(l)}_fireMoveEvents(e){this.fire(new g.k("move",e)),this._zooming&&this.fire(new g.k("zoom",e)),this._rotating&&this.fire(new g.k("rotate",e)),this._pitching&&this.fire(new g.k("pitch",e))}_afterEase(e,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const l=this._zooming,u=this._rotating,d=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,l&&this.fire(new g.k("zoomend",e)),u&&this.fire(new g.k("rotateend",e)),d&&this.fire(new g.k("pitchend",e)),this.fire(new g.k("moveend",e))}flyTo(e,s){var l;if(!e.essential&&we.prefersReducedMotion){const Ge=g.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ge,s)}this.stop(),e=g.e({offset:[0,0],speed:1.2,curve:1.42,easing:g.b9},e);const u=this._getTransformForUpdate(),d=u.zoom,v=u.bearing,w=u.pitch,S=u.padding,I="bearing"in e?this._normalizeBearing(e.bearing,v):v,P="pitch"in e?+e.pitch:w,M="padding"in e?e.padding:u.padding,B=g.P.convert(e.offset);let j=u.centerPoint.add(B);const q=u.pointLocation(j),{center:G,zoom:X}=u.getConstrained(g.N.convert(e.center||q),(l=e.zoom)!==null&&l!==void 0?l:d);this._normalizeCenter(G,u);const Y=u.zoomScale(X-d),ie=u.project(q),H=u.project(G).sub(ie);let oe=e.curve;const ce=Math.max(u.width,u.height),_e=ce/Y,Ce=H.mag();if("minZoom"in e){const Ge=g.ac(Math.min(e.minZoom,d,X),u.minZoom,u.maxZoom),bt=ce/u.zoomScale(Ge-d);oe=Math.sqrt(bt/Ce*2)}const Le=oe*oe;function Ve(Ge){const bt=(_e*_e-ce*ce+(Ge?-1:1)*Le*Le*Ce*Ce)/(2*(Ge?_e:ce)*Le*Ce);return Math.log(Math.sqrt(bt*bt+1)-bt)}function We(Ge){return(Math.exp(Ge)-Math.exp(-Ge))/2}function je(Ge){return(Math.exp(Ge)+Math.exp(-Ge))/2}const Oe=Ve(!1);let it=function(Ge){return je(Oe)/je(Oe+oe*Ge)},St=function(Ge){return ce*((je(Oe)*(We(bt=Oe+oe*Ge)/je(bt))-We(Oe))/Le)/Ce;var bt},$e=(Ve(!0)-Oe)/oe;if(Math.abs(Ce)<1e-6||!isFinite($e)){if(Math.abs(ce-_e)<1e-6)return this.easeTo(e,s);const Ge=_e<ce?-1:1;$e=Math.abs(Math.log(_e/ce))/oe,St=()=>0,it=bt=>Math.exp(Ge*oe*bt)}return e.duration="duration"in e?+e.duration:1e3*$e/("screenSpeed"in e?+e.screenSpeed/oe:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=v!==I,this._pitching=P!==w,this._padding=!u.isPaddingEqual(M),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(G),this._ease(Ge=>{const bt=Ge*$e,wi=1/it(bt);u.zoom=Ge===1?X:d+u.scaleZoom(wi),this._rotating&&(u.bearing=g.y.number(v,I,Ge)),this._pitching&&(u.pitch=g.y.number(w,P,Ge)),this._padding&&(u.interpolatePadding(S,M,Ge),j=u.centerPoint.add(B)),this.terrain&&!e.freezeElevation&&this._updateElevation(Ge);const Mt=Ge===1?G:u.unproject(ie.add(H.mult(St(bt))).mult(wi));u.setLocationAtPoint(u.renderWorldCopies?Mt.wrap():Mt,j),this._applyUpdatedTransform(u),this._fireMoveEvents(s)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,s){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,s)}return e||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(e,s,l){l.animate===!1||l.duration===0?(e(1),s()):(this._easeStart=we.now(),this._easeOptions=l,this._onEaseFrame=e,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,s){e=g.b3(e,-180,180);const l=Math.abs(e-s);return Math.abs(e-360-s)<l&&(e-=360),Math.abs(e+360-s)<l&&(e+=360),e}_normalizeCenter(e,s){if(!s.renderWorldCopies||s.lngRange)return;const l=e.lng-s.center.lng;e.lng+=l>180?-360:l<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(g.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const Gr={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Zo{constructor(e=Gr){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=he.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=he.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=he.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){he.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,s){const l=this._map._getUIString(`AttributionControl.${s}`);e.title=l,e.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(u=>typeof u!="string"?"":u)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const s=this._map.style.sourceCaches;for(const u in s){const d=s[u];if(d.used||d.usedForTerrain){const v=d.getSource();v.attribution&&e.indexOf(v.attribution)<0&&e.push(v.attribution)}}e=e.filter(u=>String(u).trim()),e.sort((u,d)=>u.length-d.length),e=e.filter((u,d)=>{for(let v=d+1;v<e.length;v++)if(e[v].indexOf(u)>=0)return!1;return!0});const l=e.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,e.length?(this._innerContainer.innerHTML=l,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Pt{constructor(e={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const l=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=he.create("div","maplibregl-ctrl");const s=he.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){he.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Qa{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const s=++this._id;return this._queue.push({callback:e,id:s,cancelled:!1}),s}remove(e){const s=this._currentlyRunning,l=s?this._queue.concat(s):this._queue;for(const u of l)if(u.id===e)return void(u.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const l of s)if(!l.cancelled&&(l.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var dh=g.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Lu extends g.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,s){this.sourceCache.update(e,s),this._renderableTilesKeys=[];const l={};for(const u of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))l[u.key]=!0,this._renderableTilesKeys.push(u.key),this._tiles[u.key]||(u.posMatrix=new Float64Array(16),g.aP(u.posMatrix,0,g.X,0,g.X,0,1),this._tiles[u.key]=new Qs(u,this.tileSize));for(const u in this._tiles)l[u]||delete this._tiles[u]}freeRtt(e){for(const s in this._tiles){const l=this._tiles[s];(!e||l.tileID.equals(e)||l.tileID.isChildOf(e)||e.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const s={};for(const l of this._renderableTilesKeys){const u=this._tiles[l].tileID;if(u.canonical.equals(e.canonical)){const d=e.clone();d.posMatrix=new Float64Array(16),g.aP(d.posMatrix,0,g.X,0,g.X,0,1),s[l]=d}else if(u.canonical.isChildOf(e.canonical)){const d=e.clone();d.posMatrix=new Float64Array(16);const v=u.canonical.z-e.canonical.z,w=u.canonical.x-(u.canonical.x>>v<<v),S=u.canonical.y-(u.canonical.y>>v<<v),I=g.X>>v;g.aP(d.posMatrix,0,I,0,I,0,1),g.J(d.posMatrix,d.posMatrix,[-w*I,-S*I,0]),s[l]=d}else if(e.canonical.isChildOf(u.canonical)){const d=e.clone();d.posMatrix=new Float64Array(16);const v=e.canonical.z-u.canonical.z,w=e.canonical.x-(e.canonical.x>>v<<v),S=e.canonical.y-(e.canonical.y>>v<<v),I=g.X>>v;g.aP(d.posMatrix,0,g.X,0,g.X,0,1),g.J(d.posMatrix,d.posMatrix,[w*I,S*I,0]),g.K(d.posMatrix,d.posMatrix,[1/2**v,1/2**v,0]),s[l]=d}}return s}getSourceTile(e,s){const l=this.sourceCache._source;let u=e.overscaledZ-this.deltaZoom;if(u>l.maxzoom&&(u=l.maxzoom),u<l.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(u).key);let d=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!d||!d.dem)&&s)for(;u>=l.minzoom&&(!d||!d.dem);)d=this.sourceCache.getTileByID(e.scaledTo(u--).key);return d}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(s=>s.timeAdded>=e)}}class Go{constructor(e,s,l){this.painter=e,this.sourceCache=new Lu(s),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,s,l,u=g.X){var d;if(!(s>=0&&s<u&&l>=0&&l<u))return 0;const v=this.getTerrainData(e),w=(d=v.tile)===null||d===void 0?void 0:d.dem;if(!w)return 0;const S=function(q,G,X){var Y=G[0],ie=G[1];return q[0]=X[0]*Y+X[4]*ie+X[12],q[1]=X[1]*Y+X[5]*ie+X[13],q}([],[s/u*g.X,l/u*g.X],v.u_terrain_matrix),I=[S[0]*w.dim,S[1]*w.dim],P=Math.floor(I[0]),M=Math.floor(I[1]),B=I[0]-P,j=I[1]-M;return w.get(P,M)*(1-B)*(1-j)+w.get(P+1,M)*B*(1-j)+w.get(P,M+1)*(1-B)*j+w.get(P+1,M+1)*B*j}getElevationForLngLatZoom(e,s){if(!g.bb(s,e.wrap()))return 0;const{tileID:l,mercatorX:u,mercatorY:d}=this._getOverscaledTileIDFromLngLatZoom(e,s);return this.getElevation(l,u%g.X,d%g.X,g.X)}getElevation(e,s,l,u=g.X){return this.getDEMElevation(e,s,l,u)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const u=this.painter.context,d=new g.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Kt(u,d,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Kt(u,new g.R({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=g.an([])}const s=this.sourceCache.getSourceTile(e,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const u=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new Kt(u,s.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),s.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const l=s&&s+s.tileID.key+e.key;if(l&&!this._demMatrixCache[l]){const u=this.sourceCache.sourceCache._source.maxzoom;let d=e.canonical.z-s.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=u?d=e.canonical.z-u:g.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=e.canonical.x-(e.canonical.x>>d<<d),w=e.canonical.y-(e.canonical.y>>d<<d),S=g.bc(new Float64Array(16),[1/(g.X<<d),1/(g.X<<d),0]);g.J(S,S,[v*g.X,w*g.X,0]),this._demMatrixCache[e.key]={matrix:S,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(e){const s=this.painter,l=s.width/devicePixelRatio,u=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===u||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Kt(s.context,{width:l,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Kt(s.context,{width:l,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(l,u,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,l,u))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let d=0,v=0;d<this._coordsTextureSize;d++)for(let w=0;w<this._coordsTextureSize;w++,v+=4)s[v+0]=255&w,s[v+1]=255&d,s[v+2]=w>>8<<4|d>>8,s[v+3]=0;const l=new g.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),u=new Kt(e,l,e.gl.RGBA,{premultiply:!1});return u.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=u,u}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),l=this.painter.context,u=l.gl,d=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),v=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),u.readPixels(d,w-v-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null);const S=s[0]+(s[2]>>4<<8),I=s[1]+((15&s[2])<<8),P=this.coordsIndex[255-s[3]],M=P&&this.sourceCache.getTileByID(P);if(!M)return null;const B=this._coordsTextureSize,j=(1<<M.tileID.canonical.z)*B;return new g.Z((M.tileID.canonical.x*B+S)/j+M.tileID.wrap,(M.tileID.canonical.y*B+I)/j,this.getElevation(M.tileID,S,I,B))}depthAtPoint(e){const s=new Uint8Array(4),l=this.painter.context,u=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),u.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,s=new g.bd,l=new g.aY,u=this.meshSize,d=g.X/u,v=u*u;for(let M=0;M<=u;M++)for(let B=0;B<=u;B++)s.emplaceBack(B*d,M*d,0);for(let M=0;M<v;M+=u+1)for(let B=0;B<u;B++)l.emplaceBack(B+M,u+B+M+1,u+B+M+2),l.emplaceBack(B+M,u+B+M+2,B+M+1);const w=s.length,S=w+2*(u+1);for(const M of[0,1])for(let B=0;B<=u;B++)for(const j of[0,1])s.emplaceBack(B*d,M*g.X,j);for(let M=0;M<2*u;M+=2)l.emplaceBack(S+M,S+M+1,S+M+3),l.emplaceBack(S+M,S+M+3,S+M+2),l.emplaceBack(w+M,w+M+3,w+M+1),l.emplaceBack(w+M,w+M+2,w+M+3);const I=s.length,P=I+2*(u+1);for(const M of[0,1])for(let B=0;B<=u;B++)for(const j of[0,1])s.emplaceBack(M*g.X,B*d,j);for(let M=0;M<2*u;M+=2)l.emplaceBack(I+M,I+M+1,I+M+3),l.emplaceBack(I+M,I+M+3,I+M+2),l.emplaceBack(P+M,P+M+3,P+M+1),l.emplaceBack(P+M,P+M+2,P+M+3);return this._mesh=new Zr(e.createVertexBuffer(s,dh.members),e.createIndexBuffer(l),g.a0.simpleSegment(0,0,s.length,l.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*g.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,s){var l;const{tileID:u}=this._getOverscaledTileIDFromLngLatZoom(e,s);return(l=this.getMinMaxElevation(u).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(e){const s=this.getTerrainData(e).tile,l={minElevation:null,maxElevation:null};return s&&s.dem&&(l.minElevation=s.dem.min*this.exaggeration,l.maxElevation=s.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(e,s){const l=g.Z.fromLngLat(e.wrap()),u=(1<<s)*g.X,d=l.x*u,v=l.y*u,w=Math.floor(d/g.X),S=Math.floor(v/g.X);return{tileID:new g.S(s,0,s,w,S),mercatorX:d,mercatorY:v}}}class el{constructor(e,s,l){this._context=e,this._size=s,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new Kt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(l.texture),{id:e,fbo:s,texture:l,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(s=>e.id!==s),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const zn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Sa{constructor(e,s){this.painter=e,this.terrain=s,this.pool=new el(e.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(l=>!e._layers[l].isHidden(s)),this._coordsDescendingInv={};for(const l in e.sourceCaches){this._coordsDescendingInv[l]={};const u=e.sourceCaches[l].getVisibleCoordinates();for(const d of u){const v=this.terrain.sourceCache.getTerrainCoords(d);for(const w in v)this._coordsDescendingInv[l][w]||(this._coordsDescendingInv[l][w]=[]),this._coordsDescendingInv[l][w].push(v[w])}}this._coordsDescendingInvStr={};for(const l of e._order){const u=e._layers[l],d=u.source;if(zn[u.type]&&!this._coordsDescendingInvStr[d]){this._coordsDescendingInvStr[d]={};for(const v in this._coordsDescendingInv[d])this._coordsDescendingInvStr[d][v]=this._coordsDescendingInv[d][v].map(w=>w.key).sort().join()}}for(const l of this._renderableTiles)for(const u in this._coordsDescendingInvStr){const d=this._coordsDescendingInvStr[u][l.tileID.key];d&&d!==l.rttCoords[u]&&(l.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const s=e.type,l=this.painter,u=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(zn[s]&&(this._prevType&&zn[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(e.id),!u))return!0;if(zn[this._prevType]||zn[s]&&u){this._prevType=s;const d=this._stacks.length-1,v=this._stacks[d]||[];for(const w of this._renderableTiles){if(this.pool.isFull()&&(Rl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[d]){const I=this.pool.getObjectForId(w.rtt[d].id);if(I.stamp===w.rtt[d].stamp){this.pool.useObject(I);continue}}const S=this.pool.getOrCreateFreeObject();this.pool.useObject(S),this.pool.stampObject(S),w.rtt[d]={id:S.id,stamp:S.stamp},l.context.bindFramebuffer.set(S.fbo.framebuffer),l.context.clear({color:g.aM.transparent,stencil:0}),l.currentStencilSource=void 0;for(let I=0;I<v.length;I++){const P=l.style._layers[v[I]],M=P.source?this._coordsDescendingInv[P.source][w.tileID.key]:[w.tileID];l.context.viewport.set([0,0,S.fbo.width,S.fbo.height]),l._renderTileClippingMasks(P,M),l.renderLayer(l,l.style.sourceCaches[P.source],P,M),P.source&&(w.rttCoords[P.source]=this._coordsDescendingInvStr[P.source][w.tileID.key])}}return Rl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),zn[s]}return!1}}const Gl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ta=ze,Ls={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Gr,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:g.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Mi=p=>{p.touchstart=p.dragStart,p.touchmoveWindow=p.dragMove,p.touchend=p.dragEnd},zi={showCompass:!0,showZoom:!0,visualizePitch:!1};class nn{constructor(e,s,l=!1){this.mousedown=v=>{this.startMouse(g.e({},v,{ctrlKey:!0,preventDefault:()=>v.preventDefault()}),he.mousePos(this.element,v)),he.addEventListener(window,"mousemove",this.mousemove),he.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=v=>{this.moveMouse(v,he.mousePos(this.element,v))},this.mouseup=v=>{this.mouseRotate.dragEnd(v),this.mousePitch&&this.mousePitch.dragEnd(v),this.offTemp()},this.touchstart=v=>{v.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=he.touchPos(this.element,v.targetTouches)[0],this.startTouch(v,this._startPos),he.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),he.addEventListener(window,"touchend",this.touchend))},this.touchmove=v=>{v.targetTouches.length!==1?this.reset():(this._lastPos=he.touchPos(this.element,v.targetTouches)[0],this.moveTouch(v,this._lastPos))},this.touchend=v=>{v.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const u=e.dragRotate._mouseRotate.getClickTolerance(),d=e.dragRotate._mousePitch.getClickTolerance();this.element=s,this.mouseRotate=Nl({clickTolerance:u,enable:!0}),this.touchRotate=(({enable:v,clickTolerance:w,bearingDegreesPerPixelMoved:S=.8})=>{const I=new Cu;return new jo({clickTolerance:w,move:(P,M)=>({bearingDelta:(M.x-P.x)*S}),moveStateManager:I,enable:v,assignEvents:Mi})})({clickTolerance:u,enable:!0}),this.map=e,l&&(this.mousePitch=li({clickTolerance:d,enable:!0}),this.touchPitch=(({enable:v,clickTolerance:w,pitchDegreesPerPixelMoved:S=-.5})=>{const I=new Cu;return new jo({clickTolerance:w,move:(P,M)=>({pitchDelta:(M.y-P.y)*S}),moveStateManager:I,enable:v,assignEvents:Mi})})({clickTolerance:d,enable:!0})),he.addEventListener(s,"mousedown",this.mousedown),he.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),he.addEventListener(s,"touchcancel",this.reset)}startMouse(e,s){this.mouseRotate.dragStart(e,s),this.mousePitch&&this.mousePitch.dragStart(e,s),he.disableDrag()}startTouch(e,s){this.touchRotate.dragStart(e,s),this.touchPitch&&this.touchPitch.dragStart(e,s),he.disableDrag()}moveMouse(e,s){const l=this.map,{bearingDelta:u}=this.mouseRotate.dragMove(e,s)||{};if(u&&l.setBearing(l.getBearing()+u),this.mousePitch){const{pitchDelta:d}=this.mousePitch.dragMove(e,s)||{};d&&l.setPitch(l.getPitch()+d)}}moveTouch(e,s){const l=this.map,{bearingDelta:u}=this.touchRotate.dragMove(e,s)||{};if(u&&l.setBearing(l.getBearing()+u),this.touchPitch){const{pitchDelta:d}=this.touchPitch.dragMove(e,s)||{};d&&l.setPitch(l.getPitch()+d)}}off(){const e=this.element;he.removeEventListener(e,"mousedown",this.mousedown),he.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),he.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),he.removeEventListener(window,"touchend",this.touchend),he.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){he.enableDrag(),he.removeEventListener(window,"mousemove",this.mousemove),he.removeEventListener(window,"mouseup",this.mouseup),he.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),he.removeEventListener(window,"touchend",this.touchend)}}let Dt;function dr(p,e,s){const l=new g.N(p.lng,p.lat);if(p=new g.N(p.lng,p.lat),e){const u=new g.N(p.lng-360,p.lat),d=new g.N(p.lng+360,p.lat),v=s.locationPoint(p).distSqr(e);s.locationPoint(u).distSqr(e)<v?p=u:s.locationPoint(d).distSqr(e)<v&&(p=d)}for(;Math.abs(p.lng-s.center.lng)>180;){const u=s.locationPoint(p);if(u.x>=0&&u.y>=0&&u.x<=s.width&&u.y<=s.height)break;p.lng>s.center.lng?p.lng-=360:p.lng+=360}return p.lng!==l.lng&&s.locationPoint(p).y>s.height/2-s.getHorizon()?p:l}const Kn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function po(p,e,s){const l=p.classList;for(const u in Kn)l.remove(`maplibregl-${s}-anchor-${u}`);l.add(`maplibregl-${s}-anchor-${e}`)}class yr extends g.E{constructor(e){if(super(),this._onKeyPress=s=>{const l=s.code,u=s.charCode||s.keyCode;l!=="Space"&&l!=="Enter"&&u!==32&&u!==13||this.togglePopup()},this._onMapClick=s=>{const l=s.originalEvent.target,u=this._element;this._popup&&(l===u||u.contains(l))&&this.togglePopup()},this._update=s=>{var l;if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();((s==null?void 0:s.type)==="terrain"||(s==null?void 0:s.type)==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?dr(this._lngLat,this._flatPos,this._map.transform):(l=this._lngLat)===null||l===void 0?void 0:l.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(d=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let v="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?v="rotateX(0deg)":this._pitchAlignment==="map"&&(v=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||s&&s.type!=="moveend"||(this._pos=this._pos.round()),he.setTransform(this._element,`${Kn[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${v} ${d}`),we.frameAsync(new AbortController).then(()=>{this._updateOpacity(s&&s.type==="moveend")}).catch(()=>{})},this._onMove=s=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new g.k("dragstart"))),this.fire(new g.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new g.k("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=g.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=he.create("div");const s=he.createNS("http://www.w3.org/2000/svg","svg"),l=41,u=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${l}px`),s.setAttributeNS(null,"width",`${u}px`),s.setAttributeNS(null,"viewBox",`0 0 ${u} ${l}`);const d=he.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"stroke","none"),d.setAttributeNS(null,"stroke-width","1"),d.setAttributeNS(null,"fill","none"),d.setAttributeNS(null,"fill-rule","evenodd");const v=he.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const w=he.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const S=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Y of S){const ie=he.createNS("http://www.w3.org/2000/svg","ellipse");ie.setAttributeNS(null,"opacity","0.04"),ie.setAttributeNS(null,"cx","10.5"),ie.setAttributeNS(null,"cy","5.80029008"),ie.setAttributeNS(null,"rx",Y.rx),ie.setAttributeNS(null,"ry",Y.ry),w.appendChild(ie)}const I=he.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill",this._color);const P=he.createNS("http://www.w3.org/2000/svg","path");P.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),I.appendChild(P);const M=he.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"opacity","0.25"),M.setAttributeNS(null,"fill","#000000");const B=he.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),M.appendChild(B);const j=he.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(6.0, 7.0)"),j.setAttributeNS(null,"fill","#FFFFFF");const q=he.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const G=he.createNS("http://www.w3.org/2000/svg","circle");G.setAttributeNS(null,"fill","#000000"),G.setAttributeNS(null,"opacity","0.25"),G.setAttributeNS(null,"cx","5.5"),G.setAttributeNS(null,"cy","5.5"),G.setAttributeNS(null,"r","5.4999962");const X=he.createNS("http://www.w3.org/2000/svg","circle");X.setAttributeNS(null,"fill","#FFFFFF"),X.setAttributeNS(null,"cx","5.5"),X.setAttributeNS(null,"cy","5.5"),X.setAttributeNS(null,"r","5.4999962"),q.appendChild(G),q.appendChild(X),v.appendChild(w),v.appendChild(I),v.appendChild(M),v.appendChild(j),v.appendChild(q),s.appendChild(v),s.setAttributeNS(null,"height",l*this._scale+"px"),s.setAttributeNS(null,"width",u*this._scale+"px"),this._element.appendChild(s),this._offset=g.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()}),po(this._element,this._anchor,"marker"),e&&e.className)for(const s of e.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),he.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=g.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const u=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var s,l;if(!(!((s=this._map)===null||s===void 0)&&s.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const u=this._map,d=u.terrain.depthAtPoint(this._pos),v=u.terrain.getElevationForLngLatZoom(this._lngLat,u.transform.tileZoom);if(u.transform.lngLatToCameraDepth(this._lngLat,v)-d<.006)return void(this._element.style.opacity=this._opacity);const w=-this._offset.y/u.transform._pixelPerMeter,S=Math.sin(u.getPitch()*Math.PI/180)*w,I=u.terrain.depthAtPoint(new g.P(this._pos.x,this._pos.y-this._offset.y)),P=u.transform.lngLatToCameraDepth(this._lngLat,v+S)-I>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&P&&this._popup.remove(),this._element.style.opacity=P?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=g.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,s){return e===void 0&&s===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const tl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let il=0,Hr=!1;const Ho={maxWidth:100,unit:"metric"};function at(p,e,s){const l=s&&s.maxWidth||100,u=p._container.clientHeight/2,d=p.unproject([0,u]),v=p.unproject([l,u]),w=d.distanceTo(v);if(s&&s.unit==="imperial"){const S=3.2808*w;S>5280?st(e,l,S/5280,p._getUIString("ScaleControl.Miles")):st(e,l,S,p._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?st(e,l,w/1852,p._getUIString("ScaleControl.NauticalMiles")):w>=1e3?st(e,l,w/1e3,p._getUIString("ScaleControl.Kilometers")):st(e,l,w,p._getUIString("ScaleControl.Meters"))}function st(p,e,s,l){const u=function(d){const v=Math.pow(10,`${Math.floor(d)}`.length-1);let w=d/v;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(S){const I=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*I)/I}(w),v*w}(s);p.style.width=e*(u/s)+"px",p.innerHTML=`${u}&nbsp;${l}`}const Wo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},rl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function nl(p){if(p){if(typeof p=="number"){const e=Math.round(Math.abs(p)/Math.SQRT2);return{center:new g.P(0,0),top:new g.P(0,p),"top-left":new g.P(e,e),"top-right":new g.P(-e,e),bottom:new g.P(0,-p),"bottom-left":new g.P(e,-e),"bottom-right":new g.P(-e,-e),left:new g.P(p,0),right:new g.P(-p,0)}}if(p instanceof g.P||Array.isArray(p)){const e=g.P.convert(p);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:g.P.convert(p.center||[0,0]),top:g.P.convert(p.top||[0,0]),"top-left":g.P.convert(p["top-left"]||[0,0]),"top-right":g.P.convert(p["top-right"]||[0,0]),bottom:g.P.convert(p.bottom||[0,0]),"bottom-left":g.P.convert(p["bottom-left"]||[0,0]),"bottom-right":g.P.convert(p["bottom-right"]||[0,0]),left:g.P.convert(p.left||[0,0]),right:g.P.convert(p.right||[0,0])}}return nl(new g.P(0,0))}const sn=ze;D.AJAXError=g.bh,D.Evented=g.E,D.LngLat=g.N,D.MercatorCoordinate=g.Z,D.Point=g.P,D.addProtocol=g.bi,D.config=g.a,D.removeProtocol=g.bj,D.AttributionControl=Zo,D.BoxZoomHandler=Ka,D.CanvasSource=pn,D.CooperativeGesturesHandler=ms,D.DoubleClickZoomHandler=$l,D.DragPanHandler=ql,D.DragRotateHandler=Au,D.EdgeInsets=_a,D.FullscreenControl=class extends g.E{constructor(p={}){super(),this._onFullscreenChange=()=>{var e;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=s==null?void 0:s.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:g.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){he.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const p=this._fullscreenButton=he.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);he.create("span","maplibregl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new g.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new g.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},D.GeoJSONSource=ls,D.GeolocateControl=class extends g.E{constructor(p){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new g.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new g.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const s=new g.N(e.coords.longitude,e.coords.latitude),l=e.coords.accuracy,u=this._map.getBearing(),d=g.e({bearing:u},this.options.fitBoundsOptions),v=be.fromLngLat(s,l);this._map.fitBounds(v,d,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const s=new g.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Hr)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new g.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=he.create("button","maplibregl-ctrl-geolocate",this._container),he.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){g.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=he.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new yr({element:this._dotElement}),this._circleElement=he.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new yr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new g.k("trackuserlocationend")),this.fire(new g.k("userlocationlostfocus")))})}},this.options=g.e({},tl,p)}onAdd(p){return this._map=p,this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return g._(this,arguments,void 0,function*(e=!1){if(Dt!==void 0&&!e)return Dt;if(window.navigator.permissions===void 0)return Dt=!!window.navigator.geolocation,Dt;try{Dt=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Dt=!!window.navigator.geolocation}return Dt})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),he.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,il=0,Hr=!1}_isOutOfMapMaxBounds(p){const e=this._map.getMaxBounds(),s=p.coords;return e&&(s.longitude<e.getWest()||s.longitude>e.getEast()||s.latitude<e.getSouth()||s.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const p=this._map.getBounds(),e=p.getSouthEast(),s=p.getNorthEast(),l=e.distanceTo(s),u=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}trigger(){if(!this._setup)return g.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new g.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":il--,Hr=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new g.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new g.k("trackuserlocationstart")),this.fire(new g.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),il++,il>1?(p={maximumAge:6e5,timeout:0},Hr=!0):(p=this.options.positionOptions,Hr=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},D.Hash=kc,D.ImageSource=cs,D.KeyboardHandler=Xn,D.LngLatBounds=be,D.LogoControl=Pt,D.Map=class extends gs{constructor(p){g.bf.mark(g.bg.create);const e=Object.assign(Object.assign({},Ls),p);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new lo(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Qa,this._controls=[],this._mapId=g.a4(),this._contextLost=s=>{s.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new g.k("webglcontextlost",{originalEvent:s}))},this._contextRestored=s=>{this._setupPainter(),this.resize(),this._update(),this.fire(new g.k("webglcontextrestored",{originalEvent:s}))},this._onMapScroll=s=>{if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Gl),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=vt.addThrottleControl(()=>this.isMoving()),this._requestManager=new zt(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;const l=Fl(u=>{this._trackResize&&!this._removed&&(this.resize(u),this.redraw())},50);this._resizeObserver=new ResizeObserver(u=>{s?l(u):s=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Du(this,e),this._hash=e.hash&&new kc(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,g.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new Zo(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new Pt,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new g.k(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new g.k(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new g.k("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(p,e){if(e===void 0&&(e=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new g.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=p.onAdd(this);this._controls.push(p);const l=this._controlPositions[e];return e.indexOf("bottom")!==-1?l.insertBefore(s,l.firstChild):l.appendChild(s),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new g.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(p);return e>-1&&this._controls.splice(e,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}calculateCameraOptionsFromTo(p,e,s,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(p,e,s,l)}resize(p){var e;const s=this._containerDimensions(),l=s[0],u=s[1],d=this._getClampedPixelRatio(l,u);if(this._resizeCanvas(l,u,d),this.painter.resize(l,u,d),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const S=this._getClampedPixelRatio(l,u);this._resizeCanvas(l,u,S),this.painter.resize(l,u,S)}this.transform.resize(l,u),(e=this._requestedCameraState)===null||e===void 0||e.resize(l,u);const v=!this._moving;return v&&(this.stop(),this.fire(new g.k("movestart",p)).fire(new g.k("move",p))),this.fire(new g.k("resize",p)),v&&this.fire(new g.k("moveend",p)),this}_getClampedPixelRatio(p,e){const{0:s,1:l}=this._maxCanvasSize,u=this.getPixelRatio(),d=p*u,v=e*u;return Math.min(d>s?s/d:1,v>l?l/v:1)*u}getPixelRatio(){var p;return(p=this._overridePixelRatio)!==null&&p!==void 0?p:devicePixelRatio}setPixelRatio(p){this._overridePixelRatio=p,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(p){return this.transform.setMaxBounds(be.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}project(p){return this.transform.locationPoint(g.N.convert(p),this.style&&this.terrain)}unproject(p){return this.transform.pointLocation(g.P.convert(p),this.terrain)}isMoving(){var p;return this._moving||((p=this.handlers)===null||p===void 0?void 0:p.isMoving())}isZooming(){var p;return this._zooming||((p=this.handlers)===null||p===void 0?void 0:p.isZooming())}isRotating(){var p;return this._rotating||((p=this.handlers)===null||p===void 0?void 0:p.isRotating())}_createDelegatedListener(p,e,s){if(p==="mouseenter"||p==="mouseover"){let l=!1;return{layers:e,listener:s,delegates:{mousemove:d=>{const v=e.filter(S=>this.getLayer(S)),w=v.length!==0?this.queryRenderedFeatures(d.point,{layers:v}):[];w.length?l||(l=!0,s.call(this,new Mr(p,this,d.originalEvent,{features:w}))):l=!1},mouseout:()=>{l=!1}}}}if(p==="mouseleave"||p==="mouseout"){let l=!1;return{layers:e,listener:s,delegates:{mousemove:v=>{const w=e.filter(S=>this.getLayer(S));(w.length!==0?this.queryRenderedFeatures(v.point,{layers:w}):[]).length?l=!0:l&&(l=!1,s.call(this,new Mr(p,this,v.originalEvent)))},mouseout:v=>{l&&(l=!1,s.call(this,new Mr(p,this,v.originalEvent)))}}}}{const l=u=>{const d=e.filter(w=>this.getLayer(w)),v=d.length!==0?this.queryRenderedFeatures(u.point,{layers:d}):[];v.length&&(u.features=v,s.call(this,u),delete u.features)};return{layers:e,listener:s,delegates:{[p]:l}}}}_saveDelegatedListener(p,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(e)}_removeDelegatedListener(p,e,s){if(!this._delegatedListeners||!this._delegatedListeners[p])return;const l=this._delegatedListeners[p];for(let u=0;u<l.length;u++){const d=l[u];if(d.listener===s&&d.layers.length===e.length&&d.layers.every(v=>e.includes(v))){for(const v in d.delegates)this.off(v,d.delegates[v]);return void l.splice(u,1)}}}on(p,e,s){if(s===void 0)return super.on(p,e);const l=this._createDelegatedListener(p,typeof e=="string"?[e]:e,s);this._saveDelegatedListener(p,l);for(const u in l.delegates)this.on(u,l.delegates[u]);return this}once(p,e,s){if(s===void 0)return super.once(p,e);const l=typeof e=="string"?[e]:e,u=this._createDelegatedListener(p,l,s);for(const d in u.delegates){const v=u.delegates[d];u.delegates[d]=(...w)=>{this._removeDelegatedListener(p,l,s),v(...w)}}this._saveDelegatedListener(p,u);for(const d in u.delegates)this.once(d,u.delegates[d]);return this}off(p,e,s){return s===void 0?super.off(p,e):(this._removeDelegatedListener(p,typeof e=="string"?[e]:e,s),this)}queryRenderedFeatures(p,e){if(!this.style)return[];let s;const l=p instanceof g.P||Array.isArray(p),u=l?p:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(l?{}:p)||{},u instanceof g.P||typeof u[0]=="number")s=[g.P.convert(u)];else{const d=g.P.convert(u[0]),v=g.P.convert(u[1]);s=[d,new g.P(v.x,d.y),v,new g.P(d.x,v.y),d]}return this.style.queryRenderedFeatures(s,e,this.transform)}querySourceFeatures(p,e){return this.style.querySourceFeatures(p,e)}setStyle(p,e){return(e=g.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(p,e))}setTransformRequest(p){return this._requestManager.setTransformRequest(p),this}_getUIString(p){const e=this._locale[p];if(e==null)throw new Error(`Missing UI string '${p}'`);return e}_updateStyle(p,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(p,e));const s=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!p)),p?(this.style=new wl(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p,e,s):this.style.loadJSON(p,e,s),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new wl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,e){if(typeof p=="string"){const s=this._requestManager.transformRequest(p,"Style");g.h(s,new AbortController).then(l=>{this._updateDiff(l.data,e)}).catch(l=>{l&&this.fire(new g.j(l))})}else typeof p=="object"&&this._updateDiff(p,e)}_updateDiff(p,e){try{this.style.setState(p,e)&&this._update(!0)}catch(s){g.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(p,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():g.w("There is no style added to the map.")}addSource(p,e){return this._lazyInitEmptyStyle(),this.style.addSource(p,e),this._update(!0)}isSourceLoaded(p){const e=this.style&&this.style.sourceCaches[p];if(e!==void 0)return e.loaded();this.fire(new g.j(new Error(`There is no source with ID '${p}'`)))}setTerrain(p){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),p){const e=this.style.sourceCaches[p.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${p.source}`);this.terrain===null&&e.reload();for(const s in this.style._layers){const l=this.style._layers[s];l.type==="hillshade"&&l.source===p.source&&g.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Go(this.painter,e,p),this.painter.renderToTexture=new Sa(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=s=>{s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==p.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new g.k("terrain",{terrain:p})),this}getTerrain(){var p,e;return(e=(p=this.terrain)===null||p===void 0?void 0:p.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const p=this.style&&this.style.sourceCaches;for(const e in p){const s=p[e]._tiles;for(const l in s){const u=s[l];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}removeSource(p){return this.style.removeSource(p),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,e,s={}){const{pixelRatio:l=1,sdf:u=!1,stretchX:d,stretchY:v,content:w,textFitWidth:S,textFitHeight:I}=s;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||g.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new g.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:P,height:M,data:B}=e,j=e;return this.style.addImage(p,{data:new g.R({width:P,height:M},new Uint8Array(B)),pixelRatio:l,stretchX:d,stretchY:v,content:w,textFitWidth:S,textFitHeight:I,sdf:u,version:0,userImage:j}),j.onAdd&&j.onAdd(this,p),this}}{const{width:P,height:M,data:B}=we.getImageData(e);this.style.addImage(p,{data:new g.R({width:P,height:M},B),pixelRatio:l,stretchX:d,stretchY:v,content:w,textFitWidth:S,textFitHeight:I,sdf:u,version:0})}}updateImage(p,e){const s=this.style.getImage(p);if(!s)return this.fire(new g.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=e instanceof HTMLImageElement||g.b(e)?we.getImageData(e):e,{width:u,height:d,data:v}=l;if(u===void 0||d===void 0)return this.fire(new g.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==s.data.width||d!==s.data.height)return this.fire(new g.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(e instanceof HTMLImageElement||g.b(e));return s.data.replace(v,w),this.style.updateImage(p,s),this}getImage(p){return this.style.getImage(p)}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new g.j(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p){return vt.getImage(this._requestManager.transformRequest(p,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(p,e){return this._lazyInitEmptyStyle(),this.style.addLayer(p,e),this._update(!0)}moveLayer(p,e){return this.style.moveLayer(p,e),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(p,e,s){return this.style.setLayerZoomRange(p,e,s),this._update(!0)}setFilter(p,e,s={}){return this.style.setFilter(p,e,s),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,e,s,l={}){return this.style.setPaintProperty(p,e,s,l),this._update(!0)}getPaintProperty(p,e){return this.style.getPaintProperty(p,e)}setLayoutProperty(p,e,s,l={}){return this.style.setLayoutProperty(p,e,s,l),this._update(!0)}getLayoutProperty(p,e){return this.style.getLayoutProperty(p,e)}setGlyphs(p,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(p,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(p,e,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(p,e,s,l=>{l||this._update(!0)}),this}removeSprite(p){return this._lazyInitEmptyStyle(),this.style.removeSprite(p),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(p,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(p,e,s=>{s||this._update(!0)}),this}setLight(p,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(p){return this._lazyInitEmptyStyle(),this.style.setSky(p),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(p,e){return this.style.setFeatureState(p,e),this._update()}removeFeatureState(p,e){return this.style.removeFeatureState(p,e),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let p=0,e=0;return this._container&&(p=this._container.clientWidth||400,e=this._container.clientHeight||300),[p,e]}_setupContainer(){const p=this._container;p.classList.add("maplibregl-map");const e=this._canvasContainer=he.create("div","maplibregl-canvas-container",p);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=he.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),l=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],l);const u=this._controlContainer=he.create("div","maplibregl-control-container",p),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{d[v]=he.create("div",`maplibregl-ctrl-${v} `,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,e,s){this._canvas.width=Math.floor(s*p),this._canvas.height=Math.floor(s*e),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const p={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{e={requestedAttributes:p},l&&(e.statusMessage=l.statusMessage,e.type=l.type)},{once:!0});const s=this._canvas.getContext("webgl2",p)||this._canvas.getContext("webgl",p);if(!s){const l="Failed to initialize WebGL";throw e?(e.message=l,new Error(JSON.stringify(e))):new Error(l)}this.painter=new ao(s,this.transform),Zt.testSupport(s)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_render(p){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const u=this.transform.zoom,d=we.now();this.style.zoomHistory.update(u,d);const v=new g.z(u,{now:d,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),w=v.crossFadingFactor();w===1&&w===this._crossFadingFactor||(s=!0,this._crossFadingFactor=w),this.style.update(v)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new g.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,g.bf.mark(g.bg.load),this.fire(new g.k("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const l=this._sourcesDirty||this._styleDirty||this._placementDirty;return l||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new g.k("idle")),!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,g.bf.mark(g.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var p;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),vt.removeThrottleControl(this._imageQueueHandle),(p=this._resizeObserver)===null||p===void 0||p.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),he.remove(this._canvasContainer),he.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),g.bf.clearMetrics(),this._removed=!0,this.fire(new g.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,we.frameAsync(this._frameRequest).then(p=>{g.bf.frame(p),this._frameRequest=null,this._render(p)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get version(){return Ta}getCameraTargetElevation(){return this.transform.elevation}},D.MapMouseEvent=Mr,D.MapTouchEvent=uo,D.MapWheelEvent=Ol,D.Marker=yr,D.NavigationControl=class{constructor(p){this._updateZoomButtons=()=>{const e=this._map.getZoom(),s=e===this._map.getMaxZoom(),l=e===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,s)=>{const l=this._map._getUIString(`NavigationControl.${s}`);e.title=l,e.setAttribute("aria-label",l)},this.options=g.e({},zi,p),this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),he.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),he.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=he.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new nn(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){he.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,e){const s=he.create("button",p,this._container);return s.type="button",s.addEventListener("click",e),s}},D.Popup=class extends g.E{constructor(p){super(),this.remove=()=>(this._content&&he.remove(this._content),this._container&&(he.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new g.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var s;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=he.create("div","maplibregl-popup",this._map.getContainer()),this._tip=he.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?dr(this._lngLat,this._flatPos,this._map.transform):(s=this._lngLat)===null||s===void 0?void 0:s.wrap(),this._trackPointer&&!e)return;const l=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let u=this.options.anchor;const d=nl(this.options.offset);if(!u){const w=this._container.offsetWidth,S=this._container.offsetHeight;let I;I=l.y+d.bottom.y<S?["top"]:l.y>this._map.transform.height-S?["bottom"]:[],l.x<w/2?I.push("left"):l.x>this._map.transform.width-w/2&&I.push("right"),u=I.length===0?"bottom":I.join("-")}let v=l.add(d[u]);this.options.subpixelPositioning||(v=v.round()),he.setTransform(this._container,`${Kn[u]} translate(${v.x}px,${v.y}px)`),po(this._container,u,"popup")},this._onClose=()=>{this.remove()},this.options=g.e(Object.create(Wo),p)}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new g.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=g.N.convert(p),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const e=document.createDocumentFragment(),s=document.createElement("body");let l;for(s.innerHTML=p;l=s.firstChild,l;)e.appendChild(l);return this.setDOMContent(e)}getMaxWidth(){var p;return(p=this._container)===null||p===void 0?void 0:p.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=he.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){return this._container&&this._container.classList.add(p),this}removeClassName(p){return this._container&&this._container.classList.remove(p),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){if(this._container)return this._container.classList.toggle(p)}setSubpixelPositioning(p){this.options.subpixelPositioning=p}_createCloseButton(){this.options.closeButton&&(this._closeButton=he.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(rl);p&&p.focus()}},D.RasterDEMTileSource=Ii,D.RasterTileSource=ei,D.ScaleControl=class{constructor(p){this._onMove=()=>{at(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,at(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Ho),p)}getDefaultPosition(){return"bottom-left"}onAdd(p){return this._map=p,this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){he.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},D.ScrollZoomHandler=fs,D.Style=wl,D.TerrainControl=class{constructor(p){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=p}onAdd(p){return this._map=p,this._container=he.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=he.create("button","maplibregl-ctrl-terrain",this._container),he.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){he.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},D.TwoFingersTouchPitchHandler=Ul,D.TwoFingersTouchRotateHandler=ba,D.TwoFingersTouchZoomHandler=Ya,D.TwoFingersTouchZoomRotateHandler=qo,D.VectorTileSource=oa,D.VideoSource=To,D.addSourceType=(p,e)=>g._(void 0,void 0,void 0,function*(){if(ko(p))throw new Error(`A source type called "${p}" already exists.`);((s,l)=>{aa[s]=l})(p,e)}),D.clearPrewarmedResources=function(){const p=Xt;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(Ot),Xt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},D.getMaxParallelImageRequests=function(){return g.a.MAX_PARALLEL_IMAGE_REQUESTS},D.getRTLTextPluginStatus=function(){return Jr().getRTLTextPluginStatus()},D.getVersion=function(){return sn},D.getWorkerCount=function(){return qt.workerCount},D.getWorkerUrl=function(){return g.a.WORKER_URL},D.importScriptInWorkers=function(p){return Ys().broadcast("IS",p)},D.prewarm=function(){vi().acquire(Ot)},D.setMaxParallelImageRequests=function(p){g.a.MAX_PARALLEL_IMAGE_REQUESTS=p},D.setRTLTextPlugin=function(p,e){return Jr().setRTLTextPlugin(p,e)},D.setWorkerCount=function(p){qt.workerCount=p},D.setWorkerUrl=function(p){g.a.WORKER_URL=p}});var Ie=$;return Ie})}($d)),$d.exports}var Ng=Og();const Lf=gm(Ng),Vg=37.5406,jg=55.6571,Ug=16,$g="3QiafPZ1H9X0Pm9cC6uA",qg=()=>{const A=Bf(),Z=Zp(Ie=>Ie.map.markers),$=Ir.useRef(null),ae=Ir.useRef(null),me=Ir.useRef({});return Ir.useEffect(()=>{A(Mg())},[A]),Ir.useEffect(()=>{ae.current||(ae.current=new Lf.Map({container:$.current,style:`https://api.maptiler.com/maps/streets-v2/style.json?key=${$g}`,center:[Vg,jg],zoom:Ug}),ae.current.on("click",Ie=>{if(Ie.originalEvent.target.closest(".maplibregl-marker"))return;const g=Ie.lngLat,ze={coordinates:{lng:g.lng,lat:g.lat}};A(Pg(ze))}))},[A]),Ir.useEffect(()=>{ae.current&&(Object.values(me.current).forEach(Ie=>Ie.remove()),me.current={},Z.forEach(Ie=>{const D=new Lf.Marker({color:"#FF0000"}).setLngLat(Ie.coordinates).addTo(ae.current);me.current[Ie.id]=D,D.getElement().addEventListener("click",()=>{A(Kf(Ie.id))})}))},[Z,A]),{mapContainer:$}},Zg=()=>{const{mapContainer:A}=qg();return Nr.jsx("div",{className:"map-wrap",children:Nr.jsx("div",{ref:A,className:"map"})})},Gg=()=>Nr.jsx("div",{className:"header",children:Nr.jsx("a",{href:"https://t.me/rinath52",target:"_blank",children:" "})});function Hg(){return Nr.jsx(Vm,{store:Ag,children:Nr.jsxs("div",{className:"app",children:[Nr.jsx(Gg,{}),Nr.jsxs("div",{className:"container",children:[Nr.jsx(Fg,{}),Nr.jsx(Zg,{})]})]})})}km.createRoot(document.getElementById("root")).render(Nr.jsx(Hg,{}));
